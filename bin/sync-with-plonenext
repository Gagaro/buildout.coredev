#!/usr/bin/env python
import os, sys, urllib2

script_location = os.path.abspath(sys.argv[0])
buildoutroot = os.path.dirname(script_location)
if buildoutroot.endswith("bin"):
    buildoutroot = os.path.dirname(buildoutroot)

outfile = open(os.path.join(buildoutroot, 'sources.cfg'), "w")

outfile.writelines("""\
#this file is generated by bin/sync-with-plonenext

[sources]
""")

def sources(infile):
    for line in infile:
        line = line.strip()
        if not line or line.startswith("#"):
            continue
        yield "%s = svn %s" % tuple(line.split())

print "Fetching sources from plonenext/3.3"
infile = urllib2.urlopen("https://svn.plone.org/svn/plone/plonenext/3.3/etc/sources")
print "Writing sources.cfg"
outfile.writelines("\n".join(sorted(sources(infile))))
outfile.close()
infile.close()


outfile = open(os.path.join(buildoutroot, 'versions.cfg'), "w")

outfile.writelines("""\
#this file is generated by bin/sync-with-plonenext

""")

print "Fetching versions.cfg from plonenext/3.3"
infile = urllib2.urlopen("https://svn.plone.org/svn/plone/plonenext/3.3/versions.cfg")
print "Writing versions.cfg"
outfile.write(infile.read())

outfile.close()
infile.close()
