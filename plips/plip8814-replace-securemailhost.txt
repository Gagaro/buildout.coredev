PLIP 8814: Replace SecureMailHost with a standard Zope mailhost
==============================================

This plip is ready for review.

Plip ticket: https://dev.plone.org/plone/ticket/8814

The final acceptance of this PLIP will likely be dependent on whether
changes to Products.MailHost that now live on Zope trunk are merged
for the final 2.12 release.

Plone no longer depends on SecureMailHost, though it now monkey
patches some SecureMailHost functionality into the Zope MailHost with
deprecation warnings.  The plone.app.upgrade package does depend on
SecureMailHost in order to migrate settings from existing SecureMailHost
instances.

Branches Made
-------------------

https://svn.plone.org/svn/plone/Plone/branches/plip8814-mailhost
https://svn.plone.org/svn/plone/plone.app.contentrules/branches/plip8814-mailhost
https://svn.plone.org/svn/plone/plone.app.upgrade/branches/plip8814-mailhost

The current implementation depends on Zope2 trunk as well, but
hopefully those will be merged for 2.12:

http://thread.gmane.org/gmane.comp.web.zope.devel/21366

Summary of changes
------------------

- Use MailHost instead of SecureMailHost on install

- Added migration of existing SecureMailHost instances to plone.app.upgrade

- Remove references to secureSend and other SecureMailHost API calls
  from Products.CMFPlone and plone.app.contentrules

- Fixed inconsistent tests in plone.app.controlpanel

- Add backwards compatibility patches to ensure 3rd party code that
  uses secureSend, validateSingleNormalizedEmailAddress,
  validateSingleEmailAddress, or validateEmailAddresses continues to
  work but produces deprecation warnings.

- Add deprecated import of EMAIL_RE and EMAIL_CUTOFF_RE, since those
  are essentially public APIs of SecureMailHost.

- Committed fixes to Products.MailHost on Zope trunk awaiting review
  for release with Zope 2.12.  The following issues were fixed:

  - Products.MailHost.MailHost makes it difficult to set a charset for
    the message

  - Products.MailHost.MailHost does not handle unicode messages.

  - Products.MailHost.MailHost treats message bodies with a ':' in them
    as headers!!

Tests
------

- New MailHost functionality in Zope2 has extensive tests.

- Some test changes were needed to correctly use MailHost for encoded emails

- Tests for the migration and portal setup were added.

- There are no tests for the BBB patches for SecureMailHost
  functionality, but they have been manually tested.

- The Zope2 trunk MailHost changes cause one cosmetic test failure in
  CMFDefault, due to its tests expecting automatic base64 encoding
  from python's email module, whereas the MailHost changes use
  quoted-printable by default.

- Using Zope2 trunk seems to cause a test import error in kss.core.
  This shouldn't matter as we won't actually depend on Zope2 trunk.

Needed documentation changes
----------------------------

- Document method deprecations


Backwards compatibility
-----------------------

No known issues.  Email encoded utf-8 will be transport encoded
Quoted-Printable instead of Base64 as a result of MailHost changes.


Credits
-------

Hanno Schlichting
Alec Mitchell
