PLIP 9352: Improved search results
===========================

PLIP ticket: http://dev.plone.org/plone/ticket/9352

Review by Ross Patterson (me@rpatterson.net, zenwryly on irc)

The PLIP was reviewed on Ubuntu 10.10 (Maverick) using python 2.6.6
and Google Chrome 9.0.


Review steps
------------

- Ran the plips/plip9352-search-results.cfg buildout.

- Ran "bin/test -s plone.app.search -s plone.app.contentlisting -s plone.app.upgrade -s plone.app.layout -s plonetheme.classic     -s plonetheme.sunburst -s plone.app.testing -s plone.testing".

- Created a new Plone site.

- Performed a number of searches, modified filters, search terms, etc..

- Examined code.


Notes and observations
----------------------

- I'm not sure that showing the relevance is as useless as the PLIP
  suggests.  Seeing that the most relevant result is just 10% relevant
  instead of 90% seems useful to me.

- Got one failure in the tests:

  Failure in test testDefaultJSIsInstalled (plone.app.upgrade.v41.tests.TestMigrations_v4_1alpha1)
  Traceback (most recent call last):
    File "/usr/lib/python2.6/unittest.py", line 279, in run
      testMethod()
    File "/home/xen/src/plone-coredev.svn/src/plone.app.upgrade/plone/app/upgrade/v41/tests.py", line 22, in testDefaultJSIsInstalled
      self.failUnless('search.js' in installedScriptIds)
    File "/usr/lib/python2.6/unittest.py", line 325, in failUnless
      if not expr: raise self.failureException, msg
  AssertionError

  Update: fixed.

- What is the current status of performance impact?

  Update: the ticket comments cover this well, bottom line performance
  seems better than the existing search form now.

- Ditto for everything in David's review.  Especially the bits about
  updating the links from liveSearch and the search portlet.

- The README.txt and description in setup.py are empty for
  plone.app.search.  These should have some minimal content at the
  very least, preferably they should explain the package for those who
  might want to re-use it.

- Has plone.app.search/docs/TODO.txt been updated to reflect current
  status?  Doesn't look like it.

- plone.app.search/setup.py declares only "setuptools" in
  install_requires, that can't be right.

  Update: fixed.

- When I open the advanced search/filters, it seems to be done as a
  separate page load.  Is there any reason this isn't just a hidden
  element that is shown when clicked to avoid the page load?

  Update: fixed by missing merge.

- Actually, I'm not seeing any AJAX behavior.  Every change to
  filters, search terms, sort order seems to result in another page
  load.  I thought AJAX update was part of this scope?  Was this
  changed per David's feedback?

  Update: AJAX now works thinks to spliter doing a missed merge he'd
  intended to do.  Works really well.

- Where is updated_search being used?  I can't find any references to
  it.  Is this related to some deprecation of AJAX behavior?

  Update: wasn't seeing the reference because the JS that uses it
  wasn't included before spliter's merge fix.

- The diffs of the relevant branches (IOW, changes other than
  plone.app.search itself) are quite long and involve a lot of merging
  so I wasn't able to review them in time.  I was able to review the
  plone.app.search code however, looks good.

- Test coverage on plone.app.search needs to be improved.

- The installation profile for plone.app.search shows up on the Plone
  site add form.  Firstly, it needs a clear and descriptive title and
  description.  Secondly, should it be showing up there at all?
  Wouldn't this be part of the default Plone install?

  Update: fixed.

- It occurrs to me that this PLIP could have and probably should have
  re-used the plone.app.querystring package created for
  plone.app.collection which provides their AJAX search query
  building.  The stuff used by plone.app.collection is pretty slick
  and we should avoid multiple ways of doing things.  It seems like
  this ship has already sailed so it may be too late but I wanted to
  note it.

Conclusion
----------

The work here is a vast improvement and I'm +1 on merging.  We should
fix the links from liveSearch and the search portlet.  The
documentation in README.txt and the setup.py description should also
be written.

See my review of PLIP #9327 for concerns about
plone.app.contentlisting but I really hope we we find a way to address
those issues and merge this PLIP.
