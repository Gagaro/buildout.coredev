PLIP 9214: Support logins using e-mail address instead of user id
=================================================================

This plip is in progress.

Plip ticket: https://dev.plone.org/plone/ticket/9214


To do
-----

- Add the use_email_as_login property to the Site Setup.  The Security
  settings panel looks like a good match.

- migration: add the use_email_as_login property

- add tests

- test some scenarios where use_email_as_login is changed


Further ideas
-------------

Related ideas that may be nice to incorporate into this plip.

- Make email address case insensitive: you should always use lower
  case.

- In places where user ids are shown ('last modified by a@b.c') avoid
  showing the complete email address; perhaps just show the part
  before the '@' sign.  Also see plip 9305: Use real names instead of
  usernames.

- Offer migration of current login names to email addresses.


Summary of changes
------------------

- Basically the patches from
  http://svn.plone.org/svn/collective/collective.emaillogin/trunk have
  been merged.

- Added site_properties/use_email_as_login; default False.

- Independent from the use_email_as_login setting we allow the '@'
  sign in login names.  See _ALLOWED_MEMBER_ID_PATTERN in
  Products/CMFPlone/RegistrationTool.py

- When use_email_as_login is true:

  - join form: user name field is not shown

  - join_form_validate.vpy: the filled in email address is added to
    the request as username: context.REQUEST.set('username', email)
    which means this address will be used as the user name and login
    name of the new member.

  - personalize.cpy calls Products.CMFPlone.utils:set_own_login_name
    to change the login name when the email address is changed.  Note
    that the user id never changes, so this is always the same as the
    initial email address.  You can always log in with your login name
    and with your user id.

  - Various labels and error messages are slightly changed, e.g. the
    login form and portlet do not show user name but e-mail.

  - Various methods in PasswordResetTool get the user by login name
    instead of user id.  If you have changed your email address a
    couple of times, then PasswordResetTool can handle requests from
    the first (which is the user id) and the last (which is the
    current login name).


Needed documentation changes
----------------------------

Documentation should describe this feature.  Something like this:

You can now allow users to use their email address as login name.
This feature can be switched on in the Security settings control
panel.  The effect is that on the registration form no field is shown
for the user name.  On the login form the user is now asked to fill in
an email address.


Backwards compatibility
-----------------------

The default setting is to *not* use the email address as the login
name, so the default behaviour is the same as in previous Plone
versions.  The exception is that '@' signs are now always allowed in
login names.  (Of course this is my hidden agenda for this plip: allow
myself to pick 'm@urits' as login name. ;-))


Credits
-------

Maurits van Rees
