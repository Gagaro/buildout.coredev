PLIP 9263: GenericSetup syntax for importing Sharing page roles
===============================================================

This is a basic review covering why I'm -1 on merging.

Export
------

The export functionality does not include the roles that come with Plone. It
appears that these are handled somewhat differently, being real, ephemeral
utilities at the zope root registry, rather that the vogue of on-the-fly
persistent utilities.

This causes the export functionality to miss out the roles that come with Plone,
making examples of the XML format difficult to come by and customisation more
confusing.

The generated GS output is:

.. source :: xml

    <?xml version="1.0"?>
    <sharing/>


Import
------

I modified the sharing.xml file in a snapshot of a clean site as follows:

.. source :: xml

    <?xml version="1.0"?>
    <sharing>
        <role
            id="MagicMan"
            title="Can perform magic"
            />
    </sharing>

and created that role in rolemap:

.. source :: xml

    <?xml version="1.0"?>
    <rolemap>
      <roles>
        <role name="Anonymous"/>
        <role name="Authenticated"/>
        <role name="Contributor"/>
        <role name="Editor"/>
        <role name="Manager"/>
        <role name="Member"/>
        <role name="Owner"/>
        <role name="Reader"/>
        <role name="MagicMan"/>
        <role name="Reviewer"/>
      </roles>
      <!-- ... -->
    </rolemap>

When attempting to reimport this profile it failed::

    Traceback (innermost last):
      Module ZPublisher.Publish, line 127, in publish
      Module ZPublisher.mapply, line 77, in mapply
      Module ZPublisher.Publish, line 47, in call_object
      Module Products.GenericSetup.tool, line 522, in manage_importAllSteps
      Module Products.GenericSetup.tool, line 331, in runAllImportStepsFromProfile
       - __traceback_info__: snapshot-snapshot-20091007022048
      Module Products.GenericSetup.tool, line 1085, in _runImportStepsFromContext
      Module Products.GenericSetup.tool, line 999, in _doRunImportStep
       - __traceback_info__: portlets
      Module plone.app.portlets.exportimport.portlets, line 707, in importPortlets
      Module Products.GenericSetup.utils, line 509, in _importBody
      Module plone.app.portlets.exportimport.portlets, line 205, in _importNode
      Module plone.app.portlets.exportimport.portlets, line 214, in _initProvider
      Module plone.app.portlets.exportimport.portlets, line 277, in _initPortlets
      Module plone.app.portlets.exportimport.portlets, line 439, in _initAssignmentNode
      Module plone.app.portlets.exportimport.portlets, line 82, in import_assignment
      Module plone.app.portlets.exportimport.portlets, line 124, in import_node
      Module plone.app.portlets.exportimport.portlets, line 162, in from_unicode
      Module zope.schema._field, line 302, in fromUnicode
      Module zope.schema._bootstrapfields, line 138, in validate
      Module zope.schema._field, line 318, in _validate
    ConstraintNotSatisfied

This second issue may well be a problem with my XML, but it's not immediately
obvious to me and it makes me worry that the import is fragile.

Conclusions
-----------

The design seems sane, but I'd like to see all registered utilities being
exported, not just the ones at the current component root, and some explanation
of why the import fails.
