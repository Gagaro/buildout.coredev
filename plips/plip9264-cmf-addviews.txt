PLIP 9263: Merge backport patches from plone.app.dexterity into Plone
=====================================================================

This plip is in progress.

PLIP ticket: https://dev.plone.org/plone/ticket/9264


To do
-----

- more testing
- we could remove the DWIM for supporting the IAdding view, since it's easy
  to use add_view_expr instead now, thereby simplifying the code - see below.

Summary of changes
------------------

CMF 2.2 includes an action in the 'folder/add' category, constructed from the
property 'add_view_expr', which is now available on all FTIs. This should be
used to give a URL for an add view.

This PLIP merges patches from plone.app.dexterity into plone.app.content
(FolderFactoriesView) and plone.app.contentmenu (FactoriesSubMenuItem) to
support this property.


Needed documentation changes
----------------------------

We should make it clear that this property exists and is used by Plone. It
is already used by Dexterity, in conjunction with the ++add++ traversal
namespace.

We should deprecate the pattern of registering a view for IAdding (aka the 
'+' view) with the same name as the 'factory' property in the FTI. It'd be
better if third party types that used IAdding just used the add_view_expr,
e.g.::

    string:${folder_url}/+/my.factory

Backwards compatibility
-----------------------

The add menu now constructs a URL for a type using the following rules:

 * If an add_view_expr is set, use that
 * Otherwise, if an IAdding-style view exists, use that
 * Otherwise, fall back on a URL using createObject
 
IAdding support (registering a view for the '+' view with the same name as
the factory set in the FTI) remains a viable option for compatibility, but
does introduce a slight performance and complexity overhead. If desired, we
could remove this support and demand that people use use add_view_expr to
achieve the same thing. The changes required are very simple, as documented
above.

Credits
-------

Martin Aspeli
