PLIP 11300: Switch to HTML 5 
============================

PLIP ticket: https://dev.plone.org/plone/ticket/11300

Review #2 by Alec Mitchell (alecpm@gmail.com, alecm on irc)

The PLIP was reviewed on Mac OS X 10.6.7 using python 2.6.6 and Google
Chrome 12.0.742.100.


Review steps
------------

- Ran buildout with plip11300-switch-to-html5.cfg.

- Reviewed code differences from trunk in Products.CMFPlone

- Reviewed code differences from trunk in plone.app.layout

- Reviewed code differences from trunk in plonetheme.sunburst

- Ran tests for Products.CMFPlone.

- Ran tests for plone.app.layout.

- Ran tests for plonetheme.sunburst.

- Started instance.

- Ran front page html (logged-in and anonymous) through
  html5.validator.nu and w3c validators.

- Added RR and kss.core branches and plone.app.kss trunk to
  auto-checkout config.

- Re-ran validators.

- Tested KSS functionality.

- Ran tests for plone.app.kss.

- Ran tests for kss.core.

- Checked standard buildout with SVN versions of KSS packages to
  determine source of KSS errors.


Notes and observations
----------------------
- As Rob noted the version pin for GenericSetup seems strange.  Is
  this an accident?

- The main html tag appears to be inside of an IE conditional comment,
  but with some additional comment elements in the middle.  This
  smells a bit like a browser hack to me. The latest updates to the
  Paul Irish link appears to be a little cleaner.  They include an IE9
  class just in case, and also use a !(IE) condition (if only for
  additional clarity).  The current conditional tags are a little
  confusing, even if they work and validate.

- The changes in plone.app.layout look reasonable.

- The changes in plonetheme.sunburst look reasonable, but there's a
  merge confilct line hanging around in CHANGES.txt

- Validation passed with the exception of the "kinetic-stylesheet" custom
  rel attribute.

- There is one trivial test failure in
  Products.CMFPlone.tests.testMigrationTool.TestMigrationTool.testDoUpgrades.
  There were no other test failures in any of the relevant packages.

- The w3c validator complains about the http-equiv="Content-Type" meta
  tag, the KSS link rel attributes, and the use of an undeclared
  &mdash; entity in the page title.

- The html5.validator.nu validator complains only about the KSS link
  rel attributes.

- Apparently there are branches of ResourceRegistries and kss.core
  that should have been included in the PLIP configuration.
  Additionally, plone.app.kss trunk should have been included in the
  configuration.  Using these branches fixes the all of the validation
  errors.  Unfortunately, KSS features appear to no longer work when
  the kss.core branch is included (404 error on kssValidateField).
  Including archetypes.kss trunk in the PLIP config does not appear to
  correct the issue.

- Using the standard buildout.cfg with plone.app.kss, kss.core and
  archtypes.kss trunk results in the same KSS errors.  However,
  reverting the recent changes to plone.app.kss trunk related to this
  PLIP appears to remedy the problem.

Conclusion
----------

I think this PLIP is nearly ready for merge.  The test failure isn't a
major concern since the metadata version will inevitably be updated
numerous times before 4.2 is released.  The ResourceRegistries and
kss.core branches along with plone.app.kss trunk should be included in
the PLIP config, so that they aren't forgotten at merge and release
time.  Whatever is causing KSS failures needs to be addressed though,
since it appears to be related to this PLIP.

I'd like to see a cleaner/clearer version of the conditional comment
hack on the html tag, but it's not a blocker.  The link in the sourc
provides what appear to be some nice improvements over the current
implementation.

Denys's explanation about the use of modernizr, combined with the fact
that it's already being relied upon by another PLIP, leaves me
satisfied with its inclusion.
