[buildout]
extends = buildout.cfg
parts +=
    xmltest
    xmlalltests
    coverage-report
    pylint
    zptlint
    zptlint-test
    
[xmltest]
recipe = collective.xmltestreport
eggs =
    ${test:eggs}
defaults = ['--auto-color', '--auto-progress']

[xmlalltests]
recipe = plone.recipe.alltests
package-map = ${alltests:package-map}
groups = ${alltests:groups}
exclude = ${alltests:exclude}
test-script = ${buildout:bin-directory}/xmltest

[zptlint]
recipe = zc.recipe.egg
eggs =
   zptlint
entry-points = zptlint=zptlint:run

[zptlint-test]
recipe = collective.recipe.template
input = inline:
    #!/bin/sh
    if [ -e zptlint.log ]; then
      echo "Old zptlint.log file removed"
      rm zptlint.log
    fi
    echo "Running zptlint-test"
    for pkg in ${buildout:package-directories}
    do
        find $pkg -regex ".*\.[c|z]?pt" | xargs bin/zptlint | perl -p -e 's/\s+$/ /g;s/\s+/ /g;s/\*{3}s?/\n/g' >> zptlint.log
    done
output = ${buildout:directory}/bin/zptlint-test
mode = 755

[pylint]
recipe = zc.recipe.egg
eggs =
    pylint
    ${instance:eggs}
entry-points = pylint=pylint.lint:Run
arguments = [
        '--output-format=parseable',
        '--zope=y',
        '--reports=n',
        '--disable=E0611,F0401,W0232,E1101,C0103',
        '--generated-members=objects',
        ] + sys.argv[1:]

# Disable messages:
# E0611:No name %r in module %r. Used when a name cannot be found in a module.
# F0401:Unable to import %r (%s). Used when pylint has been unable to import a module.
# W0232:Class has no __init__ method. Used when a class has no __init__ method, neither its parent classes.
# C0103:Invalid name "%s" (should match %s). Used when the name doesn't match the regular expression associated to its type (constant, variable, class...).