Repository: mockup


Branch: refs/heads/master
Date: 2015-09-08T10:02:27-05:00
Author: Sam Schwartz (obct537) <schwas45@uwosh.edu>
Commit: https://github.com/plone/mockup/commit/7abceda044e3a94ce7ee101af5e308dc4bf65324

Fixed issue causing filemanager paths being set to '/undefined'

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 4939f4f..1d661f9 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -593,7 +593,9 @@ define([
       if (path !== '/'){
         path += '/';
       }
-      return path + node.name;
+
+      var name = (node.name !== undefined) ? node.name : '';
+      return path + name;
     },
     getFolderPath: function(node){
       var self = this;


Repository: mockup


Branch: refs/heads/master
Date: 2015-09-08T10:02:41-05:00
Author: Sam Schwartz (obct537) <schwas45@uwosh.edu>
Commit: https://github.com/plone/mockup/commit/841531c9b0a2f99ee6b18b032b8af14d88979b78

Filemanager will no longer save over folders

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 1d661f9..3689d7e 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -222,7 +222,7 @@ define([
 
       self._save = function() {
 
-        var path = self.getNodePath();
+        var path = $('.active', self.$tabs).data('path');
         if( path === undefined ) {
           alert("No file selected.");
           return;
@@ -230,12 +230,12 @@ define([
         self.doAction('saveFile', {
           type: 'POST',
           data: {
-            path: self.getNodePath(),
+            path: path,
             data: self.ace.editor.getValue(),
             _authenticator: utils.getAuthenticator()
           },
           success: function(data) {
-            $('[data-path="' + self.getNodePath() + '"]').removeClass("modified");
+            $('[data-path="' + path + '"]').removeClass("modified");
           }
         });
       };


Repository: mockup


Branch: refs/heads/master
Date: 2015-09-08T10:03:00-05:00
Author: Sam Schwartz (obct537) <schwas45@uwosh.edu>
Commit: https://github.com/plone/mockup/commit/b8557fbaafc86f9de9b7835834388e63da4427ce

Thememapper popups now close when clicking elsewhere

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 3689d7e..704a679 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -272,6 +272,25 @@ define([
       self.tree = new Tree(self.$tree, self.options.treeConfig);
       self.$editor = self.$('.editor');
 
+      /* close popovers when clicking away */
+      $(document).click(function(e){
+          var $el = $(e.target);
+          if(!$el.is(':visible')){
+              // ignore this, fake event trigger to element that is not visible
+              return;
+          }
+          if($el.is('a') || $el.parent().is('a')){
+              return;
+          }
+          var $popover = $('.popover:visible');
+          if($popover.length > 0 && !$.contains($popover[0], $el[0])){
+              var popover = $popover.data('component');
+              if(popover){
+                  popover.hide();
+              }
+          }
+      });
+
       self.$tree.bind('tree.select', function(e) {
         if( e.node === null ) {
           self.toggleButtons(false);


Repository: mockup


Branch: refs/heads/master
Date: 2015-09-08T10:04:11-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/79a804e01905da6cf76db3ee02cf0a105c0cbe71

Filemanager no longer sets path to / after a delete

Files changed:
M mockup/patterns/filemanager/js/delete.js

diff --git a/mockup/patterns/filemanager/js/delete.js b/mockup/patterns/filemanager/js/delete.js
index e8da2f1..ef60adc 100644
--- a/mockup/patterns/filemanager/js/delete.js
+++ b/mockup/patterns/filemanager/js/delete.js
@@ -45,10 +45,11 @@ define([
                 self.app.$tree.tree('openNode', node);
             }
 
+            self.app.closeActiveTab();
+
             delete self.app.fileData[self.data.path];
             delete self.data;
           });
-          self.app.closeTab(data.path);
           self.app.resizeEditor();
         }
       });


Repository: mockup


Branch: refs/heads/master
Date: 2015-09-08T10:05:22-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/de3150522737a70ada203e4a47e1480e74d607ec

Updated changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 59e7da5..e2b9c57 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,12 @@ Changelog
 2.0.8 (Unreleased)
 ------------------
 
+- Fixed issue causing folders to be overwritten in the thememapper 
+  [obct537]
+
+- Thememapper popups now close when the user clicks somewhere else 
+  [obct537]
+
 - Add option to use tinyMCE inline on a contenteditable div. The pattern
   creates the contenteditable div from the textarea, copies it's content to it
   and handles saving changed data back to the textarea on form submit.


Repository: mockup


Branch: refs/heads/master
Date: 2015-09-08T12:20:08-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/6ec7f323e7cdd576990aad3081a10ab372445674

Added rudimentary error checking

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 704a679..51a3a53 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -223,7 +223,7 @@ define([
       self._save = function() {
 
         var path = $('.active', self.$tabs).data('path');
-        if( path === undefined ) {
+        if( path === undefined || path === false ) {
           alert("No file selected.");
           return;
         }
@@ -235,6 +235,9 @@ define([
             _authenticator: utils.getAuthenticator()
           },
           success: function(data) {
+            if( data['error'] !== undefined ) {
+              alert("There was a problem saving the file.");
+            }
             $('[data-path="' + path + '"]').removeClass("modified");
           }
         });


Repository: mockup


Branch: refs/heads/master
Date: 2015-09-08T12:22:47-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/402d61eb3fb4c33c7bab4c54137a085bc5d98e1f

Merge pull request #570 from plone/pathing

Pathing

Files changed:
M CHANGES.rst
M mockup/patterns/filemanager/js/delete.js
M mockup/patterns/filemanager/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 59e7da5..e2b9c57 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,12 @@ Changelog
 2.0.8 (Unreleased)
 ------------------
 
+- Fixed issue causing folders to be overwritten in the thememapper 
+  [obct537]
+
+- Thememapper popups now close when the user clicks somewhere else 
+  [obct537]
+
 - Add option to use tinyMCE inline on a contenteditable div. The pattern
   creates the contenteditable div from the textarea, copies it's content to it
   and handles saving changed data back to the textarea on form submit.
diff --git a/mockup/patterns/filemanager/js/delete.js b/mockup/patterns/filemanager/js/delete.js
index e8da2f1..ef60adc 100644
--- a/mockup/patterns/filemanager/js/delete.js
+++ b/mockup/patterns/filemanager/js/delete.js
@@ -45,10 +45,11 @@ define([
                 self.app.$tree.tree('openNode', node);
             }
 
+            self.app.closeActiveTab();
+
             delete self.app.fileData[self.data.path];
             delete self.data;
           });
-          self.app.closeTab(data.path);
           self.app.resizeEditor();
         }
       });
diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 4939f4f..51a3a53 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -222,20 +222,23 @@ define([
 
       self._save = function() {
 
-        var path = self.getNodePath();
-        if( path === undefined ) {
+        var path = $('.active', self.$tabs).data('path');
+        if( path === undefined || path === false ) {
           alert("No file selected.");
           return;
         }
         self.doAction('saveFile', {
           type: 'POST',
           data: {
-            path: self.getNodePath(),
+            path: path,
             data: self.ace.editor.getValue(),
             _authenticator: utils.getAuthenticator()
           },
           success: function(data) {
-            $('[data-path="' + self.getNodePath() + '"]').removeClass("modified");
+            if( data['error'] !== undefined ) {
+              alert("There was a problem saving the file.");
+            }
+            $('[data-path="' + path + '"]').removeClass("modified");
           }
         });
       };
@@ -272,6 +275,25 @@ define([
       self.tree = new Tree(self.$tree, self.options.treeConfig);
       self.$editor = self.$('.editor');
 
+      /* close popovers when clicking away */
+      $(document).click(function(e){
+          var $el = $(e.target);
+          if(!$el.is(':visible')){
+              // ignore this, fake event trigger to element that is not visible
+              return;
+          }
+          if($el.is('a') || $el.parent().is('a')){
+              return;
+          }
+          var $popover = $('.popover:visible');
+          if($popover.length > 0 && !$.contains($popover[0], $el[0])){
+              var popover = $popover.data('component');
+              if(popover){
+                  popover.hide();
+              }
+          }
+      });
+
       self.$tree.bind('tree.select', function(e) {
         if( e.node === null ) {
           self.toggleButtons(false);
@@ -593,7 +615,9 @@ define([
       if (path !== '/'){
         path += '/';
       }
-      return path + node.name;
+
+      var name = (node.name !== undefined) ? node.name : '';
+      return path + name;
     },
     getFolderPath: function(node){
       var self = this;


