Repository: plone.locking


Branch: refs/heads/master
Date: 2015-09-05T23:18:36-04:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.locking/commit/7c4ef13ccb6f9e1fbccf773bbc896a20adec32e0

Pull settings from registry instead of site_properties

Files changed:
M plone/locking/lockable.py

diff --git a/plone/locking/lockable.py b/plone/locking/lockable.py
index bb51d59..ad967ec 100644
--- a/plone/locking/lockable.py
+++ b/plone/locking/lockable.py
@@ -4,9 +4,9 @@
 from persistent.dict import PersistentDict
 
 from zope.annotation.interfaces import IAnnotations
+from zope.component import getUtility
 
 from AccessControl import getSecurityManager
-from Products.CMFCore.utils import getToolByName
 from webdav.LockItem import LockItem
 
 from plone.locking.interfaces import IRefreshableLockable
@@ -39,10 +39,9 @@ def __init__(self, context):
     def lock(self, lock_type=STEALABLE_LOCK, children=False):
         settings = queryAdapter(self.context, ILockSettings)
         if settings is None:
-            # No context specific adapter, is this a Plone site?
-            pprops = getToolByName(self.context, 'portal_properties', None)
-            if pprops is not None and 'site_properties' in pprops.objectIds():
-                settings = pprops.site_properties
+            registry = getUtility(IRegistry)
+            settings = registry.forInterface(ISiteSchema,
+                                             prefix='plone')
         if settings is not None and settings.lock_on_ttw_edit is False:
             return
 


Repository: plone.locking


Branch: refs/heads/master
Date: 2015-09-05T23:24:54-04:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.locking/commit/efdfa52ce9781de0fbe37693fd8aed243b89ffe1

Add missing imports

Files changed:
M plone/locking/lockable.py

diff --git a/plone/locking/lockable.py b/plone/locking/lockable.py
index ad967ec..ddb94f5 100644
--- a/plone/locking/lockable.py
+++ b/plone/locking/lockable.py
@@ -9,6 +9,9 @@
 from AccessControl import getSecurityManager
 from webdav.LockItem import LockItem
 
+from plone.registry.interfaces import IRegistry
+from Products.CMFPlone.interfaces import ISiteSchema
+
 from plone.locking.interfaces import IRefreshableLockable
 from plone.locking.interfaces import INonStealableLock
 from plone.locking.interfaces import ITTWLockable


Repository: plone.locking


Branch: refs/heads/master
Date: 2015-09-06T15:17:44-04:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.locking/commit/c6654f3c41073e99b23ab4e578ae7891291adc76

Fix registry lookup to pull from the correct control panel schema

Files changed:
M plone/locking/lockable.py

diff --git a/plone/locking/lockable.py b/plone/locking/lockable.py
index ddb94f5..4d5ce68 100644
--- a/plone/locking/lockable.py
+++ b/plone/locking/lockable.py
@@ -10,7 +10,7 @@
 from webdav.LockItem import LockItem
 
 from plone.registry.interfaces import IRegistry
-from Products.CMFPlone.interfaces import ISiteSchema
+from Products.CMFPlone.interfaces import IEditingSchema
 
 from plone.locking.interfaces import IRefreshableLockable
 from plone.locking.interfaces import INonStealableLock
@@ -43,7 +43,7 @@ def lock(self, lock_type=STEALABLE_LOCK, children=False):
         settings = queryAdapter(self.context, ILockSettings)
         if settings is None:
             registry = getUtility(IRegistry)
-            settings = registry.forInterface(ISiteSchema,
+            settings = registry.forInterface(IEditingSchema,
                                              prefix='plone')
         if settings is not None and settings.lock_on_ttw_edit is False:
             return


Repository: plone.locking


Branch: refs/heads/master
Date: 2015-09-07T00:21:17-04:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.locking/commit/808844d06d6995754b10b4021620d4ff0fde89bf

Bump version, changelog

Files changed:
M CHANGES.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d915751..bc8ea6c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,10 +1,10 @@
 Changelog
 =========
 
-2.0.9 (unreleased)
+2.1.0 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Pull lock_on_ttw_edit setting from 
 
 
 2.0.8 (2015-07-20)
diff --git a/setup.py b/setup.py
index b0d5993..1ed1796 100644
--- a/setup.py
+++ b/setup.py
@@ -1,6 +1,6 @@
 from setuptools import setup, find_packages
 
-version = '2.0.9.dev0'
+version = '2.1.0.dev0'
 
 setup(name='plone.locking',
       version=version,


