Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-04-16T13:59:38+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/e69b118068c442183a1d4020aa0f43d6dc5c2b03

Cache results on view

Cache the results of the collection and folder view on the request. The
results might be called again by other packages to extract information on
the result list.

Files changed:
M docs/CHANGES.rst
M plone/app/contenttypes/browser/collection.py
M plone/app/contenttypes/browser/folder.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 304975b..05edf1b 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,6 +4,11 @@ Changelog
 1.2a8 (unreleased)
 ------------------
 
+- Cache the results of the collection and folder view on the request. The
+  results might be called again by other packages to extract information on the
+  result list.
+  [thet]
+
 - Don't batch the already batched collection results. Fixes #221.
   [thet]
 
diff --git a/plone/app/contenttypes/browser/collection.py b/plone/app/contenttypes/browser/collection.py
index 017b241..00487cd 100644
--- a/plone/app/contenttypes/browser/collection.py
+++ b/plone/app/contenttypes/browser/collection.py
@@ -16,6 +16,7 @@ def __init__(self, *args, **kwargs):
         self.collection_behavior = ICollection(context)
         self.b_size = self.collection_behavior.item_count
 
+    @memoize
     def results(self, **kwargs):
         """Return a content listing based result set with results from the
         collection query.
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 5005930..25fd160 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -42,6 +42,7 @@ def __init__(self, context, request):
         b_start = getattr(self.request, 'b_start', None)
         self.b_start = int(b_start) if b_start is not None else 0
 
+    @memoize
     def results(self, **kwargs):
         """Return a content listing based result set with contents of the
         folder.


