Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-26T20:13:35+02:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/Products.CMFPlone/commit/abc31095e9cd40e816299668ea20b7d813f9582a

Revert removal of portal_quickinstaller.installProducts

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/quickinstaller.pt
M Products/CMFPlone/controlpanel/browser/quickinstaller.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e4ada32..b289b53 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,10 @@ Changelog
 5.0b4 (unreleased)
 ----------------
 
+- Fix add-ons to be installed using CMFQuickInstaller (restore support
+  for Extensions/Install.py)
+  [datakurre]
+
 - Rename showEditableBorder to showToolbar and deprecate using
   disable_border and enable_border for enable_toolbar and disable_toolbar
   [vangheem]
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
index 1d3d1ed..d0ccf1d 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
@@ -131,7 +131,7 @@
                 <form action="install_products" method="post" class="pull-right">
                    <input type="hidden"
                            name="install_products:list"
-                           tal:attributes="value string:profile-${product/install_profile/id};" />
+                           tal:attributes="value pid;" />
                    <span i18n:translate="label_product_install_action">
                       <span i18n:name="install_button">
                          <input class="context"
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.py b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
index ea73ec7..a5ce2f8 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.py
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
@@ -203,20 +203,14 @@ def __call__(self):
 class InstallProductsView(BrowserView):
 
     def __call__(self):
-        """
-        Install products by running the default import steps
-        XXX: is this running all profiles?
-        """
-        setupTool = getToolByName(self.context, 'portal_setup')
-        profiles = self.request.get('install_products')
+        qi = getToolByName(self.context, 'portal_quickinstaller')
+        products = self.request.get('install_products')
         msg_type = 'info'
-        if profiles:
+        if products:
             messages = IStatusMessage(self.request)
-            for profile in profiles:
-                # TODO: find out where this is and don't run already
-                # activated profiles
-                setupTool.runAllImportStepsFromProfile(profile)
-                msg = _(u'Installed ${product}!', mapping={'product': profile})
+            for product in products:
+                qi.installProducts(products=[product, ])
+                msg = _(u'Installed ${product}!', mapping={'product': product})
                 messages.addStatusMessage(msg, type=msg_type)
 
         purl = getToolByName(self.context, 'portal_url')()
@@ -225,7 +219,6 @@ def __call__(self):
 
 class UninstallProductsView(BrowserView):
     def __call__(self):
-        # XXX: Need to call the uninstall profile
         qi = getToolByName(self.context, 'portal_quickinstaller')
         products = self.request.get('uninstall_products')
         msg_type = 'info'


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-27T09:55:22+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/c137ff73c0a5c54c5721bd1cd5f3adef1160b1c4

Merge pull request #444 from plone/datakurre-restore-installproducts

Revert removal of portal_quickinstaller.installProducts

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/quickinstaller.pt
M Products/CMFPlone/controlpanel/browser/quickinstaller.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e4ada32..b289b53 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,10 @@ Changelog
 5.0b4 (unreleased)
 ----------------
 
+- Fix add-ons to be installed using CMFQuickInstaller (restore support
+  for Extensions/Install.py)
+  [datakurre]
+
 - Rename showEditableBorder to showToolbar and deprecate using
   disable_border and enable_border for enable_toolbar and disable_toolbar
   [vangheem]
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
index 1d3d1ed..d0ccf1d 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.pt
@@ -131,7 +131,7 @@
                 <form action="install_products" method="post" class="pull-right">
                    <input type="hidden"
                            name="install_products:list"
-                           tal:attributes="value string:profile-${product/install_profile/id};" />
+                           tal:attributes="value pid;" />
                    <span i18n:translate="label_product_install_action">
                       <span i18n:name="install_button">
                          <input class="context"
diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.py b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
index ea73ec7..a5ce2f8 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.py
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
@@ -203,20 +203,14 @@ def __call__(self):
 class InstallProductsView(BrowserView):
 
     def __call__(self):
-        """
-        Install products by running the default import steps
-        XXX: is this running all profiles?
-        """
-        setupTool = getToolByName(self.context, 'portal_setup')
-        profiles = self.request.get('install_products')
+        qi = getToolByName(self.context, 'portal_quickinstaller')
+        products = self.request.get('install_products')
         msg_type = 'info'
-        if profiles:
+        if products:
             messages = IStatusMessage(self.request)
-            for profile in profiles:
-                # TODO: find out where this is and don't run already
-                # activated profiles
-                setupTool.runAllImportStepsFromProfile(profile)
-                msg = _(u'Installed ${product}!', mapping={'product': profile})
+            for product in products:
+                qi.installProducts(products=[product, ])
+                msg = _(u'Installed ${product}!', mapping={'product': product})
                 messages.addStatusMessage(msg, type=msg_type)
 
         purl = getToolByName(self.context, 'portal_url')()
@@ -225,7 +219,6 @@ def __call__(self):
 
 class UninstallProductsView(BrowserView):
     def __call__(self):
-        # XXX: Need to call the uninstall profile
         qi = getToolByName(self.context, 'portal_quickinstaller')
         products = self.request.get('uninstall_products')
         msg_type = 'info'


