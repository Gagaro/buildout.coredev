Repository: plone.protect
Branch: refs/heads/master
Date: 2015-03-07T11:06:11+02:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.protect/commit/9bcbda38a312cf8ab707693daadb91f7a63cd72d

Add ITransform.transformBytes for protect transform to fix compatibility with plone.app.blocks' ESI-rendering

Files changed:
M CHANGES.txt
M plone/protect/auto.py

diff --git a/CHANGES.txt b/CHANGES.txt
index f4a71a1..6d69405 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,8 +4,9 @@ Changelog
 3.0.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
-
+- Add ITransform.transformBytes for protect transform to fix compatibility
+  with plone.app.blocks' ESI-rendering
+  [atsoukka]
 
 3.0.1 (2014-11-01)
 ------------------
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 663e003..62deed3 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -68,6 +68,10 @@ def parseTree(self, result):
                         'token to response for url %s' % self.request.URL)
             return None
 
+    def transformBytes(self, result, encoding):
+        result = unicode(result, encoding, 'ignore')
+        return self.transformIterable([result], encoding)
+
     def transformString(self, result, encoding):
         return self.transformIterable([result], encoding)
 


Repository: plone.protect
Branch: refs/heads/master
Date: 2015-03-10T09:44:28-07:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.protect/commit/5f89da06fbdc7665f9d54160f6348a6405cfc8ad

Merge pull request #7 from plone/datakurre-add-transformBytes

Add ITransform.transformBytes for protect transform to fix compatibility

Files changed:
M CHANGES.txt
M plone/protect/auto.py

diff --git a/CHANGES.txt b/CHANGES.txt
index f4a71a1..6d69405 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,8 +4,9 @@ Changelog
 3.0.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
-
+- Add ITransform.transformBytes for protect transform to fix compatibility
+  with plone.app.blocks' ESI-rendering
+  [atsoukka]
 
 3.0.1 (2014-11-01)
 ------------------
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 663e003..62deed3 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -68,6 +68,10 @@ def parseTree(self, result):
                         'token to response for url %s' % self.request.URL)
             return None
 
+    def transformBytes(self, result, encoding):
+        result = unicode(result, encoding, 'ignore')
+        return self.transformIterable([result], encoding)
+
     def transformString(self, result, encoding):
         return self.transformIterable([result], encoding)
 


