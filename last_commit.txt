Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-09-19T14:55:59+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/773cd053c3b87ff4a536a3adc060427cd13ae1c9

Fix an error with logging an exception on indexing SearchableText for files and concating utf-8 encoded strings.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/indexers.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1174d3d..b50361d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 1.2.3 (unreleased)
 ------------------
 
+- Fix an error with logging an exception on indexing SearchableText for files
+  and concating utf-8 encoded strings.
+  [thet]
+
 - Make consistent use of LeadImage behavior everywhere. Related to
   plone/plone.app.contenttypes#1012. Contentleadimages no longer show up in
   full_view since they are a viewlet.
@@ -12,6 +16,7 @@ Changelog
 - Fixed the summary_view styling
   [sneridagh]
 
+
 1.2.2 (2015-09-15)
 ------------------
 
diff --git a/plone/app/contenttypes/indexers.py b/plone/app/contenttypes/indexers.py
index 568a182..084a95a 100644
--- a/plone/app/contenttypes/indexers.py
+++ b/plone/app/contenttypes/indexers.py
@@ -27,7 +27,8 @@ def _unicode_save_string_concat(*args):
     for value in args:
         if isinstance(value, unicode):
             value = value.encode('utf-8', 'replace')
-        result = ' '.join((result, value))
+        if value:
+            result = ' '.join((result, value))
     return result
 
 
@@ -77,7 +78,7 @@ def SearchableText_file(obj):
         raise
     except Exception, msg:
         logger.exception('exception while trying to convert '
-                         'blob contents to "text/plain" for %r. Error: %s',
+                         'blob contents to "text/plain" for %r. Error: %s' %
                          (obj, str(msg)))
         return SearchableText(obj)
 


