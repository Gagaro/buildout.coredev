Repository: plone.app.event
Branch: refs/heads/master
Date: 2015-04-16T16:36:56+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.event/commit/22eb363cfa0b14d7d0975e8f0159c0c9fc630b09

Support for contentFilter on request for event_listing.

Files changed:
M CHANGES.rst
M plone/app/event/browser/event_listing.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d5f3d6b..ce26dbf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0a9 (unreleased)
 ------------------
 
+- Support for ``contentFilter`` on request for ``event_listing``.
+  [thet]
+
 - Fix ``ImageScalingViewFactory`` and add a custom ILeadImage viewlet for
   Occurrences. Fixes the display of ILeadImage images from the originating
   event in event views of occurrences by delegating to the parent object.
diff --git a/plone/app/event/browser/event_listing.py b/plone/app/event/browser/event_listing.py
index 97c1623..cdf334a 100644
--- a/plone/app/event/browser/event_listing.py
+++ b/plone/app/event/browser/event_listing.py
@@ -139,12 +139,12 @@ def events(self, ret_mode=RET_MODE_ACCESSORS, expand=True, batch=True):
         if self.is_collection:
             ctx = self.default_context
             query = queryparser.parseFormquery(ctx, ctx.query)
-            custom_query = {}
+            custom_query = self.request.get('contentFilter', {})
             if 'start' not in query or 'end' not in query:
                 # ... else don't show the navigation bar
                 start, end = self._start_end
                 start, end = _prepare_range(ctx, start, end)
-                custom_query = start_end_query(start, end)
+                custom_query.update(start_end_query(start, end))
             res = ctx.results(
                 batch=False, brains=True, custom_query=custom_query
             )


Repository: plone.app.event
Branch: refs/heads/master
Date: 2015-04-21T16:08:48+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.event/commit/2b9d09f34173c62815320bec09bdb4e8349068e0

Merge pull request #178 from plone/thet-contentFilter

Support for contentFilter on request for event_listing.

Files changed:
M CHANGES.rst
M plone/app/event/browser/event_listing.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d5f3d6b..ce26dbf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0a9 (unreleased)
 ------------------
 
+- Support for ``contentFilter`` on request for ``event_listing``.
+  [thet]
+
 - Fix ``ImageScalingViewFactory`` and add a custom ILeadImage viewlet for
   Occurrences. Fixes the display of ILeadImage images from the originating
   event in event views of occurrences by delegating to the parent object.
diff --git a/plone/app/event/browser/event_listing.py b/plone/app/event/browser/event_listing.py
index 97c1623..cdf334a 100644
--- a/plone/app/event/browser/event_listing.py
+++ b/plone/app/event/browser/event_listing.py
@@ -139,12 +139,12 @@ def events(self, ret_mode=RET_MODE_ACCESSORS, expand=True, batch=True):
         if self.is_collection:
             ctx = self.default_context
             query = queryparser.parseFormquery(ctx, ctx.query)
-            custom_query = {}
+            custom_query = self.request.get('contentFilter', {})
             if 'start' not in query or 'end' not in query:
                 # ... else don't show the navigation bar
                 start, end = self._start_end
                 start, end = _prepare_range(ctx, start, end)
-                custom_query = start_end_query(start, end)
+                custom_query.update(start_end_query(start, end))
             res = ctx.results(
                 batch=False, brains=True, custom_query=custom_query
             )


