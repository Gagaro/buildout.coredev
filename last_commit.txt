Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-09-29T17:15:23+13:00
Author: ezvirtual (ezvirtual) <ezvirtual@thevirtual.co.nz>
Commit: https://github.com/plone/plone.app.querystring/commit/775ae4a025d049d6b4e8bced9aacaf591702a9a1

add 'Subject' index to be fixed on existing collections &amp; upgrade step to ensure it is run

Files changed:
M plone/app/querystring/profiles/default/metadata.xml
M plone/app/querystring/upgrades.py
M plone/app/querystring/upgrades.zcml

diff --git a/plone/app/querystring/profiles/default/metadata.xml b/plone/app/querystring/profiles/default/metadata.xml
index 66c4f1f..7705a50 100644
--- a/plone/app/querystring/profiles/default/metadata.xml
+++ b/plone/app/querystring/profiles/default/metadata.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>11</version>
+  <version>12</version>
   <dependencies>
       <dependency>profile-plone.app.registry:default</dependency>
   </dependencies>
diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index 67adfeb..425073d 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -24,6 +24,7 @@ def fix_select_all_existing_collections(context):
         u'portal_type',
         u'review_state',
         u'Creator'
+        u'Subject'
     ]
     operator_mapping = {
         # old -> new
diff --git a/plone/app/querystring/upgrades.zcml b/plone/app/querystring/upgrades.zcml
index 6eb85bc..633c896 100644
--- a/plone/app/querystring/upgrades.zcml
+++ b/plone/app/querystring/upgrades.zcml
@@ -112,4 +112,13 @@
         />
   </genericsetup:upgradeSteps>
 
+  <genericsetup:upgradeStep
+      source="11"
+      destination="12"
+      title="Fix existing collections"
+      profile="plone.app.querystring:default"
+      description="Fix indexes on existing collections by changing 'is' operators to 'any'"
+      handler=".upgrades.fix_select_all_existing_collections"
+      />
+
 </configure>


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-09-29T17:57:12+13:00
Author: ezvirtual (ezvirtual) <ezvirtual@thevirtual.co.nz>
Commit: https://github.com/plone/plone.app.querystring/commit/8de1ab68fca46a7ec1506639181e62e8f3edcd09

update changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 898f87a..440092d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.3.9 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Add upgrade step to fix Subject index for existing collections
+  [ezvirtual]
 
 
 1.3.8 (2015-09-21)


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-09-29T22:10:37+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.querystring/commit/134405ded979fbba9ea6c6d3676308b645655e76

Merge pull request #53 from plone/upgrade_subject_index

Upgrade step to fix 'Subject' index on existing collections

Files changed:
M CHANGES.rst
M plone/app/querystring/profiles/default/metadata.xml
M plone/app/querystring/upgrades.py
M plone/app/querystring/upgrades.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 898f87a..440092d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.3.9 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Add upgrade step to fix Subject index for existing collections
+  [ezvirtual]
 
 
 1.3.8 (2015-09-21)
diff --git a/plone/app/querystring/profiles/default/metadata.xml b/plone/app/querystring/profiles/default/metadata.xml
index 66c4f1f..7705a50 100644
--- a/plone/app/querystring/profiles/default/metadata.xml
+++ b/plone/app/querystring/profiles/default/metadata.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>11</version>
+  <version>12</version>
   <dependencies>
       <dependency>profile-plone.app.registry:default</dependency>
   </dependencies>
diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index 67adfeb..425073d 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -24,6 +24,7 @@ def fix_select_all_existing_collections(context):
         u'portal_type',
         u'review_state',
         u'Creator'
+        u'Subject'
     ]
     operator_mapping = {
         # old -> new
diff --git a/plone/app/querystring/upgrades.zcml b/plone/app/querystring/upgrades.zcml
index 6eb85bc..633c896 100644
--- a/plone/app/querystring/upgrades.zcml
+++ b/plone/app/querystring/upgrades.zcml
@@ -112,4 +112,13 @@
         />
   </genericsetup:upgradeSteps>
 
+  <genericsetup:upgradeStep
+      source="11"
+      destination="12"
+      title="Fix existing collections"
+      profile="plone.app.querystring:default"
+      description="Fix indexes on existing collections by changing 'is' operators to 'any'"
+      handler=".upgrades.fix_select_all_existing_collections"
+      />
+
 </configure>


