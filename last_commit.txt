Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2015-09-10T11:38:55+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.app.portlets/commit/6845cf59cc3e26d32ff1e35afb218414b94404eb

if currentFolderOnly, nav portlet header link must to current folder

Files changed:
M CHANGES.rst
M plone/app/portlets/portlets/navigation.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2a5456d..5cae976 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 3.0.10 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- If 'currentFolderOnly', navigation portlet header link should go to current
+  folder, not to sitemap
+  [ebrehault]
 
 
 3.0.9 (2015-09-09)
diff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py
index 03a4924..50c1b51 100644
--- a/plone/app/portlets/portlets/navigation.py
+++ b/plone/app/portlets/portlets/navigation.py
@@ -185,7 +185,7 @@ def heading_link_target(self):
         displaying /sitemap links for anything besides nav root.
         """
 
-        if not self.data.root_uid:
+        if not self.data.root_uid and not self.data.currentFolderOnly:
             # No particular root item assigned -> should get link to the
             # navigation root sitemap of the current context acquisition chain
             portal_state = getMultiAdapter((self.context, self.request), name="plone_portal_state")


Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2015-09-10T14:10:44+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.app.portlets/commit/0644102239c6d191627b67051bdbd9d23d37a732

Merge pull request #55 from plone/ebr-fix-nav-portlet-header-link

If 'currentFolderOnly', navigation portlet header link should go to current folder

Files changed:
M CHANGES.rst
M plone/app/portlets/portlets/navigation.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2a5456d..5cae976 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 3.0.10 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- If 'currentFolderOnly', navigation portlet header link should go to current
+  folder, not to sitemap
+  [ebrehault]
 
 
 3.0.9 (2015-09-09)
diff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py
index 03a4924..50c1b51 100644
--- a/plone/app/portlets/portlets/navigation.py
+++ b/plone/app/portlets/portlets/navigation.py
@@ -185,7 +185,7 @@ def heading_link_target(self):
         displaying /sitemap links for anything besides nav root.
         """
 
-        if not self.data.root_uid:
+        if not self.data.root_uid and not self.data.currentFolderOnly:
             # No particular root item assigned -> should get link to the
             # navigation root sitemap of the current context acquisition chain
             portal_state = getMultiAdapter((self.context, self.request), name="plone_portal_state")


