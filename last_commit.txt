Repository: plone.schemaeditor
Branch: refs/heads/master
Date: 2015-02-23T08:11:43+01:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/plone.schemaeditor/commit/265fc252290a236bcef824f5c98f47f5d5f70600

restore allowedFields filtering in FieldsVocabularyFactory

Files changed:
M plone/schemaeditor/fields.py

diff --git a/plone/schemaeditor/fields.py b/plone/schemaeditor/fields.py
index 5054c91..052304b 100644
--- a/plone/schemaeditor/fields.py
+++ b/plone/schemaeditor/fields.py
@@ -53,6 +53,9 @@ def editable(self, field):
 
 def FieldsVocabularyFactory(context):
     field_factories = getUtilitiesFor(IFieldFactory)
+    if context.allowedFields is not None:
+        field_factories = [(id, factory) for id, factory in field_factories
+                            if id in context.allowedFields]
     terms = []
     for (field_id, factory) in field_factories:
         terms.append(SimpleVocabulary.createTerm(factory,


