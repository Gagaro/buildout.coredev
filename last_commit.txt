Repository: mockup


Branch: refs/heads/master
Date: 2015-08-11T10:50:41-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/ba3a26d2257e5e7b26876573962e1ca299bd3abb

Filemanager will now re-open files to the same line

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 1520914..e0ac061 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -431,6 +431,14 @@ define([
       var doc = event.node.path;
       if(self.fileData[doc]) {
         self.openEditor(doc);
+        var resetLine = function() {
+          if( self.fileData[doc].line === undefined ) {
+            return;
+          }
+          self.ace.editor.scrollToLine(self.fileData[doc].line);
+          self.ace.editor.renderer.off("afterRender", resetLine);
+        };
+        self.ace.editor.renderer.on("afterRender", resetLine);
       } else {
         self.doAction('getFile', {
           data: { path: doc },
@@ -501,6 +509,8 @@ define([
       // first we need to save the current editor content
       if(self.currentPath) {
         self.fileData[self.currentPath].contents = self.ace.editor.getValue();
+        var lineNum = self.ace.editor.getFirstVisibleRow();
+        self.fileData[self.currentPath].line = lineNum;
       }
       self.currentPath = path;
       if (self.ace !== undefined){


Repository: mockup


Branch: refs/heads/master
Date: 2015-08-11T10:50:41-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/6068f665067dcbbdcd43fc0553b1dc9279d473f3

Added comments

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index e0ac061..e07f8bc 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -431,13 +431,18 @@ define([
       var doc = event.node.path;
       if(self.fileData[doc]) {
         self.openEditor(doc);
+
         var resetLine = function() {
           if( self.fileData[doc].line === undefined ) {
             return;
           }
           self.ace.editor.scrollToLine(self.fileData[doc].line);
+          //We only want this to fire after the intial render,
+          //Not after rendering a "scroll" or "focus" event,
+          //So we remove it.
           self.ace.editor.renderer.off("afterRender", resetLine);
         };
+
         self.ace.editor.renderer.on("afterRender", resetLine);
       } else {
         self.doAction('getFile', {


Repository: mockup


Branch: refs/heads/master
Date: 2015-08-11T10:50:41-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/82ec28991fedc881b0d0fa792dc2577a0647d89b

oops...

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index e07f8bc..18b889e 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -439,10 +439,10 @@ define([
           self.ace.editor.scrollToLine(self.fileData[doc].line);
           //We only want this to fire after the intial render,
           //Not after rendering a "scroll" or "focus" event,
-          //So we remove it.
+          //So we remove it immediately after.
           self.ace.editor.renderer.off("afterRender", resetLine);
         };
-
+        //This sets the listener before rendering finishes
         self.ace.editor.renderer.on("afterRender", resetLine);
       } else {
         self.doAction('getFile', {


Repository: mockup


Branch: refs/heads/master
Date: 2015-08-11T10:50:41-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/49188510aafcc2074e0014587c8c7a9410770db1

The cursor position will now also be restored

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 18b889e..a09d496 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -437,6 +437,7 @@ define([
             return;
           }
           self.ace.editor.scrollToLine(self.fileData[doc].line);
+          self.ace.editor.moveCursorToPosition(self.fileData[doc].cursorPosition)
           //We only want this to fire after the intial render,
           //Not after rendering a "scroll" or "focus" event,
           //So we remove it immediately after.
@@ -516,6 +517,7 @@ define([
         self.fileData[self.currentPath].contents = self.ace.editor.getValue();
         var lineNum = self.ace.editor.getFirstVisibleRow();
         self.fileData[self.currentPath].line = lineNum;
+        self.fileData[self.currentPath].cursorPosition = self.ace.editor.getCursorPosition();
       }
       self.currentPath = path;
       if (self.ace !== undefined){


Repository: mockup


Branch: refs/heads/master
Date: 2015-08-11T10:52:05-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/01507efccf04d0c98c6d8977c399f09e66f5cd3f

Updating changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 8b4ed2e..dd3ee1a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,10 +6,20 @@ Changelog
 
 - add action value to form when using disableAjaxFormSubmit option on modal
   [vangheem]
+  
 - Modal Pattern: If ``data-view-url`` attribute is available on the body, use
   it. Otherwise look for ``data-base-url`` and finally for a ``<base>`` tag.
   [ale-rt]
 
+- filemanager will now re-open files to the same line/position as when it was closed
+  [obct537]
+
+- Fixed "less is not defined" error while in production mode
+  [obct537]
+
+- lessbuilder will now use relative urls
+  [obct537]
+
 - add "Save As" option in less builder
   [obct537]
 


Repository: mockup


Branch: refs/heads/master
Date: 2015-08-11T11:08:33-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/892aaf093e1d1daab7681ae037a1795adc122eea

Merge pull request #553 from plone/reopen

Filemanager will now reopen files to the same line

Files changed:
M CHANGES.rst
M mockup/patterns/filemanager/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 8b4ed2e..dd3ee1a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -6,10 +6,20 @@ Changelog
 
 - add action value to form when using disableAjaxFormSubmit option on modal
   [vangheem]
+  
 - Modal Pattern: If ``data-view-url`` attribute is available on the body, use
   it. Otherwise look for ``data-base-url`` and finally for a ``<base>`` tag.
   [ale-rt]
 
+- filemanager will now re-open files to the same line/position as when it was closed
+  [obct537]
+
+- Fixed "less is not defined" error while in production mode
+  [obct537]
+
+- lessbuilder will now use relative urls
+  [obct537]
+
 - add "Save As" option in less builder
   [obct537]
 
diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 1520914..a09d496 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -431,6 +431,20 @@ define([
       var doc = event.node.path;
       if(self.fileData[doc]) {
         self.openEditor(doc);
+
+        var resetLine = function() {
+          if( self.fileData[doc].line === undefined ) {
+            return;
+          }
+          self.ace.editor.scrollToLine(self.fileData[doc].line);
+          self.ace.editor.moveCursorToPosition(self.fileData[doc].cursorPosition)
+          //We only want this to fire after the intial render,
+          //Not after rendering a "scroll" or "focus" event,
+          //So we remove it immediately after.
+          self.ace.editor.renderer.off("afterRender", resetLine);
+        };
+        //This sets the listener before rendering finishes
+        self.ace.editor.renderer.on("afterRender", resetLine);
       } else {
         self.doAction('getFile', {
           data: { path: doc },
@@ -501,6 +515,9 @@ define([
       // first we need to save the current editor content
       if(self.currentPath) {
         self.fileData[self.currentPath].contents = self.ace.editor.getValue();
+        var lineNum = self.ace.editor.getFirstVisibleRow();
+        self.fileData[self.currentPath].line = lineNum;
+        self.fileData[self.currentPath].cursorPosition = self.ace.editor.getCursorPosition();
       }
       self.currentPath = path;
       if (self.ace !== undefined){


