Repository: plone.app.layout


Branch: refs/heads/master
Date: 2015-10-14T21:35:11+02:00
Author: Franz Gerhard Reinisch (fgrcon) <franz@fgrcon.net>
Commit: https://github.com/plone/plone.app.layout/commit/5dfcb29d6204ef358865319f229f9913c965024b

fix icon rendering ...
  https://github.com/plone/Products.CMFPlone/issues/1151

Files changed:
M CHANGES.rst
M plone/app/layout/globals/interfaces.py
M plone/app/layout/viewlets/document_relateditems.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 9550d4a..a1eca8a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.5.16 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- fix icon rendering ... CMFPlone#1151
+  [fgrcon]
 
 
 2.5.15 (2015-09-20)
diff --git a/plone/app/layout/globals/interfaces.py b/plone/app/layout/globals/interfaces.py
index 7573510..ed8f4c4 100644
--- a/plone/app/layout/globals/interfaces.py
+++ b/plone/app/layout/globals/interfaces.py
@@ -65,7 +65,9 @@ def icons_visible():
         """
 
     def getIcon(item):
-        """Returns an object which implements the IContentIcon interface and
+        """
+        deprecated for Plone > 5.0 see https://github.com/plone/Products.CMFPlone/issues/1151
+        Returns an object which implements the IContentIcon interface and
         provides the informations necessary to render an icon. The item
         parameter needs to be adaptable to IContentIcon. Icons can be disabled
         globally or just for anonymous users with the icon_visibility property
diff --git a/plone/app/layout/viewlets/document_relateditems.pt b/plone/app/layout/viewlets/document_relateditems.pt
index afa6524..f2b25f9 100644
--- a/plone/app/layout/viewlets/document_relateditems.pt
+++ b/plone/app/layout/viewlets/document_relateditems.pt
@@ -12,8 +12,7 @@
         <header i18n:translate="label_related_items">Related content</header>
         <ul>
           <li tal:repeat="item related">
-            <span tal:define="desc                item/Description;
-                              item_icon           python:plone_layout.getIcon(item);
+            <span tal:define="desc                item/Description;                              
                               item_type           item/portal_type;
                               item_type_class     python:'contenttype-' + normalizeString(item_type);
                               item_wf_state       item/review_state|python: context_state.workflow_state();
@@ -21,7 +20,6 @@
                               item_url            item/getURL|item/absolute_url;
                               item_url            python:(item_type in use_view_action) and item_url+'/view' or item_url"
                   tal:attributes="class item_type_class">
-              <img tal:replace="structure item_icon/html_tag" />
               <a href="" class=""
                  tal:attributes="href  item_url;
                                  title desc;


Repository: plone.app.layout


Branch: refs/heads/master
Date: 2015-10-14T21:55:00-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/1441bd9cc3fe0e33226ef235ec32c2cb7bad2065

Merge pull request #67 from fgrcon/master

fix icon rendering ...

Files changed:
M CHANGES.rst
M plone/app/layout/globals/interfaces.py
M plone/app/layout/viewlets/document_relateditems.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 9550d4a..a1eca8a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.5.16 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- fix icon rendering ... CMFPlone#1151
+  [fgrcon]
 
 
 2.5.15 (2015-09-20)
diff --git a/plone/app/layout/globals/interfaces.py b/plone/app/layout/globals/interfaces.py
index 7573510..ed8f4c4 100644
--- a/plone/app/layout/globals/interfaces.py
+++ b/plone/app/layout/globals/interfaces.py
@@ -65,7 +65,9 @@ def icons_visible():
         """
 
     def getIcon(item):
-        """Returns an object which implements the IContentIcon interface and
+        """
+        deprecated for Plone > 5.0 see https://github.com/plone/Products.CMFPlone/issues/1151
+        Returns an object which implements the IContentIcon interface and
         provides the informations necessary to render an icon. The item
         parameter needs to be adaptable to IContentIcon. Icons can be disabled
         globally or just for anonymous users with the icon_visibility property
diff --git a/plone/app/layout/viewlets/document_relateditems.pt b/plone/app/layout/viewlets/document_relateditems.pt
index afa6524..f2b25f9 100644
--- a/plone/app/layout/viewlets/document_relateditems.pt
+++ b/plone/app/layout/viewlets/document_relateditems.pt
@@ -12,8 +12,7 @@
         <header i18n:translate="label_related_items">Related content</header>
         <ul>
           <li tal:repeat="item related">
-            <span tal:define="desc                item/Description;
-                              item_icon           python:plone_layout.getIcon(item);
+            <span tal:define="desc                item/Description;                              
                               item_type           item/portal_type;
                               item_type_class     python:'contenttype-' + normalizeString(item_type);
                               item_wf_state       item/review_state|python: context_state.workflow_state();
@@ -21,7 +20,6 @@
                               item_url            item/getURL|item/absolute_url;
                               item_url            python:(item_type in use_view_action) and item_url+'/view' or item_url"
                   tal:attributes="class item_type_class">
-              <img tal:replace="structure item_icon/html_tag" />
               <a href="" class=""
                  tal:attributes="href  item_url;
                                  title desc;


