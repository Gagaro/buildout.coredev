Repository: plone.testing


Branch: refs/heads/master
Date: 2015-07-10T15:08:43+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.testing/commit/fea5658df0c92b2e4cc3419b413e8f53878fe928

Allow mulitple registration functions for product install

In some rare cases multiple registration functions are helpful (ie the use of archetypes.configure). This commit introduces a parameter for the installProduct method which allows this behavior. It is set to False by default

Files changed:
M src/plone/testing/z2.py

diff --git a/src/plone/testing/z2.py b/src/plone/testing/z2.py
index da2cd89..bc68839 100644
--- a/src/plone/testing/z2.py
+++ b/src/plone/testing/z2.py
@@ -26,7 +26,7 @@
 
 _INSTALLED_PRODUCTS = {}
 
-def installProduct(app, productName, quiet=False):
+def installProduct(app, productName, quiet=False, multiinit=False):
     """Install the Zope 2 product with the given name, so that it will show
     up in the Zope 2 control panel and have its ``initialize()`` hook called.
 
@@ -81,7 +81,8 @@ def installProduct(app, productName, quiet=False):
                 _INSTALLED_PRODUCTS[productName] = (module, init_func,)
 
                 found = True
-                break
+                if not multiinit:
+                    break
 
     if not found and not quiet:
         sys.stderr.write("Could not install product %s\n" % productName)


Repository: plone.testing


Branch: refs/heads/master
Date: 2015-07-15T14:06:17Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.testing/commit/3b2238431af71b552a4b6227b4741aa9ed863ae9

document changes

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index e060a8d..80f4c3e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,6 +1,13 @@
 Changelog
 =========
 
+4.0.14 (unreleased)
+-------------------
+
+- Added ``multiinit``-parameter to z2.installProduct
+  to allow multiple initialize methods for a package
+  [tomgross]
+
 4.0.13 (2015-03-13)
 -------------------
 
@@ -10,7 +17,6 @@ Changelog
 - Add tox.ini
   [icemac]
 
-
 4.0.12 (2014-09-07)
 -------------------
 


Repository: plone.testing


Branch: refs/heads/master
Date: 2015-07-24T09:47:35+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.testing/commit/68790a5088f035e3affeee2b70800f76d9d145a4

Merge pull request #14 from plone/tomgross-patch-1

Allow mulitple registration functions for product install

Files changed:
M CHANGES.rst
M src/plone/testing/z2.py

diff --git a/CHANGES.rst b/CHANGES.rst
index e060a8d..80f4c3e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,6 +1,13 @@
 Changelog
 =========
 
+4.0.14 (unreleased)
+-------------------
+
+- Added ``multiinit``-parameter to z2.installProduct
+  to allow multiple initialize methods for a package
+  [tomgross]
+
 4.0.13 (2015-03-13)
 -------------------
 
@@ -10,7 +17,6 @@ Changelog
 - Add tox.ini
   [icemac]
 
-
 4.0.12 (2014-09-07)
 -------------------
 
diff --git a/src/plone/testing/z2.py b/src/plone/testing/z2.py
index da2cd89..bc68839 100644
--- a/src/plone/testing/z2.py
+++ b/src/plone/testing/z2.py
@@ -26,7 +26,7 @@
 
 _INSTALLED_PRODUCTS = {}
 
-def installProduct(app, productName, quiet=False):
+def installProduct(app, productName, quiet=False, multiinit=False):
     """Install the Zope 2 product with the given name, so that it will show
     up in the Zope 2 control panel and have its ``initialize()`` hook called.
 
@@ -81,7 +81,8 @@ def installProduct(app, productName, quiet=False):
                 _INSTALLED_PRODUCTS[productName] = (module, init_func,)
 
                 found = True
-                break
+                if not multiinit:
+                    break
 
     if not found and not quiet:
         sys.stderr.write("Could not install product %s\n" % productName)


