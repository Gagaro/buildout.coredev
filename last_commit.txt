Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-20T12:29:45-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/25c6d42634b5f8ac4994887ed63a8bf9c83ca681

Revert "metadata.xml should be at version 8"

This reverts commit 91d3a7bb06c4653ed5e1bd78e8526801d1b0c35f.

Files changed:
M plone/app/querystring/profiles/default/metadata.xml

diff --git a/plone/app/querystring/profiles/default/metadata.xml b/plone/app/querystring/profiles/default/metadata.xml
index 288415a..d3f9949 100644
--- a/plone/app/querystring/profiles/default/metadata.xml
+++ b/plone/app/querystring/profiles/default/metadata.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>8</version>
+  <version>7</version>
   <dependencies>
       <dependency>profile-plone.app.registry:default</dependency>
   </dependencies>


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-20T12:29:47-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/01ce8cb4e0a89de0e7cdfbef6cfc8ce8bbf24a74

Revert "Revert "Use selection.all for portal_types, review_state and Creator operations.""

This reverts commit a6596377a6886b51b3ac989aac2bd247bf511750.

Files changed:
A plone/app/querystring/profiles/upgrades/to_9/registry.xml
M CHANGES.rst
M plone/app/querystring/profiles.zcml
M plone/app/querystring/profiles/default/metadata.xml
M plone/app/querystring/profiles/default/registry.xml
M plone/app/querystring/upgrades.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 0583b8d..72c272b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -7,6 +7,9 @@ Changelog
 - Hide upgrade-profiles when creating a new site.
   [pbauer]
 
+- Use selection.all for portal_types, review_state and Creator operations.
+  [frapell]
+
 - Actually convert the value to a datetime for the DateIndex query modifier.
   [frapell]
 
diff --git a/plone/app/querystring/profiles.zcml b/plone/app/querystring/profiles.zcml
index 23689a3..be2354a 100644
--- a/plone/app/querystring/profiles.zcml
+++ b/plone/app/querystring/profiles.zcml
@@ -57,4 +57,12 @@
         provides="Products.GenericSetup.interfaces.EXTENSION"
         />
 
+    <genericsetup:registerProfile
+        name="upgrade_to_9"
+        title="Querystring Upgrade profile to v9"
+        description=""
+        directory="profiles/upgrades/to_9"
+        provides="Products.GenericSetup.interfaces.EXTENSION"
+        />
+
  </configure>
diff --git a/plone/app/querystring/profiles/default/metadata.xml b/plone/app/querystring/profiles/default/metadata.xml
index d3f9949..dd8af24 100644
--- a/plone/app/querystring/profiles/default/metadata.xml
+++ b/plone/app/querystring/profiles/default/metadata.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>7</version>
+  <version>9</version>
   <dependencies>
       <dependency>profile-plone.app.registry:default</dependency>
   </dependencies>
diff --git a/plone/app/querystring/profiles/default/registry.xml b/plone/app/querystring/profiles/default/registry.xml
index 0aa4744..4e4f744 100644
--- a/plone/app/querystring/profiles/default/registry.xml
+++ b/plone/app/querystring/profiles/default/registry.xml
@@ -280,6 +280,7 @@
         <value key="sortable">True</value>
         <value key="operations">
             <element>plone.app.querystring.operation.string.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
             <element>plone.app.querystring.operation.string.currentUser</element>
         </value>
        <value key="group" i18n:translate="">Metadata</value>
@@ -443,7 +444,7 @@
         <value key="enabled">True</value>
         <value key="sortable">False</value>
         <value key="operations">
-            <element>plone.app.querystring.operation.selection.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
         </value>
         <value key="vocabulary">plone.app.vocabularies.ReallyUserFriendlyTypes</value>
        <value key="group" i18n:translate="">Metadata</value>
@@ -469,7 +470,7 @@
         <value key="enabled">True</value>
         <value key="sortable">True</value>
         <value key="operations">
-            <element>plone.app.querystring.operation.selection.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
         </value>
         <value key="vocabulary">plone.app.vocabularies.WorkflowStates</value>
        <value key="group" i18n:translate="">Metadata</value>
diff --git a/plone/app/querystring/profiles/upgrades/to_9/registry.xml b/plone/app/querystring/profiles/upgrades/to_9/registry.xml
new file mode 100644
index 0000000..702f5bc
--- /dev/null
+++ b/plone/app/querystring/profiles/upgrades/to_9/registry.xml
@@ -0,0 +1,44 @@
+<registry xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+          i18n:domain="plone">
+
+    <records interface="plone.app.querystring.interfaces.IQueryField"
+             prefix="plone.app.querystring.field.portal_type">
+        <value key="title" i18n:translate="">Type</value>
+        <value key="description" i18n:translate="">An item's type (e.g. Event)</value>
+        <value key="enabled">True</value>
+        <value key="sortable">False</value>
+        <value key="operations">
+            <element>plone.app.querystring.operation.selection.any</element>
+        </value>
+        <value key="vocabulary">plone.app.vocabularies.ReallyUserFriendlyTypes</value>
+       <value key="group" i18n:translate="">Metadata</value>
+    </records>
+
+    <records interface="plone.app.querystring.interfaces.IQueryField"
+             prefix="plone.app.querystring.field.review_state">
+        <value key="title" i18n:translate="">Review state</value>
+        <value key="description" i18n:translate="">An item's workflow state (e.g.published)</value>
+        <value key="enabled">True</value>
+        <value key="sortable">True</value>
+        <value key="operations">
+            <element>plone.app.querystring.operation.selection.any</element>
+        </value>
+        <value key="vocabulary">plone.app.vocabularies.WorkflowStates</value>
+       <value key="group" i18n:translate="">Metadata</value>
+    </records>
+
+    <records interface="plone.app.querystring.interfaces.IQueryField"
+             prefix="plone.app.querystring.field.Creator">
+        <value key="title" i18n:translate="">Creator</value>
+        <value key="description" i18n:translate="">The person that created an item</value>
+        <value key="enabled">True</value>
+        <value key="sortable">True</value>
+        <value key="operations">
+            <element>plone.app.querystring.operation.string.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
+            <element>plone.app.querystring.operation.string.currentUser</element>
+        </value>
+       <value key="group" i18n:translate="">Metadata</value>
+    </records>
+
+</registry>
\ No newline at end of file
diff --git a/plone/app/querystring/upgrades.zcml b/plone/app/querystring/upgrades.zcml
index a261c70..68de125 100644
--- a/plone/app/querystring/upgrades.zcml
+++ b/plone/app/querystring/upgrades.zcml
@@ -71,4 +71,14 @@
         />
   </genericsetup:upgradeSteps>
 
+  <genericsetup:upgradeSteps
+      source="8"
+      destination="9"
+      profile="plone.app.querystring:default">
+    <genericsetup:upgradeDepends
+        title="Change portal_types, review_state and Creator operations to use selection.all"
+        import_profile="plone.app.querystring:upgrade_to_9"
+        />
+  </genericsetup:upgradeSteps>
+
 </configure>


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-20T14:53:35-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/bef4caf53748d8cf149476f6235afeed3c9efd86

Write migration steps for the operations change

Files changed:
M CHANGES.rst
M plone/app/querystring/upgrades.py
M plone/app/querystring/upgrades.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 72c272b..b522423 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -7,7 +7,8 @@ Changelog
 - Hide upgrade-profiles when creating a new site.
   [pbauer]
 
-- Use selection.all for portal_types, review_state and Creator operations.
+- Replace selection.is with selection.all for portal_types and review_state
+  operations, and add selection.all for Creator operation.
   [frapell]
 
 - Actually convert the value to a datetime for the DateIndex query modifier.
diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index 61db057..f7cf749 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -16,3 +16,29 @@ def upgrade_1_to_2_typo_in_registry(context):
     if right_value not in values:
         values.append(right_value)
     registry[name] = values
+
+
+def fix_select_all_existing_collections(context):
+
+    ops_to_fix = [
+        u'portal_type',
+        u'review_state'
+    ]
+    old_val = u"plone.app.querystring.operation.selection.is"
+    new_val = u"plone.app.querystring.operation.selection.any"
+
+    catalog = context.portal_catalog
+    results = catalog.unrestrictedSearchResults(
+        portal_type="Collection"
+    )
+
+    for elem in results:
+        obj = elem.getObject()
+        aux = list()
+        for op in obj.query:
+            if op['i'] in ops_to_fix and op['o'] == old_val:
+                op['o'] = new_val
+            aux.append(op)
+
+        obj.query = aux
+        obj.reindexObject()
diff --git a/plone/app/querystring/upgrades.zcml b/plone/app/querystring/upgrades.zcml
index 68de125..3b32147 100644
--- a/plone/app/querystring/upgrades.zcml
+++ b/plone/app/querystring/upgrades.zcml
@@ -76,9 +76,15 @@
       destination="9"
       profile="plone.app.querystring:default">
     <genericsetup:upgradeDepends
-        title="Change portal_types, review_state and Creator operations to use selection.all"
+        title="Use selection.all operation"
+        description="Replace selection.is with selection.all for portal_types and review_state operations, and add selection.all for Creator operations."
         import_profile="plone.app.querystring:upgrade_to_9"
         />
+    <upgradeStep
+        title="Fix existing collections"
+        handler=".upgrades.fix_select_all_existing_collections"
+        />
+
   </genericsetup:upgradeSteps>
 
 </configure>


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-20T15:23:07-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/6cf34032c7bd25e8aaa336885f73f601b92bfed3

Only update collections that need to be changed

Files changed:
M plone/app/querystring/upgrades.py

diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index f7cf749..5b47429 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -33,12 +33,15 @@ def fix_select_all_existing_collections(context):
     )
 
     for elem in results:
+        changed = False
         obj = elem.getObject()
         aux = list()
         for op in obj.query:
             if op['i'] in ops_to_fix and op['o'] == old_val:
                 op['o'] = new_val
+                changed = True
             aux.append(op)
 
-        obj.query = aux
-        obj.reindexObject()
+        if changed:
+            obj.query = aux
+            obj.reindexObject()


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-20T15:54:23-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/a2b7bd9e39e3220c2c7feb7deca9f2cd6de1f763

Improve code clarity

Files changed:
M plone/app/querystring/upgrades.py

diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index 5b47429..0fcd2aa 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -20,28 +20,29 @@ def upgrade_1_to_2_typo_in_registry(context):
 
 def fix_select_all_existing_collections(context):
 
-    ops_to_fix = [
+    indexes_to_fix = [
         u'portal_type',
         u'review_state'
     ]
-    old_val = u"plone.app.querystring.operation.selection.is"
-    new_val = u"plone.app.querystring.operation.selection.any"
+    old_operator = u"plone.app.querystring.operation.selection.is"
+    new_operator = u"plone.app.querystring.operation.selection.any"
 
     catalog = context.portal_catalog
-    results = catalog.unrestrictedSearchResults(
+    brains = catalog.unrestrictedSearchResults(
         portal_type="Collection"
     )
 
-    for elem in results:
+    for brain in brains:
         changed = False
-        obj = elem.getObject()
-        aux = list()
-        for op in obj.query:
-            if op['i'] in ops_to_fix and op['o'] == old_val:
-                op['o'] = new_val
+        obj = brain.getObject()
+        fixed_querystring = list()
+        for querystring in obj.query:
+            if querystring['i'] in indexes_to_fix \
+                    and querystring['o'] == old_operator:
+                querystring['o'] = new_operator
                 changed = True
-            aux.append(op)
+            fixed_querystring.append(querystring)
 
         if changed:
-            obj.query = aux
+            obj.query = fixed_querystring
             obj.reindexObject()


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-20T15:55:05-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/87f591da2bc6596324a9b0fd84f019242a7f944b

No need to override every property, just the one we want to change

Files changed:
M plone/app/querystring/profiles/upgrades/to_9/registry.xml

diff --git a/plone/app/querystring/profiles/upgrades/to_9/registry.xml b/plone/app/querystring/profiles/upgrades/to_9/registry.xml
index 702f5bc..5ccb7a7 100644
--- a/plone/app/querystring/profiles/upgrades/to_9/registry.xml
+++ b/plone/app/querystring/profiles/upgrades/to_9/registry.xml
@@ -3,42 +3,25 @@
 
     <records interface="plone.app.querystring.interfaces.IQueryField"
              prefix="plone.app.querystring.field.portal_type">
-        <value key="title" i18n:translate="">Type</value>
-        <value key="description" i18n:translate="">An item's type (e.g. Event)</value>
-        <value key="enabled">True</value>
-        <value key="sortable">False</value>
         <value key="operations">
             <element>plone.app.querystring.operation.selection.any</element>
         </value>
-        <value key="vocabulary">plone.app.vocabularies.ReallyUserFriendlyTypes</value>
-       <value key="group" i18n:translate="">Metadata</value>
     </records>
 
     <records interface="plone.app.querystring.interfaces.IQueryField"
              prefix="plone.app.querystring.field.review_state">
-        <value key="title" i18n:translate="">Review state</value>
-        <value key="description" i18n:translate="">An item's workflow state (e.g.published)</value>
-        <value key="enabled">True</value>
-        <value key="sortable">True</value>
         <value key="operations">
             <element>plone.app.querystring.operation.selection.any</element>
         </value>
-        <value key="vocabulary">plone.app.vocabularies.WorkflowStates</value>
-       <value key="group" i18n:translate="">Metadata</value>
     </records>
 
     <records interface="plone.app.querystring.interfaces.IQueryField"
              prefix="plone.app.querystring.field.Creator">
-        <value key="title" i18n:translate="">Creator</value>
-        <value key="description" i18n:translate="">The person that created an item</value>
-        <value key="enabled">True</value>
-        <value key="sortable">True</value>
         <value key="operations">
             <element>plone.app.querystring.operation.string.is</element>
             <element>plone.app.querystring.operation.selection.any</element>
             <element>plone.app.querystring.operation.string.currentUser</element>
         </value>
-       <value key="group" i18n:translate="">Metadata</value>
     </records>
 
 </registry>
\ No newline at end of file


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-21T17:00:31+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.querystring/commit/9ad950762ae499beb7d8c7ec1e13063b1df3bee2

Changed selection.all to selection.any in description of latest change.

Files changed:
M CHANGES.rst
M plone/app/querystring/upgrades.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index b522423..a47a272 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -7,8 +7,8 @@ Changelog
 - Hide upgrade-profiles when creating a new site.
   [pbauer]
 
-- Replace selection.is with selection.all for portal_types and review_state
-  operations, and add selection.all for Creator operation.
+- Replace selection.is with selection.any for portal_types and review_state
+  operations, and add selection.any for Creator operation.
   [frapell]
 
 - Actually convert the value to a datetime for the DateIndex query modifier.
diff --git a/plone/app/querystring/upgrades.zcml b/plone/app/querystring/upgrades.zcml
index 3b32147..9c87283 100644
--- a/plone/app/querystring/upgrades.zcml
+++ b/plone/app/querystring/upgrades.zcml
@@ -76,8 +76,8 @@
       destination="9"
       profile="plone.app.querystring:default">
     <genericsetup:upgradeDepends
-        title="Use selection.all operation"
-        description="Replace selection.is with selection.all for portal_types and review_state operations, and add selection.all for Creator operations."
+        title="Use selection.any operation"
+        description="Replace selection.is with selection.any for portal_types and review_state operations, and add selection.any for Creator operations."
         import_profile="plone.app.querystring:upgrade_to_9"
         />
     <upgradeStep


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-21T17:03:22+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.querystring/commit/f0560b09a252b38cc14c63540f06fd9a44b1d1cc

Merge pull request #39 from plone/collections-fixes

Collections fixes

Files changed:
A plone/app/querystring/profiles/upgrades/to_9/registry.xml
M CHANGES.rst
M plone/app/querystring/profiles.zcml
M plone/app/querystring/profiles/default/metadata.xml
M plone/app/querystring/profiles/default/registry.xml
M plone/app/querystring/upgrades.py
M plone/app/querystring/upgrades.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 0583b8d..a47a272 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -7,6 +7,10 @@ Changelog
 - Hide upgrade-profiles when creating a new site.
   [pbauer]
 
+- Replace selection.is with selection.any for portal_types and review_state
+  operations, and add selection.any for Creator operation.
+  [frapell]
+
 - Actually convert the value to a datetime for the DateIndex query modifier.
   [frapell]
 
diff --git a/plone/app/querystring/profiles.zcml b/plone/app/querystring/profiles.zcml
index 23689a3..be2354a 100644
--- a/plone/app/querystring/profiles.zcml
+++ b/plone/app/querystring/profiles.zcml
@@ -57,4 +57,12 @@
         provides="Products.GenericSetup.interfaces.EXTENSION"
         />
 
+    <genericsetup:registerProfile
+        name="upgrade_to_9"
+        title="Querystring Upgrade profile to v9"
+        description=""
+        directory="profiles/upgrades/to_9"
+        provides="Products.GenericSetup.interfaces.EXTENSION"
+        />
+
  </configure>
diff --git a/plone/app/querystring/profiles/default/metadata.xml b/plone/app/querystring/profiles/default/metadata.xml
index 288415a..dd8af24 100644
--- a/plone/app/querystring/profiles/default/metadata.xml
+++ b/plone/app/querystring/profiles/default/metadata.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>8</version>
+  <version>9</version>
   <dependencies>
       <dependency>profile-plone.app.registry:default</dependency>
   </dependencies>
diff --git a/plone/app/querystring/profiles/default/registry.xml b/plone/app/querystring/profiles/default/registry.xml
index 0aa4744..4e4f744 100644
--- a/plone/app/querystring/profiles/default/registry.xml
+++ b/plone/app/querystring/profiles/default/registry.xml
@@ -280,6 +280,7 @@
         <value key="sortable">True</value>
         <value key="operations">
             <element>plone.app.querystring.operation.string.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
             <element>plone.app.querystring.operation.string.currentUser</element>
         </value>
        <value key="group" i18n:translate="">Metadata</value>
@@ -443,7 +444,7 @@
         <value key="enabled">True</value>
         <value key="sortable">False</value>
         <value key="operations">
-            <element>plone.app.querystring.operation.selection.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
         </value>
         <value key="vocabulary">plone.app.vocabularies.ReallyUserFriendlyTypes</value>
        <value key="group" i18n:translate="">Metadata</value>
@@ -469,7 +470,7 @@
         <value key="enabled">True</value>
         <value key="sortable">True</value>
         <value key="operations">
-            <element>plone.app.querystring.operation.selection.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
         </value>
         <value key="vocabulary">plone.app.vocabularies.WorkflowStates</value>
        <value key="group" i18n:translate="">Metadata</value>
diff --git a/plone/app/querystring/profiles/upgrades/to_9/registry.xml b/plone/app/querystring/profiles/upgrades/to_9/registry.xml
new file mode 100644
index 0000000..5ccb7a7
--- /dev/null
+++ b/plone/app/querystring/profiles/upgrades/to_9/registry.xml
@@ -0,0 +1,27 @@
+<registry xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+          i18n:domain="plone">
+
+    <records interface="plone.app.querystring.interfaces.IQueryField"
+             prefix="plone.app.querystring.field.portal_type">
+        <value key="operations">
+            <element>plone.app.querystring.operation.selection.any</element>
+        </value>
+    </records>
+
+    <records interface="plone.app.querystring.interfaces.IQueryField"
+             prefix="plone.app.querystring.field.review_state">
+        <value key="operations">
+            <element>plone.app.querystring.operation.selection.any</element>
+        </value>
+    </records>
+
+    <records interface="plone.app.querystring.interfaces.IQueryField"
+             prefix="plone.app.querystring.field.Creator">
+        <value key="operations">
+            <element>plone.app.querystring.operation.string.is</element>
+            <element>plone.app.querystring.operation.selection.any</element>
+            <element>plone.app.querystring.operation.string.currentUser</element>
+        </value>
+    </records>
+
+</registry>
\ No newline at end of file
diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index 61db057..0fcd2aa 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -16,3 +16,33 @@ def upgrade_1_to_2_typo_in_registry(context):
     if right_value not in values:
         values.append(right_value)
     registry[name] = values
+
+
+def fix_select_all_existing_collections(context):
+
+    indexes_to_fix = [
+        u'portal_type',
+        u'review_state'
+    ]
+    old_operator = u"plone.app.querystring.operation.selection.is"
+    new_operator = u"plone.app.querystring.operation.selection.any"
+
+    catalog = context.portal_catalog
+    brains = catalog.unrestrictedSearchResults(
+        portal_type="Collection"
+    )
+
+    for brain in brains:
+        changed = False
+        obj = brain.getObject()
+        fixed_querystring = list()
+        for querystring in obj.query:
+            if querystring['i'] in indexes_to_fix \
+                    and querystring['o'] == old_operator:
+                querystring['o'] = new_operator
+                changed = True
+            fixed_querystring.append(querystring)
+
+        if changed:
+            obj.query = fixed_querystring
+            obj.reindexObject()
diff --git a/plone/app/querystring/upgrades.zcml b/plone/app/querystring/upgrades.zcml
index a261c70..9c87283 100644
--- a/plone/app/querystring/upgrades.zcml
+++ b/plone/app/querystring/upgrades.zcml
@@ -71,4 +71,20 @@
         />
   </genericsetup:upgradeSteps>
 
+  <genericsetup:upgradeSteps
+      source="8"
+      destination="9"
+      profile="plone.app.querystring:default">
+    <genericsetup:upgradeDepends
+        title="Use selection.any operation"
+        description="Replace selection.is with selection.any for portal_types and review_state operations, and add selection.any for Creator operations."
+        import_profile="plone.app.querystring:upgrade_to_9"
+        />
+    <upgradeStep
+        title="Fix existing collections"
+        handler=".upgrades.fix_select_all_existing_collections"
+        />
+
+  </genericsetup:upgradeSteps>
+
 </configure>


