Repository: plone.protect


Branch: refs/heads/master
Date: 2015-09-17T08:49:47-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.protect/commit/808f73e1f18387bc1e19cc477ca28acc63569517

Do not raise ComponentLookupError on transform

Files changed:
M CHANGES.rst
M plone/protect/auto.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b20055d..80fd3ce 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 3.0.8 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Do not raise ComponentLookupError on transform
+  [vangheem]
 
 
 3.0.7 (2015-07-24)
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index f139893..6374558 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -252,10 +252,9 @@ def transform(self, result):
         try:
             token = createToken()
         except ComponentLookupError:
-            if self.site is None:
-                # skip here, utility not installed yet on zope root
-                return
-            raise
+            if self.site is not None:
+                LOGGER.warn('Keyring not found on site. This should not happen', exc_info=True)
+            return result
 
         for form in root.cssselect('form'):
             # XXX should we only do POST? If we're logged in and


