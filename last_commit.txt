Repository: plone.dexterity


Branch: refs/heads/master
Date: 2015-08-13T21:42:39+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.dexterity/commit/ec318875a99615c12ec65a81325545d7f2322273

set title on WebDAV upload

Files changed:
M CHANGES.rst
M plone/dexterity/filerepresentation.py
M plone/dexterity/tests/test_webdav.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a76670d..8cf4845 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,8 @@ Changelog
 - Avoid our own DeprecationWarning about portalTypeToSchemaName.
   [maurits]
 
+- Set title on WebDAV upload
+  [tomgross]
 
 2.3.3 (2015-07-29)
 ------------------
diff --git a/plone/dexterity/filerepresentation.py b/plone/dexterity/filerepresentation.py
index 5effd9d..36256c1 100644
--- a/plone/dexterity/filerepresentation.py
+++ b/plone/dexterity/filerepresentation.py
@@ -492,6 +492,9 @@ def __call__(self, name, contentType, data):
             # get object created -> object added -> object modified.
             notify(ObjectCreatedEvent(obj))
 
+            if not obj.Title():
+                obj.setTitle(obj.getId())
+
         return obj
 
 
diff --git a/plone/dexterity/tests/test_webdav.py b/plone/dexterity/tests/test_webdav.py
index 3678504..65dc9b3 100644
--- a/plone/dexterity/tests/test_webdav.py
+++ b/plone/dexterity/tests/test_webdav.py
@@ -21,6 +21,7 @@
 from plone.dexterity.interfaces import IDexterityFTI
 from plone.dexterity.schema import SCHEMA_CACHE
 from plone.mocktestcase import MockTestCase
+from plone.mocktestcase.dummy import Dummy
 from plone.rfc822.interfaces import IPrimaryField
 from webdav.NullResource import NullResource
 from zExceptions import Forbidden
@@ -57,6 +58,21 @@ def _createResponse(self):
         return HTTPResponse()
 
 
+class ItemDummy(Dummy):
+    """ Dummy objects with title getter and setter """
+
+    title = ''
+
+    def Title(self):
+        return self.title
+
+    def setTitle(self, title):
+        self.title = title
+
+    def getId(self):
+        return self.__dict__.get('id', '')
+
+
 class TestWebZope2DAVAPI(MockTestCase):
 
     def test_get_size_no_adapter(self):
@@ -825,6 +841,9 @@ def test_listDAVObjects(self):
 
 class TestFileRepresentation(MockTestCase):
 
+    def create_dummy(self, **kw):
+        return ItemDummy(**kw)
+
     def test_directory_factory(self):
         class TestContainer(Container):
 
@@ -1046,7 +1065,7 @@ def test_file_factory_factory_utility(self):
         ctr_mock = self.mocker.mock()
         pt_mock = self.mocker.mock()
 
-        result_dummy = self.create_dummy()
+        result_dummy = self.create_dummy(id='test.html')
 
         getToolByName_mock = self.mocker.replace(
             'Products.CMFCore.utils.getToolByName'
@@ -1097,6 +1116,7 @@ def factory(*args, **kwargs):
             result_dummy,
             factory('test.html', 'text/html', '<html />')
         )
+        self.assertEqual(result_dummy.Title(), 'test.html')
 
     def test_file_factory_content_type_factory_utility(self):
         container_mock = self.mocker.mock()


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2015-09-17T08:34:36Z
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.dexterity/commit/ae0787b95e830a435aa82cdec3e6413eb0b1b2e2

Added keywords to setup.py.

[ci skip]

Files changed:
M setup.py

diff --git a/setup.py b/setup.py
index 8a0f27a..4e8b2a0 100644
--- a/setup.py
+++ b/setup.py
@@ -27,7 +27,7 @@
         "Programming Language :: Python :: 2.7",
         "Topic :: Software Development :: Libraries :: Python Modules",
     ],
-    keywords='',
+    keywords='plone dexterity contenttypes',
     author='Martin Aspeli',
     author_email='optilude@gmail.com',
     url='https://pypi.python.org/pypi/plone.dexterity',


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2015-09-17T08:34:36Z
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.dexterity/commit/3c31d5e14b6d1798832381f437b4edca68ebc252

Preparing release 2.3.4

[ci skip]

Files changed:
M CHANGES.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 8cf4845..b4c9518 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -2,7 +2,7 @@ Changelog
 =========
 
 
-2.3.4 (unreleased)
+2.3.4 (2015-08-14)
 ------------------
 
 - Avoid our own DeprecationWarning about portalTypeToSchemaName.
diff --git a/setup.py b/setup.py
index 4e8b2a0..ebae6c4 100644
--- a/setup.py
+++ b/setup.py
@@ -3,7 +3,7 @@
 from setuptools import find_packages
 
 
-version = '2.3.4.dev0'
+version = '2.3.4'
 
 short_description = """\
 Framework for content types as filesystem code and TTW (Zope/CMF/Plone)\


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2015-09-17T08:34:36Z
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.dexterity/commit/785bf23ada270f2b37b326ffe2be137ce407dfb7

Back to development: 2.3.5

[ci skip]

Files changed:
M CHANGES.rst
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b4c9518..0b59243 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -2,6 +2,12 @@ Changelog
 =========
 
 
+2.3.5 (unreleased)
+------------------
+
+- Nothing changed yet.
+
+
 2.3.4 (2015-08-14)
 ------------------
 
diff --git a/setup.py b/setup.py
index ebae6c4..813e43e 100644
--- a/setup.py
+++ b/setup.py
@@ -3,7 +3,7 @@
 from setuptools import find_packages
 
 
-version = '2.3.4'
+version = '2.3.5.dev0'
 
 short_description = """\
 Framework for content types as filesystem code and TTW (Zope/CMF/Plone)\


Repository: plone.dexterity


Branch: refs/heads/master
Date: 2015-09-19T13:31:34+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.dexterity/commit/e45d5476c9992f5f8403ef90c091bb2aab32b7aa

Merge pull request #39 from plone/tomgross-fixwebdav

Set title on WebDAV upload

Files changed:
M CHANGES.rst
M plone/dexterity/filerepresentation.py
M plone/dexterity/tests/test_webdav.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 88d2b04..0b59243 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -14,6 +14,8 @@ Changelog
 - Avoid our own DeprecationWarning about portalTypeToSchemaName.
   [maurits]
 
+- Set title on WebDAV upload
+  [tomgross]
 
 2.3.3 (2015-07-29)
 ------------------
diff --git a/plone/dexterity/filerepresentation.py b/plone/dexterity/filerepresentation.py
index 5effd9d..36256c1 100644
--- a/plone/dexterity/filerepresentation.py
+++ b/plone/dexterity/filerepresentation.py
@@ -492,6 +492,9 @@ def __call__(self, name, contentType, data):
             # get object created -> object added -> object modified.
             notify(ObjectCreatedEvent(obj))
 
+            if not obj.Title():
+                obj.setTitle(obj.getId())
+
         return obj
 
 
diff --git a/plone/dexterity/tests/test_webdav.py b/plone/dexterity/tests/test_webdav.py
index 3678504..65dc9b3 100644
--- a/plone/dexterity/tests/test_webdav.py
+++ b/plone/dexterity/tests/test_webdav.py
@@ -21,6 +21,7 @@
 from plone.dexterity.interfaces import IDexterityFTI
 from plone.dexterity.schema import SCHEMA_CACHE
 from plone.mocktestcase import MockTestCase
+from plone.mocktestcase.dummy import Dummy
 from plone.rfc822.interfaces import IPrimaryField
 from webdav.NullResource import NullResource
 from zExceptions import Forbidden
@@ -57,6 +58,21 @@ def _createResponse(self):
         return HTTPResponse()
 
 
+class ItemDummy(Dummy):
+    """ Dummy objects with title getter and setter """
+
+    title = ''
+
+    def Title(self):
+        return self.title
+
+    def setTitle(self, title):
+        self.title = title
+
+    def getId(self):
+        return self.__dict__.get('id', '')
+
+
 class TestWebZope2DAVAPI(MockTestCase):
 
     def test_get_size_no_adapter(self):
@@ -825,6 +841,9 @@ def test_listDAVObjects(self):
 
 class TestFileRepresentation(MockTestCase):
 
+    def create_dummy(self, **kw):
+        return ItemDummy(**kw)
+
     def test_directory_factory(self):
         class TestContainer(Container):
 
@@ -1046,7 +1065,7 @@ def test_file_factory_factory_utility(self):
         ctr_mock = self.mocker.mock()
         pt_mock = self.mocker.mock()
 
-        result_dummy = self.create_dummy()
+        result_dummy = self.create_dummy(id='test.html')
 
         getToolByName_mock = self.mocker.replace(
             'Products.CMFCore.utils.getToolByName'
@@ -1097,6 +1116,7 @@ def factory(*args, **kwargs):
             result_dummy,
             factory('test.html', 'text/html', '<html />')
         )
+        self.assertEqual(result_dummy.Title(), 'test.html')
 
     def test_file_factory_content_type_factory_utility(self):
         container_mock = self.mocker.mock()


