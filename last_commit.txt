Repository: Products.PasswordResetTool
Branch: refs/heads/master
Date: 2015-03-23T11:42:12+10:00
Author: David\ Beitey (davidjb) <david@davidjb.com>
Commit: https://github.com/plone/Products.PasswordResetTool/commit/11367299bd68ffab4a7a35e43d744a7c0c1aa2f3

Set email content-type correctly in notification templates

Files changed:
M CHANGES.txt
M Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
M Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
M README.txt

diff --git a/CHANGES.txt b/CHANGES.txt
index 1647961..609e167 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,6 +4,10 @@ Changelog
 2.1.2 (unreleased)
 ------------------
 
+- Set mail Content-Type within registration and password reset email
+  templates (rather than HTTP response headers which are ignored).
+  [davidjb]
+
 - Read ``use_email_as_login`` setting from the registry instead of portal
   properties (see https://github.com/plone/Products.CMFPlone/issues/216).
   [jcerjak]
diff --git a/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt b/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
index d5a57a1..68125bd 100644
--- a/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
+++ b/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
@@ -1,5 +1,4 @@
 <tal:root define="lt string:&lt;;gt string:&gt;;
-                  dummy python:request.RESPONSE.setHeader('Content-Type', 'text/plain;; charset=%s' % options['charset']);
                   member python:options['member'];
                   portal_state context/@@plone_portal_state;
                   view context/@@passwordreset_view;
@@ -8,6 +7,7 @@
 >From: <span tal:replace="structure view/encoded_mail_sender" />
 To: <span tal:replace="python:member.getProperty('email')" />
 Subject: <span tal:replace="view/mail_password_subject" />
+Content-Type: text/plain
 Precedence: bulk
 
 <div i18n:domain="passwordresettool"
diff --git a/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt b/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
index 89b9d2f..8730d0a 100644
--- a/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
+++ b/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
@@ -1,5 +1,4 @@
 <tal:root define="lt string:&lt;;gt string:&gt;;
-                  dummy python:request.RESPONSE.setHeader('Content-Type', 'text/plain;; charset=utf-8');
                   member python:options['member'];
                   portal_properties context/@@plone_tools/properties;
                   view context/@@passwordreset_view;
@@ -7,6 +6,7 @@
 >From: <span tal:replace="structure view/encoded_mail_sender" />
 To: <span tal:replace="python:member.getProperty('email')" />
 Subject: <span tal:replace="view/registered_notify_subject" />
+Content-Type: text/plain
 Precedence: bulk
 
 <div i18n:domain="passwordresettool"
diff --git a/README.txt b/README.txt
index 9a2ce96..4dbe0e6 100644
--- a/README.txt
+++ b/README.txt
@@ -87,7 +87,8 @@ Notes
     'mail_password_response'.
 
   - 'mail_password_template':
-    Provides the text of the email.
+    Provides the basic headers and text of the email, for extraction
+    and parsing for use by a mail sender.
 
   - 'mail_password_response':
     Informs that the mail has been sent.


