Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2015-10-23T12:29:02+02:00
Author: Gagaro (Gagaro) <gagaro42@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/51a504f3b27b9710c0faa4658d0d563682b06f82

tests: #29 Check if user can add keywords for AjaxSelectWidget

Files changed:
M plone/app/z3cform/tests/test_widgets.py

diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index afba4db..f964966 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -2,9 +2,12 @@
 from datetime import date
 from datetime import datetime
 from mock import Mock
+from plone.app.testing import TEST_USER_ID
+from plone.app.testing import setRoles
 from plone.app.widgets.testing import ExampleVocabulary
 from plone.app.widgets.testing import PLONEAPPWIDGETS_DX_INTEGRATION_TESTING
 from plone.app.widgets.testing import TestRequest
+from plone.app.z3cform.tests.layer import PAZ3CForm_INTEGRATION_TESTING
 from plone.dexterity.fti import DexterityFTI
 from plone.registry.interfaces import IRegistry
 from plone.testing.zca import UNIT_TESTING
@@ -871,6 +874,33 @@ def test_fieldwidget_sequence(self):
         self.assertIs(widget.request, request)
 
 
+class AjaxSelectWidgetIntegrationTests(unittest.TestCase):
+
+    layer = PAZ3CForm_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.request = TestRequest(environ={'HTTP_ACCEPT_LANGUAGE': 'en'})
+
+    def test_keywords_can_add(self):
+        from plone.app.z3cform.widget import AjaxSelectWidget
+
+        portal = self.layer['portal']
+        setRoles(portal, TEST_USER_ID, ['Manager'])
+        widget = AjaxSelectWidget(self.request)
+        widget.context = portal
+        widget.vocabulary = 'plone.app.vocabularies.Keywords'
+        self.assertEqual(widget._base_args()['pattern_options']['allowNewItems'], 'true')
+
+    def test_keywords_cannot_add(self):
+        from plone.app.z3cform.widget import AjaxSelectWidget
+
+        portal = self.layer['portal']
+        widget = AjaxSelectWidget(self.request)
+        widget.context = portal
+        widget.vocabulary = 'plone.app.vocabularies.Keywords'
+        self.assertEqual(widget._base_args()['pattern_options']['allowNewItems'], 'false')
+
+
 class QueryStringWidgetTests(unittest.TestCase):
 
     def setUp(self):


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2015-10-23T08:13:38-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/ba62ae0aa8fe11254bac5a7cca35ad62e090f510

Merge pull request #30 from plone/tests-29

tests: #29 Check if user can add keywords for AjaxSelectWidget

Files changed:
M plone/app/z3cform/tests/test_widgets.py

diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index afba4db..f964966 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -2,9 +2,12 @@
 from datetime import date
 from datetime import datetime
 from mock import Mock
+from plone.app.testing import TEST_USER_ID
+from plone.app.testing import setRoles
 from plone.app.widgets.testing import ExampleVocabulary
 from plone.app.widgets.testing import PLONEAPPWIDGETS_DX_INTEGRATION_TESTING
 from plone.app.widgets.testing import TestRequest
+from plone.app.z3cform.tests.layer import PAZ3CForm_INTEGRATION_TESTING
 from plone.dexterity.fti import DexterityFTI
 from plone.registry.interfaces import IRegistry
 from plone.testing.zca import UNIT_TESTING
@@ -871,6 +874,33 @@ def test_fieldwidget_sequence(self):
         self.assertIs(widget.request, request)
 
 
+class AjaxSelectWidgetIntegrationTests(unittest.TestCase):
+
+    layer = PAZ3CForm_INTEGRATION_TESTING
+
+    def setUp(self):
+        self.request = TestRequest(environ={'HTTP_ACCEPT_LANGUAGE': 'en'})
+
+    def test_keywords_can_add(self):
+        from plone.app.z3cform.widget import AjaxSelectWidget
+
+        portal = self.layer['portal']
+        setRoles(portal, TEST_USER_ID, ['Manager'])
+        widget = AjaxSelectWidget(self.request)
+        widget.context = portal
+        widget.vocabulary = 'plone.app.vocabularies.Keywords'
+        self.assertEqual(widget._base_args()['pattern_options']['allowNewItems'], 'true')
+
+    def test_keywords_cannot_add(self):
+        from plone.app.z3cform.widget import AjaxSelectWidget
+
+        portal = self.layer['portal']
+        widget = AjaxSelectWidget(self.request)
+        widget.context = portal
+        widget.vocabulary = 'plone.app.vocabularies.Keywords'
+        self.assertEqual(widget._base_args()['pattern_options']['allowNewItems'], 'false')
+
+
 class QueryStringWidgetTests(unittest.TestCase):
 
     def setUp(self):


