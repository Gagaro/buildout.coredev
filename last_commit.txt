Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:13-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/0d5794e40f47985783a77685b5b95b2a78f3b250

Initial upload setup

Files changed:
M mockup/patterns/filemanager/pattern.js
M mockup/patterns/thememapper/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index e8c85cd..74a23bb 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -246,6 +246,9 @@ define([
       var self = this;
       var doc = event.node.path;
       if (event.node.folder){
+        if( self.options.theme ) {
+          self.setUploadUrl(event.node.path);
+        }
         return true;
       }
       if(self.fileData[doc]) {
@@ -386,7 +389,20 @@ define([
       parts.reverse();
       return '/' + parts.join('/');
     },
+    getUpload: function() {
+      var self = this;
 
+      return _.find(self.views, function(x) { return x.upload !== undefined });
+    },
+    getUploadUrl: function(relativePath) {
+      var self = this;
+
+      var url = self.options.uploadUrl;
+      url += relativePath;
+      url += "?_authenticator=" + utils.getAuthenticator();
+
+      return url;
+    },
     resizeEditor: function() {
         var self = this;
 
@@ -411,6 +427,24 @@ define([
           self.ace.editor.resize();
           self.ace.editor.$blockScrolling = Infinity;
         }
+    },
+    setUploadUrl: function(path) {
+      var self = this;
+
+      if( path === undefined ) {
+        path = "";
+      }
+
+      var view = self.getUpload();
+      if( view !== undefined ) {
+        var url = self.options.uploadUrl +
+                  path +
+                  "/themeFileUpload" +
+                  "?_authenticator=" +
+                  utils.getAuthenticator();
+
+        view.upload.dropzone.options.url = url;
+      }
     }
   });
 
diff --git a/mockup/patterns/thememapper/pattern.js b/mockup/patterns/thememapper/pattern.js
index 615e8dd..7de6e5f 100644
--- a/mockup/patterns/thememapper/pattern.js
+++ b/mockup/patterns/thememapper/pattern.js
@@ -424,6 +424,7 @@ define([
     trigger: '.pat-thememapper',
     defaults: {
       filemanagerConfig: {},
+      themeUrl: null,
       mockupUrl: null,
       unthemedUrl: null,
       helpUrl: null,
@@ -456,7 +457,12 @@ define([
       self.ruleBuilder = new RuleBuilder(function(){
         debugger; //callback
       });
+
+      self.options.filemanagerConfig.uploadUrl = self.options.themeUrl;
+      self.options.filemanagerConfig.theme = true;
       self.fileManager = new FileManager(self.$fileManager, self.options.filemanagerConfig);
+      self.fileManager.setUploadUrl();
+
       self.mockupInspector = new Inspector(self.$mockupInspector, {
         name: _t('HTML mockup'),
         ruleBuilder: self.ruleBuilder,


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:13-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/e7dd15bfbfa881387e52c67561cdc2458c73d6da

Files will now correctly save within subfolders

Files changed:
M mockup/patterns/filemanager/js/upload.js
M mockup/patterns/filemanager/pattern.js
M mockup/patterns/thememapper/pattern.thememapper.less
M mockup/patterns/upload/templates/upload.xml

diff --git a/mockup/patterns/filemanager/js/upload.js b/mockup/patterns/filemanager/js/upload.js
index 6029a31..7a2017e 100644
--- a/mockup/patterns/filemanager/js/upload.js
+++ b/mockup/patterns/filemanager/js/upload.js
@@ -19,7 +19,10 @@ define([
       PopoverView.prototype.render.call(this);
       self.upload = new Upload(self.$('.uploadify-me').addClass('pat-upload'), {
         url: self.app.options.uploadUrl,
-        success: function() {
+        success: function(response) {
+          if( self.callback ) {
+            self.callback.apply(self.app, [response]);
+          }
         }
       });
       return this;
diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 74a23bb..c4402ff 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -154,7 +154,8 @@ define([
             tooltip: _t('Upload file to current directory'),
             context: 'default'
           }),
-          app: self
+          app: self,
+          callback: self.addTreeElement
         });
         self.views.push(uploadView);
         mainButtons.push(uploadView.triggerView);
@@ -214,6 +215,43 @@ define([
     $: function(selector){
       return this.$el.find(selector);
     },
+    addTreeElement: function(file) {
+      var self = this;
+
+      if( self.$tree === undefined ) {
+        return;
+      }
+
+      var node = self.getSelectedNode();
+      var path = "";
+      var name = file.name;
+
+      if( node.filename ) {
+        //We just want the selected folder, not an object in it.
+        path = node.path.substr(0, node.path.indexOf(node.filename) - 1);
+        node = self.$tree.tree('moveUp');
+      }
+      else if( node.path ){
+        path = node.path;
+      }
+
+      var options = {
+        label: name,
+        path: path + '/' + name,
+        filename: name,
+        fileType: name.substr(name.lastIndexOf('.') + 1, name.length),
+        folder: false,
+        name: name
+      };
+
+      if( node === false )
+      {
+        //If node is empty, jqtree makes the new node a root
+        node = null
+      }
+
+      self.$tree.tree('appendNode', options, node);
+    },
     render: function(){
       var self = this;
       self.$el.html(self.template(self.options));
@@ -394,15 +432,6 @@ define([
 
       return _.find(self.views, function(x) { return x.upload !== undefined });
     },
-    getUploadUrl: function(relativePath) {
-      var self = this;
-
-      var url = self.options.uploadUrl;
-      url += relativePath;
-      url += "?_authenticator=" + utils.getAuthenticator();
-
-      return url;
-    },
     resizeEditor: function() {
         var self = this;
 
diff --git a/mockup/patterns/thememapper/pattern.thememapper.less b/mockup/patterns/thememapper/pattern.thememapper.less
index 8322959..3b76b22 100644
--- a/mockup/patterns/thememapper/pattern.thememapper.less
+++ b/mockup/patterns/thememapper/pattern.thememapper.less
@@ -171,4 +171,55 @@
             padding-left: 0;
         }
     }
+
+    .upload-area {
+        border: 2px dashed #ddd;
+        background-color: #eee;
+        padding: 10px;
+
+        p {
+            margin-top: 1em;
+            margin-bottom: 1em;
+            text-align: center;
+            font-size: xx-large;
+            color: #aaa;
+        }
+
+        #fakeUploadFile {
+            height: 30px;
+            font-size: x-large;
+        }
+
+        .row > div {
+            display: inline;
+        }
+
+        .browse {
+            margin: 0 0 10px 75px;
+        }
+
+        .col-md-9 {
+            width: 75%;
+        }
+
+        .col-md-8 {
+            width: 66%;
+        }
+
+        .col-md-1 {
+            width: 8%;
+        }
+
+        .col-md-3 {
+            width: 25%;
+        }
+
+        .sr-only {
+            display: none;
+        }
+
+        .upload-queue {
+            clear: both;
+        }
+    }
 }
diff --git a/mockup/patterns/upload/templates/upload.xml b/mockup/patterns/upload/templates/upload.xml
index 4531640..3556274 100644
--- a/mockup/patterns/upload/templates/upload.xml
+++ b/mockup/patterns/upload/templates/upload.xml
@@ -1,7 +1,7 @@
 <div class="upload-container upload-multiple">
     <h2 class="title"><%- _t("Upload stuff here") %></h2>
     <p class="help">
-        <%- _t('Just drag N drop stuff on the area below or press "upload" button.') %>
+        <%- _t('Just drag N drop stuff on the area below or press the "browse" button.') %>
     </p>
     <div class="upload-area">
         <div class="fallback">


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:14-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/7ab0372eff9ebaaf4a8479a02a645395826e3c46

Re-themed the upload window for the thememapper

Files changed:
M mockup/patterns/thememapper/pattern.thememapper.less

diff --git a/mockup/patterns/thememapper/pattern.thememapper.less b/mockup/patterns/thememapper/pattern.thememapper.less
index 3b76b22..2a8c6fe 100644
--- a/mockup/patterns/thememapper/pattern.thememapper.less
+++ b/mockup/patterns/thememapper/pattern.thememapper.less
@@ -194,32 +194,45 @@
             display: inline;
         }
 
+        .item {
+            margin: 10px 0;
+            height: 50px;
+            div {
+                display: table-cell;
+            }
+        }
+
         .browse {
             margin: 0 0 10px 75px;
         }
 
-        .col-md-9 {
-            width: 75%;
+        .title {
+            width: 250px;
         }
 
-        .col-md-8 {
-            width: 66%;
+        .action {
+            width: 20px;
         }
 
-        .col-md-1 {
-            width: 8%;
-        }
+        .info {
+            width: 100px;
 
-        .col-md-3 {
-            width: 25%;
+            img {
+                display: inline;
+                background-color: white;
+                max-height: 50px;
+                float: right;
+                max-width: 50px;
+                margin-top: -35px;
+            }
         }
 
-        .sr-only {
+        .controls {
             display: none;
         }
 
-        .upload-queue {
-            clear: both;
+        .sr-only {
+            display: none;
         }
     }
 }


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:14-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/bc082d6e98cefa8837fa414f3f1ec1efe887421b

Removed pointless textbox from thememapper upload

Files changed:
M mockup/patterns/thememapper/pattern.thememapper.less

diff --git a/mockup/patterns/thememapper/pattern.thememapper.less b/mockup/patterns/thememapper/pattern.thememapper.less
index 2a8c6fe..1944704 100644
--- a/mockup/patterns/thememapper/pattern.thememapper.less
+++ b/mockup/patterns/thememapper/pattern.thememapper.less
@@ -186,8 +186,7 @@
         }
 
         #fakeUploadFile {
-            height: 30px;
-            font-size: x-large;
+            display: none;
         }
 
         .row > div {
@@ -203,7 +202,7 @@
         }
 
         .browse {
-            margin: 0 0 10px 75px;
+            width: 100%;
         }
 
         .title {


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:14-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/2757d6fac0ef9d924584121c42d82944eb810e38

Fixed bug when closing tabs

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index c4402ff..7543bbb 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -249,8 +249,9 @@ define([
         //If node is empty, jqtree makes the new node a root
         node = null
       }
-
-      self.$tree.tree('appendNode', options, node);
+      var newNode = self.$tree.tree('appendNode', options, node);
+      self.$tree.tree('selectNode', newNode);
+      self.getUpload().options.triggerView.$el.click();
     },
     render: function(){
       var self = this;
@@ -310,10 +311,11 @@ define([
                 $item.addClass('active');
                 self.openEditor($item.attr('data-path'));
               } else {
-                self.ace.setText('');
+                self.openEditor();
               }
             }
             $(this).parent().remove();
+            self.resizeEditor();
           });
           $('.select', $item).click(function(e){
             e.preventDefault();
@@ -368,7 +370,12 @@ define([
 
       self.resizeEditor();
 
-      if( typeof self.fileData[path].info !== 'undefined' )
+      if( self.currentPath === undefined ) {
+          self.ace.setText();
+          self.ace.setSyntax('text');
+          self.ace.editor.clearSelection();
+      }
+      else if( typeof self.fileData[path].info !== 'undefined' )
       {
           var preview = self.fileData[path].info;
           self.ace.editor.off();
@@ -444,7 +451,6 @@ define([
 
         //+2 for the editor borders
         h -= 2;
-
         //accounts for the borders/margin
         self.$editor.height(h);
         var w = container.innerWidth();


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:14-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/f16d2a0d7ce56731d0730770b2f006dd2a627edb

Files will be opened immediately after uploading

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 7543bbb..f2064bb 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -251,6 +251,8 @@ define([
       }
       var newNode = self.$tree.tree('appendNode', options, node);
       self.$tree.tree('selectNode', newNode);
+      self.openFile({node: newNode});
+      //Close the upload popover
       self.getUpload().options.triggerView.$el.click();
     },
     render: function(){


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:14-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/ccc680c1983f76155d3c718dfd1a5777e970405d

Upload window now closes properly on multi-uploads

Files changed:
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index f2064bb..f68f71f 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -253,7 +253,10 @@ define([
       self.$tree.tree('selectNode', newNode);
       self.openFile({node: newNode});
       //Close the upload popover
-      self.getUpload().options.triggerView.$el.click();
+      var upload = self.getUpload();
+      if( upload.triggerView.$el.hasClass('active') ) {
+        upload.options.triggerView.$el.click();
+      }
     },
     render: function(){
       var self = this;


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-08T15:44:14-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/2677fcf9fc23486ada9066e26dd01e5c85222554

Made a few small visual changes

Files changed:
M mockup/patterns/filemanager/js/upload.js
M mockup/patterns/thememapper/pattern.thememapper.less
M mockup/patterns/upload/pattern.js

diff --git a/mockup/patterns/filemanager/js/upload.js b/mockup/patterns/filemanager/js/upload.js
index 7a2017e..296f305 100644
--- a/mockup/patterns/filemanager/js/upload.js
+++ b/mockup/patterns/filemanager/js/upload.js
@@ -11,7 +11,7 @@ define([
     className: 'popover upload',
     title: _.template('<%= _t("Upload") %>'),
     content: _.template(
-      '<span class="current-path"></span>' +
+      '<span>Location: <span class="current-path"></span></span>' +
       '<input type="text" name="upload" style="display:none" />' +
       '<div class="uploadify-me"></div>'),
     render: function() {
diff --git a/mockup/patterns/thememapper/pattern.thememapper.less b/mockup/patterns/thememapper/pattern.thememapper.less
index 1944704..a35484c 100644
--- a/mockup/patterns/thememapper/pattern.thememapper.less
+++ b/mockup/patterns/thememapper/pattern.thememapper.less
@@ -195,7 +195,6 @@
 
         .item {
             margin: 10px 0;
-            height: 50px;
             div {
                 display: table-cell;
             }
diff --git a/mockup/patterns/upload/pattern.js b/mockup/patterns/upload/pattern.js
index c896ed4..449d069 100644
--- a/mockup/patterns/upload/pattern.js
+++ b/mockup/patterns/upload/pattern.js
@@ -190,7 +190,7 @@ define([
         // upload pattern, e.g. the TinyMCE pattern's link plugin.
         self.$el.trigger('uploadAllCompleted', {
           'data': response,
-          'path_uid': self.$pathInput.val()
+          'path_uid': (self.$pathInput) ? self.$pathInput.val() : null
         });
       });
 


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-09T13:39:19-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/171dbcda92fe915ffb7721d52116325e2342d8ec

Upload now displays an error if the upload fails

Files changed:
M mockup/patterns/filemanager/pattern.js
M mockup/patterns/texteditor/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index f68f71f..9e960d6 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -218,6 +218,12 @@ define([
     addTreeElement: function(file) {
       var self = this;
 
+      if( file.status !== 'success' )
+      {
+          alert('There was a problem during the upload process.');
+          return;
+      }
+
       if( self.$tree === undefined ) {
         return;
       }
diff --git a/mockup/patterns/texteditor/pattern.js b/mockup/patterns/texteditor/pattern.js
index fe5c6f1..0e6f2e6 100644
--- a/mockup/patterns/texteditor/pattern.js
+++ b/mockup/patterns/texteditor/pattern.js
@@ -94,12 +94,14 @@ define([
 
       // set id on current element
       var id = utils.setId(self.$el);
-      self.$wrapper = $('<div/>').css({
+      self.$wrapper = $('<div class="editorWrapper" />').css({
         height: self.options.height + 25, // weird sizing issue here...
         width: self.options.width,
         position: 'relative'
       });
-      self.$el.wrap(self.$wrapper);
+      if( !self.$el.parent().hasClass('editorWrapper') ) {
+          self.$el.wrap(self.$wrapper);
+      }
       self.$el.css({
         width: self.options.width,
         height: self.options.height,


Repository: mockup
Branch: refs/heads/master
Date: 2015-06-09T14:14:03-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/8acf2263c5c9c48d50af111cc73c2ab0abc318b2

Merge pull request #509 from plone/thememapper_uploads

Thememapper uploads

Files changed:
M mockup/patterns/filemanager/js/upload.js
M mockup/patterns/filemanager/pattern.js
M mockup/patterns/texteditor/pattern.js
M mockup/patterns/thememapper/pattern.js
M mockup/patterns/thememapper/pattern.thememapper.less
M mockup/patterns/upload/pattern.js
M mockup/patterns/upload/templates/upload.xml

diff --git a/mockup/patterns/filemanager/js/upload.js b/mockup/patterns/filemanager/js/upload.js
index 6029a31..296f305 100644
--- a/mockup/patterns/filemanager/js/upload.js
+++ b/mockup/patterns/filemanager/js/upload.js
@@ -11,7 +11,7 @@ define([
     className: 'popover upload',
     title: _.template('<%= _t("Upload") %>'),
     content: _.template(
-      '<span class="current-path"></span>' +
+      '<span>Location: <span class="current-path"></span></span>' +
       '<input type="text" name="upload" style="display:none" />' +
       '<div class="uploadify-me"></div>'),
     render: function() {
@@ -19,7 +19,10 @@ define([
       PopoverView.prototype.render.call(this);
       self.upload = new Upload(self.$('.uploadify-me').addClass('pat-upload'), {
         url: self.app.options.uploadUrl,
-        success: function() {
+        success: function(response) {
+          if( self.callback ) {
+            self.callback.apply(self.app, [response]);
+          }
         }
       });
       return this;
diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index e8c85cd..9e960d6 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -154,7 +154,8 @@ define([
             tooltip: _t('Upload file to current directory'),
             context: 'default'
           }),
-          app: self
+          app: self,
+          callback: self.addTreeElement
         });
         self.views.push(uploadView);
         mainButtons.push(uploadView.triggerView);
@@ -214,6 +215,55 @@ define([
     $: function(selector){
       return this.$el.find(selector);
     },
+    addTreeElement: function(file) {
+      var self = this;
+
+      if( file.status !== 'success' )
+      {
+          alert('There was a problem during the upload process.');
+          return;
+      }
+
+      if( self.$tree === undefined ) {
+        return;
+      }
+
+      var node = self.getSelectedNode();
+      var path = "";
+      var name = file.name;
+
+      if( node.filename ) {
+        //We just want the selected folder, not an object in it.
+        path = node.path.substr(0, node.path.indexOf(node.filename) - 1);
+        node = self.$tree.tree('moveUp');
+      }
+      else if( node.path ){
+        path = node.path;
+      }
+
+      var options = {
+        label: name,
+        path: path + '/' + name,
+        filename: name,
+        fileType: name.substr(name.lastIndexOf('.') + 1, name.length),
+        folder: false,
+        name: name
+      };
+
+      if( node === false )
+      {
+        //If node is empty, jqtree makes the new node a root
+        node = null
+      }
+      var newNode = self.$tree.tree('appendNode', options, node);
+      self.$tree.tree('selectNode', newNode);
+      self.openFile({node: newNode});
+      //Close the upload popover
+      var upload = self.getUpload();
+      if( upload.triggerView.$el.hasClass('active') ) {
+        upload.options.triggerView.$el.click();
+      }
+    },
     render: function(){
       var self = this;
       self.$el.html(self.template(self.options));
@@ -246,6 +296,9 @@ define([
       var self = this;
       var doc = event.node.path;
       if (event.node.folder){
+        if( self.options.theme ) {
+          self.setUploadUrl(event.node.path);
+        }
         return true;
       }
       if(self.fileData[doc]) {
@@ -269,10 +322,11 @@ define([
                 $item.addClass('active');
                 self.openEditor($item.attr('data-path'));
               } else {
-                self.ace.setText('');
+                self.openEditor();
               }
             }
             $(this).parent().remove();
+            self.resizeEditor();
           });
           $('.select', $item).click(function(e){
             e.preventDefault();
@@ -327,7 +381,12 @@ define([
 
       self.resizeEditor();
 
-      if( typeof self.fileData[path].info !== 'undefined' )
+      if( self.currentPath === undefined ) {
+          self.ace.setText();
+          self.ace.setSyntax('text');
+          self.ace.editor.clearSelection();
+      }
+      else if( typeof self.fileData[path].info !== 'undefined' )
       {
           var preview = self.fileData[path].info;
           self.ace.editor.off();
@@ -386,7 +445,11 @@ define([
       parts.reverse();
       return '/' + parts.join('/');
     },
+    getUpload: function() {
+      var self = this;
 
+      return _.find(self.views, function(x) { return x.upload !== undefined });
+    },
     resizeEditor: function() {
         var self = this;
 
@@ -399,7 +462,6 @@ define([
 
         //+2 for the editor borders
         h -= 2;
-
         //accounts for the borders/margin
         self.$editor.height(h);
         var w = container.innerWidth();
@@ -411,6 +473,24 @@ define([
           self.ace.editor.resize();
           self.ace.editor.$blockScrolling = Infinity;
         }
+    },
+    setUploadUrl: function(path) {
+      var self = this;
+
+      if( path === undefined ) {
+        path = "";
+      }
+
+      var view = self.getUpload();
+      if( view !== undefined ) {
+        var url = self.options.uploadUrl +
+                  path +
+                  "/themeFileUpload" +
+                  "?_authenticator=" +
+                  utils.getAuthenticator();
+
+        view.upload.dropzone.options.url = url;
+      }
     }
   });
 
diff --git a/mockup/patterns/texteditor/pattern.js b/mockup/patterns/texteditor/pattern.js
index fe5c6f1..0e6f2e6 100644
--- a/mockup/patterns/texteditor/pattern.js
+++ b/mockup/patterns/texteditor/pattern.js
@@ -94,12 +94,14 @@ define([
 
       // set id on current element
       var id = utils.setId(self.$el);
-      self.$wrapper = $('<div/>').css({
+      self.$wrapper = $('<div class="editorWrapper" />').css({
         height: self.options.height + 25, // weird sizing issue here...
         width: self.options.width,
         position: 'relative'
       });
-      self.$el.wrap(self.$wrapper);
+      if( !self.$el.parent().hasClass('editorWrapper') ) {
+          self.$el.wrap(self.$wrapper);
+      }
       self.$el.css({
         width: self.options.width,
         height: self.options.height,
diff --git a/mockup/patterns/thememapper/pattern.js b/mockup/patterns/thememapper/pattern.js
index 615e8dd..7de6e5f 100644
--- a/mockup/patterns/thememapper/pattern.js
+++ b/mockup/patterns/thememapper/pattern.js
@@ -424,6 +424,7 @@ define([
     trigger: '.pat-thememapper',
     defaults: {
       filemanagerConfig: {},
+      themeUrl: null,
       mockupUrl: null,
       unthemedUrl: null,
       helpUrl: null,
@@ -456,7 +457,12 @@ define([
       self.ruleBuilder = new RuleBuilder(function(){
         debugger; //callback
       });
+
+      self.options.filemanagerConfig.uploadUrl = self.options.themeUrl;
+      self.options.filemanagerConfig.theme = true;
       self.fileManager = new FileManager(self.$fileManager, self.options.filemanagerConfig);
+      self.fileManager.setUploadUrl();
+
       self.mockupInspector = new Inspector(self.$mockupInspector, {
         name: _t('HTML mockup'),
         ruleBuilder: self.ruleBuilder,
diff --git a/mockup/patterns/thememapper/pattern.thememapper.less b/mockup/patterns/thememapper/pattern.thememapper.less
index 8322959..a35484c 100644
--- a/mockup/patterns/thememapper/pattern.thememapper.less
+++ b/mockup/patterns/thememapper/pattern.thememapper.less
@@ -171,4 +171,66 @@
             padding-left: 0;
         }
     }
+
+    .upload-area {
+        border: 2px dashed #ddd;
+        background-color: #eee;
+        padding: 10px;
+
+        p {
+            margin-top: 1em;
+            margin-bottom: 1em;
+            text-align: center;
+            font-size: xx-large;
+            color: #aaa;
+        }
+
+        #fakeUploadFile {
+            display: none;
+        }
+
+        .row > div {
+            display: inline;
+        }
+
+        .item {
+            margin: 10px 0;
+            div {
+                display: table-cell;
+            }
+        }
+
+        .browse {
+            width: 100%;
+        }
+
+        .title {
+            width: 250px;
+        }
+
+        .action {
+            width: 20px;
+        }
+
+        .info {
+            width: 100px;
+
+            img {
+                display: inline;
+                background-color: white;
+                max-height: 50px;
+                float: right;
+                max-width: 50px;
+                margin-top: -35px;
+            }
+        }
+
+        .controls {
+            display: none;
+        }
+
+        .sr-only {
+            display: none;
+        }
+    }
 }
diff --git a/mockup/patterns/upload/pattern.js b/mockup/patterns/upload/pattern.js
index c896ed4..449d069 100644
--- a/mockup/patterns/upload/pattern.js
+++ b/mockup/patterns/upload/pattern.js
@@ -190,7 +190,7 @@ define([
         // upload pattern, e.g. the TinyMCE pattern's link plugin.
         self.$el.trigger('uploadAllCompleted', {
           'data': response,
-          'path_uid': self.$pathInput.val()
+          'path_uid': (self.$pathInput) ? self.$pathInput.val() : null
         });
       });
 
diff --git a/mockup/patterns/upload/templates/upload.xml b/mockup/patterns/upload/templates/upload.xml
index 4531640..3556274 100644
--- a/mockup/patterns/upload/templates/upload.xml
+++ b/mockup/patterns/upload/templates/upload.xml
@@ -1,7 +1,7 @@
 <div class="upload-container upload-multiple">
     <h2 class="title"><%- _t("Upload stuff here") %></h2>
     <p class="help">
-        <%- _t('Just drag N drop stuff on the area below or press "upload" button.') %>
+        <%- _t('Just drag N drop stuff on the area below or press the "browse" button.') %>
     </p>
     <div class="upload-area">
         <div class="fallback">


