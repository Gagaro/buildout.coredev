Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-05-28T12:10:23-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/55c17a6c14ad504d22e9d92cf924d2b4fbc07da8

check if css_path defined first

Files changed:
M CHANGES.rst
M Products/CMFPlone/resources/browser/cook.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a4477eb..a751424 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0b3 (unreleased)
 ------------------
 
+- do not require css to be defined for non-compilable bundles
+  [vangheem]
+
 - fix weird issue with selecting multiple links and images on a page
   while you are editing with tinymce
   [vangheem]
diff --git a/Products/CMFPlone/resources/browser/cook.py b/Products/CMFPlone/resources/browser/cook.py
index 895f843..5e1e760 100644
--- a/Products/CMFPlone/resources/browser/cook.py
+++ b/Products/CMFPlone/resources/browser/cook.py
@@ -74,18 +74,19 @@ def cookWhenChangingSettings(context, bundle):
         fi = StringIO(cooked_js)
         folder.writeFile(resource_filepath, fi)
 
-        # Storing css
-        resource_path = css_path.split('++plone++')[-1]
-        resource_name, resource_filepath = resource_path.split('/', 1)
-        persistent_directory = getUtility(IResourceDirectory, name="persistent")
-        if OVERRIDE_RESOURCE_DIRECTORY_NAME not in persistent_directory:
-            persistent_directory.makeDirectory(OVERRIDE_RESOURCE_DIRECTORY_NAME)
-        container = persistent_directory[OVERRIDE_RESOURCE_DIRECTORY_NAME]
-        if resource_name not in container:
-            container.makeDirectory(resource_name)
-        folder = container[resource_name]
-        fi = StringIO(cooked_css)
-        folder.writeFile(resource_filepath, fi)
+        if css_path:
+            # Storing css if defined
+            resource_path = css_path.split('++plone++')[-1]
+            resource_name, resource_filepath = resource_path.split('/', 1)
+            persistent_directory = getUtility(IResourceDirectory, name="persistent")
+            if OVERRIDE_RESOURCE_DIRECTORY_NAME not in persistent_directory:
+                persistent_directory.makeDirectory(OVERRIDE_RESOURCE_DIRECTORY_NAME)
+            container = persistent_directory[OVERRIDE_RESOURCE_DIRECTORY_NAME]
+            if resource_name not in container:
+                container.makeDirectory(resource_name)
+            folder = container[resource_name]
+            fi = StringIO(cooked_css)
+            folder.writeFile(resource_filepath, fi)
         bundle.last_compilation = datetime.now()
         # setRequest(original_request)
     except NotFound:


