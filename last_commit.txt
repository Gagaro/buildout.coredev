Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-19T14:47:55+02:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/b46fdab0d7bcd9de014ac3413e952835914acd32

Added the inline JS of the plone-addsite template to its own static resource. This fixes #847.

Files changed:
A Products/CMFPlone/browser/static/plone-admin-ui.js
M Products/CMFPlone/browser/admin.zcml
M Products/CMFPlone/browser/templates/plone-addsite.pt

diff --git a/Products/CMFPlone/browser/admin.zcml b/Products/CMFPlone/browser/admin.zcml
index dd49203..12228bf 100644
--- a/Products/CMFPlone/browser/admin.zcml
+++ b/Products/CMFPlone/browser/admin.zcml
@@ -62,6 +62,11 @@
       />
 
   <browser:resource
+      file="static/plone-admin-ui.js"
+      name="plone-admin-ui.js"
+      />
+
+  <browser:resource
       file="static/jstz-1.0.4.min.js"
       name="jstz-1.0.4.min.js"
       />
diff --git a/Products/CMFPlone/browser/static/plone-admin-ui.js b/Products/CMFPlone/browser/static/plone-admin-ui.js
new file mode 100644
index 0000000..2f112f0
--- /dev/null
+++ b/Products/CMFPlone/browser/static/plone-admin-ui.js
@@ -0,0 +1,25 @@
+function siteid_focus() {
+  "use strict";
+  var siteid = document.getElementById('site_id');
+  siteid.focus();
+}
+
+function set_timezone() {
+  "use strict";
+  var i, tzopt,
+      tz = jstz.determine(),
+      tzname = tz.name(),
+      tzopts = document.getElementById('portal_timezone').options;
+  for (i=1; i<=tzopts.length; i++) {
+    tzopt = tzopts[i-1];
+    if (tzname === tzopt.value){
+      tzopt.selected = 'selected';
+      break;
+    }
+  }
+}
+window.onload = function () {
+  "use strict";
+  siteid_focus();
+  set_timezone();
+};
diff --git a/Products/CMFPlone/browser/templates/plone-addsite.pt b/Products/CMFPlone/browser/templates/plone-addsite.pt
index 63cbec7..1009be0 100644
--- a/Products/CMFPlone/browser/templates/plone-addsite.pt
+++ b/Products/CMFPlone/browser/templates/plone-addsite.pt
@@ -15,33 +15,7 @@
         tal:attributes="href string:${context/absolute_url}/++resource++plone-admin-ui.css"
         href="/++resource++plone-admin-ui.css" />
   <script type="text/javascript" tal:attributes="src string:${context/absolute_url}/++resource++jstz-1.0.4.min.js"></script>
-  <script type="text/javascript">
-    function siteid_focus() {
-      "use strict";
-      var siteid = document.getElementById('site_id');
-      siteid.focus();
-    }
-
-    function set_timezone() {
-      "use strict";
-      var i, tzopt,
-          tz = jstz.determine(),
-          tzname = tz.name(),
-          tzopts = document.getElementById('portal_timezone').options;
-      for (i=1; i<=tzopts.length; i++) {
-        tzopt = tzopts[i-1];
-        if (tzname === tzopt.value){
-          tzopt.selected = 'selected';
-          break;
-        }
-      }
-    }
-    window.onload = function () {
-      "use strict";
-      siteid_focus();
-      set_timezone();
-    };
-  </script>
+  <script type="text/javascript" tal:attributes="src string:${context/absolute_url}/++resource++plone-admin-ui.js"></script>
 </head>
 
 <body>


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-19T15:03:43+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.CMFPlone/commit/4cdc0a6effeb481854be68fe4d055a58a9f5550b

Merge pull request #1042 from plone/sneridagh-fix-847

Added the inline JS of the plone-addsite template to its own static râ€¦

Files changed:
A Products/CMFPlone/browser/static/plone-admin-ui.js
M Products/CMFPlone/browser/admin.zcml
M Products/CMFPlone/browser/templates/plone-addsite.pt

diff --git a/Products/CMFPlone/browser/admin.zcml b/Products/CMFPlone/browser/admin.zcml
index dd49203..12228bf 100644
--- a/Products/CMFPlone/browser/admin.zcml
+++ b/Products/CMFPlone/browser/admin.zcml
@@ -62,6 +62,11 @@
       />
 
   <browser:resource
+      file="static/plone-admin-ui.js"
+      name="plone-admin-ui.js"
+      />
+
+  <browser:resource
       file="static/jstz-1.0.4.min.js"
       name="jstz-1.0.4.min.js"
       />
diff --git a/Products/CMFPlone/browser/static/plone-admin-ui.js b/Products/CMFPlone/browser/static/plone-admin-ui.js
new file mode 100644
index 0000000..2f112f0
--- /dev/null
+++ b/Products/CMFPlone/browser/static/plone-admin-ui.js
@@ -0,0 +1,25 @@
+function siteid_focus() {
+  "use strict";
+  var siteid = document.getElementById('site_id');
+  siteid.focus();
+}
+
+function set_timezone() {
+  "use strict";
+  var i, tzopt,
+      tz = jstz.determine(),
+      tzname = tz.name(),
+      tzopts = document.getElementById('portal_timezone').options;
+  for (i=1; i<=tzopts.length; i++) {
+    tzopt = tzopts[i-1];
+    if (tzname === tzopt.value){
+      tzopt.selected = 'selected';
+      break;
+    }
+  }
+}
+window.onload = function () {
+  "use strict";
+  siteid_focus();
+  set_timezone();
+};
diff --git a/Products/CMFPlone/browser/templates/plone-addsite.pt b/Products/CMFPlone/browser/templates/plone-addsite.pt
index 63cbec7..1009be0 100644
--- a/Products/CMFPlone/browser/templates/plone-addsite.pt
+++ b/Products/CMFPlone/browser/templates/plone-addsite.pt
@@ -15,33 +15,7 @@
         tal:attributes="href string:${context/absolute_url}/++resource++plone-admin-ui.css"
         href="/++resource++plone-admin-ui.css" />
   <script type="text/javascript" tal:attributes="src string:${context/absolute_url}/++resource++jstz-1.0.4.min.js"></script>
-  <script type="text/javascript">
-    function siteid_focus() {
-      "use strict";
-      var siteid = document.getElementById('site_id');
-      siteid.focus();
-    }
-
-    function set_timezone() {
-      "use strict";
-      var i, tzopt,
-          tz = jstz.determine(),
-          tzname = tz.name(),
-          tzopts = document.getElementById('portal_timezone').options;
-      for (i=1; i<=tzopts.length; i++) {
-        tzopt = tzopts[i-1];
-        if (tzname === tzopt.value){
-          tzopt.selected = 'selected';
-          break;
-        }
-      }
-    }
-    window.onload = function () {
-      "use strict";
-      siteid_focus();
-      set_timezone();
-    };
-  </script>
+  <script type="text/javascript" tal:attributes="src string:${context/absolute_url}/++resource++plone-admin-ui.js"></script>
 </head>
 
 <body>


