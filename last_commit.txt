Repository: Products.ATContentTypes
Branch: refs/heads/master
Date: 2015-05-12T14:13:21+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/Products.ATContentTypes/commit/2eb817c5791540c5cf19b8dac7323c5c351fc431

add CSRF token in createObject redirection

Files changed:
M CHANGES.txt
M Products/ATContentTypes/skins/ATContentTypes/createObject.cpy

diff --git a/CHANGES.txt b/CHANGES.txt
index bc73941..8288f70 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 2.2.6 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Add CSRF authenticator in createObject script
+  [ebrehault]
 
 
 2.2.5 (2015-05-04)
diff --git a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
index beabdf4..8de0040 100644
--- a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
+++ b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
@@ -17,6 +17,8 @@ response = REQUEST.response
 response.setHeader('Expires', 'Sat, 01 Jan 2000 00:00:00 GMT')
 response.setHeader('Cache-Control', 'no-cache')
 
+authenticator = context.restrictedTraverse("@@authenticator")
+
 if id is None:
     id = context.generateUniqueId(type_name)
 else:
@@ -37,7 +39,7 @@ if not fti.queryMethodID('edit'):
 if type_name in context.portal_factory.getFactoryTypes():
     new_url = 'portal_factory/' + type_name + '/' + id
     if state.getStatus() != 'success_no_edit':
-        new_url = new_url + '/edit'
+        new_url = new_url + '/edit?_authenticator='  + authenticator.token()
     state.set(status='factory', next_action='redirect_to:string:%s' % new_url)
     # If there's an issue with object creation, let the factory handle it
     return state


Repository: Products.ATContentTypes
Branch: refs/heads/master
Date: 2015-05-18T09:19:01-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.ATContentTypes/commit/8e4fa926b1d839761c603c18c20398868e6df667

Merge pull request #19 from plone/ebr-createobject-authenticator

add CSRF token in createObject redirection

Files changed:
M CHANGES.txt
M Products/ATContentTypes/skins/ATContentTypes/createObject.cpy

diff --git a/CHANGES.txt b/CHANGES.txt
index bc73941..8288f70 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 2.2.6 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Add CSRF authenticator in createObject script
+  [ebrehault]
 
 
 2.2.5 (2015-05-04)
diff --git a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
index beabdf4..8de0040 100644
--- a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
+++ b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
@@ -17,6 +17,8 @@ response = REQUEST.response
 response.setHeader('Expires', 'Sat, 01 Jan 2000 00:00:00 GMT')
 response.setHeader('Cache-Control', 'no-cache')
 
+authenticator = context.restrictedTraverse("@@authenticator")
+
 if id is None:
     id = context.generateUniqueId(type_name)
 else:
@@ -37,7 +39,7 @@ if not fti.queryMethodID('edit'):
 if type_name in context.portal_factory.getFactoryTypes():
     new_url = 'portal_factory/' + type_name + '/' + id
     if state.getStatus() != 'success_no_edit':
-        new_url = new_url + '/edit'
+        new_url = new_url + '/edit?_authenticator='  + authenticator.token()
     state.set(status='factory', next_action='redirect_to:string:%s' % new_url)
     # If there's an issue with object creation, let the factory handle it
     return state


