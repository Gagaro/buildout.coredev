Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-05-05T22:29:13+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/5f597e7f4e09e65faf8a07ec8570d9013ec68f1f

Show the LeadImageViewlet only on default views.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/viewlets.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3a7023b..ae856dc 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,7 @@ Changelog
 1.2a9 (unreleased)
 ------------------
 
-- Don't show LeadImageViewlet on folder_contents view.
+- Show the LeadImageViewlet only on default views.
   [thet]
 
 
diff --git a/plone/app/contenttypes/behaviors/viewlets.py b/plone/app/contenttypes/behaviors/viewlets.py
index 623eaf0..461231a 100644
--- a/plone/app/contenttypes/behaviors/viewlets.py
+++ b/plone/app/contenttypes/behaviors/viewlets.py
@@ -1,6 +1,7 @@
 # -*- coding: utf-8 -*-
 from plone.app.contenttypes.behaviors.leadimage import ILeadImage
 from plone.app.contenttypes.interfaces import INewsItem
+from plone.app.layout.globals.interfaces import IViewView
 from plone.app.layout.viewlets import ViewletBase
 
 
@@ -11,5 +12,5 @@ def update(self):
         self.context = ILeadImage(self.context)
         self.available = True if self.context.image else False
         if INewsItem.providedBy(self.context)\
-                or 'folder_contents' in self.request.URL:
+                or not IViewView.providedBy(self.view):
             self.available = False


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-05-05T22:29:26+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/b05e604c7e9a74ecbf66784bd5f35c55ab0fa65b

adapt test

Files changed:
M plone/app/contenttypes/tests/test_behaviors_leadimage.py

diff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py
index cc9ab9b..c3b4252 100644
--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py
+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py
@@ -79,9 +79,6 @@ def test_lead_image_viewlet_shows_up(self):
 
         self.assertTrue('<div class="leadImage">' in self.browser.contents)
 
-        # But doesn't show up on folder_contents
+        # But doesn't show up on folder_contents, which is not a default view
         self.browser.open(self.portal_url + '/leadimagedoc/folder_contents')
         self.assertTrue('<div class="leadImage">' not in self.browser.contents)
-        # nor @@folder_contents
-        self.browser.open(self.portal_url + '/leadimagedoc/@@folder_contents')
-        self.assertTrue('<div class="leadImage">' not in self.browser.contents)


