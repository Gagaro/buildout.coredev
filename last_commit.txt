Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2015-10-07T13:59:48+02:00
Author: Victor Fernandez de Alba (sneridagh) <sneridagh@gmail.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/492d47f8ba3ea2c773efa9a30499416c2f0881d7

Fix DX upload file from plonebrowser using tinymce-upload view when uploading to a DX p.a.c. default file/image.

Files changed:
M Products/TinyMCE/adapters/Upload.py

diff --git a/Products/TinyMCE/adapters/Upload.py b/Products/TinyMCE/adapters/Upload.py
index f699bb3..d9f13c4 100644
--- a/Products/TinyMCE/adapters/Upload.py
+++ b/Products/TinyMCE/adapters/Upload.py
@@ -164,7 +164,7 @@ def upload(self):
                 obj.description = description
 
         if HAS_DEXTERITY and IDexterityContent.providedBy(obj):
-            if not self.setDexterityItem(obj, uploadfile):
+            if not self.setDexterityItem(obj, uploadfile, id):
                 return self.errorMessage(
                         _("The content-type '${type}' has no image- or file-field!",
                           mapping={'type': metatype}))
@@ -185,7 +185,7 @@ def upload(self):
             path = obj.absolute_url()
         return self.okMessage(path, folder)
 
-    def setDexterityItem(self, obj, uploadfile):
+    def setDexterityItem(self, obj, uploadfile, filename):
         """ Set the blob-field of dexterity-based types
 
         This works with blob-types of plone.app.contenttypes and has
@@ -219,7 +219,7 @@ def setDexterityItem(self, obj, uploadfile):
         else:
             # Create either a NamedBlobImage or a NamedImage
             setattr(obj, field_name, field._type(uploadfile.read(),
-                                                 filename=unicode(id)))
+                                                 filename=unicode(filename)))
         return True
 
     def setDescription(self, description):


