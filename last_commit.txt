Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2015-08-12T16:39:55+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/8de45a82dcfb42f4dab472aed9510ea68caa67ec

5.0 beta: do not set url_expr on configlet.

This must be done with setActionExpression.
Fixes https://github.com/plone/Products.CMFPlone/issues/814

Files changed:
M CHANGES.rst
M plone/app/upgrade/v50/betas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 452129f..2b4a093 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,11 @@ Changelog
 1.3.13 (unreleased)
 -------------------
 
+- 5.0 beta: do not set ``url_expr`` on configlet.  This must be done
+  with ``setActionExpression``.
+  Fixes https://github.com/plone/Products.CMFPlone/issues/814
+  [maurits]
+
 - Turn @@tinymce-controlpanel ``content_css`` field into a list
   [ebrehault]
 
diff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py
index 1bbf12a..719cfea 100644
--- a/plone/app/upgrade/v50/betas.py
+++ b/plone/app/upgrade/v50/betas.py
@@ -258,7 +258,8 @@ def to50beta3(context):
         if x.id == 'TypesSettings'
     ][0]
     configlet.title = "Content Settings"
-    configlet.url_expr = "string:${portal_url}/@@content-controlpanel"
+    configlet.setActionExpression(
+        "string:${portal_url}/@@content-controlpanel")
 
 
 def to50beta4(context):


