Repository: plone.resourceeditor


Branch: refs/heads/master
Date: 2015-10-14T15:43:22+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.resourceeditor/commit/ab88c942cca4df72a19decc8b6c2c53a561ff34f

No longer rely on deprecated bobobase_modification_time from Persistence.Persistent.

Files changed:
M CHANGES.rst
M plone/resourceeditor/browser.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3e3027a..a053d6e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.0.4 (unreleased)
 ------------------
 
+- No longer rely on deprecated ``bobobase_modification_time`` from
+  ``Persistence.Persistent``.
+  [thet]
+
 - Minor cleanup (pep8, readability, ReST)
   [jensens]
 
@@ -13,6 +17,7 @@ Changelog
 - Fixed problem error preventing file saving from the filemanager
   [obct537]
 
+
 2.0.3 (2015-09-27)
 ------------------
 
diff --git a/plone/resourceeditor/browser.py b/plone/resourceeditor/browser.py
index a2f2baa..936088d 100644
--- a/plone/resourceeditor/browser.py
+++ b/plone/resourceeditor/browser.py
@@ -1,5 +1,6 @@
 # -*- coding: utf-8 -*-
 from AccessControl import Unauthorized
+from DateTime import DateTime
 from OFS.Image import File, Image
 from plone.resource.file import FilesystemFile
 from plone.resource.interfaces import IResourceDirectory
@@ -125,7 +126,7 @@ def getInfo(self, obj, path='/'):
         size = 0
 
         if isinstance(obj, File):
-            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')  # noqa
+            properties['dateModified'] = DateTime(obj._p_mtime).strftime('%c')
             size = obj.get_size() / 1024
 
         fileType = self.getExtension(obj)
@@ -641,7 +642,7 @@ def getInfo(self, path, getSize=False):
         }
 
         if isinstance(obj, File):
-            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')  # noqa
+            properties['dateModified'] = DateTime(obj._p_mtime).strftime('%c')
             size = obj.get_size() / 1024
             if size < 1024:
                 size_specifier = u'kb'
@@ -651,8 +652,7 @@ def getInfo(self, path, getSize=False):
             properties['size'] = '%i%s' % (
                 size,
                 translate(_(u'filemanager_%s' % size_specifier,
-                            default=size_specifier), context=self.request)
-                )
+                            default=size_specifier), context=self.request))
 
         fileType = 'txt'
 


Repository: plone.resourceeditor


Branch: refs/heads/master
Date: 2015-10-15T12:39:46+03:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.resourceeditor/commit/2253c6fe2b3e4a29bc1d258598ba331e1d9164a0

Merge pull request #15 from plone/thet-nobobomodification

Remove bobobase_modification_time

Files changed:
M CHANGES.rst
M plone/resourceeditor/browser.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3e3027a..a053d6e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.0.4 (unreleased)
 ------------------
 
+- No longer rely on deprecated ``bobobase_modification_time`` from
+  ``Persistence.Persistent``.
+  [thet]
+
 - Minor cleanup (pep8, readability, ReST)
   [jensens]
 
@@ -13,6 +17,7 @@ Changelog
 - Fixed problem error preventing file saving from the filemanager
   [obct537]
 
+
 2.0.3 (2015-09-27)
 ------------------
 
diff --git a/plone/resourceeditor/browser.py b/plone/resourceeditor/browser.py
index a2f2baa..936088d 100644
--- a/plone/resourceeditor/browser.py
+++ b/plone/resourceeditor/browser.py
@@ -1,5 +1,6 @@
 # -*- coding: utf-8 -*-
 from AccessControl import Unauthorized
+from DateTime import DateTime
 from OFS.Image import File, Image
 from plone.resource.file import FilesystemFile
 from plone.resource.interfaces import IResourceDirectory
@@ -125,7 +126,7 @@ def getInfo(self, obj, path='/'):
         size = 0
 
         if isinstance(obj, File):
-            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')  # noqa
+            properties['dateModified'] = DateTime(obj._p_mtime).strftime('%c')
             size = obj.get_size() / 1024
 
         fileType = self.getExtension(obj)
@@ -641,7 +642,7 @@ def getInfo(self, path, getSize=False):
         }
 
         if isinstance(obj, File):
-            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')  # noqa
+            properties['dateModified'] = DateTime(obj._p_mtime).strftime('%c')
             size = obj.get_size() / 1024
             if size < 1024:
                 size_specifier = u'kb'
@@ -651,8 +652,7 @@ def getInfo(self, path, getSize=False):
             properties['size'] = '%i%s' % (
                 size,
                 translate(_(u'filemanager_%s' % size_specifier,
-                            default=size_specifier), context=self.request)
-                )
+                            default=size_specifier), context=self.request))
 
         fileType = 'txt'
 


