Repository: plone.app.blob
Branch: refs/heads/master
Date: 2015-05-29T12:03:01-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.blob/commit/7cb4aed5d3e01367999e59ccd44d4af80b03a206

reapply at_download fix along with test fix

Files changed:
M src/plone/app/blob/field.py
M src/plone/app/blob/tests/base.py

diff --git a/src/plone/app/blob/field.py b/src/plone/app/blob/field.py
index 5138f8c..97e67eb 100644
--- a/src/plone/app/blob/field.py
+++ b/src/plone/app/blob/field.py
@@ -293,7 +293,7 @@ def fixAutoId(self, instance):
                 # a file name was given, so the instance needs to be renamed...
                 instance.setId(filename)
 
-    @security.private
+    @security.protected(View)
     def download(self, instance, REQUEST=None, RESPONSE=None):
         """ download the file (use default index_html) """
         return self.index_html(
diff --git a/src/plone/app/blob/tests/base.py b/src/plone/app/blob/tests/base.py
index 4c7c389..edd6b24 100644
--- a/src/plone/app/blob/tests/base.py
+++ b/src/plone/app/blob/tests/base.py
@@ -51,7 +51,7 @@ class BlobLinguaFunctionalTestCase(PloneTestCase):
 def changeAllowedSizes(portal, sizes):
     try:
         iprops = portal.portal_properties.imaging_properties
-        iprops.manage_changeProperties(allowed_sizes=['foo 23:23'])
+        iprops.manage_changeProperties(allowed_sizes=sizes)
     except AttributeError:
         # Plone 5, no longer stored here
         registry = queryUtility(IRegistry)


