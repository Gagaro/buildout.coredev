Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-06T20:57:08-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/06de468d519f8a7b3cac6958847d406ec9d2dc9e

fix building when mutliple resources fixes #853

Files changed:
M Products/CMFPlone/controlpanel/browser/resourceregistry.py

diff --git a/Products/CMFPlone/controlpanel/browser/resourceregistry.py b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
index de24d68..8c225de 100644
--- a/Products/CMFPlone/controlpanel/browser/resourceregistry.py
+++ b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
@@ -331,8 +331,13 @@ def save_less_build(self):
         overrides = OverrideFolderManager(self.context)
         req = self.request
         filepath = 'static/%s-compiled.css' % req.form['bundle']
-        data = '\n'.join([req.form[k] for k in req.form.keys()
-                          if k.startswith('data-')])
+        data = ''
+        for key, value in req.form.items():
+            if not key.startswith('data-'):
+                continue
+            if isinstance(value, basestring):
+                value = [value]
+            data += '\n'.join(value) + '\n'
         overrides.save_file(filepath, data)
         bundle = self.get_bundles().get(req.form['bundle'])
         if bundle:


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-06T23:35:03-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/6b0673641e69b54eac535142e98470594199aedb

Merge pull request #871 from plone/fix-multiple-resources-build

fix building when mutliple resources fixes #853

Files changed:
M Products/CMFPlone/controlpanel/browser/resourceregistry.py

diff --git a/Products/CMFPlone/controlpanel/browser/resourceregistry.py b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
index de24d68..8c225de 100644
--- a/Products/CMFPlone/controlpanel/browser/resourceregistry.py
+++ b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
@@ -331,8 +331,13 @@ def save_less_build(self):
         overrides = OverrideFolderManager(self.context)
         req = self.request
         filepath = 'static/%s-compiled.css' % req.form['bundle']
-        data = '\n'.join([req.form[k] for k in req.form.keys()
-                          if k.startswith('data-')])
+        data = ''
+        for key, value in req.form.items():
+            if not key.startswith('data-'):
+                continue
+            if isinstance(value, basestring):
+                value = [value]
+            data += '\n'.join(value) + '\n'
         overrides.save_file(filepath, data)
         bundle = self.get_bundles().get(req.form['bundle'])
         if bundle:


