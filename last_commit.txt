Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-06-25T20:31:23-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/37848a5bb2bf403dea414fa4ce07773409d3043b

upload pattern uses the baseUrl to compute the upload URL, so this should always be the site root and not the current context

Files changed:
M CHANGES.rst
M Products/CMFPlone/patterns/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 264551e..84dbe13 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,10 @@ Changelog
 5.0b3 (unreleased)
 ------------------
 
+- Upload pattern uses the baseUrl to compute the upload URL, so this should
+  always be the site root and not the current context
+  [frapell]
+
 - rewrite css files when saving customized files in the resource registry
   [vangheem]
 
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index a129463..27652aa 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -243,7 +243,7 @@ def tinymce(self):
             'upload': {
                 'initialFolder': initial,
                 'currentPath': current_path,
-                'baseUrl': folder.absolute_url(),
+                'baseUrl': generator.portal_url,
                 'relativePath': '@@fileUpload',
                 'uploadMultiple': False,
                 'maxFiles': 1,


