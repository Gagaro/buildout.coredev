Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-10-05T15:28:51+02:00
Author: Peter Mathis (petschki) <peter.mathis@kombinat.at>
Commit: https://github.com/plone/plone.app.content/commit/ae9702a406d18dae8772590aacccc843e6633efa

fix for vocabulary item path to remove INavigationRoot path

Files changed:
M CHANGES.rst
M plone/app/content/browser/vocabulary.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0c505d7..625cc47 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 3.0.13 (unreleased)
 -------------------
 
+- Fix vocabulary item path to remove INavigationRoot path.
+  [petschki]
+
 - Refactor FolderContentsView to allow reasy overwriting of options.
   [Gagaro]
 
diff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py
index 14a355e..0766e20 100644
--- a/plone/app/content/browser/vocabulary.py
+++ b/plone/app/content/browser/vocabulary.py
@@ -1,7 +1,7 @@
 # -*- coding: utf-8 -*-
 from AccessControl import getSecurityManager
-from Products.CMFCore.utils import getToolByName
 from plone.app.layout.navigation.interfaces import INavigationRoot
+from plone.app.layout.navigation.root import getNavigationRoot
 from Products.Five import BrowserView
 from logging import getLogger
 from plone.app.content.utils import json_dumps
@@ -131,8 +131,7 @@ def __call__(self):
             attributes = attributes.split(',')
 
         if attributes:
-            portal = getToolByName(context, 'portal_url').getPortalObject()
-            base_path = '/'.join(portal.getPhysicalPath())
+            base_path = getNavigationRoot(context)
             for vocab_item in results:
                 if not results_are_brains:
                     vocab_item = vocab_item.value


Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-10-05T09:56:01-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/3d64a8d9cffda230ea69ea8f2c6bde1cb19f71c2

Merge pull request #56 from plone/navroot_support

fix for vocabulary item path to remove INavigationRoot path

Files changed:
M CHANGES.rst
M plone/app/content/browser/vocabulary.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3a77963..7282a50 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 3.0.13 (unreleased)
 -------------------
 
+- Fix vocabulary item path to remove INavigationRoot path.
+  [petschki]
+
 - Refactor FolderContentsView to allow reasy overwriting of options.
 - Fix the actions to allow unicode in titles.
   [Gagaro]
diff --git a/plone/app/content/browser/vocabulary.py b/plone/app/content/browser/vocabulary.py
index 14a355e..0766e20 100644
--- a/plone/app/content/browser/vocabulary.py
+++ b/plone/app/content/browser/vocabulary.py
@@ -1,7 +1,7 @@
 # -*- coding: utf-8 -*-
 from AccessControl import getSecurityManager
-from Products.CMFCore.utils import getToolByName
 from plone.app.layout.navigation.interfaces import INavigationRoot
+from plone.app.layout.navigation.root import getNavigationRoot
 from Products.Five import BrowserView
 from logging import getLogger
 from plone.app.content.utils import json_dumps
@@ -131,8 +131,7 @@ def __call__(self):
             attributes = attributes.split(',')
 
         if attributes:
-            portal = getToolByName(context, 'portal_url').getPortalObject()
-            base_path = '/'.join(portal.getPhysicalPath())
+            base_path = getNavigationRoot(context)
             for vocab_item in results:
                 if not results_are_brains:
                     vocab_item = vocab_item.value


