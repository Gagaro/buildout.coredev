Repository: plone.protect


Branch: refs/heads/master
Date: 2015-10-08T15:40:29-07:00
Author: Alec Mitchell (alecpm) <alecpm@gmail.com>
Commit: https://github.com/plone/plone.protect/commit/00cf2a550f152bc3e68d36f0f4a615ef4e7570c6

Allow per-view customization of X-Frame-Options header.

Files changed:
M CHANGES.rst
M README.rst
M plone/protect/auto.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c252936..c759a8c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 3.0.15 (unreleased)
 -------------------
 
-- nothing;
+- Allow views to override 'X-Frame-Options' by setting the response header
+  manually.
+  [alecm]
 
 3.0.14 (2015-10-08)
 -------------------
diff --git a/README.rst b/README.rst
index 978211c..e47dd3b 100644
--- a/README.rst
+++ b/README.rst
@@ -182,9 +182,11 @@ version 3.0.
 To protect against this attack, plone employs the use of the X-Frame-Options
 header. plone.protect will set the X-Frame-Options value to ``SAMEORIGIN``.
 
-To customize this value, you can either override it at your proxy server or
-you can set the environment variable of ``PLONE_X_FRAME_OPTIONS`` to whatever
-value you'd like plone.protect to set this to.
+To customize this value, you can set it to a custom value for a custom view
+(e.g. ``self.request.response.setHeader('X-Frame-Options', 'ALLOWALL')``),
+override it at your proxy server, or you can set the environment variable of
+``PLONE_X_FRAME_OPTIONS`` to whatever value you'd like plone.protect to set
+this to globally.
 
 You can opt out of this by making the environment variable empty.
 
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 85ee976..393b724 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -108,7 +108,7 @@ def transformIterable(self, result, encoding):
         """
 
         # before anything, do the clickjacking protection
-        if X_FRAME_OPTIONS:
+        if X_FRAME_OPTIONS and not self.request.response.getHeader('X-Frame-Options'):
             self.request.response.setHeader('X-Frame-Options', X_FRAME_OPTIONS)
 
         if CSRF_DISABLED:


