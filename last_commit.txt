Repository: plone.app.event


Branch: refs/heads/master
Date: 2015-06-22T21:03:39+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.event/commit/34b8387c86cd6910560f3709e4e1559ceda0389c

For thetthe event portlet, cache the list of events on the request (plone.memoize.view) instead of the instance, which creates a write transaction.

Files changed:
M CHANGES.rst
M plone/app/event/portlets/portlet_events.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 9c54642..f619d03 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,11 @@ Changelog
 2.0a13 (unreleased)
 -------------------
 
+- For the event portlet, cache the list of events on the request
+  (plone.memoize.view) instead of the instance, which creates a write
+  transaction.
+  [thet]
+
 - Let ``date_speller`` return the short, 2-letter weekday abbreviation instead
   of a 3-letter one.
   [thet]
diff --git a/plone/app/event/portlets/portlet_events.py b/plone/app/event/portlets/portlet_events.py
index 86c34fc..5fc5568 100644
--- a/plone/app/event/portlets/portlet_events.py
+++ b/plone/app/event/portlets/portlet_events.py
@@ -17,7 +17,7 @@
 from plone.app.uuid.utils import uuidToObject
 from plone.app.vocabularies.catalog import CatalogSource
 from plone.memoize.compress import xhtml_compress
-from plone.memoize.instance import memoize
+from plone.memoize import view
 from plone.portlets.interfaces import IPortletDataProvider
 from zExceptions import NotFound
 from zope import schema
@@ -145,7 +145,7 @@ def available(self):
         return self.data.count > 0 and len(self.events)
 
     @property
-    @memoize
+    @view.memoize
     def events(self):
         context = aq_inner(self.context)
         data = self.data


