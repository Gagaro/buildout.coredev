Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2015-07-09T17:09:19+02:00
Author: Harald Friessnegger (frisi) <harald@webmeisterei.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/9f59fa0a4c932f596866131776e9cefdee000fed

prevent diazo from manipulating the returned html page to ensure uploadOk is called correctly

Files changed:
M HISTORY.rst
M Products/TinyMCE/browser/browser.py

diff --git a/HISTORY.rst b/HISTORY.rst
index c532073..bd7e337 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -5,7 +5,10 @@ HISTORY
 1.3.11 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- deactivate diazo for ``@@tinymce-upload`` view to make
+  sure ``uploadOk`` script is called to update the
+  content browser panel.
+  [fRiSi]
 
 
 1.3.10 (2015-06-26)
diff --git a/Products/TinyMCE/browser/browser.py b/Products/TinyMCE/browser/browser.py
index b3dc24a..b985a8c 100644
--- a/Products/TinyMCE/browser/browser.py
+++ b/Products/TinyMCE/browser/browser.py
@@ -30,6 +30,8 @@ class TinyMCEBrowserView(BrowserView):
     def upload(self):
         """Upload a file to the zodb"""
 
+        # keep diazo from touching this page
+        self.request.response.setHeader('X-Theme-Disabled', 'True')
         context = IUpload(self.context)
         return context.upload()
 


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2015-07-22T17:42:50+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/c65e26b6fb333e354dca96bf0c7078f5cbb96d72

Merge branch '1.3.x' into diazo-friendly

Files changed:
M HISTORY.rst
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/editor_plugin.js
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
M Products/TinyMCE/skins/tinymce/plugins/plonebrowser/plonebrowser.htm.pt
M README.rst

diff --git a/HISTORY.rst b/HISTORY.rst
index bd7e337..ed92bca 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -10,6 +10,12 @@ HISTORY
   content browser panel.
   [fRiSi]
 
+- UI and UX improvements: Do not cover upload button.
+  Clickable icons. (fixes #106) [fRiSi]
+
+- Fixed current image scale in image popups
+  [huubbouma]
+
 
 1.3.10 (2015-06-26)
 -------------------
diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/editor_plugin.js b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/editor_plugin.js
index d850199..90bc1d7 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/editor_plugin.js
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/editor_plugin.js
@@ -1 +1 @@
-(function(){tinymce.create("tinymce.plugins.PloneBrowserPlugin",{init:function(a,b){a.addCommand("mcePloneImage",function(){var c=a.dom.getAttrib(a.selection.getNode(),"class");if(c&&c.indexOf("mceItem")!==-1){return}a.windowManager.open({file:b+"/plonebrowser.htm?ploneimage=1",width:820+parseInt(a.getLang("plonebrowser.delta_width",0),10),height:500+parseInt(a.getLang("plonebrowser.delta_height",0),10),inline:1},{plugin_url:b})});a.addCommand("mcePloneLink",function(){var c=a.selection;if(c.isCollapsed()&&!a.dom.getParent(c.getNode(),"A")){return}a.windowManager.open({file:b+"/plonebrowser.htm?plonelink=1",width:820+parseInt(a.getLang("plonebrowser.delta_width",0)),height:540+parseInt(a.getLang("plonebrowser.delta_height",0)),inline:1},{plugin_url:b})});a.addButton("image",{title:"advanced.image_desc",cmd:"mcePloneImage"});a.addButton("link",{title:"advanced.link_desc",cmd:"mcePloneLink"});a.addShortcut("ctrl+k","advanced.link_desc","mcePloneLink")},getInfo:function(){return{longname:"Plone browser",author:"Plone Foundation",authorurl:"http://plone.org",infourl:"http://plone.org/products/tinymce",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("plonebrowser",tinymce.plugins.PloneBrowserPlugin)}());
\ No newline at end of file
+(function(){tinymce.create("tinymce.plugins.PloneBrowserPlugin",{init:function(a,b){a.addCommand("mcePloneImage",function(){var c=a.dom.getAttrib(a.selection.getNode(),"class");if(c&&c.indexOf("mceItem")!==-1){return}a.windowManager.open({file:b+"/plonebrowser.htm?ploneimage=1",width:820+parseInt(a.getLang("plonebrowser.delta_width",0),10),height:540+parseInt(a.getLang("plonebrowser.delta_height",0),10),inline:1},{plugin_url:b})});a.addCommand("mcePloneLink",function(){var c=a.selection;if(c.isCollapsed()&&!a.dom.getParent(c.getNode(),"A")){return}a.windowManager.open({file:b+"/plonebrowser.htm?plonelink=1",width:820+parseInt(a.getLang("plonebrowser.delta_width",0)),height:540+parseInt(a.getLang("plonebrowser.delta_height",0)),inline:1},{plugin_url:b})});a.addButton("image",{title:"advanced.image_desc",cmd:"mcePloneImage"});a.addButton("link",{title:"advanced.link_desc",cmd:"mcePloneLink"});a.addShortcut("ctrl+k","advanced.link_desc","mcePloneLink")},getInfo:function(){return{longname:"Plone browser",author:"Plone Foundation",authorurl:"http://plone.org",infourl:"http://plone.org/products/tinymce",version:tinymce.majorVersion+"."+tinymce.minorVersion}}});tinymce.PluginManager.add("plonebrowser",tinymce.plugins.PloneBrowserPlugin)}());
\ No newline at end of file
diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
index f95a9d7..b47ec6d 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/js/plonebrowser.js
@@ -349,8 +349,8 @@ BrowserDialog.prototype.init = function () {
             } else {
                 scaled_image = this.parseImageScale(selected_node.attr("src"));
 
-                // Update the dimensions <select> with the corresponding value.
-                jq('#dimensions', document).val(scaled_image.scale);
+                // Store the selected scale on the dimensions <select>.
+                jq('#dimensions', document).data('selectedScale', scaled_image.scale);
 
                 if (scaled_image.url.indexOf('resolveuid/') > -1) {
                     /** Handle UID linked image **/
@@ -739,7 +739,7 @@ BrowserDialog.prototype.setDetails = function (url) {
         'url': url + '/tinymce-jsondetails',
         'dataType': 'json',
         'success': function (data) {
-            var dimension = jq('#dimensions', document).val(),
+            var dimension = jq('#dimensions', document).data('selectedScale'),
                 dimensions,
                 i;
 
diff --git a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/plonebrowser.htm.pt b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/plonebrowser.htm.pt
index c26bfb6..1e9e41f 100644
--- a/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/plonebrowser.htm.pt
+++ b/Products/TinyMCE/skins/tinymce/plugins/plonebrowser/plonebrowser.htm.pt
@@ -14,22 +14,26 @@
   <div class="dialog-wrapper icons-on" id="content">
 
         <div id="linktype_panel">
-            <div id="linktype">
+            <div id="linktype" i18n:domain="plone.tinymce">
                 <div id="internal_link" class="current">
-                    <img src="img/internal_link.png" />
-                    <a href="#internal" i18n:translate="" i18n:domain="plone.tinymce">Internal</a>
+                    <a href="#internal">
+                      <img src="img/internal_link.png" />
+                      <span i18n:translate="">Internal</span></a>
                 </div>
                 <div id="external_link">
-                    <img src="img/external_link.png" />
-                    <a href="#external" i18n:translate="" i18n:domain="plone.tinymce">External</a>
+                    <a href="#external">
+                      <img src="img/external_link.png" />
+                      <span i18n:translate="">External</span></a>
                 </div>
                 <div id="email_link">
-                    <img src="img/email_link.png" />
-                    <a href="#email" i18n:translate="" i18n:domain="plone.tinymce">Email</a>
+                    <a href="#email">
+                      <img src="img/email_link.png" />
+                      <span i18n:translate="">Email</span></a>
                 </div>
                 <div id="anchor_link">
-                    <img src="img/anchor_link.png" />
-                    <a href="#anchor" i18n:translate="" i18n:domain="plone.tinymce">Anchor</a>
+                    <a href="#anchor">
+                      <img src="img/anchor_link.png" />
+                      <span i18n:translate="">Anchor</span></a>
                 </div>
             </div>
         </div>
@@ -259,7 +263,7 @@
 
         <div id="footer" class="row">
             <div id="upload-button" class="cell width-3:4 position-0 hide">
-                <img src="img/application_get.png" /> <a id="upload" href="" i18n:translate="" i18n:domain="plone.tinymce">Upload</a>
+                <a id="upload" href=""><img src="img/application_get.png" /> <span i18n:translate="" i18n:domain="plone.tinymce">Upload</span></a>
             </div>
             <div id="action-button" class="cell width-1:4 position-3:4">
                 <input type="submit" id="insert-selection" class="context plonebutton" name="insert-image"
diff --git a/README.rst b/README.rst
index 1604735..950fb06 100644
--- a/README.rst
+++ b/README.rst
@@ -1 +1 @@
-Documentation at http://readthedocs.org/docs/productstinymce/
+Documentation at https://productstinymce.readthedocs.org/en/latest/


Repository: Products.TinyMCE


Branch: refs/heads/1.3.x
Date: 2015-07-22T17:43:13+02:00
Author: Fred van Dijk (fredvd) <fredvd@gmail.com>
Commit: https://github.com/plone/Products.TinyMCE/commit/c3cd2d42ff1394b2ae01f3ef0faf03fc6ab82af8

Merge branch 'diazo-friendly' into 1.3.x

Files changed:
M HISTORY.rst
M Products/TinyMCE/browser/browser.py

diff --git a/HISTORY.rst b/HISTORY.rst
index 43c247d..ed92bca 100644
--- a/HISTORY.rst
+++ b/HISTORY.rst
@@ -5,6 +5,11 @@ HISTORY
 1.3.11 (unreleased)
 -------------------
 
+- deactivate diazo for ``@@tinymce-upload`` view to make
+  sure ``uploadOk`` script is called to update the
+  content browser panel.
+  [fRiSi]
+
 - UI and UX improvements: Do not cover upload button.
   Clickable icons. (fixes #106) [fRiSi]
 
diff --git a/Products/TinyMCE/browser/browser.py b/Products/TinyMCE/browser/browser.py
index b3dc24a..b985a8c 100644
--- a/Products/TinyMCE/browser/browser.py
+++ b/Products/TinyMCE/browser/browser.py
@@ -30,6 +30,8 @@ class TinyMCEBrowserView(BrowserView):
     def upload(self):
         """Upload a file to the zodb"""
 
+        # keep diazo from touching this page
+        self.request.response.setHeader('X-Theme-Disabled', 'True')
         context = IUpload(self.context)
         return context.upload()
 


