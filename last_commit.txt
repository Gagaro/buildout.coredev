Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2015-11-05T14:44:32-06:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/04d2d89d9226fd72753dfa5e6261113ec72dc5b3

Fix case where unicode ends up getting used when resolving
  img tags and (un)restrictedTraverse does not work with unicode

Files changed:
M CHANGES.txt
M plone/outputfilters/filters/resolveuid_and_caption.py

diff --git a/CHANGES.txt b/CHANGES.txt
index 16dd8e7..13839eb 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,9 @@ Changelog
 2.1.1 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fix case where unicode ends up getting used when resolving
+  img tags and (un)restrictedTraverse doesn't work with unicode
+  [vangheem]
 
 
 2.1 (2015-07-18)
diff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py
index 112e6bc..26b7599 100644
--- a/plone/outputfilters/filters/resolveuid_and_caption.py
+++ b/plone/outputfilters/filters/resolveuid_and_caption.py
@@ -205,7 +205,7 @@ def traversal_stack(base, path):
                         # Also, if the image itself is not viewable, we rather
                         # show a broken image than hide it or raise
                         # unauthorized here (for the referring document).
-                        child = obj.unrestrictedTraverse(child_id)
+                        child = obj.unrestrictedTraverse(str(child_id))
                 except ConflictError:
                     raise
                 except (AttributeError, KeyError, NotFound, ztkNotFound):


Repository: plone.outputfilters


Branch: refs/heads/master
Date: 2015-11-06T11:19:33-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.outputfilters/commit/3a57f7583ee729f03f26861ec5e15e0d4ddc9866

Merge pull request #14 from plone/unicode-img

Fix issue with unicode, img tags and unrestrictedTraverse

Files changed:
M CHANGES.txt
M plone/outputfilters/filters/resolveuid_and_caption.py

diff --git a/CHANGES.txt b/CHANGES.txt
index 16dd8e7..13839eb 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,9 @@ Changelog
 2.1.1 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fix case where unicode ends up getting used when resolving
+  img tags and (un)restrictedTraverse doesn't work with unicode
+  [vangheem]
 
 
 2.1 (2015-07-18)
diff --git a/plone/outputfilters/filters/resolveuid_and_caption.py b/plone/outputfilters/filters/resolveuid_and_caption.py
index 112e6bc..26b7599 100644
--- a/plone/outputfilters/filters/resolveuid_and_caption.py
+++ b/plone/outputfilters/filters/resolveuid_and_caption.py
@@ -205,7 +205,7 @@ def traversal_stack(base, path):
                         # Also, if the image itself is not viewable, we rather
                         # show a broken image than hide it or raise
                         # unauthorized here (for the referring document).
-                        child = obj.unrestrictedTraverse(child_id)
+                        child = obj.unrestrictedTraverse(str(child_id))
                 except ConflictError:
                     raise
                 except (AttributeError, KeyError, NotFound, ztkNotFound):


