Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2015-09-16T15:35:48+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.widgets/commit/7bd8c8c46250c249b56bb8ff2b8d4c5e927ac1e3

Pull types_link_to_folder_contents values from the configuration registry.

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 8e09e3e..241a9f1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.0.1 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Pull types_link_to_folder_contents values from the configuration registry.
+  [esteele]
 
 
 2.0.0 (2015-03-26)
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index 63b0bc3..a439bdb 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -2,10 +2,13 @@
 
 from Products.CMFCore.interfaces import ISiteRoot
 from Products.CMFCore.utils import getToolByName
+from Products.CMFPlone.interfaces import ITypesSchema
+from plone.registry.interfaces import IRegistry
 from datetime import datetime
 from plone.app.layout.navigation.root import getNavigationRootObject
 from zope.component import providedBy
 from zope.component import queryUtility
+from zope.component import getUtility
 from zope.component.hooks import getSite
 from zope.i18n import translate
 from zope.i18nmessageid import MessageFactory
@@ -136,10 +139,9 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
     options.setdefault('homeText', msgstr)
     options.setdefault('folderTypes', ['Folder'])
 
-    properties = getToolByName(context, 'portal_properties')
-    if properties:
-        options['folderTypes'] = properties.site_properties.getProperty(
-            'typesLinkToFolderContentsInFC', options['folderTypes'])
+    registry = getUtility(IRegistry)
+    settings = registry.forInterface(ITypesSchema, prefix="plone")
+    options['folderTypes'] = settings.types_link_to_folder_contents
 
     return options
 


Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2015-09-17T15:50:57+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.widgets/commit/936baf27f5e729c36231009a1fa5b69c1326be08

Use failover get method.

Files changed:
M plone/app/widgets/utils.py

diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index a439bdb..144f26a 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -2,7 +2,6 @@
 
 from Products.CMFCore.interfaces import ISiteRoot
 from Products.CMFCore.utils import getToolByName
-from Products.CMFPlone.interfaces import ITypesSchema
 from plone.registry.interfaces import IRegistry
 from datetime import datetime
 from plone.app.layout.navigation.root import getNavigationRootObject
@@ -138,10 +137,9 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
                        context=request)
     options.setdefault('homeText', msgstr)
     options.setdefault('folderTypes', ['Folder'])
-
     registry = getUtility(IRegistry)
-    settings = registry.forInterface(ITypesSchema, prefix="plone")
-    options['folderTypes'] = settings.types_link_to_folder_contents
+    options['folderTypes'] = registry.get(
+        'plone.types_link_to_folder_contents', [])
 
     return options
 


Repository: plone.app.widgets


Branch: refs/heads/master
Date: 2015-09-20T17:32:42+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.widgets/commit/05b2719219899b34a1eccdc458df8fbb2e36642e

Merge pull request #110 from plone/portal-properties-cleanup

Portal properties cleanup

Files changed:
M CHANGES.rst
M plone/app/widgets/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 8e09e3e..241a9f1 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.0.1 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Pull types_link_to_folder_contents values from the configuration registry.
+  [esteele]
 
 
 2.0.0 (2015-03-26)
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index 63b0bc3..144f26a 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -2,10 +2,12 @@
 
 from Products.CMFCore.interfaces import ISiteRoot
 from Products.CMFCore.utils import getToolByName
+from plone.registry.interfaces import IRegistry
 from datetime import datetime
 from plone.app.layout.navigation.root import getNavigationRootObject
 from zope.component import providedBy
 from zope.component import queryUtility
+from zope.component import getUtility
 from zope.component.hooks import getSite
 from zope.i18n import translate
 from zope.i18nmessageid import MessageFactory
@@ -135,11 +137,9 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
                        context=request)
     options.setdefault('homeText', msgstr)
     options.setdefault('folderTypes', ['Folder'])
-
-    properties = getToolByName(context, 'portal_properties')
-    if properties:
-        options['folderTypes'] = properties.site_properties.getProperty(
-            'typesLinkToFolderContentsInFC', options['folderTypes'])
+    registry = getUtility(IRegistry)
+    options['folderTypes'] = registry.get(
+        'plone.types_link_to_folder_contents', [])
 
     return options
 


