Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-11-20T15:26:27-06:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/ad8808485c4bf7ed7de9325b16a706d1652ef023

Fix potential acquisition issues with folder listings

Files changed:
M CHANGES.rst
M plone/app/contenttypes/browser/folder.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 532a65a..f39738f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -11,6 +11,9 @@ New:
 
 Fixes:
 
+- Fix potential acquisition issues with folder listings
+  [vangheem]
+
 - Avoid AttributeError when trying to get the default_page of an item
   when migrating
   [frapell]
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 50b5c33..fd1abf5 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -1,5 +1,8 @@
 # -*- coding: utf-8 -*-
+import random
+
 from Acquisition import aq_base
+from Acquisition import aq_inner
 from Products.CMFPlone.PloneBatch import Batch
 from Products.CMFPlone.utils import safe_callable
 from Products.Five import BrowserView
@@ -12,7 +15,6 @@
 from zope.component import getMultiAdapter
 from zope.component import getUtility
 from zope.contentprovider.interfaces import IContentProvider
-import random
 
 HAS_SECURITY_SETTINGS = True
 try:
@@ -62,7 +64,7 @@ def results(self, **kwargs):
         kwargs.setdefault('b_size', self.b_size)
         kwargs.setdefault('b_start', self.b_start)
 
-        results = self.context.restrictedTraverse('@@folderListing')(**kwargs)
+        results = aq_inner(self.context).restrictedTraverse('@@folderListing')(**kwargs)
         return results
 
     def batch(self):
@@ -211,4 +213,4 @@ def no_items_message(self):
         return _(
             'description_no_items_in_folder',
             default=u"There are currently no items in this folder."
-        )
+        )
\ No newline at end of file


