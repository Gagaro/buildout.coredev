Repository: Products.ATContentTypes
Branch: refs/heads/master
Date: 2015-01-22T20:54:28+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.ATContentTypes/commit/623e62db796cee96709049d529f864da1f3fb82b

Revert "Revert "Add profile 'base' to allow addons to depend on ATContentTypes i..."

Files changed:
A Products/ATContentTypes/profiles/base/componentregistry.xml
A Products/ATContentTypes/profiles/base/metadata.xml
A Products/ATContentTypes/profiles/base/rolemap.xml
A Products/ATContentTypes/profiles/base/skins.xml
A Products/ATContentTypes/profiles/base/toolset.xml
A Products/ATContentTypes/tests/test_base_profile.py
M CHANGES.txt
M Products/ATContentTypes/configure.zcml
M Products/ATContentTypes/profiles/default/metadata.xml
M Products/ATContentTypes/profiles/default/types.xml
D Products/ATContentTypes/profiles/default/componentregistry.xml
D Products/ATContentTypes/profiles/default/rolemap.xml
D Products/ATContentTypes/profiles/default/skins.xml
D Products/ATContentTypes/profiles/default/toolset.xml

diff --git a/CHANGES.txt b/CHANGES.txt
index 39ff9c7..206fa13 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,9 @@ Changelog
 2.2.3 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Add profile 'base' to allow addons to depend on ATContentTypes in Plone 5
+  without uninstalling the dexterity default-types.
+  [pbauer]
 
 
 2.2.2 (2014-10-23)
diff --git a/Products/ATContentTypes/configure.zcml b/Products/ATContentTypes/configure.zcml
index db7a6dd..1a5792a 100644
--- a/Products/ATContentTypes/configure.zcml
+++ b/Products/ATContentTypes/configure.zcml
@@ -60,6 +60,14 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="base"
+      title="Archetypes-tools without content-types"
+      directory="profiles/base"
+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
   <genericsetup:importStep
       name="atct_content"
       title="ATContentTypes default content"
diff --git a/Products/ATContentTypes/profiles/base/componentregistry.xml b/Products/ATContentTypes/profiles/base/componentregistry.xml
new file mode 100644
index 0000000..7a4d865
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/componentregistry.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+<componentregistry>
+ <utilities>
+  <utility
+     interface="Products.ATContentTypes.interface.IATCTTool"
+     object="portal_atct"/>
+ </utilities>
+</componentregistry>
diff --git a/Products/ATContentTypes/profiles/base/metadata.xml b/Products/ATContentTypes/profiles/base/metadata.xml
new file mode 100644
index 0000000..964d111
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/metadata.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+<metadata>
+  <version>1</version>
+  <dependencies>
+    <dependency>profile-Products.Archetypes:Archetypes</dependency>
+    <dependency>profile-Products.CMFFormController:CMFFormController</dependency>
+  </dependencies>
+</metadata>
diff --git a/Products/ATContentTypes/profiles/base/rolemap.xml b/Products/ATContentTypes/profiles/base/rolemap.xml
new file mode 100644
index 0000000..ff91619
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/rolemap.xml
@@ -0,0 +1,47 @@
+<?xml version="1.0"?>
+<rolemap>
+  <permissions>
+    <permission name="ATContentTypes: Add Document" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Event" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add File" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Folder" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Image" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Link" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add News Item" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+  </permissions>
+</rolemap>
diff --git a/Products/ATContentTypes/profiles/base/skins.xml b/Products/ATContentTypes/profiles/base/skins.xml
new file mode 100644
index 0000000..4e2ae22
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/skins.xml
@@ -0,0 +1,11 @@
+<?xml version="1.0"?>
+<object name="portal_skins" meta_type="Plone Skins Tool">
+ <object name="ATContentTypes" meta_type="Filesystem Directory View"
+    directory="Products.ATContentTypes:skins/ATContentTypes"/>
+ <object name="archetypes" meta_type="Filesystem Directory View"
+    directory="Products.Archetypes:skins/archetypes"/>
+ <skin-path name="*">
+  <layer name="ATContentTypes" insert-after="custom"/>
+  <layer name="archetypes" insert-after="custom"/>
+ </skin-path>
+</object>
diff --git a/Products/ATContentTypes/profiles/base/toolset.xml b/Products/ATContentTypes/profiles/base/toolset.xml
new file mode 100644
index 0000000..6f6b568
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/toolset.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+<tool-setup>
+ <required tool_id="portal_atct"
+           class="Products.ATContentTypes.tool.atct.ATCTTool"/>
+ <required tool_id="portal_factory"
+           class="Products.ATContentTypes.tool.factory.FactoryTool"/>
+ <required tool_id="portal_metadata"
+           class="Products.ATContentTypes.tool.metadata.MetadataTool"/>
+</tool-setup>
diff --git a/Products/ATContentTypes/profiles/default/componentregistry.xml b/Products/ATContentTypes/profiles/default/componentregistry.xml
deleted file mode 100644
index 7a4d865..0000000
--- a/Products/ATContentTypes/profiles/default/componentregistry.xml
+++ /dev/null
@@ -1,8 +0,0 @@
-<?xml version="1.0"?>
-<componentregistry>
- <utilities>
-  <utility
-     interface="Products.ATContentTypes.interface.IATCTTool"
-     object="portal_atct"/>
- </utilities>
-</componentregistry>
diff --git a/Products/ATContentTypes/profiles/default/metadata.xml b/Products/ATContentTypes/profiles/default/metadata.xml
index 4410f5f..4ff0d5f 100644
--- a/Products/ATContentTypes/profiles/default/metadata.xml
+++ b/Products/ATContentTypes/profiles/default/metadata.xml
@@ -2,8 +2,7 @@
 <metadata>
   <version>1</version>
   <dependencies>
-    <dependency>profile-Products.Archetypes:Archetypes</dependency>
-    <dependency>profile-Products.CMFFormController:CMFFormController</dependency>
+    <dependency>profile-Products.ATContentTypes:base</dependency>
     <dependency>profile-plone.app.collection:default</dependency>
     <dependency>profile-plone.app.imaging:default</dependency>
     <dependency>profile-plone.app.widgets:default</dependency>
diff --git a/Products/ATContentTypes/profiles/default/rolemap.xml b/Products/ATContentTypes/profiles/default/rolemap.xml
deleted file mode 100644
index ff91619..0000000
--- a/Products/ATContentTypes/profiles/default/rolemap.xml
+++ /dev/null
@@ -1,47 +0,0 @@
-<?xml version="1.0"?>
-<rolemap>
-  <permissions>
-    <permission name="ATContentTypes: Add Document" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Event" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add File" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Folder" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Image" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Link" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add News Item" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-  </permissions>
-</rolemap>
diff --git a/Products/ATContentTypes/profiles/default/skins.xml b/Products/ATContentTypes/profiles/default/skins.xml
deleted file mode 100644
index 4e2ae22..0000000
--- a/Products/ATContentTypes/profiles/default/skins.xml
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_skins" meta_type="Plone Skins Tool">
- <object name="ATContentTypes" meta_type="Filesystem Directory View"
-    directory="Products.ATContentTypes:skins/ATContentTypes"/>
- <object name="archetypes" meta_type="Filesystem Directory View"
-    directory="Products.Archetypes:skins/archetypes"/>
- <skin-path name="*">
-  <layer name="ATContentTypes" insert-after="custom"/>
-  <layer name="archetypes" insert-after="custom"/>
- </skin-path>
-</object>
diff --git a/Products/ATContentTypes/profiles/default/toolset.xml b/Products/ATContentTypes/profiles/default/toolset.xml
deleted file mode 100644
index 6f6b568..0000000
--- a/Products/ATContentTypes/profiles/default/toolset.xml
+++ /dev/null
@@ -1,9 +0,0 @@
-<?xml version="1.0"?>
-<tool-setup>
- <required tool_id="portal_atct"
-           class="Products.ATContentTypes.tool.atct.ATCTTool"/>
- <required tool_id="portal_factory"
-           class="Products.ATContentTypes.tool.factory.FactoryTool"/>
- <required tool_id="portal_metadata"
-           class="Products.ATContentTypes.tool.metadata.MetadataTool"/>
-</tool-setup>
diff --git a/Products/ATContentTypes/profiles/default/types.xml b/Products/ATContentTypes/profiles/default/types.xml
index 325a6d1..10a5c78 100644
--- a/Products/ATContentTypes/profiles/default/types.xml
+++ b/Products/ATContentTypes/profiles/default/types.xml
@@ -1,5 +1,15 @@
 <?xml version="1.0"?>
 <object name="portal_types" meta_type="Plone Types Tool">
+ <!-- We remove existing FTIs since they could be Dexterity-based and would
+ not be compatible in that case -->
+ <object name="Document" remove="True"/>
+ <object name="Event" remove="True"/>
+ <object name="File" remove="True"/>
+ <object name="Folder" remove="True"/>
+ <object name="Image" remove="True"/>
+ <object name="Link" remove="True"/>
+ <object name="News Item" remove="True"/>
+
  <property
     name="title">Controls the available content types in your portal</property>
  <object name="ATBooleanCriterion"
diff --git a/Products/ATContentTypes/tests/test_base_profile.py b/Products/ATContentTypes/tests/test_base_profile.py
new file mode 100644
index 0000000..2c34d1e
--- /dev/null
+++ b/Products/ATContentTypes/tests/test_base_profile.py
@@ -0,0 +1,20 @@
+# -*- coding: UTF-8 -*-
+from Products.PloneTestCase.PloneTestCase import PloneTestCase
+from Products.CMFCore.utils import getToolByName
+from Products.CMFDynamicViewFTI.interfaces import IDynamicViewTypeInformation
+
+
+class TestBaseProfile(PloneTestCase):
+
+    def afterSetUp(self):
+        self.loginAsPortalOwner()
+        qi = self.portal.portal_quickinstaller
+        qi.uninstallProducts(['ATContentTypes'])
+        portal_setup = self.portal.portal_setup
+        portal_setup.runAllImportStepsFromProfile('profile-Products.ATContentTypes:base')
+
+    def test_attypes_not_installed(self):
+        tt = getToolByName(self.portal, 'portal_types')
+        types = tt.listTypeInfo()
+        for t in types:
+            self.assertNotEqual(t.product, 'ATContentTypes')


Repository: Products.ATContentTypes
Branch: refs/heads/master
Date: 2015-01-23T09:38:14+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.ATContentTypes/commit/a15b5992597d4dd4819d4fcfe222c418cc89d0fc

Merge pull request #13 from plone/revert-12-revert-11-master

Revert "Revert "Add profile 'base' to allow addons to depend on ATConten...

Files changed:
A Products/ATContentTypes/profiles/base/componentregistry.xml
A Products/ATContentTypes/profiles/base/metadata.xml
A Products/ATContentTypes/profiles/base/rolemap.xml
A Products/ATContentTypes/profiles/base/skins.xml
A Products/ATContentTypes/profiles/base/toolset.xml
A Products/ATContentTypes/tests/test_base_profile.py
M CHANGES.txt
M Products/ATContentTypes/configure.zcml
M Products/ATContentTypes/profiles/default/metadata.xml
M Products/ATContentTypes/profiles/default/types.xml
D Products/ATContentTypes/profiles/default/componentregistry.xml
D Products/ATContentTypes/profiles/default/rolemap.xml
D Products/ATContentTypes/profiles/default/skins.xml
D Products/ATContentTypes/profiles/default/toolset.xml

diff --git a/CHANGES.txt b/CHANGES.txt
index 39ff9c7..206fa13 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,9 @@ Changelog
 2.2.3 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Add profile 'base' to allow addons to depend on ATContentTypes in Plone 5
+  without uninstalling the dexterity default-types.
+  [pbauer]
 
 
 2.2.2 (2014-10-23)
diff --git a/Products/ATContentTypes/configure.zcml b/Products/ATContentTypes/configure.zcml
index db7a6dd..1a5792a 100644
--- a/Products/ATContentTypes/configure.zcml
+++ b/Products/ATContentTypes/configure.zcml
@@ -60,6 +60,14 @@
       provides="Products.GenericSetup.interfaces.EXTENSION"
       />
 
+  <genericsetup:registerProfile
+      name="base"
+      title="Archetypes-tools without content-types"
+      directory="profiles/base"
+      for="Products.CMFPlone.interfaces.IPloneSiteRoot"
+      provides="Products.GenericSetup.interfaces.EXTENSION"
+      />
+
   <genericsetup:importStep
       name="atct_content"
       title="ATContentTypes default content"
diff --git a/Products/ATContentTypes/profiles/base/componentregistry.xml b/Products/ATContentTypes/profiles/base/componentregistry.xml
new file mode 100644
index 0000000..7a4d865
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/componentregistry.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+<componentregistry>
+ <utilities>
+  <utility
+     interface="Products.ATContentTypes.interface.IATCTTool"
+     object="portal_atct"/>
+ </utilities>
+</componentregistry>
diff --git a/Products/ATContentTypes/profiles/base/metadata.xml b/Products/ATContentTypes/profiles/base/metadata.xml
new file mode 100644
index 0000000..964d111
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/metadata.xml
@@ -0,0 +1,8 @@
+<?xml version="1.0"?>
+<metadata>
+  <version>1</version>
+  <dependencies>
+    <dependency>profile-Products.Archetypes:Archetypes</dependency>
+    <dependency>profile-Products.CMFFormController:CMFFormController</dependency>
+  </dependencies>
+</metadata>
diff --git a/Products/ATContentTypes/profiles/base/rolemap.xml b/Products/ATContentTypes/profiles/base/rolemap.xml
new file mode 100644
index 0000000..ff91619
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/rolemap.xml
@@ -0,0 +1,47 @@
+<?xml version="1.0"?>
+<rolemap>
+  <permissions>
+    <permission name="ATContentTypes: Add Document" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Event" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add File" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Folder" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Image" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add Link" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+    <permission name="ATContentTypes: Add News Item" acquire="True">
+      <role name="Manager"/>
+      <role name="Site Administrator"/>
+      <role name="Owner"/>
+      <role name="Contributor"/>
+    </permission>
+  </permissions>
+</rolemap>
diff --git a/Products/ATContentTypes/profiles/base/skins.xml b/Products/ATContentTypes/profiles/base/skins.xml
new file mode 100644
index 0000000..4e2ae22
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/skins.xml
@@ -0,0 +1,11 @@
+<?xml version="1.0"?>
+<object name="portal_skins" meta_type="Plone Skins Tool">
+ <object name="ATContentTypes" meta_type="Filesystem Directory View"
+    directory="Products.ATContentTypes:skins/ATContentTypes"/>
+ <object name="archetypes" meta_type="Filesystem Directory View"
+    directory="Products.Archetypes:skins/archetypes"/>
+ <skin-path name="*">
+  <layer name="ATContentTypes" insert-after="custom"/>
+  <layer name="archetypes" insert-after="custom"/>
+ </skin-path>
+</object>
diff --git a/Products/ATContentTypes/profiles/base/toolset.xml b/Products/ATContentTypes/profiles/base/toolset.xml
new file mode 100644
index 0000000..6f6b568
--- /dev/null
+++ b/Products/ATContentTypes/profiles/base/toolset.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0"?>
+<tool-setup>
+ <required tool_id="portal_atct"
+           class="Products.ATContentTypes.tool.atct.ATCTTool"/>
+ <required tool_id="portal_factory"
+           class="Products.ATContentTypes.tool.factory.FactoryTool"/>
+ <required tool_id="portal_metadata"
+           class="Products.ATContentTypes.tool.metadata.MetadataTool"/>
+</tool-setup>
diff --git a/Products/ATContentTypes/profiles/default/componentregistry.xml b/Products/ATContentTypes/profiles/default/componentregistry.xml
deleted file mode 100644
index 7a4d865..0000000
--- a/Products/ATContentTypes/profiles/default/componentregistry.xml
+++ /dev/null
@@ -1,8 +0,0 @@
-<?xml version="1.0"?>
-<componentregistry>
- <utilities>
-  <utility
-     interface="Products.ATContentTypes.interface.IATCTTool"
-     object="portal_atct"/>
- </utilities>
-</componentregistry>
diff --git a/Products/ATContentTypes/profiles/default/metadata.xml b/Products/ATContentTypes/profiles/default/metadata.xml
index 4410f5f..4ff0d5f 100644
--- a/Products/ATContentTypes/profiles/default/metadata.xml
+++ b/Products/ATContentTypes/profiles/default/metadata.xml
@@ -2,8 +2,7 @@
 <metadata>
   <version>1</version>
   <dependencies>
-    <dependency>profile-Products.Archetypes:Archetypes</dependency>
-    <dependency>profile-Products.CMFFormController:CMFFormController</dependency>
+    <dependency>profile-Products.ATContentTypes:base</dependency>
     <dependency>profile-plone.app.collection:default</dependency>
     <dependency>profile-plone.app.imaging:default</dependency>
     <dependency>profile-plone.app.widgets:default</dependency>
diff --git a/Products/ATContentTypes/profiles/default/rolemap.xml b/Products/ATContentTypes/profiles/default/rolemap.xml
deleted file mode 100644
index ff91619..0000000
--- a/Products/ATContentTypes/profiles/default/rolemap.xml
+++ /dev/null
@@ -1,47 +0,0 @@
-<?xml version="1.0"?>
-<rolemap>
-  <permissions>
-    <permission name="ATContentTypes: Add Document" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Event" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add File" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Folder" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Image" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add Link" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-    <permission name="ATContentTypes: Add News Item" acquire="True">
-      <role name="Manager"/>
-      <role name="Site Administrator"/>
-      <role name="Owner"/>
-      <role name="Contributor"/>
-    </permission>
-  </permissions>
-</rolemap>
diff --git a/Products/ATContentTypes/profiles/default/skins.xml b/Products/ATContentTypes/profiles/default/skins.xml
deleted file mode 100644
index 4e2ae22..0000000
--- a/Products/ATContentTypes/profiles/default/skins.xml
+++ /dev/null
@@ -1,11 +0,0 @@
-<?xml version="1.0"?>
-<object name="portal_skins" meta_type="Plone Skins Tool">
- <object name="ATContentTypes" meta_type="Filesystem Directory View"
-    directory="Products.ATContentTypes:skins/ATContentTypes"/>
- <object name="archetypes" meta_type="Filesystem Directory View"
-    directory="Products.Archetypes:skins/archetypes"/>
- <skin-path name="*">
-  <layer name="ATContentTypes" insert-after="custom"/>
-  <layer name="archetypes" insert-after="custom"/>
- </skin-path>
-</object>
diff --git a/Products/ATContentTypes/profiles/default/toolset.xml b/Products/ATContentTypes/profiles/default/toolset.xml
deleted file mode 100644
index 6f6b568..0000000
--- a/Products/ATContentTypes/profiles/default/toolset.xml
+++ /dev/null
@@ -1,9 +0,0 @@
-<?xml version="1.0"?>
-<tool-setup>
- <required tool_id="portal_atct"
-           class="Products.ATContentTypes.tool.atct.ATCTTool"/>
- <required tool_id="portal_factory"
-           class="Products.ATContentTypes.tool.factory.FactoryTool"/>
- <required tool_id="portal_metadata"
-           class="Products.ATContentTypes.tool.metadata.MetadataTool"/>
-</tool-setup>
diff --git a/Products/ATContentTypes/profiles/default/types.xml b/Products/ATContentTypes/profiles/default/types.xml
index 325a6d1..10a5c78 100644
--- a/Products/ATContentTypes/profiles/default/types.xml
+++ b/Products/ATContentTypes/profiles/default/types.xml
@@ -1,5 +1,15 @@
 <?xml version="1.0"?>
 <object name="portal_types" meta_type="Plone Types Tool">
+ <!-- We remove existing FTIs since they could be Dexterity-based and would
+ not be compatible in that case -->
+ <object name="Document" remove="True"/>
+ <object name="Event" remove="True"/>
+ <object name="File" remove="True"/>
+ <object name="Folder" remove="True"/>
+ <object name="Image" remove="True"/>
+ <object name="Link" remove="True"/>
+ <object name="News Item" remove="True"/>
+
  <property
     name="title">Controls the available content types in your portal</property>
  <object name="ATBooleanCriterion"
diff --git a/Products/ATContentTypes/tests/test_base_profile.py b/Products/ATContentTypes/tests/test_base_profile.py
new file mode 100644
index 0000000..2c34d1e
--- /dev/null
+++ b/Products/ATContentTypes/tests/test_base_profile.py
@@ -0,0 +1,20 @@
+# -*- coding: UTF-8 -*-
+from Products.PloneTestCase.PloneTestCase import PloneTestCase
+from Products.CMFCore.utils import getToolByName
+from Products.CMFDynamicViewFTI.interfaces import IDynamicViewTypeInformation
+
+
+class TestBaseProfile(PloneTestCase):
+
+    def afterSetUp(self):
+        self.loginAsPortalOwner()
+        qi = self.portal.portal_quickinstaller
+        qi.uninstallProducts(['ATContentTypes'])
+        portal_setup = self.portal.portal_setup
+        portal_setup.runAllImportStepsFromProfile('profile-Products.ATContentTypes:base')
+
+    def test_attypes_not_installed(self):
+        tt = getToolByName(self.portal, 'portal_types')
+        types = tt.listTypeInfo()
+        for t in types:
+            self.assertNotEqual(t.product, 'ATContentTypes')


