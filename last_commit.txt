Repository: plone.protect


Branch: refs/heads/master
Date: 2015-10-06T09:47:17-07:00
Author: David Glick (davisagli) <david.glick@plone.org>
Commit: https://github.com/plone/plone.protect/commit/ed5b3b8453850f84d0a7efe602c1a96c88585f2b

don't worry about writes to session objects in the temporary storage

Files changed:
M plone/protect/auto.py

diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 5eede0a..426c062 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -175,7 +175,9 @@ def _registered_objects(self):
         app = self.request.PARENTS[-1]
         return list(itertools.chain.from_iterable([
             conn._registered_objects
-            for conn in app._p_jar.connections.values()
+            # skip the 'temporary' connection since it stores session objects
+            # which get written all the time
+            for name, conn in app._p_jar.connections.items() if name != 'temporary'
         ]))
 
     def _check(self):
@@ -284,4 +286,4 @@ def transform(self, result, encoding):
                 hidden.attrib['value'] = token
                 form.append(hidden)
 
-        return result
\ No newline at end of file
+        return result


Repository: plone.protect


Branch: refs/heads/master
Date: 2015-10-06T13:13:20-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.protect/commit/e167324335a2b7915a650d067719625f7ffe8762

Merge pull request #22 from plone/davisagli-session-writes

don't worry about writes to session objects in the temporary storage

Files changed:
M plone/protect/auto.py

diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 5eede0a..426c062 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -175,7 +175,9 @@ def _registered_objects(self):
         app = self.request.PARENTS[-1]
         return list(itertools.chain.from_iterable([
             conn._registered_objects
-            for conn in app._p_jar.connections.values()
+            # skip the 'temporary' connection since it stores session objects
+            # which get written all the time
+            for name, conn in app._p_jar.connections.items() if name != 'temporary'
         ]))
 
     def _check(self):
@@ -284,4 +286,4 @@ def transform(self, result, encoding):
                 hidden.attrib['value'] = token
                 form.append(hidden)
 
-        return result
\ No newline at end of file
+        return result


