Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-05-28T16:00:04-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/f8cd26337649685bc6986b97c4472f66bd2c9fca

Fixed broken getTheme method

Files changed:
M src/plone/app/theming/utils.py

diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index ca5ca00..27b038d 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -266,15 +266,15 @@ def extractThemeInfo(zipfile, checkRules=True):
 
 
 def getTheme(name, manifest=None, resources=None):
-    if manifest is None:
-        if resources is None:
-            resources = getAllResources(
-                MANIFEST_FORMAT,
-                filter=isValidThemeDirectory
-            )
-        if name not in resources:
-            return None
-        manifest = resources[name] or {}
+    if resources is None:
+        resources = getAllResources(
+            MANIFEST_FORMAT,
+            filter=isValidThemeDirectory
+        )
+        manifest = filter(lambda x: x['name'] == name, resources)[0]
+
+        if manifest is None:
+            manifest = {}
 
     title = manifest.get('title', None)
     if title is None:


Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-05-28T16:04:11-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/fe7f2d8b0f4ce097950aa7d7d473aba7c2ccc2e4

re-added manifest check

Files changed:
M src/plone/app/theming/utils.py

diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index 27b038d..9b7c376 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -266,15 +266,16 @@ def extractThemeInfo(zipfile, checkRules=True):
 
 
 def getTheme(name, manifest=None, resources=None):
-    if resources is None:
-        resources = getAllResources(
-            MANIFEST_FORMAT,
-            filter=isValidThemeDirectory
-        )
-        manifest = filter(lambda x: x['name'] == name, resources)[0]
-
-        if manifest is None:
-            manifest = {}
+    if manifest is None:
+        if resources is None:
+            resources = getAllResources(
+                MANIFEST_FORMAT,
+                filter=isValidThemeDirectory
+            )
+            manifest = filter(lambda x: x['name'] == name, resources)[0]
+
+            if manifest is None:
+                manifest = {}
 
     title = manifest.get('title', None)
     if title is None:


Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-05-28T16:13:32-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/0ae1fcb9201e4f4dbb8939bc95db8a2cd98b8aa9

Merge pull request #55 from plone/refactoring

Fixed broken getTheme method

Files changed:
M src/plone/app/theming/utils.py

diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index ca5ca00..9b7c376 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -272,9 +272,10 @@ def getTheme(name, manifest=None, resources=None):
                 MANIFEST_FORMAT,
                 filter=isValidThemeDirectory
             )
-        if name not in resources:
-            return None
-        manifest = resources[name] or {}
+            manifest = filter(lambda x: x['name'] == name, resources)[0]
+
+            if manifest is None:
+                manifest = {}
 
     title = manifest.get('title', None)
     if title is None:


