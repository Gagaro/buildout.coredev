Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2015-09-07T22:58:36+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.Archetypes/commit/04460d4b05cdcae3f7956ec6f032237a58cbabe8

Fixed tests when portal_properties tool is not registered.

Files changed:
M Products/Archetypes/tests/test_default_mimetypes.py

diff --git a/Products/Archetypes/tests/test_default_mimetypes.py b/Products/Archetypes/tests/test_default_mimetypes.py
index d60480d..a17d0f5 100644
--- a/Products/Archetypes/tests/test_default_mimetypes.py
+++ b/Products/Archetypes/tests/test_default_mimetypes.py
@@ -1,8 +1,6 @@
 # test initialisation and setup
 
 from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
-from unittest import TestSuite, makeSuite
-
 from Products.Archetypes.mimetype_utils import getDefaultContentType
 from Products.Archetypes.mimetype_utils import setDefaultContentType
 
@@ -15,9 +13,9 @@ def test_ATDocumentDefaultType(self):
         # default mimetype tests
         _orignal_pp = self.portal['portal_properties']
         self.portal._delObject('portal_properties', suppress_events=True)
-        from Products.CMFCore.utils import getToolByName
         from Products.CMFCore.utils import _tool_interface_registry
-        ptool = _tool_interface_registry.pop('portal_properties')
+        _marker = object()
+        ptool = _tool_interface_registry.pop('portal_properties', _marker)
 
         self.loginAsPortalOwner()
         # we create a new document:
@@ -36,4 +34,5 @@ def test_ATDocumentDefaultType(self):
         # no properties tool nor properties sheet
         self.assertEqual(getDefaultContentType(self.portal), 'text/x-web-markdown')
         self.portal['portal_properties'] = _orignal_pp
-        _tool_interface_registry['portal_properties'] = ptool
+        if ptool is not _marker:
+            _tool_interface_registry['portal_properties'] = ptool


