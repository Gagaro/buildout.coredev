Repository: plone.i18n
Branch: refs/heads/master
Date: 2015-03-30T10:51:58+02:00
Author: Ramon Navarro Bosch (bloodbare) <ramon.nb@gmail.com>
Commit: https://github.com/plone/plone.i18n/commit/81390be8dc832639f961d29d8ff21916b245a211

Updating code set from plone 4 to plone 5 does not have the registry and manage views are broken for the traversal

Files changed:
M plone/i18n/utility.py

diff --git a/plone/i18n/utility.py b/plone/i18n/utility.py
index cedb07f..68f2c3c 100644
--- a/plone/i18n/utility.py
+++ b/plone/i18n/utility.py
@@ -38,7 +38,12 @@ def getLanguageBindings(self):
 
 def setLanguageBinding(request):
     binding = request.get('LANGUAGE_TOOL', None)
-    settings = getMultiAdapter((getSite(), request), INegotiateLanguage)
+    try:
+        settings = getMultiAdapter((getSite(), request), INegotiateLanguage)
+    except:
+        # We may be on a site before upgrading so return None
+        # No registry is registered
+        return None
 
     if not isinstance(binding, LanguageBinding):
         # Create new binding instance


