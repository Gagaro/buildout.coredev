Repository: plone.batching


Branch: refs/heads/master
Date: 2015-07-16T17:22:05+02:00
Author: Patrick Gerken (do3cc) <do3cc@patrick-gerken.de>
Commit: https://github.com/plone/plone.batching/commit/4ef092cc52ebca49b4eb2a0c94491fb79f541638

Fix assertion on edge cse

Files changed:
M CHANGES.rst
M plone/batching/batch.py
M plone/batching/tests.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b1dd523..682db93 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,10 @@ Changelog
   or it fails in previous_pages when using orphan
   [gbastien]
 
+- Allow orphan size to be equal to batch size. This allows
+  the edge case of batch size 0 with default orphan size 0.
+  [do3cc]
+
 
 1.0.4 (2015-04-28)
 ------------------
diff --git a/plone/batching/batch.py b/plone/batching/batch.py
index cb30b1e..da15cdc 100644
--- a/plone/batching/batch.py
+++ b/plone/batching/batch.py
@@ -31,8 +31,8 @@ def __init__(self, sequence, size, start=0, end=0, orphan=0, overlap=0,
         overlap   - the number of overlapping elements in each batch
         pagerange - the number of pages to display in the navigation
         """
-        assert orphan < size, "Having an orphan size, higher than batch size" \
-                              " is undefined"
+        assert orphan <= size, "Having an orphan size higher than batch size" \
+                               " is undefined"
         start += 1
         self._sequence = sequence
         self._size = size
diff --git a/plone/batching/tests.py b/plone/batching/tests.py
index eda6168..8c9a42d 100644
--- a/plone/batching/tests.py
+++ b/plone/batching/tests.py
@@ -104,6 +104,8 @@ def test_lastpage_with_orphans(self):
         self.assertEqual(10, batch.lastpage)
         batch = BaseBatch(range(71), 10, orphan=2)
         self.assertEqual(7, batch.lastpage)
+        batch = BaseBatch(range(0), 0, orphan=0)
+        self.assertEqual(1, batch.lastpage)
         self.assertRaises(AssertionError, BaseBatch, [], 10, orphan=20)
 
     def test_items_not_on_page(self):


