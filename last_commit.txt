Repository: mockup


Branch: refs/heads/master
Date: 2015-07-02T13:04:22-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/31e9c1d1045f77e55ad38cc06e66fb22eae7fcaa

UI/UX improvements to related items folder tree select

Files changed:
M CHANGES.rst
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/tree/pattern.tree.less
M mockup/tests/pattern-relateditems-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 7b63e2c..f109e89 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- UI/UX improvements to related items folder tree select
+  [vangheem]
+
 - correctly set href and id for autotoc pattern
   [vangheem]
 
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index 22dc019..28061ac 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -126,10 +126,13 @@ define([
         '<span class="pattern-relateditems-tree">' +
           '<a href="#" class="pattern-relateditems-tree-select"><span class="glyphicon glyphicon-indent-left"></span></a> ' +
           '<div class="tree-container">' +
-            '<span class="select-folder-label">Select folder</span>' +
-            '<a href="#" class="btn close pattern-relateditems-tree-cancel">X</a>' +
+            '<div class="title-container">' +
+              '<a href="#" class="btn close pattern-relateditems-tree-cancel">' +
+                '<span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>' +
+              '</a>' +
+              '<span class="select-folder-label">Select folder</span>' +
+            '</div>' +
             '<div class="pat-tree" />' +
-            '<a href="#" class="btn btn-default pattern-relateditems-tree-itemselect">Select</a>' +
           '</div>' +
         '</span>' +
         '<span class="pattern-relateditems-path-label">' +
@@ -244,6 +247,20 @@ define([
             nodes.push(node);
           });
           return nodes;
+        },
+        onCreateLi: function(node, $li) {
+          if(node._loaded){
+            if(node.children.length === 0){
+              $li.find('.jqtree-title').append('<span class="tree-node-empty">' + _t('(empty)') + '</span>');
+            }
+          }
+          $li.append('<span class="pattern-relateditems-buttons"><a class="pattern-relateditems-result-browse" href="#"></a></span>');
+          $li.find('.pattern-relateditems-result-browse').click(function(e){
+            e.preventDefault();
+            self.currentPath = node.path;
+            self.browseTo(self.currentPath);
+            $treeContainer.fadeOut();
+          });
         }
       });
       treePattern.$el.bind('tree.select', function(e) {
@@ -277,21 +294,20 @@ define([
         return false;
       });
 
-      $('a.pattern-relateditems-tree-itemselect', $treeContainer).click(function(e) {
-        e.preventDefault();
-        self.browseTo(self.currentPath); // just browse to current path since it's set elsewhere
-        $treeContainer.fadeOut();
-        return false;
-      });
-
       $treeSelect.on('click', function(e) {
         e.preventDefault();
         self.browsing = true;
         self.currentPath = '/';
+        self.$el.select2('close');
         $treeContainer.fadeIn();
         treePattern.$el.tree('loadDataFromUrl', self.treeQuery.getUrl());
         return false;
       });
+
+      self.$el.on('select2-opening', function(){
+        $treeContainer.fadeOut();
+      });
+
       self.$browsePath.html($crumbs);
     },
     selectItem: function(item) {
diff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less
index f1f68f7..c126cc5 100644
--- a/mockup/patterns/relateditems/pattern.relateditems.less
+++ b/mockup/patterns/relateditems/pattern.relateditems.less
@@ -52,6 +52,23 @@
   }
 }
 
+.pattern-relateditems-buttons {
+  position: absolute;
+  display: inline-block;
+  text-align: right;
+  font-size: 18px;
+  right: 0;
+  top: 50%;
+  margin-top: -16px;
+  a {
+    display: block;
+    height: 36px;
+    line-height: 36px;
+    .glyphicon();
+    .glyphicon-chevron-right();
+  }
+}
+
 .pattern-relateditems-result {
   padding-right: 30px;
   position: relative;
@@ -67,24 +84,7 @@
     line-height: 15px;
     padding-top: 5px;
   }
-
-  .pattern-relateditems-buttons {
-    position: absolute;
-    display: inline-block;
-    text-align: right;
-    font-size: 18px;
-    right: 0;
-    top: 50%;
-    margin-top: -16px;
-    a {
-      display: block;
-      height: 36px;
-      line-height: 36px;
-      .glyphicon();
-      .glyphicon-chevron-right();
-    }
-  }
-
+  
   .pattern-relateditems-result-path {
     display: block;
     color: #444;
@@ -102,69 +102,84 @@
 
 /* tree parts */
 .pattern-relateditems-tree {
-    .tree-container {
-        position: absolute;
-        background-color: white;
-        min-width: 200px;
-        padding: 0px;
-        left: 4px;
-        border: 3px solid #DDD;
-        border-radius: 7px;
-        top: 4px;
-        display: none;
-        z-index: 10000;
-        min-width: 350px;
-        margin-top: 10px;
-
-        .pat-tree {
-            max-height: 400px;
-            overflow-y: scroll;
-            overflow-x: hidden;
-            border-top: 1px solid #DDD;
-            border-bottom: 1px solid #DDD;
-            padding: 2px 0;
-        }
+  .tree-container {
+    box-shadow: 0px 0px 8px 0px #DDD;
+    position: absolute;
+    background-color: white;
+    min-width: 200px;
+    padding: 0px;
+    left: -1px;
+    top: -11px;
+    border: 1px solid #5897fb;
+    display: none;
+    z-index: 10000;
+    min-width: 350px;
+    margin-top: 10px;
+
+    .pat-tree {
+      max-height: 400px;
+      overflow-y: scroll;
+      overflow-x: hidden;
+      border-top: 1px solid #DDD;
+      border-bottom: 1px solid #DDD;
+      padding: 2px 0;
+    }
 
-        .select-folder-label {
-            display: block;
-            margin: 10px 5px 5px 5px;
-            font-style: italic;
-            font-weight: bold;
-        }
+    .select-folder-label {
+      font-weight: bold;
+    }
 
-        .btn.close.pattern-relateditems-tree-itemselect{
-            display: block;
-            margin: 2px;
-            opacity: 1.0;
-        }
-        .btn.close.pattern-relateditems-tree-cancel{
-            display: block;
-            position: absolute;
-            top: 5px;
-            right: 5px;
-        }
+    .tree-node-empty{
+      font-size: 75%;
+    }
 
-        .jqtree-tree {
-            .jqtree_common {
-                padding-left: 2px;
-            }
+    .title-container{
+      background-color: #f1f1f1;
+    }
 
-            .jqtree_common.jqtree-selected {
-                .jqtree_common.jqtree-element {
-                    background: #97BDD6;
-                    text-shadow: none;
-                }
-            }
+    .jqtree-tree {
+      background-image: -webkit-gradient(linear, 0% 0%, 0% 100%, color-stop(1%, #eeeeee), color-stop(5%, #ffffff));
+      background-image: -webkit-linear-gradient(top, #eeeeee 1%, #ffffff 5%);
+      background-image: -moz-linear-gradient(top, #eeeeee 1%, #ffffff 5%);
+      background-image: linear-gradient(to bottom, #eeeeee 1%, #ffffff 5%);
+
+      .pattern-relateditems-buttons {
+        margin-top: -22px;
+        top: inherit;
+      }
+      .jqtree_common {
+        padding-left: 2px;
+      }
+
+      .jqtree_common.jqtree-selected {
+        .jqtree_common.jqtree-element {
+          background: #f1f1f1;
+          text-shadow: none;
+        }
+      }
 
-            li.jqtree_common {
-                padding-right: 6px;
+      .jqtree-toggler{
+        top: 20%;
+      }
 
-                .jqtree_common.jqtree-element {
-                    &:hover {
-                        background: #DDD;
-                    }
-                }
+      li.jqtree_common {
+        .jqtree-element{
+          padding: 0;
+        }
+        .jqtree_common.jqtree-element {
+            &:hover {
+                background: #f1f1f1;
             }
         }
+        &.jqtree-folder{
+          margin-left: 18px;
+
+          ul.jqtree_common{
+            margin-left:0;
+            padding-left:0;
+          }
+        }
+      }
     }
+  }
 }
diff --git a/mockup/patterns/tree/pattern.tree.less b/mockup/patterns/tree/pattern.tree.less
index 8f42efd..7fdf023 100644
--- a/mockup/patterns/tree/pattern.tree.less
+++ b/mockup/patterns/tree/pattern.tree.less
@@ -1,3 +1,7 @@
 /* (inline) forces includes this file without processing it.
  * Necessary because of the IE hack in there, which causes ParseError. */
-@import (inline) "@{bowerPath}/jqtree/jqtree.css";
\ No newline at end of file
+@import (inline) "@{bowerPath}/jqtree/jqtree.css";
+
+.autotabs ul li.jqtree_common{
+  display:block;
+}
\ No newline at end of file
diff --git a/mockup/tests/pattern-relateditems-test.js b/mockup/tests/pattern-relateditems-test.js
index a6a48ed..4265830 100644
--- a/mockup/tests/pattern-relateditems-test.js
+++ b/mockup/tests/pattern-relateditems-test.js
@@ -450,7 +450,7 @@ define([
         '</div>').appendTo('body');
 
       var clock = sinon.useFakeTimers();
-      var pattern = $('.pat-relateditems', $el).patternRelateditems().data('patternRelateditems');
+      $('.pat-relateditems', $el).patternRelateditems().data('patternRelateditems');
 
       clock.tick(1000);
 
@@ -459,10 +459,7 @@ define([
       $el.find('.pattern-relateditems-tree-select').trigger('click');
       clock.tick(1000);
 
-      $el.find('.pat-tree ul li div').eq(2).trigger('click');
-      clock.tick(1000);
-
-      $el.find('.pattern-relateditems-tree-itemselect').trigger('click');
+      $el.find('.pat-tree ul li .pattern-relateditems-buttons a').eq(2).trigger('click');
       clock.tick(1000);
 
       expect($el.find('.crumb').length).to.equal(2);
@@ -482,7 +479,7 @@ define([
         '</div>').appendTo('body');
 
       var clock = sinon.useFakeTimers();
-      var pattern = $('.pat-relateditems', $el).patternRelateditems().data('patternRelateditems');
+      $('.pat-relateditems', $el).patternRelateditems().data('patternRelateditems');
 
       clock.tick(1000);
 
@@ -494,10 +491,7 @@ define([
       $el.find('.pat-tree ul li div').eq(1).trigger('click');
       clock.tick(1000);
 
-      $el.find('.pat-tree ul li div').eq(2).trigger('click');
-      clock.tick(1000);
-
-      $el.find('.pattern-relateditems-tree-itemselect').trigger('click');
+      $el.find('.pat-tree ul li .pattern-relateditems-buttons a').eq(2).trigger('click');
       clock.tick(1000);
 
       expect($el.find('.crumb').length).to.equal(3);


