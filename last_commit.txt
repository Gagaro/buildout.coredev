Repository: plone.portlet.collection
Branch: refs/heads/master
Date: 2015-03-16T12:20:57+01:00
Author: Kees Hink (khink) <keeshink@gmail.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/942ad1c27c6b9c08f48c652333a998d7c7b351f9

Remove DL's from portlet templates.

Files changed:
M CHANGES.rst
M plone/portlet/collection/collection.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 454342c..afceac5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -47,6 +47,10 @@ Changelog
 2.2.0 (2014-02-22)
 ------------------
 
+- Remove DL's from portlet templates.
+  https://github.com/plone/Products.CMFPlone/issues/163
+  [khink]
+
 - plone.portlet.collection should also install plone.app.querystring:default
   profile
   [garbas]
diff --git a/plone/portlet/collection/collection.pt b/plone/portlet/collection/collection.pt
index f8091a0..9b489c6 100644
--- a/plone/portlet/collection/collection.pt
+++ b/plone/portlet/collection/collection.pt
@@ -1,19 +1,21 @@
-<dl class="portlet portletCollection"
+<section class="portlet portletCollection"
     i18n:domain="plone"
     tal:define="collection_url view/collection_url;
                 plone_view context/@@plone;
                 toLocalizedTime nocall:plone_view/toLocalizedTime;
                 viewActions here/portal_properties/site_properties/typesUseViewActionInListings|python:();"
-    tal:attributes="class string:portlet portletCollection ${view/css_class}"><dt class="portletHeader">
+    tal:attributes="class string:portlet portletCollection ${view/css_class}"><header class="portletHeader">
         <span class="portletTopLeft"></span>
         <a tal:attributes="href collection_url" tal:omit-tag="not:view/data/show_more">
             <span tal:content="view/data/header" />
         </a>
         <span class="portletTopRight"></span>
-    </dt>
+  </header>
 
+
+  <ul class="portletContent">
     <tal:events tal:repeat="obj view/results">
-    <dd class="portletItem"
+    <li class="portletItem"
         tal:define="oddrow repeat/obj/odd;
                     useView python:obj.portal_type in viewActions;
                     itemUrl python:useView and obj.getURL() + '/view' or obj.getURL();
@@ -32,10 +34,11 @@
                 Date
             </span>
         </a>
-    </dd>
+    </li>
     </tal:events>
+  </ul>
 
-    <dd class="portletFooter"
+    <footer class="portletFooter"
             tal:condition="python:showMore or view.include_empty_footer()"
             tal:define="showMore view/data/show_more">
         <span class="portletBottomLeft"></span>
@@ -46,6 +49,6 @@
         </a>
         </span>
         <span class="portletBottomRight"></span>
-    </dd>
+  </footer>
 
-</dl>
+</section>


Repository: plone.portlet.collection
Branch: refs/heads/master
Date: 2015-03-16T12:26:09+01:00
Author: Kees Hink (khink) <keeshink@gmail.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/8baf0e98d35ca8e07f0c7a0ebd7bfbdec164ce19

Fix tests. Kids, don't parse HTML with regexps.

http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454

Files changed:
M plone/portlet/collection/tests/functional.txt

diff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt
index c75a2ac..768bd11 100644
--- a/plone/portlet/collection/tests/functional.txt
+++ b/plone/portlet/collection/tests/functional.txt
@@ -71,26 +71,27 @@ of the site. Show only two items to make the test sanely terse.
 Go to the home page and see if the portlet looks OK.
 
     >>> browser.open(portal_url)
-    >>> import re
-    >>> match = re.search('<dl class="portlet portletCollection.*?</dl>', browser.contents, flags=re.DOTALL)
-    >>> portlet_contents = match.group()
+    >>> from lxml import etree
+    >>> html = etree.HTML(browser.contents)
+    >>> portlet = html.xpath('//*[contains(@class, "portletCollection")]')[0]
+    >>> portlet_contents = etree.tostring(portlet)
     >>> def strip_white_space(contents):
     ...     lines = [line.strip() for line in contents.splitlines() if line.strip()]
     ...     return '\n'.join(lines)
     >>> print strip_white_space(portlet_contents)
-    <dl class="portlet portletCollection portlet-collection-test-collection"><dt class="portletHeader">
+    <section class="portlet portletCollection portlet-collection-test-collection"><header class="portletHeader">
     <span class="portletTopLeft"></span>
     <a href="http://nohost/plone/test-collection">
     <span>Test Collection</span>
     </a>
     <span class="portletTopRight"></span>
-    </dt>
-    <dd class="portletItem odd">
+    </header>
+    <li class="portletItem odd">
     <a href="http://nohost/plone/test-document" class="tile contenttype-document" title="">
     Test Document
     </a>
-    </dd>
-    <dd class="portletFooter">
+    </li>
+    <footer class="portletFooter">
     <span class="portletBottomLeft"></span>
     <span>
     <a href="http://nohost/plone/test-collection">
@@ -99,8 +100,8 @@ Go to the home page and see if the portlet looks OK.
     </a>
     </span>
     <span class="portletBottomRight"></span>
-    </dd>
-    </dl>
+    </footer>
+    </section>
 
 Now test what happens if we toggle the "show more link" option.
 
@@ -116,21 +117,21 @@ Now test what happens if we toggle the "show more link" option.
 Go back to the home page and see if it looks OK.
 
     >>> browser.open(portal_url)
-    >>> match = re.search('<dl class="portlet portletCollection.*?</dl>', browser.contents, flags=re.DOTALL)
+    >>> match = re.search('<\w+ class="portlet portletCollection.*?</\w+>', browser.contents, flags=re.DOTALL)
     >>> portlet_contents = match.group()
     >>> print strip_white_space(portlet_contents)
-    <dl class="portlet portletCollection portlet-collection-test-collection"><dt class="portletHeader">
+    <section class="portlet portletCollection portlet-collection-test-collection"><header class="portletHeader">
     <span class="portletTopLeft"></span>
     <span>Test Collection</span>
     <span class="portletTopRight"></span>
-    </dt>
-    <dd class="portletItem odd">
+    </header>
+    <li class="portletItem odd">
     <a href="http://nohost/plone/test-document" class="tile contenttype-document" title="">
     Test Document
     </a>
-    </dd>
-    <dd class="portletFooter">
+    </li>
+    <footer class="portletFooter">
     <span class="portletBottomLeft"></span>
     <span class="portletBottomRight"></span>
-    </dd>
-    </dl>
+    </footer>
+    </section>


Repository: plone.portlet.collection
Branch: refs/heads/master
Date: 2015-03-16T12:29:05+01:00
Author: Kees Hink (khink) <keeshink@gmail.com>
Commit: https://github.com/plone/plone.portlet.collection/commit/3cd6f757e8dfef66ab7dfbf6becd178b33765be3

Fix last part of the test: regexp -&gt; lxml

&lt;/\w+&gt; will match the first closing tag, so portlet_contents would
be almost empty.

Files changed:
M plone/portlet/collection/tests/functional.txt

diff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt
index 768bd11..a1b2d17 100644
--- a/plone/portlet/collection/tests/functional.txt
+++ b/plone/portlet/collection/tests/functional.txt
@@ -117,21 +117,8 @@ Now test what happens if we toggle the "show more link" option.
 Go back to the home page and see if it looks OK.
 
     >>> browser.open(portal_url)
-    >>> match = re.search('<\w+ class="portlet portletCollection.*?</\w+>', browser.contents, flags=re.DOTALL)
-    >>> portlet_contents = match.group()
-    >>> print strip_white_space(portlet_contents)
-    <section class="portlet portletCollection portlet-collection-test-collection"><header class="portletHeader">
-    <span class="portletTopLeft"></span>
-    <span>Test Collection</span>
-    <span class="portletTopRight"></span>
-    </header>
-    <li class="portletItem odd">
-    <a href="http://nohost/plone/test-document" class="tile contenttype-document" title="">
-    Test Document
-    </a>
-    </li>
-    <footer class="portletFooter">
-    <span class="portletBottomLeft"></span>
-    <span class="portletBottomRight"></span>
-    </footer>
-    </section>
+    >>> html = etree.HTML(browser.contents)
+    >>> portlet = html.xpath('//*[contains(@class, "portletCollection")]')[0]
+    >>> portlet_contents = etree.tostring(portlet)
+    >>> '<a href="http://nohost/plone/test-collection">' in portlet_contents
+    False


Repository: plone.portlet.collection
Branch: refs/heads/master
Date: 2015-03-16T17:58:10+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.portlet.collection/commit/0a06607cac089be4fcc0ea52df688ae719026618

Merge pull request #3 from plone/remove-dt-dl-dd

Remove DL's from portlet templates.

Files changed:
M CHANGES.rst
M plone/portlet/collection/collection.pt
M plone/portlet/collection/tests/functional.txt

diff --git a/CHANGES.rst b/CHANGES.rst
index 454342c..afceac5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -47,6 +47,10 @@ Changelog
 2.2.0 (2014-02-22)
 ------------------
 
+- Remove DL's from portlet templates.
+  https://github.com/plone/Products.CMFPlone/issues/163
+  [khink]
+
 - plone.portlet.collection should also install plone.app.querystring:default
   profile
   [garbas]
diff --git a/plone/portlet/collection/collection.pt b/plone/portlet/collection/collection.pt
index f8091a0..9b489c6 100644
--- a/plone/portlet/collection/collection.pt
+++ b/plone/portlet/collection/collection.pt
@@ -1,19 +1,21 @@
-<dl class="portlet portletCollection"
+<section class="portlet portletCollection"
     i18n:domain="plone"
     tal:define="collection_url view/collection_url;
                 plone_view context/@@plone;
                 toLocalizedTime nocall:plone_view/toLocalizedTime;
                 viewActions here/portal_properties/site_properties/typesUseViewActionInListings|python:();"
-    tal:attributes="class string:portlet portletCollection ${view/css_class}"><dt class="portletHeader">
+    tal:attributes="class string:portlet portletCollection ${view/css_class}"><header class="portletHeader">
         <span class="portletTopLeft"></span>
         <a tal:attributes="href collection_url" tal:omit-tag="not:view/data/show_more">
             <span tal:content="view/data/header" />
         </a>
         <span class="portletTopRight"></span>
-    </dt>
+  </header>
 
+
+  <ul class="portletContent">
     <tal:events tal:repeat="obj view/results">
-    <dd class="portletItem"
+    <li class="portletItem"
         tal:define="oddrow repeat/obj/odd;
                     useView python:obj.portal_type in viewActions;
                     itemUrl python:useView and obj.getURL() + '/view' or obj.getURL();
@@ -32,10 +34,11 @@
                 Date
             </span>
         </a>
-    </dd>
+    </li>
     </tal:events>
+  </ul>
 
-    <dd class="portletFooter"
+    <footer class="portletFooter"
             tal:condition="python:showMore or view.include_empty_footer()"
             tal:define="showMore view/data/show_more">
         <span class="portletBottomLeft"></span>
@@ -46,6 +49,6 @@
         </a>
         </span>
         <span class="portletBottomRight"></span>
-    </dd>
+  </footer>
 
-</dl>
+</section>
diff --git a/plone/portlet/collection/tests/functional.txt b/plone/portlet/collection/tests/functional.txt
index c75a2ac..a1b2d17 100644
--- a/plone/portlet/collection/tests/functional.txt
+++ b/plone/portlet/collection/tests/functional.txt
@@ -71,26 +71,27 @@ of the site. Show only two items to make the test sanely terse.
 Go to the home page and see if the portlet looks OK.
 
     >>> browser.open(portal_url)
-    >>> import re
-    >>> match = re.search('<dl class="portlet portletCollection.*?</dl>', browser.contents, flags=re.DOTALL)
-    >>> portlet_contents = match.group()
+    >>> from lxml import etree
+    >>> html = etree.HTML(browser.contents)
+    >>> portlet = html.xpath('//*[contains(@class, "portletCollection")]')[0]
+    >>> portlet_contents = etree.tostring(portlet)
     >>> def strip_white_space(contents):
     ...     lines = [line.strip() for line in contents.splitlines() if line.strip()]
     ...     return '\n'.join(lines)
     >>> print strip_white_space(portlet_contents)
-    <dl class="portlet portletCollection portlet-collection-test-collection"><dt class="portletHeader">
+    <section class="portlet portletCollection portlet-collection-test-collection"><header class="portletHeader">
     <span class="portletTopLeft"></span>
     <a href="http://nohost/plone/test-collection">
     <span>Test Collection</span>
     </a>
     <span class="portletTopRight"></span>
-    </dt>
-    <dd class="portletItem odd">
+    </header>
+    <li class="portletItem odd">
     <a href="http://nohost/plone/test-document" class="tile contenttype-document" title="">
     Test Document
     </a>
-    </dd>
-    <dd class="portletFooter">
+    </li>
+    <footer class="portletFooter">
     <span class="portletBottomLeft"></span>
     <span>
     <a href="http://nohost/plone/test-collection">
@@ -99,8 +100,8 @@ Go to the home page and see if the portlet looks OK.
     </a>
     </span>
     <span class="portletBottomRight"></span>
-    </dd>
-    </dl>
+    </footer>
+    </section>
 
 Now test what happens if we toggle the "show more link" option.
 
@@ -116,21 +117,8 @@ Now test what happens if we toggle the "show more link" option.
 Go back to the home page and see if it looks OK.
 
     >>> browser.open(portal_url)
-    >>> match = re.search('<dl class="portlet portletCollection.*?</dl>', browser.contents, flags=re.DOTALL)
-    >>> portlet_contents = match.group()
-    >>> print strip_white_space(portlet_contents)
-    <dl class="portlet portletCollection portlet-collection-test-collection"><dt class="portletHeader">
-    <span class="portletTopLeft"></span>
-    <span>Test Collection</span>
-    <span class="portletTopRight"></span>
-    </dt>
-    <dd class="portletItem odd">
-    <a href="http://nohost/plone/test-document" class="tile contenttype-document" title="">
-    Test Document
-    </a>
-    </dd>
-    <dd class="portletFooter">
-    <span class="portletBottomLeft"></span>
-    <span class="portletBottomRight"></span>
-    </dd>
-    </dl>
+    >>> html = etree.HTML(browser.contents)
+    >>> portlet = html.xpath('//*[contains(@class, "portletCollection")]')[0]
+    >>> portlet_contents = etree.tostring(portlet)
+    >>> '<a href="http://nohost/plone/test-collection">' in portlet_contents
+    False


