Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-07-06T13:34:13-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/a05fe33492e850174c8a965aebac5967e9f9a2d8

Added paths to less.js and less-variables.js for the mockup thememapper

Files changed:
M src/plone/app/theming/browser/mapper.pt
M src/plone/app/theming/browser/mapper.py

diff --git a/src/plone/app/theming/browser/mapper.pt b/src/plone/app/theming/browser/mapper.pt
index 5ea44cf..0e6cf05 100644
--- a/src/plone/app/theming/browser/mapper.pt
+++ b/src/plone/app/theming/browser/mapper.pt
@@ -106,7 +106,9 @@
           <section id="content-core">
             <input tal:replace="structure context/@@authenticator/authenticator" />
             <div class="pat-thememapper" data-pat-thememapper='themeUrl: ${view/resourceUrl};
-					  editable: ${view/editable};
+                      editable: ${view/editable};
+                      lessUrl: ${view/lessUrl};
+                      lessVariables: ${views/lessVariables};  
                       filemanagerConfig:{"actionUrl":"${view/themeBaseUrl}/@@plone.resourceeditor.filemanager-actions"};
                       mockupUrl:${view/themeBaseUrl}/@@theming-controlpanel-mapper-getframe?path=/${view/themeBasePathEncoded}/${view/defaultThemeFile}&amp;theme=off;
                       unthemedUrl:${view/themeBaseUrl}/@@theming-controlpanel-mapper-getframe?path=/&amp;diazo.off=1;
diff --git a/src/plone/app/theming/browser/mapper.py b/src/plone/app/theming/browser/mapper.py
index 6905006..16a8888 100644
--- a/src/plone/app/theming/browser/mapper.py
+++ b/src/plone/app/theming/browser/mapper.py
@@ -73,8 +73,16 @@ def setup(self):
             self.name
         )
         self.themeBasePathEncoded = urllib.quote_plus(self.themeBasePath)
-        self.themeBaseUrl = '/'.join([self.portalUrl, self.themeBasePath])
-            
+        self.themeBaseUrl = '/'.join([self.portalUrl, self.themeBasePath]) 
+
+        try:
+            registry = getUtility(IRegistry)
+            self.lessUrl = registry['plone.resources.lessc']
+            self.lessVariables = self.portalUrl + '/' + registry['plone.resources.less-variables']
+        except:
+            self.lessUrl = None
+            self.lessVariables = None
+
         self.editable = IWritableResourceDirectory.providedBy(
             self.resourceDirectory
         )


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-07-06T13:41:31-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/329962e72221740af59117764fd17e85743311db

Fixed typo

Files changed:
M src/plone/app/theming/browser/mapper.pt

diff --git a/src/plone/app/theming/browser/mapper.pt b/src/plone/app/theming/browser/mapper.pt
index 0e6cf05..7d4b5fb 100644
--- a/src/plone/app/theming/browser/mapper.pt
+++ b/src/plone/app/theming/browser/mapper.pt
@@ -108,7 +108,7 @@
             <div class="pat-thememapper" data-pat-thememapper='themeUrl: ${view/resourceUrl};
                       editable: ${view/editable};
                       lessUrl: ${view/lessUrl};
-                      lessVariables: ${views/lessVariables};  
+                      lessVariables: ${view/lessVariables};
                       filemanagerConfig:{"actionUrl":"${view/themeBaseUrl}/@@plone.resourceeditor.filemanager-actions"};
                       mockupUrl:${view/themeBaseUrl}/@@theming-controlpanel-mapper-getframe?path=/${view/themeBasePathEncoded}/${view/defaultThemeFile}&amp;theme=off;
                       unthemedUrl:${view/themeBaseUrl}/@@theming-controlpanel-mapper-getframe?path=/&amp;diazo.off=1;


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-07-06T13:42:51-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/51c2b076e3972e9952a74ed43fac0d978386d184

Merge pull request #63 from plone/lessbuilder

Lessbuilder

Files changed:
M src/plone/app/theming/browser/mapper.pt
M src/plone/app/theming/browser/mapper.py

diff --git a/src/plone/app/theming/browser/mapper.pt b/src/plone/app/theming/browser/mapper.pt
index 5ea44cf..7d4b5fb 100644
--- a/src/plone/app/theming/browser/mapper.pt
+++ b/src/plone/app/theming/browser/mapper.pt
@@ -106,7 +106,9 @@
           <section id="content-core">
             <input tal:replace="structure context/@@authenticator/authenticator" />
             <div class="pat-thememapper" data-pat-thememapper='themeUrl: ${view/resourceUrl};
-					  editable: ${view/editable};
+                      editable: ${view/editable};
+                      lessUrl: ${view/lessUrl};
+                      lessVariables: ${view/lessVariables};
                       filemanagerConfig:{"actionUrl":"${view/themeBaseUrl}/@@plone.resourceeditor.filemanager-actions"};
                       mockupUrl:${view/themeBaseUrl}/@@theming-controlpanel-mapper-getframe?path=/${view/themeBasePathEncoded}/${view/defaultThemeFile}&amp;theme=off;
                       unthemedUrl:${view/themeBaseUrl}/@@theming-controlpanel-mapper-getframe?path=/&amp;diazo.off=1;
diff --git a/src/plone/app/theming/browser/mapper.py b/src/plone/app/theming/browser/mapper.py
index 6905006..16a8888 100644
--- a/src/plone/app/theming/browser/mapper.py
+++ b/src/plone/app/theming/browser/mapper.py
@@ -73,8 +73,16 @@ def setup(self):
             self.name
         )
         self.themeBasePathEncoded = urllib.quote_plus(self.themeBasePath)
-        self.themeBaseUrl = '/'.join([self.portalUrl, self.themeBasePath])
-            
+        self.themeBaseUrl = '/'.join([self.portalUrl, self.themeBasePath]) 
+
+        try:
+            registry = getUtility(IRegistry)
+            self.lessUrl = registry['plone.resources.lessc']
+            self.lessVariables = self.portalUrl + '/' + registry['plone.resources.less-variables']
+        except:
+            self.lessUrl = None
+            self.lessVariables = None
+
         self.editable = IWritableResourceDirectory.providedBy(
             self.resourceDirectory
         )


