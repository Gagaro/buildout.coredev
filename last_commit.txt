Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2015-09-04T17:26:27+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.schemaeditor/commit/6be9e37b264d05564662f630890d9bc6d60321b0

Make ``plone.protect.utils.addTokenToUrl`` a soft dependency, making this package usable in Plone &lt; 5.0.

Files changed:
M CHANGES.rst
M plone/schemaeditor/browser/schema/listing.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 40baee7..77345fa 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 2.0.7 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Make ``plone.protect.utils.addTokenToUrl`` a soft dependency, making this
+  package usable in Plone < 5.0.
+  [thet]
 
 
 2.0.6 (2015-07-18)
diff --git a/plone/schemaeditor/browser/schema/listing.py b/plone/schemaeditor/browser/schema/listing.py
index 0c35d01..a559c7e 100644
--- a/plone/schemaeditor/browser/schema/listing.py
+++ b/plone/schemaeditor/browser/schema/listing.py
@@ -7,13 +7,18 @@
 from plone.z3cform.layout import FormWrapper
 from plone.memoize.instance import memoize
 from plone.autoform.form import AutoExtensibleForm
-from plone.protect.utils import addTokenToUrl
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 
 from plone.schemaeditor import SchemaEditorMessageFactory as _
 from plone.schemaeditor.interfaces import IFieldFactory
 from plone.schemaeditor.utils import SchemaModifiedEvent
 
+try:
+    from plone.protect.utils import addTokenToUrl
+except ImportError:
+    addTokenToUrl = None
+
+
 
 class SchemaListing(AutoExtensibleForm, form.Form):
     implements(IEditForm)
@@ -83,7 +88,8 @@ def delete_url(self, field):
         if field.__name__ in self.context.fieldsWhichCannotBeDeleted:
             return
         url = '%s/%s/@@delete' % (self.context.absolute_url(), field.__name__)
-        url = addTokenToUrl(url, self.request)
+        if addTokenToUrl:
+            url = addTokenToUrl(url, self.request)
         return url
 
     @button.buttonAndHandler(


Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2015-09-04T20:51:50+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.schemaeditor/commit/c81ca0b1c2bf7fdd1a27702cff6977fb03ee24e5

Merge pull request #33 from plone/thet-addTokenToUrl-softdependency-2

addTokenToUrl soft dependency 2nd try

Files changed:
M CHANGES.rst
M plone/schemaeditor/browser/schema/listing.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 40baee7..77345fa 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 2.0.7 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Make ``plone.protect.utils.addTokenToUrl`` a soft dependency, making this
+  package usable in Plone < 5.0.
+  [thet]
 
 
 2.0.6 (2015-07-18)
diff --git a/plone/schemaeditor/browser/schema/listing.py b/plone/schemaeditor/browser/schema/listing.py
index 0c35d01..a559c7e 100644
--- a/plone/schemaeditor/browser/schema/listing.py
+++ b/plone/schemaeditor/browser/schema/listing.py
@@ -7,13 +7,18 @@
 from plone.z3cform.layout import FormWrapper
 from plone.memoize.instance import memoize
 from plone.autoform.form import AutoExtensibleForm
-from plone.protect.utils import addTokenToUrl
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 
 from plone.schemaeditor import SchemaEditorMessageFactory as _
 from plone.schemaeditor.interfaces import IFieldFactory
 from plone.schemaeditor.utils import SchemaModifiedEvent
 
+try:
+    from plone.protect.utils import addTokenToUrl
+except ImportError:
+    addTokenToUrl = None
+
+
 
 class SchemaListing(AutoExtensibleForm, form.Form):
     implements(IEditForm)
@@ -83,7 +88,8 @@ def delete_url(self, field):
         if field.__name__ in self.context.fieldsWhichCannotBeDeleted:
             return
         url = '%s/%s/@@delete' % (self.context.absolute_url(), field.__name__)
-        url = addTokenToUrl(url, self.request)
+        if addTokenToUrl:
+            url = addTokenToUrl(url, self.request)
         return url
 
     @button.buttonAndHandler(


