Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2015-09-22T13:50:23-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.multilingual/commit/fcb7fd1931a8ff305d24bf88fba7eb3a75b1634b

disable csrf protection with multilingual

Files changed:
M src/plone/app/multilingual/testing.py

diff --git a/src/plone/app/multilingual/testing.py b/src/plone/app/multilingual/testing.py
index 5794be6..2ef49c1 100644
--- a/src/plone/app/multilingual/testing.py
+++ b/src/plone/app/multilingual/testing.py
@@ -32,6 +32,11 @@
 from zope.lifecycleevent import ObjectModifiedEvent
 import plone.app.dexterity
 import plone.app.multilingual
+try:
+    from plone.app.robotframework.utils import disableCSRFProtection
+except ImportError:
+    def disableCSRFProtection():
+        pass
 
 
 class PloneAppMultilingualLayer(PloneSandboxLayer):
@@ -105,6 +110,7 @@ class MultiLingual(RemoteLibrary):
 
     def create_content_type(self, portal_type):
         """Create dummy content type with a single custom field"""
+        disableCSRFProtection()
         fti = DexterityFTI(str(portal_type), title=portal_type)
         fti.behaviors = (
             'plone.app.dexterity.behaviors.metadata.IBasic',
@@ -131,6 +137,7 @@ def set_field_language_independent(self, portal_type, field, value='1'):
         """Set the given field in the given portal type language independent
         or unset from being one
         """
+        disableCSRFProtection()
         for schema in iterSchemataForType(portal_type):
             if field in schema:
                 ob = schema[field]
@@ -149,6 +156,7 @@ def create_translation(self, *args, **kwargs):
 
             Create translation  /plone/en/foo  ca  title=Translated
         """
+        disableCSRFProtection()
         # Parse arguments:
         uid_or_path = args[0]
         target_language = args[1]


