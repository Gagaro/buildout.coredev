Repository: plone.app.widgets
Branch: refs/heads/master
Date: 2015-02-17T20:15:40-06:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/3b841adc3d070410156389d0604f6aadcd346cdc

use five.globalrequest

Files changed:
M plone/app/widgets/configure.zcml
M plone/app/widgets/utils.py
M setup.py

diff --git a/plone/app/widgets/configure.zcml b/plone/app/widgets/configure.zcml
index aeb3e62..8a499f2 100644
--- a/plone/app/widgets/configure.zcml
+++ b/plone/app/widgets/configure.zcml
@@ -13,6 +13,7 @@
 
   <include package="Products.CMFPlone" />
   <include package="plone.app.vocabularies" />
+  <include package="five.globalrequest" />
 
   <include package="mockup" />
 
diff --git a/plone/app/widgets/utils.py b/plone/app/widgets/utils.py
index f64ef0a..63b0bc3 100644
--- a/plone/app/widgets/utils.py
+++ b/plone/app/widgets/utils.py
@@ -14,6 +14,7 @@
 from zope.component import getMultiAdapter
 from zope.component import ComponentLookupError
 import json
+from zope.globalrequest import getRequest
 
 _ = MessageFactory('plone.app.widgets')
 _plone = MessageFactory('plone')
@@ -124,13 +125,14 @@ def get_relateditems_options(context, value, separator, vocabulary_name,
                                      vocabulary_name, vocabulary_view,
                                      field_name)
 
-    msgstr = translate(_plone(u'Search'), context=context.REQUEST)
+    request = getRequest()
+    msgstr = translate(_plone(u'Search'), context=request)
     options.setdefault('searchText', msgstr)
-    msgstr = translate(_(u'Entire site'), context=context.REQUEST)
+    msgstr = translate(_(u'Entire site'), context=request)
     options.setdefault('searchAllText', msgstr)
     msgstr = translate(_plone('tabs_home',
                        default=u'Home'),
-                       context=context.REQUEST)
+                       context=request)
     options.setdefault('homeText', msgstr)
     options.setdefault('folderTypes', ['Folder'])
 
diff --git a/setup.py b/setup.py
index b82c195..aed0238 100644
--- a/setup.py
+++ b/setup.py
@@ -30,7 +30,8 @@
         # nedded because users vocabulary was added here
         'plone.app.vocabularies>=2.1.12dev',
         # needed for compatibility with jQuery 1.9+
-        'Products.CMFPlone>=5.0.dev0'
+        'Products.CMFPlone>=5.0.dev0',
+        'five.globalrequest'
     ],
     extras_require={
         'test': [


