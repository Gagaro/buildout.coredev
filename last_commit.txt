Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-03-11T03:34:17+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/0fd147b5cfaf4f927b15292f955d677efd72f01f

Don't try to show IContentLeadImage images, if theree none. Use the 'mini' scale as default scale for IContentLeadImage

Files changed:
M docs/CHANGES.rst
M plone/app/contenttypes/behaviors/leadimage.pt

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 0dadc09..502a6b8 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 1.2 (unreleased)
 ----------------
 
+- Don't try to show IContentLeadImage images, if theree none. Use the "mini"
+  scale as default scale for IContentLeadImage.
+  [thet]
+
 - Improve handling of Link types with other URL schemes than ``http://`` and
   ``https://``.
   [thet]
diff --git a/plone/app/contenttypes/behaviors/leadimage.pt b/plone/app/contenttypes/behaviors/leadimage.pt
index 5e3b3ca..1c50f80 100644
--- a/plone/app/contenttypes/behaviors/leadimage.pt
+++ b/plone/app/contenttypes/behaviors/leadimage.pt
@@ -1,5 +1,6 @@
-<div class="leadImage"
-     tal:condition="view/available">
-  <img tal:define="scale context/@@images"
-       tal:replace="structure python: scale.scale('image', width=200, height=200).tag(css_class='newsImage')" />
-</div>
\ No newline at end of file
+<div class="leadImage" tal:condition="view/available">
+  <img tal:define="has_img context/image|nothing;
+                   scales context/@@images|nothing"
+       tal:condition="python:has_img and scales" 
+       tal:replace="structure python: scales.scale('image', scale='mini').tag(css_class='newsImage')" />
+</div>


