Repository: plone.i18n
Branch: refs/heads/master
Date: 2015-04-20T12:03:34+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.i18n/commit/fcec32a18e6c6b9514ce3effb655e08b312206d7

Allow calling getPreferredLanguage with no request

This makes calls of getPreferredLanguage backwards compatible.

Files changed:
M plone/i18n/utility.py

diff --git a/plone/i18n/utility.py b/plone/i18n/utility.py
index 68f2c3c..ecaf185 100644
--- a/plone/i18n/utility.py
+++ b/plone/i18n/utility.py
@@ -11,8 +11,7 @@
 from zope.component import getMultiAdapter
 from zope.component import getUtility
 from Products.CMFCore.interfaces import IDublinCore
-from zope.component.hooks import getSite
-
+from zope.globalrequest import getRequest
 from plone.registry.interfaces import IRegistry
 from Products.CMFPlone.interfaces import ILanguageSchema
 
@@ -234,8 +233,10 @@ def getLanguageCookie(self, request):
             return langCookie
         return None
 
-    def getPreferredLanguage(self, request):
+    def getPreferredLanguage(self, request=None):
         """Gets the preferred site language."""
+        if request is None:
+            request = getRequest()
         l = self.getLanguageBindings(request)
         if l[0]:
             if not self.settings.use_combined_language_codes:


Repository: plone.i18n
Branch: refs/heads/master
Date: 2015-04-20T10:09:17Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.i18n/commit/6dd1d457913742e552db21cc7ecdf07537b78ce3

document changes

Files changed:
M CHANGES.txt

diff --git a/CHANGES.txt b/CHANGES.txt
index d3d2c18..be564e4 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 3.0.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Allow calling getPreferedLanguage without parameter again
+  [tomgross]
 
 
 3.0.1 (2015-03-30)


Repository: plone.i18n
Branch: refs/heads/master
Date: 2015-04-22T15:35:18+02:00
Author: Ramon Navarro Bosch (bloodbare) <ramon.nb@gmail.com>
Commit: https://github.com/plone/plone.i18n/commit/845d2b12b3bd570c6ab14e22fab1e8ca2405601f

Merge pull request #11 from plone/tomgross-patch-1

Allow calling getPreferredLanguage with no request

Files changed:
M CHANGES.txt
M plone/i18n/utility.py

diff --git a/CHANGES.txt b/CHANGES.txt
index d3d2c18..be564e4 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 3.0.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Allow calling getPreferedLanguage without parameter again
+  [tomgross]
 
 
 3.0.1 (2015-03-30)
diff --git a/plone/i18n/utility.py b/plone/i18n/utility.py
index 68f2c3c..ecaf185 100644
--- a/plone/i18n/utility.py
+++ b/plone/i18n/utility.py
@@ -11,8 +11,7 @@
 from zope.component import getMultiAdapter
 from zope.component import getUtility
 from Products.CMFCore.interfaces import IDublinCore
-from zope.component.hooks import getSite
-
+from zope.globalrequest import getRequest
 from plone.registry.interfaces import IRegistry
 from Products.CMFPlone.interfaces import ILanguageSchema
 
@@ -234,8 +233,10 @@ def getLanguageCookie(self, request):
             return langCookie
         return None
 
-    def getPreferredLanguage(self, request):
+    def getPreferredLanguage(self, request=None):
         """Gets the preferred site language."""
+        if request is None:
+            request = getRequest()
         l = self.getLanguageBindings(request)
         if l[0]:
             if not self.settings.use_combined_language_codes:


