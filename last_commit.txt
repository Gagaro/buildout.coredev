Repository: plone.app.querystring


Branch: refs/heads/1.2.x
Date: 2015-09-18T22:09:46+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.querystring/commit/1445e1209e325a53a4064f0a822df63049ef57b3

Check if key is in the catalog indexes, for mapSortableIndexes.

Files changed:
M plone/app/querystring/registryreader.py

diff --git a/plone/app/querystring/registryreader.py b/plone/app/querystring/registryreader.py
index 8c849e0..3f1ac56 100644
--- a/plone/app/querystring/registryreader.py
+++ b/plone/app/querystring/registryreader.py
@@ -109,7 +109,7 @@ def mapSortableIndexes(self, values):
         catalog = getToolByName(getSite(), 'portal_catalog')._catalog
         sortables = {}
         for key, field in values.get('%s.field' % self.prefix).iteritems():
-            if field['sortable'] and \
+            if field['sortable'] and key in catalog.indexes and \
                not IZCTextIndex.providedBy(catalog.getIndex(key)):
                 sortables[key] = values.get('%s.field.%s' % (self.prefix, key))
         values['sortable'] = sortables


