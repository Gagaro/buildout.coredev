Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-05-04T18:26:56+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/7ec1cdece9b879979393279f7aa4213da0c598ad

update docs and simplify changelog

Files changed:
M docs/CHANGES.rst
M docs/README.rst

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index d548685..7f017ce 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 1.2a8 (unreleased)
 ------------------
 
+- Add migrations from custom AT types to available DX types (fix #133).
+  [gbastien, cekk, tiazma, flohcim, pbauer]
+
 - Fix ``contentFilter`` for collections.
   [thet]
 
@@ -109,13 +112,6 @@ Changelog
 1.2a5 (2014-10-23)
 ------------------
 
-- Add custom migration for AT-Types that were removed from portal_types.
-  [pbauer]
-
-- Added helper view for migration custom AT types to available DX types,
-  see issue #133.
-  [gbastien]
-
 - Code modernization: sorted imports, use decorators, utf8 headers.
   [jensens]
 
@@ -169,9 +165,6 @@ Changelog
   sort order correctly.
   [maurits]
 
-- Added migration method that allows to migrate custom AT types to
-  available DX types (#133)
-  [cekk]
 
 1.2a3 (2014-04-19)
 ------------------
diff --git a/docs/README.rst b/docs/README.rst
index 9e47cec..ce6c26f 100644
--- a/docs/README.rst
+++ b/docs/README.rst
@@ -250,7 +250,7 @@ Migrating custom content
 
 During migrations of the default types any custom content-types will not be migrated and will continue to work as expected.
 
-To help you migrating these to Dexterity plone.app.contenttypes contains a migration form (``/@@custom_migration``) that allows you to migrate any (custom or default) Archetypes-type to any (custom or default) Dexterity-type. The only requirement is that the Dexterity-type you want to migrate to has to exist and that the class of a old type are still present. It makes no difference if the type you are migrating is still registered in portal_types or is already removed or replaced by a dexterity-version using the same name.
+To help you migrating these types to Dexterity plone.app.contenttypes contains a migration form (``/@@custom_migration``) that allows you to migrate any (custom or default) Archetypes-type to any (custom or default) Dexterity-type. The only requirement is that the Dexterity-type you want to migrate to has to exist and that the class of the old type is still present. It makes no difference if the type you are migrating from is still registered in portal_types or is already removed or replaced by a dexterity-version using the same name.
 
 In the form ``/@@custom_migration`` you can select a Dexterity-type for any Archetypes-types that exists in the portal. You can then map the source-types fields to the targets fields. You can also choose to ignore fields. You have to take care that the values can be migrated (since there is no validation for that), e.g. it would make no sense to migrate a ImageField to a TextField. There are build-in methods for most field-types, custom or rarely used fields might not migrate properly (you can create a issue if you miss a migration that is not yet supported).
 
@@ -260,15 +260,9 @@ After you map the fields you can test the configuration. During a test one item
 Widgets
 -------
 
-When used in Plone 4.x plone.app.contenttypes uses the default z3c.form widgets. All widgets work as they used to with Archetypes except for the keywords-widget for which a simple linesfield is used.
+When used in Plone 4.x plone.app.contenttypes uses the default z3c.form widgets. All widgets work as they used to with Archetypes except for the keywords-widget for which a simple linesfield is used. Replacing that with a nicer implementation is explained below.
 
-It is recommended to use ``plone.app.widgets`` to switch to the widgets that will be used in Plone 5.
-
-
-How to use with plone.app.widgets
-^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
-
-TODO
+It is also possible to use ``plone.app.widgets`` to switch to the widgets that are used in Plone 5.
 
 
 How to override widgets


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-05-04T18:27:13+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/30236251177fbf992eefb760a96d64e2f5114173

fix test-isolation-issues

Files changed:
M plone/app/contenttypes/tests/test_migration_custom.py

diff --git a/plone/app/contenttypes/tests/test_migration_custom.py b/plone/app/contenttypes/tests/test_migration_custom.py
index 28863a8..4ec135a 100644
--- a/plone/app/contenttypes/tests/test_migration_custom.py
+++ b/plone/app/contenttypes/tests/test_migration_custom.py
@@ -255,6 +255,7 @@ def test_migrate_atevent_to_dxnewsitem(self):
         at_event.setText('Tütensuppe')
         at_event.setContentType('text/plain')
 
+        oldTZ = os.environ.get('TZ', None)
         os.environ['TZ'] = 'Asia/Tbilisi'
 
         qi = self.portal.portal_quickinstaller
@@ -276,6 +277,11 @@ def test_migrate_atevent_to_dxnewsitem(self):
         )
         # migrate ATCTEvent to default DX News Item
         migrateCustomAT(fields_mapping, src_type='Event', dst_type='News Item')
+        if oldTZ:
+            os.environ['TZ'] = oldTZ
+        else:
+            del os.environ['TZ']
+
         dx_newsitem = self.portal['event']
         self.assertTrue(INewsItem.providedBy(dx_newsitem))
         self.assertTrue(dx_newsitem is not at_event)
@@ -321,6 +327,7 @@ def test_migrate_atevent_to_dxevent(self):
         at_event.setText('Tütensuppe')
         at_event.setContentType('text/plain')
 
+        oldTZ = os.environ.get('TZ', None)
         TZ = 'Asia/Tbilisi'
         os.environ['TZ'] = TZ
         timezone = pytz.timezone(TZ)
@@ -383,3 +390,7 @@ def test_migrate_atevent_to_dxevent(self):
             timezone.localize(datetime.strptime(start, FORMAT)))
         self.assertEquals(
             dx_event.end, timezone.localize(datetime.strptime(end, FORMAT)))
+        if oldTZ:
+            os.environ['TZ'] = oldTZ
+        else:
+            del os.environ['TZ']


