Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-10-02T20:09:42+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.theming/commit/5ba9447150776f7edbfd73b528b9b62f31dd14b5

Do not fail in ``isThemeEnabled`` when we have no settings.

This happens when migrating from Plone 3 to Plone 5, but maybe also in
other cases.

Files changed:
M CHANGES.rst
M src/plone/app/theming/policy.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4b357f0..20b5e5b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,10 @@ Changelog
 1.2.15 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Do not fail in ``isThemeEnabled`` when we have no settings, for
+  example when migrating from Plone 3 to Plone 5, but maybe also in
+  other cases.
+  [maurits]
 
 
 1.2.14 (2015-09-27)
diff --git a/src/plone/app/theming/policy.py b/src/plone/app/theming/policy.py
index 900e773..76060f2 100644
--- a/src/plone/app/theming/policy.py
+++ b/src/plone/app/theming/policy.py
@@ -87,7 +87,7 @@ def isThemeEnabled(self, settings=None):
 
         if not settings:
             settings = self.getSettings()
-        if not settings.enabled or not settings.rules:
+        if settings is None or not settings.enabled or not settings.rules:
             return False
 
         server_url = self.request.get('SERVER_URL')


