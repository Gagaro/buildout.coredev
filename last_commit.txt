Repository: plone.app.content
Branch: refs/heads/master
Date: 2015-04-09T14:31:30+02:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/de0dfbbe6c400cf7a177e9eddf6644d843815b70

translate add menu. fixes https://github.com/plone/Products.CMFPlone/issues/421

Files changed:
M CHANGES.rst
M plone/app/content/browser/folder.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3031164..3e81bf2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 3.0.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Translate folder contents add menu
+  [vangheem]
 
 
 3.0.3 (2015-03-26)
diff --git a/plone/app/content/browser/folder.py b/plone/app/content/browser/folder.py
index d497bac..07d2d77 100644
--- a/plone/app/content/browser/folder.py
+++ b/plone/app/content/browser/folder.py
@@ -26,6 +26,7 @@
 from zope.container.interfaces import INameChooser
 from zope.event import notify
 from zope.interface import implementer
+from zope.i18n import translate
 from zope.lifecycleevent import ObjectModifiedEvent
 
 import transaction
@@ -530,8 +531,15 @@ def __call__(self):
         factories_menu = getUtility(
             IBrowserMenu, name='plone_contentmenu_factory',
             context=self.context).getMenuItems(self.context, self.request)
-        factories_menu = [m for m in factories_menu
-                          if m.get('title') != 'folder_add_settings']
+        factories = []
+        for item in factories_menu:
+            if item.get('title') == 'folder_add_settings':
+                continue
+            factories.append({
+                'id': item.get('id'),
+                'title': translate(item.get('title', '')),
+                'action': item.get('action')
+                })
 
         context = aq_inner(self.context)
         crumbs = []
@@ -564,7 +572,7 @@ def __call__(self):
                     val = val[len(base_path):]
                 item[key] = val
         return json_dumps({
-            'addButtons': factories_menu,
+            'addButtons': factories,
             'defaultPage': self.context.getDefaultPage(),
             'breadcrumbs': [c for c in reversed(crumbs)],
             'object': item


