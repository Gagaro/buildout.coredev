Repository: plone.app.querystring
Branch: refs/heads/1.2.x
Date: 2015-05-29T16:29:52+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.querystring/commit/f33d659281e1961516bc36e2b346e48ce7efa0a8

fix query for path using a UID

Conflicts:
	plone/app/querystring/queryparser.py

Files changed:
M plone/app/querystring/queryparser.py
M plone/app/querystring/tests/testQueryParser.py

diff --git a/plone/app/querystring/queryparser.py b/plone/app/querystring/queryparser.py
index 9cc011c..564c751 100644
--- a/plone/app/querystring/queryparser.py
+++ b/plone/app/querystring/queryparser.py
@@ -247,14 +247,13 @@ def _path(context, row):
             depth = int(_depth)
         except ValueError:
             pass
-    if not '/' in values:
+    if '/' not in values:
         # It must be a UID
-        values = '/'.join(getPathByUID(context, values))
+        values = getPathByUID(context, values)
     # take care of absolute paths without nav_root
     nav_root = getNavigationRoot(context)
     if not values.startswith(nav_root):
         values = nav_root + values
-
     query = {}
     if depth is not None:
         query['depth'] = depth
diff --git a/plone/app/querystring/tests/testQueryParser.py b/plone/app/querystring/tests/testQueryParser.py
index 07bc2ae..a4a7a7b 100644
--- a/plone/app/querystring/tests/testQueryParser.py
+++ b/plone/app/querystring/tests/testQueryParser.py
@@ -21,13 +21,13 @@ class MockObject(object):
 
     def __init__(self, uid, path):
         self.uid = uid
-        self.path = path.split("/")
+        self.path = path
 
     def getPath(self):
         return self.path
 
     def getPhysicalPath(self):
-        return self.path
+        return self.path.split("/")
 
     def absolute_url(self):
         return self.path
@@ -159,7 +159,6 @@ def test_path_computed(self):
             'o': 'plone.app.querystring.operation.string.path',
             'v': '00000000000000001',
         }
-
         parsed = queryparser.parseFormquery(MockSite(), [data, ])
         self.assertEqual(
             parsed, {'path': {'query': ['/%s/foo' % MOCK_SITE_ID]}})
@@ -506,4 +505,4 @@ def test__relativePath(self):
 
     def test_getPathByUID(self):
         actual = queryparser.getPathByUID(MockSite(), '00000000000000001')
-        self.assertEqual(actual, ['', 'site', 'foo'])
+        self.assertEqual(actual, '/site/foo')


Repository: plone.app.querystring
Branch: refs/heads/1.2.x
Date: 2015-05-29T16:30:39+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.querystring/commit/ea71c80625e4e115206d7c872c826b1c9ecde4ae

add changenote

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 5b2a878..70e24bc 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.2.6 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fix path-queries using UID (backported from master).
+  [pbauer]
 
 
 1.2.5 (2015-04-28)


