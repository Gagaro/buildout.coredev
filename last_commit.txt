Repository: plone.app.registry


Branch: refs/heads/master
Date: 2015-10-05T08:47:56-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.registry/commit/eec6a3d3a5b8f16093ccb353bdb2136a0c741010

show loading icon in control panel when searching

Files changed:
M CHANGES.rst
M plone/app/registry/browser/resources/registry.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 94525f8..c12c623 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,8 +4,8 @@ Changelog
 1.3.6 (unreleased)
 ------------------
 
-- Nothing changed yet.
-
+- show loading icon in control panel when searching
+  [vangheem]
 
 1.3.5 (2015-09-20)
 ------------------
diff --git a/plone/app/registry/browser/resources/registry.js b/plone/app/registry/browser/resources/registry.js
index fea3119..c351a20 100644
--- a/plone/app/registry/browser/resources/registry.js
+++ b/plone/app/registry/browser/resources/registry.js
@@ -24,14 +24,20 @@ if(require === undefined){
           }
         });
       }
+    }, {
+      loading: {
+        show: function(){ window.jQuery$('#spinner').show(); },
+        hide: function(){ window.jQuery$('#spinner').hide(); },
+      }
     });
   };
 }
 
 require([
   'jquery',
-  'pat-registry'
-], function($, Registry) {
+  'pat-registry',
+  'mockup-utils'
+], function($, Registry, utils) {
   'use strict';
 
   $().ready(function() {
@@ -39,10 +45,11 @@ require([
     /* ajax retrieval of paging */
     $('#recordsContainer').on('click', 'div.listingBar a', function(){
       var self = $(this);
-      $('#spinner').show();
+      utils.loading.show();
       $('#recordsContainer').load(self.attr('href') + ' #recordsTable', function(){
         /* scan registry */
         Registry.scan($('#recordsTable'));
+        utils.loading.hide();
       });
       return false;
     });
@@ -50,13 +57,14 @@ require([
     /* ajax form submission */
     $('#recordsContainer').on('submit', '#searchrow form', function(e){
       var self = $(this);
-      $('#spinner').show();
+      utils.loading.show();
       $('#recordsContainer').load(
         $('body').attr('data-base-url') + '?' + self.serialize() + ' #recordsTable',
         function(){
           $('#spinner').hide();
           $('#searchrow input[name="q"]').trigger('keypress');
           Registry.scan($('#recordsTable'));
+          utils.loading.hide();
         }
       );
       e.preventDefault();
@@ -65,7 +73,7 @@ require([
 
     /* force submit on select change */
     $('#recordsContainer').on('change', '#searchrow select', function(){
-        $('#searchrow form#registry-filter').trigger('submit');
+      $('#searchrow form#registry-filter').trigger('submit');
     });
 
     /* some init */


