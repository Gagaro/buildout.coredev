Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-05-05T21:02:44+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/919a6764804ff8cc94afaa3ebccf07a2561c6856

Don't show LeadImageViewlet on folder_contents view.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/viewlets.py
M plone/app/contenttypes/tests/test_behaviors_leadimage.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4991678..3a7023b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.2a9 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Don't show LeadImageViewlet on folder_contents view.
+  [thet]
 
 
 1.2a8 (2015-05-04)
diff --git a/plone/app/contenttypes/behaviors/viewlets.py b/plone/app/contenttypes/behaviors/viewlets.py
index bfa37ae..623eaf0 100644
--- a/plone/app/contenttypes/behaviors/viewlets.py
+++ b/plone/app/contenttypes/behaviors/viewlets.py
@@ -10,5 +10,6 @@ class LeadImageViewlet(ViewletBase):
     def update(self):
         self.context = ILeadImage(self.context)
         self.available = True if self.context.image else False
-        if INewsItem.providedBy(self.context):
+        if INewsItem.providedBy(self.context)\
+                or 'folder_contents' in self.request.URL:
             self.available = False
diff --git a/plone/app/contenttypes/tests/test_behaviors_leadimage.py b/plone/app/contenttypes/tests/test_behaviors_leadimage.py
index dcf6fba..cc9ab9b 100644
--- a/plone/app/contenttypes/tests/test_behaviors_leadimage.py
+++ b/plone/app/contenttypes/tests/test_behaviors_leadimage.py
@@ -78,3 +78,10 @@ def test_lead_image_viewlet_shows_up(self):
         self.assertTrue('image.jpg' in self.browser.contents)
 
         self.assertTrue('<div class="leadImage">' in self.browser.contents)
+
+        # But doesn't show up on folder_contents
+        self.browser.open(self.portal_url + '/leadimagedoc/folder_contents')
+        self.assertTrue('<div class="leadImage">' not in self.browser.contents)
+        # nor @@folder_contents
+        self.browser.open(self.portal_url + '/leadimagedoc/@@folder_contents')
+        self.assertTrue('<div class="leadImage">' not in self.browser.contents)


