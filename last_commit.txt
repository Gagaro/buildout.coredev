Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-16T11:48:35+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/3cb937decd8ea4f43155dafe736d16ef97310ef6

Fixes error when adding a new Plone site with a country specific locale.

Files changed:
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5cf4266..9e7842d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0b3 (unreleased)
 ------------------
 
+- Fix adding a new Plone site with country specific language. Refs #411.
+  [jaroel]
+
 - fix plone-logged-in bundle not using global jquery for requirejs dependency and in
   weird cases causing select2 load errors in patterns(especially resource registry)
   [vangheem]
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index cb97f53..cd3e13c 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -147,7 +147,7 @@ class ILanguageSchema(Interface):
             default=u"Examples: pt-br (Brazilian Portuguese), "
                     u"en-us (American English) etc."
         ),
-        default=False,
+        default=True,
         required=False
     )
 


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-16T14:07:57+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/9926d83f85ed4399ff988e731f44b25d3a58b684

Change tests to reflect the new default state.

Files changed:
M Products/CMFPlone/controlpanel/README.rst
M Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py

diff --git a/Products/CMFPlone/controlpanel/README.rst b/Products/CMFPlone/controlpanel/README.rst
index 7d9a7a4..f3ba7c6 100644
--- a/Products/CMFPlone/controlpanel/README.rst
+++ b/Products/CMFPlone/controlpanel/README.rst
@@ -68,7 +68,7 @@ Language Control Panel
   ['en']
 
   >>> language_settings.use_combined_language_codes
-  False
+  True
 
   >>> language_settings.display_flags
   False
diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
index 75fd6fe..1244317 100644
--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
@@ -74,21 +74,21 @@ def test_get_use_combined_language_codes(self):
         self.assertEqual(
             getAdapter(
                 self.portal, ILanguageSchema).use_combined_language_codes,
-            False
+            True
         )
-        self.settings.use_combined_language_codes = True
+        self.settings.use_combined_language_codes = False
         self.assertEquals(
             getAdapter(self.portal, ILanguageSchema).use_combined_language_codes,
-            True
+            False
         )
 
     def test_set_use_combined_language_codes(self):
         self.assertEquals(
             self.settings.use_combined_language_codes,
-            False
+            True
         )
         getAdapter(
-              self.portal, ILanguageSchema).use_combined_language_codes = True
+              self.portal, ILanguageSchema).use_combined_language_codes = False
         self.assertEquals(
             self.settings.use_combined_language_codes,
             True
diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
index 1e0bda0..eb32c75 100644
--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
@@ -108,25 +108,26 @@ def test_default_language(self):
     #     self.assertEqual(settings.available_languages, ['en', 'de'])
 
     def test_use_combined_language_codes(self):
+        """This checks swithing combined languages codes support off/on."""
         registry = getUtility(IRegistry)
         settings = registry.forInterface(ILanguageSchema, prefix='plone')
         self.browser.open(
             "%s/@@language-controlpanel" % self.portal_url)
-        self.assertEqual(settings.use_combined_language_codes, False)
+        self.assertEqual(settings.use_combined_language_codes, True)
         self.assertEqual(
             self.browser.getControl(
                 'Show country-specific language variants'
             ).selected,
-            False
+            True
         )
         self.browser.getControl(
             'Show country-specific language variants'
-        ).selected = True
+        ).selected = False
 
         self._inject_available_languages_field('en')
         self.browser.getControl('Save').click()
 
-        self.assertEqual(settings.use_combined_language_codes, True)
+        self.assertEqual(settings.use_combined_language_codes, False)
 
     def test_display_flags(self):
         registry = getUtility(IRegistry)


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-16T15:25:53+02:00
Author: Roel Bruggink (jaroel) <roel@jaroel.nl>
Commit: https://github.com/plone/Products.CMFPlone/commit/052d3a4d7e92e87bce95a278b98ea7c054a98c70

Change this test too

Files changed:
M Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py

diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
index 1244317..a96d998 100644
--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
@@ -91,7 +91,7 @@ def test_set_use_combined_language_codes(self):
               self.portal, ILanguageSchema).use_combined_language_codes = False
         self.assertEquals(
             self.settings.use_combined_language_codes,
-            True
+            False
         )
 
     def test_get_display_flags(self):


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-16T16:39:08+02:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/bb1d1ed42736195e35f2b4d590999a13b8863d91

Merge pull request #690 from plone/411-de-at-fix

Fix error when adding a new Plone site with a country specific locale.

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/README.rst
M Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
M Products/CMFPlone/interfaces/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5cf4266..9e7842d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0b3 (unreleased)
 ------------------
 
+- Fix adding a new Plone site with country specific language. Refs #411.
+  [jaroel]
+
 - fix plone-logged-in bundle not using global jquery for requirejs dependency and in
   weird cases causing select2 load errors in patterns(especially resource registry)
   [vangheem]
diff --git a/Products/CMFPlone/controlpanel/README.rst b/Products/CMFPlone/controlpanel/README.rst
index 7d9a7a4..f3ba7c6 100644
--- a/Products/CMFPlone/controlpanel/README.rst
+++ b/Products/CMFPlone/controlpanel/README.rst
@@ -68,7 +68,7 @@ Language Control Panel
   ['en']
 
   >>> language_settings.use_combined_language_codes
-  False
+  True
 
   >>> language_settings.display_flags
   False
diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
index 75fd6fe..a96d998 100644
--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_bbb_language_adapter.py
@@ -74,24 +74,24 @@ def test_get_use_combined_language_codes(self):
         self.assertEqual(
             getAdapter(
                 self.portal, ILanguageSchema).use_combined_language_codes,
-            False
+            True
         )
-        self.settings.use_combined_language_codes = True
+        self.settings.use_combined_language_codes = False
         self.assertEquals(
             getAdapter(self.portal, ILanguageSchema).use_combined_language_codes,
-            True
+            False
         )
 
     def test_set_use_combined_language_codes(self):
         self.assertEquals(
             self.settings.use_combined_language_codes,
-            False
+            True
         )
         getAdapter(
-              self.portal, ILanguageSchema).use_combined_language_codes = True
+              self.portal, ILanguageSchema).use_combined_language_codes = False
         self.assertEquals(
             self.settings.use_combined_language_codes,
-            True
+            False
         )
 
     def test_get_display_flags(self):
diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
index 1e0bda0..eb32c75 100644
--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_language.py
@@ -108,25 +108,26 @@ def test_default_language(self):
     #     self.assertEqual(settings.available_languages, ['en', 'de'])
 
     def test_use_combined_language_codes(self):
+        """This checks swithing combined languages codes support off/on."""
         registry = getUtility(IRegistry)
         settings = registry.forInterface(ILanguageSchema, prefix='plone')
         self.browser.open(
             "%s/@@language-controlpanel" % self.portal_url)
-        self.assertEqual(settings.use_combined_language_codes, False)
+        self.assertEqual(settings.use_combined_language_codes, True)
         self.assertEqual(
             self.browser.getControl(
                 'Show country-specific language variants'
             ).selected,
-            False
+            True
         )
         self.browser.getControl(
             'Show country-specific language variants'
-        ).selected = True
+        ).selected = False
 
         self._inject_available_languages_field('en')
         self.browser.getControl('Save').click()
 
-        self.assertEqual(settings.use_combined_language_codes, True)
+        self.assertEqual(settings.use_combined_language_codes, False)
 
     def test_display_flags(self):
         registry = getUtility(IRegistry)
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index cb97f53..cd3e13c 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -147,7 +147,7 @@ class ILanguageSchema(Interface):
             default=u"Examples: pt-br (Brazilian Portuguese), "
                     u"en-us (American English) etc."
         ),
-        default=False,
+        default=True,
         required=False
     )
 


