Repository: mockup


Branch: refs/heads/master
Date: 2015-07-17T08:03:18-04:00
Author: Brayton Osgood (braytonosg) <braytonosgood@gmail.com>
Commit: https://github.com/plone/mockup/commit/15141ec3909cb66493c109fea3ec7dde32a0abfc

fix pickadate default timezone to work even if the default isn't the last timezone in the list

Files changed:
M CHANGES.rst
M mockup/patterns/pickadate/pattern.js
M mockup/tests/pattern-pickadate-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index faaa645..0b1e5f9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- fix pickadate default timezone to work even if the default isn't the
+  last timezone in the list
+  [braytonosg]
+
 - remove add menu from structure as we will rely on toolbar add menu
   for this functionality
   [vangheem]
diff --git a/mockup/patterns/pickadate/pattern.js b/mockup/patterns/pickadate/pattern.js
index 2324b9e..fb9d9cf 100644
--- a/mockup/patterns/pickadate/pattern.js
+++ b/mockup/patterns/pickadate/pattern.js
@@ -245,8 +245,9 @@ define([
         if (defaultTimezone) {
           var isInList;
           // the timezone list contains the default value
-          self.options.timezone.data.forEach(function(obj) {
+          self.options.timezone.data.some(function(obj) {
             isInList = (obj.text === self.options.timezone.default) ? true : false;
+            return isInList;
           });
           if (isInList) {
             self.$timezone.attr('data-value', defaultTimezone);
diff --git a/mockup/tests/pattern-pickadate-test.js b/mockup/tests/pattern-pickadate-test.js
index 5eec29c..7d3d1c7 100644
--- a/mockup/tests/pattern-pickadate-test.js
+++ b/mockup/tests/pattern-pickadate-test.js
@@ -429,7 +429,8 @@ define([
             $input = $('.pat-pickadate', self.$el)
               .attr('data-pat-pickadate', '{"timezone": {"default": "Europe/Vienna", "data": [' +
                                             '{"id":"Europe/Berlin","text":"Europe/Berlin"},' +
-                                            '{"id":"Europe/Vienna","text":"Europe/Vienna"}' +
+                                            '{"id":"Europe/Vienna","text":"Europe/Vienna"},' +
+                                            '{"id":"Europe/Madrid","text":"Europe/Madrid"}' +
                                           ']}}'
               );
         self.$el.appendTo('body');


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-17T14:56:40+02:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/69a22626720852ac0e4dc77d1f3f7e723ecb615b

Merge pull request #534 from braytonosg/fix_pickadate_default_timezone

fix pickadate default timezone to work even if the default isn't the â€¦

Files changed:
M CHANGES.rst
M mockup/patterns/pickadate/pattern.js
M mockup/tests/pattern-pickadate-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index faaa645..0b1e5f9 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- fix pickadate default timezone to work even if the default isn't the
+  last timezone in the list
+  [braytonosg]
+
 - remove add menu from structure as we will rely on toolbar add menu
   for this functionality
   [vangheem]
diff --git a/mockup/patterns/pickadate/pattern.js b/mockup/patterns/pickadate/pattern.js
index 2324b9e..fb9d9cf 100644
--- a/mockup/patterns/pickadate/pattern.js
+++ b/mockup/patterns/pickadate/pattern.js
@@ -245,8 +245,9 @@ define([
         if (defaultTimezone) {
           var isInList;
           // the timezone list contains the default value
-          self.options.timezone.data.forEach(function(obj) {
+          self.options.timezone.data.some(function(obj) {
             isInList = (obj.text === self.options.timezone.default) ? true : false;
+            return isInList;
           });
           if (isInList) {
             self.$timezone.attr('data-value', defaultTimezone);
diff --git a/mockup/tests/pattern-pickadate-test.js b/mockup/tests/pattern-pickadate-test.js
index 5eec29c..7d3d1c7 100644
--- a/mockup/tests/pattern-pickadate-test.js
+++ b/mockup/tests/pattern-pickadate-test.js
@@ -429,7 +429,8 @@ define([
             $input = $('.pat-pickadate', self.$el)
               .attr('data-pat-pickadate', '{"timezone": {"default": "Europe/Vienna", "data": [' +
                                             '{"id":"Europe/Berlin","text":"Europe/Berlin"},' +
-                                            '{"id":"Europe/Vienna","text":"Europe/Vienna"}' +
+                                            '{"id":"Europe/Vienna","text":"Europe/Vienna"},' +
+                                            '{"id":"Europe/Madrid","text":"Europe/Madrid"}' +
                                           ']}}'
               );
         self.$el.appendTo('body');


