Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2015-09-08T09:27:45-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/f25e125f57e68e13f10d67a142020f7b61ce97a3

Do not throw a 404 on site root RSS feeds

Files changed:
M Products/CMFPlone/browser/syndication/views.py
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/browser/syndication/views.py b/Products/CMFPlone/browser/syndication/views.py
index 07c292c..34df101 100644
--- a/Products/CMFPlone/browser/syndication/views.py
+++ b/Products/CMFPlone/browser/syndication/views.py
@@ -28,7 +28,9 @@ def feed(self):
     def __call__(self):
         util = getMultiAdapter((self.context, self.request),
                                name='syndication-util')
-        if util.context_enabled(raise404=True):
+        context_state = getMultiAdapter((self.context, self.request),
+                                        name=u'plone_context_state')
+        if context_state.is_portal_root() or util.context_enabled(raise404=True):
             settings = IFeedSettings(self.context)
             if self.__name__ not in settings.feed_types:
                 raise NotFound
@@ -111,8 +113,9 @@ def __call__(self):
 
 class SettingsForm(form.EditForm):
     label = _(u'heading_syndication_properties',
-        default=u'Syndication Properties')
-    description = _(u'description_syndication_properties',
+              default=u'Syndication Properties')
+    description = _(
+        u'description_syndication_properties',
         default=u'Syndication enables you to syndicate this folder so it can'
                 u'be synchronized from other web sites.')
     fields = field.Fields(IFeedSettings)
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index f83ac59..fa6bf2c 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 4.3.7 (unreleased)
 ------------------
 
+- Do not throw a 404 on site root RSS feeds
+  [vangheem]
+
 - Upgrade known core packages at the end of the Plone migration.
   [maurits]
 


Repository: Products.CMFPlone


Branch: refs/heads/4.3.x
Date: 2015-09-08T14:32:10-03:00
Author: HÃ©ctor Velarde (hvelarde) <hvelarde@yahoo.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/859b9a09a9833209af5e616c30be8e3aa5079bc1

Merge pull request #881 from plone/fix-site-root-syndication

Do not throw a 404 on site root RSS feeds

Files changed:
M Products/CMFPlone/browser/syndication/views.py
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/browser/syndication/views.py b/Products/CMFPlone/browser/syndication/views.py
index 07c292c..34df101 100644
--- a/Products/CMFPlone/browser/syndication/views.py
+++ b/Products/CMFPlone/browser/syndication/views.py
@@ -28,7 +28,9 @@ def feed(self):
     def __call__(self):
         util = getMultiAdapter((self.context, self.request),
                                name='syndication-util')
-        if util.context_enabled(raise404=True):
+        context_state = getMultiAdapter((self.context, self.request),
+                                        name=u'plone_context_state')
+        if context_state.is_portal_root() or util.context_enabled(raise404=True):
             settings = IFeedSettings(self.context)
             if self.__name__ not in settings.feed_types:
                 raise NotFound
@@ -111,8 +113,9 @@ def __call__(self):
 
 class SettingsForm(form.EditForm):
     label = _(u'heading_syndication_properties',
-        default=u'Syndication Properties')
-    description = _(u'description_syndication_properties',
+              default=u'Syndication Properties')
+    description = _(
+        u'description_syndication_properties',
         default=u'Syndication enables you to syndicate this folder so it can'
                 u'be synchronized from other web sites.')
     fields = field.Fields(IFeedSettings)
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index f83ac59..fa6bf2c 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 4.3.7 (unreleased)
 ------------------
 
+- Do not throw a 404 on site root RSS feeds
+  [vangheem]
+
 - Upgrade known core packages at the end of the Plone migration.
   [maurits]
 


