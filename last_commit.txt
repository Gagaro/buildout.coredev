Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-05T22:44:51-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/af82a7e6420cea9d683fa776f596c64400349bd6

retry my fixes to product installation/visibility

Files changed:
M Products/CMFPlone/browser/admin.py
M Products/CMFPlone/factory.py
M Products/CMFPlone/setuphandlers.py

diff --git a/Products/CMFPlone/browser/admin.py b/Products/CMFPlone/browser/admin.py
index d1cfcc6..c107393 100644
--- a/Products/CMFPlone/browser/admin.py
+++ b/Products/CMFPlone/browser/admin.py
@@ -116,10 +116,10 @@ class FrontPage(BrowserView):
 
 class AddPloneSite(BrowserView):
 
+    # Profiles that are installed by default,
+    # but can be removed later.
     default_extension_profiles = (
-        'plone.app.registry:default',
-        'plonetheme.classic:default',
-        'plone.app.theming:default',
+        'plone.app.caching:default',
         'plonetheme.barceloneta:default',
     )
 
@@ -130,10 +130,7 @@ def profiles(self):
         # profiles available for install/uninstall, but hidden at the time
         # the Plone site is created
         not_installable = [
-            'kupu:default',
-            'plonetheme.classic:uninstall',
             'Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow',
-            'plone.app.z3cform:default',
         ]
         utils = getAllUtilitiesRegisteredFor(INonInstallable)
         for util in utils:
@@ -156,8 +153,7 @@ def _key(v):
 
         for info in profile_registry.listProfileInfo():
             if info.get('type') == BASE and \
-               info.get('for') in (IPloneSiteRoot, None) and \
-               info.get('id') != u'Products.kupu:default':
+               info.get('for') in (IPloneSiteRoot, None):
                 base_profiles.append(info)
 
         return dict(
diff --git a/Products/CMFPlone/factory.py b/Products/CMFPlone/factory.py
index 9cdf5b7..3e83747 100644
--- a/Products/CMFPlone/factory.py
+++ b/Products/CMFPlone/factory.py
@@ -62,7 +62,6 @@ def getNonInstallableProfiles(self):
                 u'plone.app.versioningbehavior:default',
                 u'plone.formwidget.recurrence:default',
                 u'plone.resource:default',
-                u'plonetheme.barceloneta:default',
                 ]
 
 
diff --git a/Products/CMFPlone/setuphandlers.py b/Products/CMFPlone/setuphandlers.py
index f9c0178..a2233c0 100644
--- a/Products/CMFPlone/setuphandlers.py
+++ b/Products/CMFPlone/setuphandlers.py
@@ -28,6 +28,7 @@ class HiddenProducts(object):
     def getNonInstallableProducts(self):
         return [
             'Archetypes', 'Products.Archetypes',
+            'ATContentTypes', 'Products.ATContentTypes',
             'CMFDefault', 'Products.CMFDefault',
             'CMFPlone', 'Products.CMFPlone', 'Products.CMFPlone.migrations',
             'CMFTopic', 'Products.CMFTopic',
@@ -43,26 +44,32 @@ def getNonInstallableProducts(self):
             'CMFDiffTool', 'Products.CMFDiffTool',
             'CMFEditions', 'Products.CMFEditions',
             'Products.NuPlone',
-            'plone.portlet.static',
-            'plone.portlet.collection',
             'borg.localrole',
-            'plone.keyring',
-            'plone.outputfilters',
-            'plone.protect',
-            'plone.app.jquery'
-            'plone.app.jquerytools',
             'plone.app.blob',
+            'plone.app.caching',
+            'plone.app.collection',
+            'plone.app.dexterity',
             'plone.app.discussion',
+            'plone.app.event',
             'plone.app.folder',
             'plone.app.imaging',
             'plone.app.intid',
+            'plone.app.jquery',
+            'plone.app.jquerytools',
             'plone.app.registry',
             'plone.app.referenceablebehavior',
             'plone.app.relationfield',
-            'plone.resource',
+            'plone.app.theming',
             'plone.app.widgets',
             'plone.app.z3cform',
-            'plone.formwidget.recurrence'
+            'plone.formwidget.recurrence',
+            'plone.keyring',
+            'plone.outputfilters',
+            'plone.portlet.static',
+            'plone.portlet.collection',
+            'plone.protect',
+            'plone.resource',
+            'plonetheme.barceloneta',
             ]
 
 


