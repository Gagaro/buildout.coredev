Repository: plone.app.testing
Branch: refs/heads/master
Date: 2015-03-05T10:41:21+01:00
Author: Patrick Gerken (do3cc) <do3cc@patrick-gerken.de>
Commit: https://github.com/plone/plone.app.testing/commit/39d0c52b55173c6a9de3a2317a8308cee9d56a1a

Adding notification to make browser layers work

Files changed:
M plone/app/testing/layers.py

diff --git a/plone/app/testing/layers.py b/plone/app/testing/layers.py
index 7f7012e..3b6a043 100644
--- a/plone/app/testing/layers.py
+++ b/plone/app/testing/layers.py
@@ -4,6 +4,10 @@
 from plone.testing import Layer
 from plone.testing import zodb, zca, z2
 
+from zope.event import notify
+from zope.traversing.interfaces import BeforeTraverseEvent
+
+
 from plone.app.testing.interfaces import (
     PLONE_SITE_ID,
     PLONE_SITE_TITLE,
@@ -286,6 +290,8 @@ def setUpEnvironment(self, portal):
         # Reset skin data
         portal.clearCurrentSkin()
         portal.setupCurrentSkin(portal.REQUEST)
+        notify(BeforeTraverseEvent(portal, portal.REQUEST))
+
 
         # Pseudo-login as the test user
         from plone.app.testing import helpers


