Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-11-04T12:34:14-02:00
Author: hvelarde (hvelarde) <hector.velarde@gmail.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/1edc9fe3182867c1b2398676c64cc9fb939b03c7

Add getRawQuery method to Collection content type for backward compatibility with Archetypes API

Files changed:
M CHANGES.rst
M docs/README.rst
M plone/app/contenttypes/content.py
M plone/app/contenttypes/tests/test_collection.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2357e38..a4a4094 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Add ``getRawQuery`` method to Collection content type for backward compatibility with Archetypes API.
+  Fixes (partially) https://github.com/plone/plone.app.contenttypes/issues/283.
+  [hvelarde]
 
 
 1.2.5 (2015-10-28)
diff --git a/docs/README.rst b/docs/README.rst
index 4896c87..8aa6d85 100644
--- a/docs/README.rst
+++ b/docs/README.rst
@@ -430,6 +430,8 @@ Differences to Products.ATContentTypes
 - There is no more field ``Location``. If you need georeferenceable consider using ``collective.geo.behaviour``
 - The link on the image of the newsitem triggers an overlay
 - The link-type now allows the of the variables ``${navigation_root_url}`` and ``${portal_url}`` to construct relative urls.
+- The ``getQuery()`` function now returns a list of dict instead of a list of CatalogContentListingObject;
+  use of ``getRawQuery()`` is deprecated.
 - The views for Folders and Collections changed their names and now share a common implementation (since version 1.2a8):
 
   - ``folder_listing_view`` (Folders) and ``collection_view`` (Collections) -> ``listing_view`` (Folders and Collections)
@@ -506,3 +508,4 @@ Contributors
 * Bogdan Girman <bogdan.girman@gmail.com>
 * Martin Opstad Reistadbakk <martin@blaastolen.com>
 * Florent Michon <fmichon@atreal.fr>
+* Héctor Velarde <hector.velarde@gmail.com>
diff --git a/plone/app/contenttypes/content.py b/plone/app/contenttypes/content.py
index faeb33b..5a71fcd 100644
--- a/plone/app/contenttypes/content.py
+++ b/plone/app/contenttypes/content.py
@@ -9,6 +9,7 @@
 from plone.app.contenttypes.interfaces import INewsItem
 from plone.dexterity.content import Container
 from plone.dexterity.content import Item
+from zope.deprecation import deprecation
 from zope.interface import implementer
 
 
@@ -37,8 +38,16 @@ def setQuery(self, query):
         self.query = query
 
     def getQuery(self):
+        """Return the query as a list of dict; note that this method
+        returns a list of CatalogContentListingObject in
+        Products.ATContentTypes.
+        """
         return self.query
 
+    @deprecation.deprecate('getRawQuery() is deprecated; use getQuery().')
+    def getRawQuery(self):
+        return self.getQuery()
+
     def setSort_on(self, sort_on):
         self.sort_on = sort_on
 
diff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py
index 30e0f1d..5319c46 100644
--- a/plone/app/contenttypes/tests/test_collection.py
+++ b/plone/app/contenttypes/tests/test_collection.py
@@ -75,6 +75,10 @@ def test_bbb_getQuery(self):
         self.collection.query = query
         self.assertEqual(self.collection.getQuery(), query)
 
+    def test_bbb_getRawQuery(self):
+        self.collection.query = query
+        self.assertEqual(self.collection.getRawQuery(), query)
+
     def test_bbb_setSort_on(self):
         self.collection.setSort_on('start')
         self.assertEqual(self.collection.sort_on, 'start')
diff --git a/setup.py b/setup.py
index 30319fa..ab07c6e 100644
--- a/setup.py
+++ b/setup.py
@@ -50,7 +50,8 @@ def read(*rnames):
           'plone.app.versioningbehavior',
           'plone.app.lockingbehavior',
           'pytz',
-          'plone.app.z3cform>=1.1.0.dev0'
+          'plone.app.z3cform>=1.1.0.dev0',
+          'zope.deprecation',
       ],
       extras_require={
           'test': [


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-11-04T17:30:01+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/3fe1b2dcf03c8d64f7829c02489a9bdd47aab5a7

Merge pull request #289 from plone/issue_283

Add getRawQuery method to Collection content type for backward compatibility with Archetypes API

Files changed:
M CHANGES.rst
M docs/README.rst
M plone/app/contenttypes/content.py
M plone/app/contenttypes/tests/test_collection.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2357e38..a4a4094 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Add ``getRawQuery`` method to Collection content type for backward compatibility with Archetypes API.
+  Fixes (partially) https://github.com/plone/plone.app.contenttypes/issues/283.
+  [hvelarde]
 
 
 1.2.5 (2015-10-28)
diff --git a/docs/README.rst b/docs/README.rst
index 4896c87..8aa6d85 100644
--- a/docs/README.rst
+++ b/docs/README.rst
@@ -430,6 +430,8 @@ Differences to Products.ATContentTypes
 - There is no more field ``Location``. If you need georeferenceable consider using ``collective.geo.behaviour``
 - The link on the image of the newsitem triggers an overlay
 - The link-type now allows the of the variables ``${navigation_root_url}`` and ``${portal_url}`` to construct relative urls.
+- The ``getQuery()`` function now returns a list of dict instead of a list of CatalogContentListingObject;
+  use of ``getRawQuery()`` is deprecated.
 - The views for Folders and Collections changed their names and now share a common implementation (since version 1.2a8):
 
   - ``folder_listing_view`` (Folders) and ``collection_view`` (Collections) -> ``listing_view`` (Folders and Collections)
@@ -506,3 +508,4 @@ Contributors
 * Bogdan Girman <bogdan.girman@gmail.com>
 * Martin Opstad Reistadbakk <martin@blaastolen.com>
 * Florent Michon <fmichon@atreal.fr>
+* Héctor Velarde <hector.velarde@gmail.com>
diff --git a/plone/app/contenttypes/content.py b/plone/app/contenttypes/content.py
index faeb33b..5a71fcd 100644
--- a/plone/app/contenttypes/content.py
+++ b/plone/app/contenttypes/content.py
@@ -9,6 +9,7 @@
 from plone.app.contenttypes.interfaces import INewsItem
 from plone.dexterity.content import Container
 from plone.dexterity.content import Item
+from zope.deprecation import deprecation
 from zope.interface import implementer
 
 
@@ -37,8 +38,16 @@ def setQuery(self, query):
         self.query = query
 
     def getQuery(self):
+        """Return the query as a list of dict; note that this method
+        returns a list of CatalogContentListingObject in
+        Products.ATContentTypes.
+        """
         return self.query
 
+    @deprecation.deprecate('getRawQuery() is deprecated; use getQuery().')
+    def getRawQuery(self):
+        return self.getQuery()
+
     def setSort_on(self, sort_on):
         self.sort_on = sort_on
 
diff --git a/plone/app/contenttypes/tests/test_collection.py b/plone/app/contenttypes/tests/test_collection.py
index 30e0f1d..5319c46 100644
--- a/plone/app/contenttypes/tests/test_collection.py
+++ b/plone/app/contenttypes/tests/test_collection.py
@@ -75,6 +75,10 @@ def test_bbb_getQuery(self):
         self.collection.query = query
         self.assertEqual(self.collection.getQuery(), query)
 
+    def test_bbb_getRawQuery(self):
+        self.collection.query = query
+        self.assertEqual(self.collection.getRawQuery(), query)
+
     def test_bbb_setSort_on(self):
         self.collection.setSort_on('start')
         self.assertEqual(self.collection.sort_on, 'start')
diff --git a/setup.py b/setup.py
index 30319fa..ab07c6e 100644
--- a/setup.py
+++ b/setup.py
@@ -50,7 +50,8 @@ def read(*rnames):
           'plone.app.versioningbehavior',
           'plone.app.lockingbehavior',
           'pytz',
-          'plone.app.z3cform>=1.1.0.dev0'
+          'plone.app.z3cform>=1.1.0.dev0',
+          'zope.deprecation',
       ],
       extras_require={
           'test': [


