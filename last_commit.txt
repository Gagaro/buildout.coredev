Repository: archetypes.referencebrowserwidget


Branch: refs/heads/master
Date: 2015-09-18T23:01:28Z
Author: T. Kim Nguyen (tkimnguyen) <tknguyen@mac.com>
Commit: https://github.com/plone/archetypes.referencebrowserwidget/commit/95c7ddef121c3736af9ad623dc551b0b1973eb3d

fix for isNotSelf(), which was throwing KeyError

Files changed:
M docs/CHANGES.txt
M src/archetypes/referencebrowserwidget/browser/view.py

diff --git a/docs/CHANGES.txt b/docs/CHANGES.txt
index 8ad76f0..84828cb 100644
--- a/docs/CHANGES.txt
+++ b/docs/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 2.5.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- saner check for isNotSelf(), which was throwing KeyError
+  [alecpm, tkimnguyen]
 
 
 2.5.3 (2015-04-15)
diff --git a/src/archetypes/referencebrowserwidget/browser/view.py b/src/archetypes/referencebrowserwidget/browser/view.py
index ec0931a..e30e816 100644
--- a/src/archetypes/referencebrowserwidget/browser/view.py
+++ b/src/archetypes/referencebrowserwidget/browser/view.py
@@ -390,17 +390,8 @@ def getUid(self, item):
         return getattr(aq_base(item), 'UID', None)
 
     def isNotSelf(self, item):
-        assert self._updated
-
-        def safe_get_object(item):
-            """ Return an object from the catalog, if it exists """
-            try:
-                return item.getObject()
-            except AttributeError:
-                return None
-
-        return self.has_brain and self.getUid(item) != self.brainuid or \
-            safe_get_object(item) != self.at_obj
+        at_uid = self.has_brain and self.brainuid or self.at_obj.UID()
+        return at_uid != self.getUid(item)
 
     def isReferencable(self, item):
         assert self._updated


Repository: archetypes.referencebrowserwidget


Branch: refs/heads/master
Date: 2015-09-21T09:21:35+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/archetypes.referencebrowserwidget/commit/27cd4be3c799e291b1f6c9db76c6678e74999192

Merge pull request #27 from tkimnguyen/master

fix for isNotSelf(), which was throwing KeyError

Files changed:
M docs/CHANGES.txt
M src/archetypes/referencebrowserwidget/browser/view.py

diff --git a/docs/CHANGES.txt b/docs/CHANGES.txt
index 8ad76f0..84828cb 100644
--- a/docs/CHANGES.txt
+++ b/docs/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 2.5.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- saner check for isNotSelf(), which was throwing KeyError
+  [alecpm, tkimnguyen]
 
 
 2.5.3 (2015-04-15)
diff --git a/src/archetypes/referencebrowserwidget/browser/view.py b/src/archetypes/referencebrowserwidget/browser/view.py
index ec0931a..e30e816 100644
--- a/src/archetypes/referencebrowserwidget/browser/view.py
+++ b/src/archetypes/referencebrowserwidget/browser/view.py
@@ -390,17 +390,8 @@ def getUid(self, item):
         return getattr(aq_base(item), 'UID', None)
 
     def isNotSelf(self, item):
-        assert self._updated
-
-        def safe_get_object(item):
-            """ Return an object from the catalog, if it exists """
-            try:
-                return item.getObject()
-            except AttributeError:
-                return None
-
-        return self.has_brain and self.getUid(item) != self.brainuid or \
-            safe_get_object(item) != self.at_obj
+        at_uid = self.has_brain and self.brainuid or self.at_obj.UID()
+        return at_uid != self.getUid(item)
 
     def isReferencable(self, item):
         assert self._updated


