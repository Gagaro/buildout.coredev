Repository: plone.api


Branch: refs/heads/master
Date: 2015-09-19T15:53:10+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.api/commit/8c371f2c888ec1ea22aae888a28de1dacf6e7d55

Pull email_charset from registry.

Files changed:
M docs/CHANGES.rst
M src/plone/api/portal.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index e75ff58..f834da3 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 1.4.7 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Get email_charset value from the configuration registry, falling back
+  to portal property if not found.
+  [esteele]
 
 
 1.4.6 (2015-09-14)
diff --git a/src/plone/api/portal.py b/src/plone/api/portal.py
index 604acfe..5df2f00 100644
--- a/src/plone/api/portal.py
+++ b/src/plone/api/portal.py
@@ -144,7 +144,10 @@ def send_email(sender=None, recipient=None, subject=None, body=None):
         if ctrlOverview.mailhost_warning():
             raise ValueError('MailHost is not configured.')
 
-    encoding = portal.getProperty('email_charset', 'utf-8')
+    try:
+        encoding = get_registry_record('plone.email_charset')
+    except InvalidParameterError:
+        encoding = portal.getProperty('email_charset', 'utf-8')
 
     if not sender:
         try:


