Repository: plone.app.portlets
Branch: refs/heads/master
Date: 2015-01-30T22:48:39+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.portlets/commit/3b80ba15b04799acf69357b57333afbb97c1467e

Fix missing definitions of plone_view. Fixes the recent portlet.

Files changed:
M CHANGES.rst
M plone/app/portlets/browser/templates/manage-contextual.pt
M plone/app/portlets/browser/templates/topbar-manage-portlets.pt
M plone/app/portlets/portlets/recent.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 3a4ad10..186b99b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 3.0.3 (unreleased)
 ------------------
 
+- Fix missing definitions of ``plone_view``. Fixes the recent portlet.
+  [thet]
+
 - Use plone_layout for getIcon.
   [pbauer]
 
diff --git a/plone/app/portlets/browser/templates/manage-contextual.pt b/plone/app/portlets/browser/templates/manage-contextual.pt
index 1db5528..d01927c 100644
--- a/plone/app/portlets/browser/templates/manage-contextual.pt
+++ b/plone/app/portlets/browser/templates/manage-contextual.pt
@@ -13,7 +13,7 @@
 </head>
 
 <body>
-<metal:main fill-slot="main" tal:define="ploneview context/@@plone">
+<metal:main fill-slot="main" tal:define="plone_view context/@@plone">
 
   <h1 class="documentFirstHeading"
       i18n:translate="title_manage_contextual_portlets">
@@ -40,7 +40,7 @@
     </tal:block>
 
       <div class="portalMessage info"
-          tal:condition="ploneview/isDefaultPageInFolder|nothing">
+          tal:condition="plone_view/isDefaultPageInFolder|nothing">
         <strong i18n:translate="">
             Info
         </strong>
diff --git a/plone/app/portlets/browser/templates/topbar-manage-portlets.pt b/plone/app/portlets/browser/templates/topbar-manage-portlets.pt
index f501d48..f8199e4 100644
--- a/plone/app/portlets/browser/templates/topbar-manage-portlets.pt
+++ b/plone/app/portlets/browser/templates/topbar-manage-portlets.pt
@@ -6,9 +6,9 @@
       i18n:domain="plone">
 <body>
 
-  <div metal:fill-slot="main">
+  <div metal:fill-slot="main" tal:define="plone_view context/@@plone">
     <div class="portalMessage info"
-        tal:condition="ploneview/isDefaultPageInFolder|nothing">
+        tal:condition="plone_view/isDefaultPageInFolder|nothing">
       <strong>
           Info
       </strong>
diff --git a/plone/app/portlets/portlets/recent.pt b/plone/app/portlets/portlets/recent.pt
index f5c0a26..a5ab758 100644
--- a/plone/app/portlets/portlets/recent.pt
+++ b/plone/app/portlets/portlets/recent.pt
@@ -15,6 +15,7 @@
         tal:condition="view/recent_items">
       <ul>
         <tal:items tal:define="plone_layout context/@@plone_layout;
+                           plone_view context/@@plone;
                            getIcon nocall:plone_layout/getIcon;
                            normalizeString nocall:plone_view/normalizeString;
                            toLocalizedTime nocall:plone_view/toLocalizedTime;"


