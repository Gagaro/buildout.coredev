Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-24T10:22:54+02:00
Author: Aleix Llus√† Serra () <a.llusa@iskra.cat>
Commit: https://github.com/plone/Products.CMFPlone/commit/d2c40b04d5db05359447317e1e584e6bcf7f6492

Fix #1072 write test for #1068 which fixes #1067: mail controlpanel not keeping password field when saving

Files changed:
M Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_mail.py

diff --git a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_mail.py b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_mail.py
index a36f6f5..2688433 100644
--- a/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_mail.py
+++ b/Products/CMFPlone/controlpanel/tests/test_controlpanel_browser_mail.py
@@ -119,6 +119,25 @@ def test_mail_controlpanel_smtp_pass(self):
         settings = registry.forInterface(IMailSchema, prefix="plone")
         self.assertEqual(settings.smtp_pass, 'secret')
 
+    def test_mail_controlpanel_smtp_pass_keep_on_saving(self):
+        self.browser.open(
+            "%s/@@mail-controlpanel" % self.portal_url)
+        self.browser.getControl(
+            name='form.widgets.smtp_userid').value = 'john@example.com'
+        self.browser.getControl(
+            name='form.widgets.smtp_pass').value = 'secret'
+        self.browser.getControl(
+            name='form.widgets.email_from_name').value = 'John'
+        self.browser.getControl(
+            name='form.widgets.email_from_address').value = \
+                'john@example.com'
+        self.browser.getControl(name='form.buttons.save').click()
+        self.browser.getControl(name='form.buttons.save').click()
+
+        registry = getUtility(IRegistry)
+        settings = registry.forInterface(IMailSchema, prefix="plone")
+        self.assertEqual(settings.smtp_pass, 'secret')
+
     def test_mail_controlpanel_email_from_name(self):
         self.browser.open(
             "%s/@@mail-controlpanel" % self.portal_url)


