Repository: plone.app.upgrade
Branch: refs/heads/master
Date: 2015-05-31T08:29:36-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/571087d99de1efde368b36b7db4cd2687dd7fcc3

do not check for plone 5 specifically. use package installed checks instead so we do not have to deal with plone 6 issues when that comes around

Files changed:
M plone/app/upgrade/utils.py
M plone/app/upgrade/v40/alphas.py
M plone/app/upgrade/v42/betas.py
M plone/app/upgrade/v42/configure.zcml
M plone/app/upgrade/v43/alphas.py

diff --git a/plone/app/upgrade/utils.py b/plone/app/upgrade/utils.py
index a98b30b..66e72ff 100644
--- a/plone/app/upgrade/utils.py
+++ b/plone/app/upgrade/utils.py
@@ -277,11 +277,3 @@ def updateIconsInBrains(context, typesToUpdate=None):
         i += 1
     pghandler.finish()
     logger.info('Updated `getIcon` metadata.')
-
-
-def isPlone5():
-    try:
-        from Products.CMFPlone import __version__
-        return __version__[0] == '5'
-    except:
-        return False
\ No newline at end of file
diff --git a/plone/app/upgrade/v40/alphas.py b/plone/app/upgrade/v40/alphas.py
index da66bbf..a5abb63 100644
--- a/plone/app/upgrade/v40/alphas.py
+++ b/plone/app/upgrade/v40/alphas.py
@@ -22,7 +22,6 @@
 from plone.app.upgrade.utils import logger
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.app.upgrade.utils import unregisterSteps
-from plone.app.upgrade.utils import isPlone5
 from plone.portlet.static.static import IStaticPortlet
 from plone.portlets.interfaces import IPortletAssignmentMapping
 from plone.portlets.interfaces import IPortletAssignmentSettings
@@ -67,8 +66,11 @@ def rememberTheme(context):
 def threeX_alpha1(context):
     """3.x -> 4.0alpha1
     """
-    if not isPlone5():
+    try:
+        import plone.app.jquerytools
         loadMigrationProfile(context, 'profile-plone.app.jquerytools:default')
+    except ImportError:
+        pass
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v40:3-4alpha1')
     loadMigrationProfile(
         context, 'profile-Products.CMFPlone:dependencies',
diff --git a/plone/app/upgrade/v42/betas.py b/plone/app/upgrade/v42/betas.py
index 6008d56..de21118 100644
--- a/plone/app/upgrade/v42/betas.py
+++ b/plone/app/upgrade/v42/betas.py
@@ -4,7 +4,6 @@
 
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.app.upgrade.utils import installOrReinstallProduct
-from plone.app.upgrade.utils import isPlone5
 from Products.CMFCore.utils import getToolByName
 
 logger = logging.getLogger('plone.app.upgrade')
@@ -51,8 +50,11 @@ def to42beta2(context):
 def to42rc1(context):
     """4.2b2 -> 4.2rc1
     """
-    if not isPlone5():
-        loadMigrationProfile(context, 'profile-plone.app.jquery:default')   
+    try:
+        import plone.app.jquerytools
+        loadMigrationProfile(context, 'profile-plone.app.jquery:default')
+    except ImportError:
+        pass
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v42:to42rc1')
 
 
diff --git a/plone/app/upgrade/v42/configure.zcml b/plone/app/upgrade/v42/configure.zcml
index f24fba9..6c5f94e 100644
--- a/plone/app/upgrade/v42/configure.zcml
+++ b/plone/app/upgrade/v42/configure.zcml
@@ -4,7 +4,7 @@
     xmlns:zcml="http://namespaces.zope.org/zcml"
     i18n_domain="plone">
 
-    <include package="plone.app.jquery" zcml:condition="not-have plone-5" />
+    <include package="plone.app.jquery" zcml:condition="installed plone.app.jquery" />
     <include file="profiles.zcml" />
 
     <genericsetup:upgradeSteps
diff --git a/plone/app/upgrade/v43/alphas.py b/plone/app/upgrade/v43/alphas.py
index 5f61f6b..e4db876 100644
--- a/plone/app/upgrade/v43/alphas.py
+++ b/plone/app/upgrade/v43/alphas.py
@@ -4,7 +4,6 @@
 from Products.CMFCore.utils import getToolByName
 from Products.ZCatalog.ProgressHandler import ZLogHandler
 from plone.app.upgrade.utils import loadMigrationProfile
-from plone.app.upgrade.utils import isPlone5
 from plone.app.upgrade.v40.alphas import cleanUpToolRegistry
 from Products.ZCTextIndex.interfaces import IZCTextIndex
 
@@ -105,9 +104,11 @@ def upgradePloneAppTheming(context):
 def upgradePloneAppJQuery(context):
     """ Upgrade TinyMCE WYSIWYG Editor to jQuery based version 1.3
     """
-    if not isPlone5():
+    try:
         from plone.app.jquery.upgrades import upgrade_2_to_3
         upgrade_2_to_3(context)
+    except ImportError:
+        pass
 
 def to43alpha1(context):
     """4.2 -> 4.3alpha1"""


