Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-05-14T16:53:20-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/bd1f9ba99d1ad40bb7fe1c00eaa32b8884aae5e2

also patch less.js

Files changed:
M Products/CMFPlone/static/components/less/dist/less.js
M Products/CMFPlone/static/components/r.js/dist/r.js

diff --git a/Products/CMFPlone/static/components/less/dist/less.js b/Products/CMFPlone/static/components/less/dist/less.js
index fbbba14..5f01977 100644
--- a/Products/CMFPlone/static/components/less/dist/less.js
+++ b/Products/CMFPlone/static/components/less/dist/less.js
@@ -462,7 +462,15 @@ FileManager.prototype.loadFile = function loadFile(filename, currentDirectory, o
         return;
     }
 
-    this.doXHR(href, options.mime, function doXHRCallback(data, lastModified) {
+    /* XXX Plone hack to always re-download resource TTW */
+    var url = href;
+    if(url.indexOf('?') === -1){
+        url += '?';
+    }else{
+        url += '&';
+    }
+    url = url + "bust=" +  (new Date()).getTime();
+    this.doXHR(url, options.mime, function doXHRCallback(data, lastModified) {
         // per file cache
         fileCache[href] = data;
 
@@ -564,7 +572,6 @@ function loadStyles(modifyVars) {
 }
 
 function loadStyleSheet(sheet, callback, reload, remaining, modifyVars) {
-
     var instanceOptions = clone(options);
     addDataAttr(instanceOptions, sheet);
     instanceOptions.mime = sheet.type;
diff --git a/Products/CMFPlone/static/components/r.js/dist/r.js b/Products/CMFPlone/static/components/r.js/dist/r.js
index 31c27a3..3e7234b 100644
--- a/Products/CMFPlone/static/components/r.js/dist/r.js
+++ b/Products/CMFPlone/static/components/r.js/dist/r.js
@@ -25821,6 +25821,7 @@ define('build', function (require) {
             d.resolve(require._cachedRawText[path]);
             return d.promise;
         } else {
+            /* XXX Plone hack to always re-download resource TTW */
             var url = path;
             if(url.indexOf('?') === -1){
                 url += '?';


