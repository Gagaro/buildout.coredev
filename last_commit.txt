Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2014-12-30T11:11:36+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/b2e005b59c95d8655c28ebc0594a6ac609ad2036

do not redefine views that are already defined in main_template

Files changed:
M plone/app/contenttypes/browser/templates/folder_listing.pt
M plone/app/contenttypes/browser/templates/link.pt
M plone/app/contenttypes/browser/templates/standard_view.pt
M plone/app/contenttypes/migration/atct_migrator.pt
M plone/app/contenttypes/migration/atct_migrator_results.pt

diff --git a/plone/app/contenttypes/browser/templates/folder_listing.pt b/plone/app/contenttypes/browser/templates/folder_listing.pt
index 39d3d28..96a368d 100644
--- a/plone/app/contenttypes/browser/templates/folder_listing.pt
+++ b/plone/app/contenttypes/browser/templates/folder_listing.pt
@@ -29,7 +29,7 @@
                         limit_display python:limit_display and int(limit_display) or None;
                         more_url more_url|request/more_url|string:folder_contents;
                         is_a_topic python:context.portal_type=='Topic';
-                        friendly_types context/@@plone_portal_state/friendly_types;
+                        friendly_types portal_state/friendly_types;
                         dummy python:not is_a_topic and contentFilter.setdefault('portal_type', friendly_types);
                         folderContents folderContents|nothing; folderContents python:folderContents or is_a_topic and context.queryCatalog(batch=True, **contentFilter) or context.getFolderContents(contentFilter, batch=True, b_size=limit_display or 100);
                         site_properties context/portal_properties/site_properties;
@@ -37,13 +37,12 @@
                         Batch python:modules['Products.CMFPlone'].Batch;
                         b_start python:request.get('b_start', 0);
                         batch python:isinstance(folderContents, Batch) and folderContents or Batch(folderContents, limit_display or 100, int(b_start), orphan=1);
-                        isAnon context/@@plone_portal_state/anonymous;
+                        isAnon portal_state/anonymous;
                         normalizeString nocall: context/plone_utils/normalizeString;
-                        toLocalizedTime nocall: context/@@plone/toLocalizedTime;
+                        toLocalizedTime nocall: plone_view/toLocalizedTime;
                         show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
-                        navigation_root_url context/@@plone_portal_state/navigation_root_url;
-                        pas_member context/@@pas_member;
-                        plone_view context/@@plone;">
+                        navigation_root_url portal_state/navigation_root_url;
+                        pas_member context/@@pas_member;">
     <tal:listing condition="batch">
 
         <ul metal:define-slot="entries">
@@ -56,7 +55,7 @@
                                    item_type_title item/Type;
                                    item_modified item/ModificationDate;
                                    item_created item/CreationDate;
-                                   item_icon python:plone_view.getIcon(item);
+                                   item_icon python:plone_layout.getIcon(item);
                                    item_type_class python:'contenttype-' + normalizeString(item_type);
                                    item_wf_state item/review_state|python: context.portal_workflow.getInfoFor(item, 'review_state', '');
                                    item_wf_state_class python:'state-' + normalizeString(item_wf_state);
diff --git a/plone/app/contenttypes/browser/templates/link.pt b/plone/app/contenttypes/browser/templates/link.pt
index b3fa2e1..4aa7290 100644
--- a/plone/app/contenttypes/browser/templates/link.pt
+++ b/plone/app/contenttypes/browser/templates/link.pt
@@ -23,8 +23,8 @@
 
     <metal:content-core fill-slot="content-core">
         <metal:block define-macro="content-core">
-        <p tal:define="portal_url context/@@plone_portal_state/portal_url;
-                       navigation_root_url context/@@plone_portal_state/navigation_root_url;
+        <p tal:define="portal_url portal_state/portal_url;
+                       navigation_root_url portal_state/navigation_root_url;
                        url view/absolute_target_url">
             <span i18n:translate="link_address">The link address is:</span>
             <a href="#" tal:attributes="href url"
diff --git a/plone/app/contenttypes/browser/templates/standard_view.pt b/plone/app/contenttypes/browser/templates/standard_view.pt
index 5865930..0664273 100644
--- a/plone/app/contenttypes/browser/templates/standard_view.pt
+++ b/plone/app/contenttypes/browser/templates/standard_view.pt
@@ -26,11 +26,11 @@
                              batch python:view.results(b_start=b_start);
                              site_properties context/portal_properties/site_properties;
                              use_view_action site_properties/typesUseViewActionInListings|python:();
-                             isAnon context/@@plone_portal_state/anonymous;
+                             isAnon portal_state/anonymous;
                              normalizeString nocall: context/plone_utils/normalizeString;
-                             toLocalizedTime nocall: context/@@plone/toLocalizedTime;
+                             toLocalizedTime nocall: plone_view/toLocalizedTime;
                              show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
-                             navigation_root_url context/@@plone_portal_state/navigation_root_url;
+                             navigation_root_url portal_state/navigation_root_url;
                              pas_member context/@@pas_member;">
         <tal:listing condition="batch">
 
diff --git a/plone/app/contenttypes/migration/atct_migrator.pt b/plone/app/contenttypes/migration/atct_migrator.pt
index 02528bf..dbcf427 100644
--- a/plone/app/contenttypes/migration/atct_migrator.pt
+++ b/plone/app/contenttypes/migration/atct_migrator.pt
@@ -10,7 +10,6 @@
     tal:define="dummy python:request.set('disable_border', 1);
                 disable_column_two python:request.set('disable_plone.rightcolumn', 1);
                 disable_column_two python:request.set('disable_plone.leftcolumn', 1);
-                portal_state context/@@plone_portal_state;
                 portal_url portal_state/portal_url">
   <link rel="stylesheet" type="text/css" href="" media="screen" tal:attributes="href string:${portal_url}/++resource++pac_migrator.css">
 </metal:block>
diff --git a/plone/app/contenttypes/migration/atct_migrator_results.pt b/plone/app/contenttypes/migration/atct_migrator_results.pt
index 74a7422..470dc3e 100644
--- a/plone/app/contenttypes/migration/atct_migrator_results.pt
+++ b/plone/app/contenttypes/migration/atct_migrator_results.pt
@@ -10,7 +10,6 @@
     tal:define="dummy python:request.set('disable_border', 1);
                 disable_column_two python:request.set('disable_plone.rightcolumn', 1);
                 disable_column_two python:request.set('disable_plone.leftcolumn', 1);
-                portal_state context/@@plone_portal_state;
                 portal_url portal_state/portal_url">
   <link rel="stylesheet" type="text/css" href="" media="screen" tal:attributes="href string:${portal_url}/++resource++pac_migrator.css">
 </metal:block>


