Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2015-09-11T12:37:52+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/04b20c96cb06d336bdd9ef130cd5de3a60b59d8e

Fix migration of types_not_searched to registry

Files changed:
M CHANGES.rst
M plone/app/upgrade/v50/alphas.py

diff --git a/CHANGES.rst b/CHANGES.rst
index bbd7a69..ca4a222 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 1.3.15 (unreleased)
 -------------------
 
+- Fix migration of types_not_searched to registry.
+  Fixes https://github.com/plone/plone.app.contenttypes/issues/268
+  [pbauer]
+
 - Remove site properties that have been migrated to the registry.
   [esteele]
 
diff --git a/plone/app/upgrade/v50/alphas.py b/plone/app/upgrade/v50/alphas.py
index ecb55f9..4e76980 100644
--- a/plone/app/upgrade/v50/alphas.py
+++ b/plone/app/upgrade/v50/alphas.py
@@ -282,7 +282,7 @@ def upgrade_search_controlpanel_settings(context):
         settings.enable_livesearch = site_properties.enable_livesearch
     settings.types_not_searched = tuple([
         t for t in types_tool.listContentTypes()
-        if t not in site_properties.types_not_searched and
+        if t in site_properties.types_not_searched and
         t not in BAD_TYPES
     ])
 
@@ -314,4 +314,3 @@ def upgrade_site_controlpanel_settings(context):
     settings.enable_sitemap = site_properties.enable_sitemap
     if site_properties.hasProperty('exposeDCMetaTags'):
         settings.exposeDCMetaTags = site_properties.exposeDCMetaTags
-    
\ No newline at end of file


