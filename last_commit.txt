Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-10T11:23:09-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/43a10d96cfdf93496ef86125853ab1a24b26a3d2

Do not bother additional CRSF protection for addMember since all public
  users get same CSRF token and the method should be unpublished.
  See https://pypi.python.org/pypi/Products.PloneHotfix20150910

Files changed:
M CHANGES.rst
M Products/CMFPlone/patches/csrf.py
M Products/CMFPlone/tests/testCSRFProtection.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 30d3391..b6de9e2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,11 @@ Changelog
 5.0rc2 (unreleased)
 -------------------
 
+- Do not bother additional CRSF protection for addMember since all public
+  users get same CSRF token and the method should be unpublished.
+  See https://pypi.python.org/pypi/Products.PloneHotfix20150910
+  [vangheem]
+
 - Remove site properties that have been migrated to the registry.
   [esteele]
 
diff --git a/Products/CMFPlone/patches/csrf.py b/Products/CMFPlone/patches/csrf.py
index ee0cafb..14c052e 100644
--- a/Products/CMFPlone/patches/csrf.py
+++ b/Products/CMFPlone/patches/csrf.py
@@ -15,9 +15,6 @@ def applyPatches():
     PT.transitionObjectsByPaths = patch(PT.transitionObjectsByPaths)
     PT.renameObjectsByPaths = patch(PT.renameObjectsByPaths)
 
-    from Products.CMFCore.RegistrationTool import RegistrationTool
-    RegistrationTool.addMember = patch(RegistrationTool.addMember)
-
     from Products.CMFCore.MembershipTool import MembershipTool as MT
     from Products.PlonePAS.tools.membership import MembershipTool as PMT
     MT.setPassword = patch(MT.setPassword)
diff --git a/Products/CMFPlone/tests/testCSRFProtection.py b/Products/CMFPlone/tests/testCSRFProtection.py
index 2350e8e..f76f8f1 100644
--- a/Products/CMFPlone/tests/testCSRFProtection.py
+++ b/Products/CMFPlone/tests/testCSRFProtection.py
@@ -57,11 +57,6 @@ def test_PloneTool_renameObjectsByPaths(self):
             'paths:list=events&new_ids:list=foo&new_titles:list=Foo')
         self.assertTrue(self.portal.get('foo', None))
 
-    def test_RegistrationTool_addMember(self):
-        self.checkAuthenticator(
-            '/portal_registration/addMember',
-            'id=john&password=y0d4Wg')
-
     def test_RegistrationTool_editMember(self):
         self.checkAuthenticator(
             '/portal_registration/editMember',


