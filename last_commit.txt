Repository: mockup
Branch: refs/heads/master
Date: 2015-05-14T10:57:22-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/797f04613adfd7fd67ac43d3e7253be4035fdf08

fix selecting a folder to upload to for upload pattern

Files changed:
M CHANGES.rst
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/tinymce/js/links.js
M mockup/patterns/upload/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index bcb851f..0834f6f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 2.0.4 (Unreleased)
 ------------------
 
-- No changes yet.
+- fix selecting a folder to upload to for upload pattern
+  [vangheem]
+
 
 2.0.3 (2015-05-13)
 ------------------
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index e6f6984..22dc019 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -299,7 +299,7 @@ define([
       self.emit('selecting');
       var data = self.$el.select2('data');
       data.push(item);
-      self.$el.select2('data', data);
+      self.$el.select2('data', data, true);
       item.selected = true;
       self.emit('selected');
     },
@@ -312,7 +312,7 @@ define([
           data.splice(i, 1);
         }
       });
-      self.$el.select2('data', data);
+      self.$el.select2('data', data, true);
       item.selected = false;
       self.emit('deselected');
     },
diff --git a/mockup/patterns/tinymce/js/links.js b/mockup/patterns/tinymce/js/links.js
index fbd6ff5..95a1e41 100644
--- a/mockup/patterns/tinymce/js/links.js
+++ b/mockup/patterns/tinymce/js/links.js
@@ -531,6 +531,7 @@ define([
       if(self.options.upload){
         self.$upload = $('.uploadify-me', self.modal.$modal);
         self.options.upload.relatedItems = self.options.relatedItems;
+        self.options.upload.relatedItems.selectableTypes = self.options.folderTypes;
         self.$upload.addClass('pat-upload').patternUpload(self.options.upload);
         self.$upload.on('uploadAllCompleted', function(evt, data) {
           // Add upload data and path_uid to the upload node's data attributes.
diff --git a/mockup/patterns/upload/pattern.js b/mockup/patterns/upload/pattern.js
index 8140a7a..c896ed4 100644
--- a/mockup/patterns/upload/pattern.js
+++ b/mockup/patterns/upload/pattern.js
@@ -86,7 +86,8 @@ define([
         basePath: '/',
         vocabularyUrl: null,
         width: 500,
-        maximumSelectionSize: 1
+        maximumSelectionSize: 1,
+        selectableTypes: ['Folder']
       }
     },
 


