Repository: mockup


Branch: refs/heads/master
Date: 2015-07-28T18:29:34-05:00
Author: Sam Schwartz (obct537) <schwas45@uwosh.edu>
Commit: https://github.com/plone/mockup/commit/84ab78e708f99aff9a5e4a32a93e71ffeeb9a68f

Fixed issue breaking LESS builds

Files changed:
M mockup/patterns/thememapper/js/lessbuilderview.js
M mockup/patterns/thememapper/pattern.js

diff --git a/mockup/patterns/thememapper/js/lessbuilderview.js b/mockup/patterns/thememapper/js/lessbuilderview.js
index 80668ab..d544301 100644
--- a/mockup/patterns/thememapper/js/lessbuilderview.js
+++ b/mockup/patterns/thememapper/js/lessbuilderview.js
@@ -122,15 +122,9 @@ define([
             function() {
               var $ = window.parent.$;
               var iframe = window.iframe['lessc'];
-              var styles = $('style', iframe.document);
-              var styleBox = $('#styleBox');
+              var styles = $('style', iframe.document)[0].innerHTML;
 
-              $(styleBox).empty();
-              $(styles).each(function() {
-                styleBox.append(this.innerHTML);
-              });
-
-              iframe.options.callback();
+              iframe.options.callback(styles);
             }
           );
         }
diff --git a/mockup/patterns/thememapper/pattern.js b/mockup/patterns/thememapper/pattern.js
index 0ed236a..74216e5 100644
--- a/mockup/patterns/thememapper/pattern.js
+++ b/mockup/patterns/thememapper/pattern.js
@@ -383,11 +383,10 @@ define([
         return false;
       }
     },
-    saveThemeCSS: function() {
+    saveThemeCSS: function(styles) {
       var self = this.env;
-      var css = self.$styleBox.html();
 
-      if( css === "" ) {
+      if( styles === "" ) {
         //There was probably a problem during compilation
         return false;
       }
@@ -396,7 +395,7 @@ define([
         type: 'POST',
         data: {
           path: self.lessPaths['save'],
-          data: css,
+          data: styles,
           _authenticator: utils.getAuthenticator()
         },
         success: function(data) {


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-28T19:02:15-05:00
Author: Sam Schwartz (obct537) <schwas45@uwosh.edu>
Commit: https://github.com/plone/mockup/commit/e3d1651c5ab018fe89b63a8c9e7d6402ca73207a

less-builder now handles multiple files

Files changed:
M mockup/patterns/thememapper/js/lessbuilderview.js
M mockup/patterns/thememapper/pattern.js

diff --git a/mockup/patterns/thememapper/js/lessbuilderview.js b/mockup/patterns/thememapper/js/lessbuilderview.js
index d544301..e4ad459 100644
--- a/mockup/patterns/thememapper/js/lessbuilderview.js
+++ b/mockup/patterns/thememapper/js/lessbuilderview.js
@@ -122,9 +122,15 @@ define([
             function() {
               var $ = window.parent.$;
               var iframe = window.iframe['lessc'];
-              var styles = $('style', iframe.document)[0].innerHTML;
+              var styles = $('style', iframe.document);
 
-              iframe.options.callback(styles);
+              var css = "";
+
+              $(styles).each(function() {
+                 css += this.innerHTML;
+              });
+
+              iframe.options.callback(css);
             }
           );
         }
diff --git a/mockup/patterns/thememapper/pattern.js b/mockup/patterns/thememapper/pattern.js
index 74216e5..b653f25 100644
--- a/mockup/patterns/thememapper/pattern.js
+++ b/mockup/patterns/thememapper/pattern.js
@@ -386,7 +386,7 @@ define([
     saveThemeCSS: function(styles) {
       var self = this.env;
 
-      if( styles === "" ) {
+      if( styles === "" || styles === undefined ) {
         //There was probably a problem during compilation
         return false;
       }


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-29T11:08:39-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/mockup/commit/dc9e753345ec9174307418183d5c6d7fdd5a7668

Filemanager tree now differentiates between images, themefiles, etc.

Files changed:
M mockup/patterns/filemanager/pattern.js
M mockup/patterns/thememapper/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index c49d56d..7bc397c 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -87,15 +87,25 @@ define([
         self.$el.html('Must specify actionUrl setting for pattern');
         return;
       }
+
       self.options.treeConfig = $.extend(true, {}, self.treeConfig, {
         dataUrl: self.options.actionUrl + '?action=dataTree',
         onCreateLi: function(node, li) {
+          var imageTypes = ['png', 'jpg', 'jpeg', 'gif', 'ico'];
+          var themeTypes = ['css', 'html', 'htm', 'txt', 'xml', 'js', 'cfg', 'less'];
+
           $('span', li).addClass('glyphicon');
           if( node.folder ) {
             $('span', li).addClass('glyphicon-folder-close')
           }
+          else if( $.inArray(node.fileType, imageTypes) >= 0) {
+            $('span', li).addClass('glyphicon-picture');
+          }
+          else if( $.inArray(node.fileType, themeTypes) >= 0) {
+            $('span', li).addClass('glyphicon-file');
+          }
           else {
-            $('span', li).addClass('glyphicon-file')
+            $('span', li).addClass('glyphicon-cog')
           }
         }
       });
@@ -243,10 +253,6 @@ define([
       if( callback === undefined ) {
         callback = function() {};
       }
-      var nodes = self.$tree.find('span');
-      $(nodes).each(function() {
-        $(this).addClass('glyphicon glyphicon-file');
-      });
       self.$tree.tree('loadDataFromUrl',
         self.options.actionUrl + '?action=dataTree',
         null,
diff --git a/mockup/patterns/thememapper/pattern.js b/mockup/patterns/thememapper/pattern.js
index b653f25..e77238a 100644
--- a/mockup/patterns/thememapper/pattern.js
+++ b/mockup/patterns/thememapper/pattern.js
@@ -342,6 +342,7 @@ define([
           $(items).each(function() {
             this.disable();
           });
+          self.lessbuilderView.triggerView.disable();
         }
       };
 


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-29T11:20:22-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/5d7e743edd901be94f6be13c68537c28a7ddfbe7

Merge pull request #542 from plone/lessfix

Fixes problems with the thememapper's LESS builder

Files changed:
M mockup/patterns/filemanager/pattern.js
M mockup/patterns/thememapper/js/lessbuilderview.js
M mockup/patterns/thememapper/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index c49d56d..7bc397c 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -87,15 +87,25 @@ define([
         self.$el.html('Must specify actionUrl setting for pattern');
         return;
       }
+
       self.options.treeConfig = $.extend(true, {}, self.treeConfig, {
         dataUrl: self.options.actionUrl + '?action=dataTree',
         onCreateLi: function(node, li) {
+          var imageTypes = ['png', 'jpg', 'jpeg', 'gif', 'ico'];
+          var themeTypes = ['css', 'html', 'htm', 'txt', 'xml', 'js', 'cfg', 'less'];
+
           $('span', li).addClass('glyphicon');
           if( node.folder ) {
             $('span', li).addClass('glyphicon-folder-close')
           }
+          else if( $.inArray(node.fileType, imageTypes) >= 0) {
+            $('span', li).addClass('glyphicon-picture');
+          }
+          else if( $.inArray(node.fileType, themeTypes) >= 0) {
+            $('span', li).addClass('glyphicon-file');
+          }
           else {
-            $('span', li).addClass('glyphicon-file')
+            $('span', li).addClass('glyphicon-cog')
           }
         }
       });
@@ -243,10 +253,6 @@ define([
       if( callback === undefined ) {
         callback = function() {};
       }
-      var nodes = self.$tree.find('span');
-      $(nodes).each(function() {
-        $(this).addClass('glyphicon glyphicon-file');
-      });
       self.$tree.tree('loadDataFromUrl',
         self.options.actionUrl + '?action=dataTree',
         null,
diff --git a/mockup/patterns/thememapper/js/lessbuilderview.js b/mockup/patterns/thememapper/js/lessbuilderview.js
index 80668ab..e4ad459 100644
--- a/mockup/patterns/thememapper/js/lessbuilderview.js
+++ b/mockup/patterns/thememapper/js/lessbuilderview.js
@@ -123,14 +123,14 @@ define([
               var $ = window.parent.$;
               var iframe = window.iframe['lessc'];
               var styles = $('style', iframe.document);
-              var styleBox = $('#styleBox');
 
-              $(styleBox).empty();
+              var css = "";
+
               $(styles).each(function() {
-                styleBox.append(this.innerHTML);
+                 css += this.innerHTML;
               });
 
-              iframe.options.callback();
+              iframe.options.callback(css);
             }
           );
         }
diff --git a/mockup/patterns/thememapper/pattern.js b/mockup/patterns/thememapper/pattern.js
index 0ed236a..e77238a 100644
--- a/mockup/patterns/thememapper/pattern.js
+++ b/mockup/patterns/thememapper/pattern.js
@@ -342,6 +342,7 @@ define([
           $(items).each(function() {
             this.disable();
           });
+          self.lessbuilderView.triggerView.disable();
         }
       };
 
@@ -383,11 +384,10 @@ define([
         return false;
       }
     },
-    saveThemeCSS: function() {
+    saveThemeCSS: function(styles) {
       var self = this.env;
-      var css = self.$styleBox.html();
 
-      if( css === "" ) {
+      if( styles === "" || styles === undefined ) {
         //There was probably a problem during compilation
         return false;
       }
@@ -396,7 +396,7 @@ define([
         type: 'POST',
         data: {
           path: self.lessPaths['save'],
-          data: css,
+          data: styles,
           _authenticator: utils.getAuthenticator()
         },
         success: function(data) {


