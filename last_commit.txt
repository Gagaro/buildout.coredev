Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-24T22:45:05-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/c41f35c09bebc214cbc48c7ce1d87042d78feb72

Be able to provide table styles in tinymce configuration

Files changed:
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py
M Products/CMFPlone/patterns/__init__.py
M Products/CMFPlone/profiles/default/metadata.xml
M Products/CMFPlone/tests/testPatternSettings.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5f61108..56fe9bd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0rc4 (unreleased)
 -------------------
 
+- Be able to provide table styles in tinymce configuration
+  [vangheem]
+
 - Fix #1071: AttributeError when saving theme settings
   [vangheem]
 
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index d2fd954..ed0d259 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -487,6 +487,14 @@ class ITinyMCELayoutSchema(Interface):
             u"Right|alignright|alignright",
             u"Justify|alignjustify|alignjustify"])
 
+    table_styles = schema.List(
+        title=_(u"Table styles"),
+        description=_('Name|class'),
+        value_type=schema.TextLine(),
+        default=[
+            u"Listing|listing"
+        ])
+
     formats = schema.Text(
         title=_(u"Formats"),
         description=_(
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index da714ad..3305358 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -45,14 +45,18 @@ def get_content_css(self):
 
         return ','.join(files)
 
-    def get_style_format(self, txt):
+    def get_style_format(self, txt, _type='format', base=None):
         parts = txt.strip().split('|')
         if len(parts) < 2:
             return
-        val = {
+        if base is None:
+            val = {}
+        else:
+            val = base
+        val.update({
             'title': parts[0],
-            'format': parts[1]
-        }
+            _type: parts[1]
+        })
         if len(parts) > 2:
             val['icon'] = parts[2]
         return val
@@ -62,6 +66,7 @@ def get_all_style_formats(self):
         block_styles = self.settings.block_styles or []
         inline_styles = self.settings.inline_styles or []
         alignment_styles = self.settings.alignment_styles or []
+        table_styles = self.settings.table_styles or []
         return [{
             'title': 'Headers',
             'items': [self.get_style_format(t) for t in header_styles]
@@ -74,6 +79,10 @@ def get_all_style_formats(self):
         }, {
             'title': 'Alignment',
             'items': [self.get_style_format(t) for t in alignment_styles]
+        }, {
+            'title': 'Tables',
+            'items': [self.get_style_format(t, 'classes', {'selector': 'table'})
+                      for t in table_styles]
         }]
 
     def get_tiny_config(self):
@@ -238,7 +247,7 @@ def tinymce(self):
             'base_url': self.context.absolute_url(),
             'tiny': generator.get_tiny_config(),
             # This is for loading the languages on tinymce
-            'loadingBaseUrl': '%s/++plone++static/components/tinymce-builded/js/tinymce' % generator.portal_url,
+            'loadingBaseUrl': '%s/++plone++static/components/tinymce-builded/js/tinymce' % generator.portal_url,  # noqa
             'prependToUrl': 'resolveuid/',
             'linkAttribute': 'UID',
             'prependToScalePart': '/@@images/image/',
diff --git a/Products/CMFPlone/profiles/default/metadata.xml b/Products/CMFPlone/profiles/default/metadata.xml
index 82b8c25..5379a35 100644
--- a/Products/CMFPlone/profiles/default/metadata.xml
+++ b/Products/CMFPlone/profiles/default/metadata.xml
@@ -1,4 +1,4 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>5010</version>
+  <version>5011</version>
 </metadata>
diff --git a/Products/CMFPlone/tests/testPatternSettings.py b/Products/CMFPlone/tests/testPatternSettings.py
index 4ceab4b..ed9b3ee 100644
--- a/Products/CMFPlone/tests/testPatternSettings.py
+++ b/Products/CMFPlone/tests/testPatternSettings.py
@@ -25,4 +25,4 @@ def test_atd_included(self):
 
     def test_style_formats(self):
         conf = self.get_conf()
-        self.assertEqual(len(conf['tiny']['style_formats']), 4)
\ No newline at end of file
+        self.assertEqual(len(conf['tiny']['style_formats']), 5)
\ No newline at end of file


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-24T22:45:35-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/c2eb6c4510be6f266a47c54ee418fd8fa3ff766b

Merge pull request #1082 from plone/tinymce-table-styles

Be able to provide table styles in tinymce configuration

Files changed:
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py
M Products/CMFPlone/patterns/__init__.py
M Products/CMFPlone/profiles/default/metadata.xml
M Products/CMFPlone/tests/testPatternSettings.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 5f61108..56fe9bd 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0rc4 (unreleased)
 -------------------
 
+- Be able to provide table styles in tinymce configuration
+  [vangheem]
+
 - Fix #1071: AttributeError when saving theme settings
   [vangheem]
 
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index d2fd954..ed0d259 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -487,6 +487,14 @@ class ITinyMCELayoutSchema(Interface):
             u"Right|alignright|alignright",
             u"Justify|alignjustify|alignjustify"])
 
+    table_styles = schema.List(
+        title=_(u"Table styles"),
+        description=_('Name|class'),
+        value_type=schema.TextLine(),
+        default=[
+            u"Listing|listing"
+        ])
+
     formats = schema.Text(
         title=_(u"Formats"),
         description=_(
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index da714ad..3305358 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -45,14 +45,18 @@ def get_content_css(self):
 
         return ','.join(files)
 
-    def get_style_format(self, txt):
+    def get_style_format(self, txt, _type='format', base=None):
         parts = txt.strip().split('|')
         if len(parts) < 2:
             return
-        val = {
+        if base is None:
+            val = {}
+        else:
+            val = base
+        val.update({
             'title': parts[0],
-            'format': parts[1]
-        }
+            _type: parts[1]
+        })
         if len(parts) > 2:
             val['icon'] = parts[2]
         return val
@@ -62,6 +66,7 @@ def get_all_style_formats(self):
         block_styles = self.settings.block_styles or []
         inline_styles = self.settings.inline_styles or []
         alignment_styles = self.settings.alignment_styles or []
+        table_styles = self.settings.table_styles or []
         return [{
             'title': 'Headers',
             'items': [self.get_style_format(t) for t in header_styles]
@@ -74,6 +79,10 @@ def get_all_style_formats(self):
         }, {
             'title': 'Alignment',
             'items': [self.get_style_format(t) for t in alignment_styles]
+        }, {
+            'title': 'Tables',
+            'items': [self.get_style_format(t, 'classes', {'selector': 'table'})
+                      for t in table_styles]
         }]
 
     def get_tiny_config(self):
@@ -238,7 +247,7 @@ def tinymce(self):
             'base_url': self.context.absolute_url(),
             'tiny': generator.get_tiny_config(),
             # This is for loading the languages on tinymce
-            'loadingBaseUrl': '%s/++plone++static/components/tinymce-builded/js/tinymce' % generator.portal_url,
+            'loadingBaseUrl': '%s/++plone++static/components/tinymce-builded/js/tinymce' % generator.portal_url,  # noqa
             'prependToUrl': 'resolveuid/',
             'linkAttribute': 'UID',
             'prependToScalePart': '/@@images/image/',
diff --git a/Products/CMFPlone/profiles/default/metadata.xml b/Products/CMFPlone/profiles/default/metadata.xml
index 82b8c25..5379a35 100644
--- a/Products/CMFPlone/profiles/default/metadata.xml
+++ b/Products/CMFPlone/profiles/default/metadata.xml
@@ -1,4 +1,4 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>5010</version>
+  <version>5011</version>
 </metadata>
diff --git a/Products/CMFPlone/tests/testPatternSettings.py b/Products/CMFPlone/tests/testPatternSettings.py
index 4ceab4b..ed9b3ee 100644
--- a/Products/CMFPlone/tests/testPatternSettings.py
+++ b/Products/CMFPlone/tests/testPatternSettings.py
@@ -25,4 +25,4 @@ def test_atd_included(self):
 
     def test_style_formats(self):
         conf = self.get_conf()
-        self.assertEqual(len(conf['tiny']['style_formats']), 4)
\ No newline at end of file
+        self.assertEqual(len(conf['tiny']['style_formats']), 5)
\ No newline at end of file


