Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-07-10T11:22:07Z
Author: Guido A.J. Stevens (gyst) <guido.stevens@cosent.nl>
Commit: https://github.com/plone/plone.app.theming/commit/e8d1cccd59a14811965fee27f75529acb5cd1c2c

improve test isolation

Files changed:
M src/plone/app/theming/tests/test_policy.py

diff --git a/src/plone/app/theming/tests/test_policy.py b/src/plone/app/theming/tests/test_policy.py
index 258f5c4..c23f926 100644
--- a/src/plone/app/theming/tests/test_policy.py
+++ b/src/plone/app/theming/tests/test_policy.py
@@ -1,6 +1,5 @@
 # -*- coding: utf-8 -*-
 import time
-import multiprocessing
 import threading
 import transaction
 import unittest2 as unittest
@@ -16,10 +15,16 @@ class TestFunctional(unittest.TestCase):
 
     layer = THEMING_FUNCTIONAL_TESTING
 
+    def setUp(self):
+        request = self.layer['request']
+        policy = theming_policy(request)
+        # avoid cache pollution from other tests
+        policy.invalidateCache()
+
     def tearDown(self):
         request = self.layer['request']
         policy = theming_policy(request)
-        # static class attribute is cached across test runs
+        # clear local thread caches
         policy.invalidateCache()
 
     def test_getSettings(self):


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-07-10T07:45:32-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/ee62744b1b3430f60e02a315d2477454c60bcf3e

Merge pull request #64 from ploneintranet/master

improve test isolation

Files changed:
M src/plone/app/theming/tests/test_policy.py

diff --git a/src/plone/app/theming/tests/test_policy.py b/src/plone/app/theming/tests/test_policy.py
index 258f5c4..c23f926 100644
--- a/src/plone/app/theming/tests/test_policy.py
+++ b/src/plone/app/theming/tests/test_policy.py
@@ -1,6 +1,5 @@
 # -*- coding: utf-8 -*-
 import time
-import multiprocessing
 import threading
 import transaction
 import unittest2 as unittest
@@ -16,10 +15,16 @@ class TestFunctional(unittest.TestCase):
 
     layer = THEMING_FUNCTIONAL_TESTING
 
+    def setUp(self):
+        request = self.layer['request']
+        policy = theming_policy(request)
+        # avoid cache pollution from other tests
+        policy.invalidateCache()
+
     def tearDown(self):
         request = self.layer['request']
         policy = theming_policy(request)
-        # static class attribute is cached across test runs
+        # clear local thread caches
         policy.invalidateCache()
 
     def test_getSettings(self):


