Repository: mockup
Branch: refs/heads/master
Date: 2015-02-08T16:06:37-06:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/6153382bd8709c1e1b4f3ad62b30e484d825c5a3

trigger event that structure has caused a page url to change

Files changed:
M mockup/patterns/structure/js/views/app.js

diff --git a/mockup/patterns/structure/js/views/app.js b/mockup/patterns/structure/js/views/app.js
index 56bb81f..391bafd 100644
--- a/mockup/patterns/structure/js/views/app.js
+++ b/mockup/patterns/structure/js/views/app.js
@@ -181,15 +181,18 @@ define([
         self.loading.show();
 
         /* maintain history here */
-        if (!self.doNotPushState && self.options.urlStructure && window.history && window.history.pushState){
-          var path = self.queryHelper.getCurrentPath();
-          if(path === '/'){
-            path = '';
+        if(self.options.urlStructure && window.history && window.history.pushState){
+          if (!self.doNotPushState){
+            var path = self.queryHelper.getCurrentPath();
+            if(path === '/'){
+              path = '';
+            }
+            var url = self.options.urlStructure.base + path + self.options.urlStructure.appended;
+            window.history.pushState(null, null, url);
+            $('body').trigger('structure-url-changed', path);
+          }else{
+            self.doNotPushState = false;
           }
-          var url = self.options.urlStructure.base + path + self.options.urlStructure.appended;
-          window.history.pushState(null, null, url);
-        }else{
-          self.doNotPushState = false;
         }
       });
 
@@ -214,6 +217,7 @@ define([
             path = '/';
           }
           self.queryHelper.currentPath = path;
+          $('body').trigger('structure-url-changed', path);
           // since this next call causes state to be pushed...
           self.doNotPushState = true;
           self.collection.goTo(self.collection.information.firstPage);


