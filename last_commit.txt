Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-05-16T20:11:16+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.contenttypes/commit/6e994d0de12389b776b5004725adf5c5bb1845f1

Fix possible error setting fields for tabular_view for collections.

Issue #209.

Cherry-picked from 1.1.x branch.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/behaviors/collection.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1444e6e..6945b13 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 1.2a10 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Fix possible error setting fields for tabular_view for
+  collections.  Issue #209.
+  [maurits]
 
 
 1.2a9 (2015-05-13)
diff --git a/plone/app/contenttypes/behaviors/collection.py b/plone/app/contenttypes/behaviors/collection.py
index fef593c..7c08ea2 100644
--- a/plone/app/contenttypes/behaviors/collection.py
+++ b/plone/app/contenttypes/behaviors/collection.py
@@ -205,7 +205,9 @@ def _set_customViewFields(self, value):
         self.context.customViewFields = value
 
     def _get_customViewFields(self):
-        return getattr(self.context, 'customViewFields', [])
+        # Note: in corner cases customViewFields might be None, but we
+        # always want a list.
+        return getattr(self.context, 'customViewFields', []) or []
 
     customViewFields = property(_get_customViewFields, _set_customViewFields)
 


