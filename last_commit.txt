Repository: mockup


Branch: refs/heads/master
Date: 2015-07-16T07:25:40+02:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/ebbf035c7c1fc1d6d17e560929bac5a1a9ec5c4d

show quick edit/view for items in structure row

Files changed:
M CHANGES.rst
M mockup/patterns/structure/js/views/tablerow.js
M mockup/patterns/structure/less/pattern.structure.less
M mockup/patterns/structure/templates/tablerow.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 7b27f60..30993df 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- show quick edit/view for items in structure row
+  [vangheem]
+
 - upgrade mockup-core to 2.1.10
   [vangheem]
 
diff --git a/mockup/patterns/structure/js/views/tablerow.js b/mockup/patterns/structure/js/views/tablerow.js
index f913e24..6f1344c 100644
--- a/mockup/patterns/structure/js/views/tablerow.js
+++ b/mockup/patterns/structure/js/views/tablerow.js
@@ -13,7 +13,7 @@ define([
     template: _.template(TableRowTemplate),
     events: {
       'change input': 'itemSelected',
-      'click td.title a': 'itemClicked'
+      'click td.title a.manage': 'itemClicked'
     },
     initialize: function(options) {
       this.options = options;
diff --git a/mockup/patterns/structure/less/pattern.structure.less b/mockup/patterns/structure/less/pattern.structure.less
index 8e4e29d..2bf6b4f 100644
--- a/mockup/patterns/structure/less/pattern.structure.less
+++ b/mockup/patterns/structure/less/pattern.structure.less
@@ -217,6 +217,9 @@
             }
         }
     }
+    .icon-group-right{
+        float: right;
+    }
 }
 
 .pat-structure {
diff --git a/mockup/patterns/structure/templates/tablerow.xml b/mockup/patterns/structure/templates/tablerow.xml
index b586fde..c7ba979 100644
--- a/mockup/patterns/structure/templates/tablerow.xml
+++ b/mockup/patterns/structure/templates/tablerow.xml
@@ -1,6 +1,10 @@
 <td class="selection"><input type="checkbox" <% if(selected){ %> checked="checked" <% } %>/></td>
 <td class="title">
-  <a href="<%- getURL %>" class="state-<%- review_state %> contenttype-<%- portal_type.toLowerCase() %>"><%- Title %></a>
+  <a href="<%- getURL %>" class="manage state-<%- review_state %> contenttype-<%- portal_type.toLowerCase() %>"><%- Title %></a>
+  <div class="icon-group-right">
+    <a href="<%- getURL %>/edit" title="Edit"><span class="glyphicon glyphicon glyphicon-pencil"></span></a>
+    <a href="<%- getURL %>" title="View"><span class="glyphicon glyphicon-new-window"></span></a>
+  </div>
 </td>
 <% _.each(activeColumns, function(column){ %>
   <% if(_.has(availableColumns, column)) { %>


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-16T07:25:40+02:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/74248d5ed2530bdaebb250af081bfa7dbf5cf339

fix tests

Files changed:
M mockup/patterns/structure/js/views/tablerow.js
M mockup/patterns/structure/templates/tablerow.xml
M mockup/tests/pattern-structure-test.js

diff --git a/mockup/patterns/structure/js/views/tablerow.js b/mockup/patterns/structure/js/views/tablerow.js
index 6f1344c..3ba90b5 100644
--- a/mockup/patterns/structure/js/views/tablerow.js
+++ b/mockup/patterns/structure/js/views/tablerow.js
@@ -3,8 +3,9 @@ define([
   'underscore',
   'backbone',
   'mockup-patterns-structure-url/js/views/actionmenu',
-  'text!mockup-patterns-structure-url/templates/tablerow.xml'
-], function($, _, Backbone, ActionMenu, TableRowTemplate) {
+  'text!mockup-patterns-structure-url/templates/tablerow.xml',
+  'mockup-utils'
+], function($, _, Backbone, ActionMenu, TableRowTemplate, utils) {
   'use strict';
 
   var TableRowView = Backbone.View.extend({
@@ -31,6 +32,7 @@ define([
       data.attributes = self.model.attributes;
       data.activeColumns = self.app.activeColumns;
       data.availableColumns = self.app.availableColumns;
+      data._authenticator = utils.getAuthenticator();
       self.$el.html(self.template(data));
       var attrs = self.model.attributes;
       self.$el.addClass('state-' + attrs['review_state']).addClass('type-' + attrs.portal_type); // jshint ignore:line
diff --git a/mockup/patterns/structure/templates/tablerow.xml b/mockup/patterns/structure/templates/tablerow.xml
index c7ba979..ac6323e 100644
--- a/mockup/patterns/structure/templates/tablerow.xml
+++ b/mockup/patterns/structure/templates/tablerow.xml
@@ -2,7 +2,7 @@
 <td class="title">
   <a href="<%- getURL %>" class="manage state-<%- review_state %> contenttype-<%- portal_type.toLowerCase() %>"><%- Title %></a>
   <div class="icon-group-right">
-    <a href="<%- getURL %>/edit" title="Edit"><span class="glyphicon glyphicon glyphicon-pencil"></span></a>
+    <a href="<%- getURL %>/edit?_authenticator=<%- _authenticator %>" title="Edit"><span class="glyphicon glyphicon glyphicon-pencil"></span></a>
     <a href="<%- getURL %>" title="View"><span class="glyphicon glyphicon-new-window"></span></a>
   </div>
 </td>
diff --git a/mockup/tests/pattern-structure-test.js b/mockup/tests/pattern-structure-test.js
index cd1104a..bc05cfa 100644
--- a/mockup/tests/pattern-structure-test.js
+++ b/mockup/tests/pattern-structure-test.js
@@ -214,12 +214,12 @@ define([
       expect(this.$el.css('overflow')).to.not.equal('hidden');
     });
 
-    it.skip('test rearrange button', function() {
+    it('test rearrange button', function() {
       /* test not working in firefox */
       registry.scan(this.$el);
       this.clock.tick(1000);
       var $popover = this.$el.find('.popover.rearrange');
-      this.$el.find('#rearrange').trigger('click');
+      this.$el.find('#btn-rearrange').trigger('click');
       expect($popover.hasClass('active')).to.equal(true);
       $popover.find('button').trigger('click');
       this.clock.tick(1000);
@@ -229,7 +229,6 @@ define([
 
     it('test select all', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       var $item = this.$el.find('table th .select-all');
       $item[0].checked = true;
@@ -239,30 +238,28 @@ define([
 
     });
 
-    it.skip('test unselect all', function() {
-      /* XXX chrome test failures, blah... */
+    it('test unselect all', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       var $item = this.$el.find('table th .select-all');
       $item[0].checked = true;
       $item.trigger('change');
+      this.clock.tick(1000);
       expect(this.$el.find('#btn-selected-items').html()).to.contain('16');
       $item[0].checked = false;
       $item.trigger('change');
+      this.clock.tick(1000);
       expect(this.$el.find('#btn-selected-items').html()).to.contain('0');
     });
 
     it('test current folder buttons do not show on root', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       expect(this.$el.find('.context-buttons').length).to.equal(0);
     });
 
     it('test current folder buttons do show on subfolder', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       var $item = this.$el.find('.itemRow').eq(0);
       $('.title a', $item).trigger('click');


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-16T07:31:33+02:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/9fe5619c3143db17fd6ef920338c4c7aa96545f4

only show view button

Files changed:
M CHANGES.rst
M mockup/patterns/structure/templates/tablerow.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 30993df..10b0ace 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,7 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
-- show quick edit/view for items in structure row
+- show quick view for items in structure row
   [vangheem]
 
 - upgrade mockup-core to 2.1.10
diff --git a/mockup/patterns/structure/templates/tablerow.xml b/mockup/patterns/structure/templates/tablerow.xml
index ac6323e..e92f594 100644
--- a/mockup/patterns/structure/templates/tablerow.xml
+++ b/mockup/patterns/structure/templates/tablerow.xml
@@ -2,8 +2,7 @@
 <td class="title">
   <a href="<%- getURL %>" class="manage state-<%- review_state %> contenttype-<%- portal_type.toLowerCase() %>"><%- Title %></a>
   <div class="icon-group-right">
-    <a href="<%- getURL %>/edit?_authenticator=<%- _authenticator %>" title="Edit"><span class="glyphicon glyphicon glyphicon-pencil"></span></a>
-    <a href="<%- getURL %>" title="View"><span class="glyphicon glyphicon-new-window"></span></a>
+    <a href="<%- getURL %>/view" title="View"><span class="glyphicon glyphicon-new-window"></span></a>
   </div>
 </td>
 <% _.each(activeColumns, function(column){ %>


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-16T07:33:02+02:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/bdba9e6ae085c44a442b1a817eb2f619156ff2e8

Merge pull request #520 from plone/quick-edit-view

show quick edit/view for items in structure row

Files changed:
M CHANGES.rst
M mockup/patterns/structure/js/views/tablerow.js
M mockup/patterns/structure/less/pattern.structure.less
M mockup/patterns/structure/templates/tablerow.xml
M mockup/tests/pattern-structure-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 7b27f60..10b0ace 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- show quick view for items in structure row
+  [vangheem]
+
 - upgrade mockup-core to 2.1.10
   [vangheem]
 
diff --git a/mockup/patterns/structure/js/views/tablerow.js b/mockup/patterns/structure/js/views/tablerow.js
index f913e24..3ba90b5 100644
--- a/mockup/patterns/structure/js/views/tablerow.js
+++ b/mockup/patterns/structure/js/views/tablerow.js
@@ -3,8 +3,9 @@ define([
   'underscore',
   'backbone',
   'mockup-patterns-structure-url/js/views/actionmenu',
-  'text!mockup-patterns-structure-url/templates/tablerow.xml'
-], function($, _, Backbone, ActionMenu, TableRowTemplate) {
+  'text!mockup-patterns-structure-url/templates/tablerow.xml',
+  'mockup-utils'
+], function($, _, Backbone, ActionMenu, TableRowTemplate, utils) {
   'use strict';
 
   var TableRowView = Backbone.View.extend({
@@ -13,7 +14,7 @@ define([
     template: _.template(TableRowTemplate),
     events: {
       'change input': 'itemSelected',
-      'click td.title a': 'itemClicked'
+      'click td.title a.manage': 'itemClicked'
     },
     initialize: function(options) {
       this.options = options;
@@ -31,6 +32,7 @@ define([
       data.attributes = self.model.attributes;
       data.activeColumns = self.app.activeColumns;
       data.availableColumns = self.app.availableColumns;
+      data._authenticator = utils.getAuthenticator();
       self.$el.html(self.template(data));
       var attrs = self.model.attributes;
       self.$el.addClass('state-' + attrs['review_state']).addClass('type-' + attrs.portal_type); // jshint ignore:line
diff --git a/mockup/patterns/structure/less/pattern.structure.less b/mockup/patterns/structure/less/pattern.structure.less
index 8e4e29d..2bf6b4f 100644
--- a/mockup/patterns/structure/less/pattern.structure.less
+++ b/mockup/patterns/structure/less/pattern.structure.less
@@ -217,6 +217,9 @@
             }
         }
     }
+    .icon-group-right{
+        float: right;
+    }
 }
 
 .pat-structure {
diff --git a/mockup/patterns/structure/templates/tablerow.xml b/mockup/patterns/structure/templates/tablerow.xml
index b586fde..e92f594 100644
--- a/mockup/patterns/structure/templates/tablerow.xml
+++ b/mockup/patterns/structure/templates/tablerow.xml
@@ -1,6 +1,9 @@
 <td class="selection"><input type="checkbox" <% if(selected){ %> checked="checked" <% } %>/></td>
 <td class="title">
-  <a href="<%- getURL %>" class="state-<%- review_state %> contenttype-<%- portal_type.toLowerCase() %>"><%- Title %></a>
+  <a href="<%- getURL %>" class="manage state-<%- review_state %> contenttype-<%- portal_type.toLowerCase() %>"><%- Title %></a>
+  <div class="icon-group-right">
+    <a href="<%- getURL %>/view" title="View"><span class="glyphicon glyphicon-new-window"></span></a>
+  </div>
 </td>
 <% _.each(activeColumns, function(column){ %>
   <% if(_.has(availableColumns, column)) { %>
diff --git a/mockup/tests/pattern-structure-test.js b/mockup/tests/pattern-structure-test.js
index cd1104a..bc05cfa 100644
--- a/mockup/tests/pattern-structure-test.js
+++ b/mockup/tests/pattern-structure-test.js
@@ -214,12 +214,12 @@ define([
       expect(this.$el.css('overflow')).to.not.equal('hidden');
     });
 
-    it.skip('test rearrange button', function() {
+    it('test rearrange button', function() {
       /* test not working in firefox */
       registry.scan(this.$el);
       this.clock.tick(1000);
       var $popover = this.$el.find('.popover.rearrange');
-      this.$el.find('#rearrange').trigger('click');
+      this.$el.find('#btn-rearrange').trigger('click');
       expect($popover.hasClass('active')).to.equal(true);
       $popover.find('button').trigger('click');
       this.clock.tick(1000);
@@ -229,7 +229,6 @@ define([
 
     it('test select all', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       var $item = this.$el.find('table th .select-all');
       $item[0].checked = true;
@@ -239,30 +238,28 @@ define([
 
     });
 
-    it.skip('test unselect all', function() {
-      /* XXX chrome test failures, blah... */
+    it('test unselect all', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       var $item = this.$el.find('table th .select-all');
       $item[0].checked = true;
       $item.trigger('change');
+      this.clock.tick(1000);
       expect(this.$el.find('#btn-selected-items').html()).to.contain('16');
       $item[0].checked = false;
       $item.trigger('change');
+      this.clock.tick(1000);
       expect(this.$el.find('#btn-selected-items').html()).to.contain('0');
     });
 
     it('test current folder buttons do not show on root', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       expect(this.$el.find('.context-buttons').length).to.equal(0);
     });
 
     it('test current folder buttons do show on subfolder', function() {
       registry.scan(this.$el);
-      var pattern = this.$el.data('patternStructure');
       this.clock.tick(1000);
       var $item = this.$el.find('.itemRow').eq(0);
       $('.title a', $item).trigger('click');


