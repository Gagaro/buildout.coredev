Repository: mockup
Branch: refs/heads/master
Date: 2015-03-31T15:42:20+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/mockup/commit/0eaf5db6e8543ff53d6a3ee3f0b9df72f64ed066

depend on newest bower

Files changed:
M bower.json

diff --git a/bower.json b/bower.json
index 0f21da1..c70b4e4 100644
--- a/bower.json
+++ b/bower.json
@@ -15,7 +15,7 @@
     "jquery.cookie": "1.4.1",
     "lodash": "2.4.1",
     "logging": "",
-    "mockup-core": "2.1.5",
+    "mockup-core": "2.1.6",
     "moment": "2.8.3",
     "pickadate": "3.4.0",
     "requirejs-text": "2.0.12",


Repository: mockup
Branch: refs/heads/master
Date: 2015-03-31T15:43:02+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/mockup/commit/6932633cea6b48aa072ea4ac5293e4c301afcdc3

Fix building of docs with ``make docs``

Files changed:
M CHANGES.rst
M Makefile
M mockup/Gruntfile.js
M mockup/index.html

diff --git a/CHANGES.rst b/CHANGES.rst
index d38d5b3..b23af9e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.2 (unreleased)
 ------------------
 
+- Fix building of docs with ``make docs``.
+  [thet]
+
 - update related items tree widget integration to have a bit better
   user interaction. Automatically open folder nodes and implement double click
   [vangheem]
diff --git a/Makefile b/Makefile
index 09e4556..e33cddb 100644
--- a/Makefile
+++ b/Makefile
@@ -54,8 +54,9 @@ bundle-resourceregistry:
 	NODE_PATH=$(NODE_PATH) $(GRUNT) bundle-resourceregistry $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js
 
 docs:
-	if test ! -d docs; then $(GIT) clone git://github.com/plone/mockup.git -b gh-pages docs; fi
-	rm -rf docs/dev
+	rm -Rf mockup/docs; mkdir mockup/docs; cp -R .git mockup/docs; cd mockup/docs; $(GIT) checkout gh-pages;
+	# if test ! -d mockup/docs; then $(GIT) clone git://github.com/plone/mockup.git -b gh-pages mockup/docs; fi
+	rm -rf mockup/docs/dev
 	NODE_PATH=$(NODE_PATH) $(GRUNT) bundle-docs $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js
 
 bootstrap-common:
@@ -114,6 +115,7 @@ clean-deep: clean
 	if test -f $(NPM); then $(NPM) cache clean; fi
 
 publish-docs:
-	echo -e "Publishing 'docs' bundle!\n"; cd docs; git add -fA .; git commit -m "Travis build $(TRAVIS_BUILD_NUMBER) pushed to 'docs'."; git push -fq https://$(GH_TOKEN)@github.com/plone/mockup.git gh-pages > /dev/null; cd ..;
+	echo -e "Publishing 'docs' bundle!\n"; cd mockup/docs; git add -fA .; git commit -m "Publishing docs"; git push -f git@github.com:plone/mockup.git gh-pages; cd ../..;
+	# echo -e "Publishing 'docs' bundle!\n"; cd mockup/docs; git add -fA .; git commit -m "Travis build $(TRAVIS_BUILD_NUMBER) pushed to 'docs'."; git push -fq https://$(GH_TOKEN)@github.com/plone/mockup.git gh-pages > /dev/null; cd ..;
 
 .PHONY: bundle bundle-widgets bundle-structure bundle-plone docs bootstrap bootstrap-nix jshint test test-once test-dev test-ci publish-docs clean clean-deep
diff --git a/mockup/Gruntfile.js b/mockup/Gruntfile.js
index 222f27b..ea0f786 100644
--- a/mockup/Gruntfile.js
+++ b/mockup/Gruntfile.js
@@ -29,15 +29,15 @@ module.exports = function(grunt) {
     copy: {
       docs: {
         files: [
+          { expand: true, src: '*.md', dest: 'docs/dev/' },
+          { expand: true, src: 'bower_components/**', dest: 'docs/dev/' },
           { expand: true, src: 'index.html', dest: 'docs/dev/' },
-          { expand: true, src: '../*.md', dest: 'docs/dev/' },
           { expand: true, src: 'js/**', dest: 'docs/dev/' },
-          { expand: true, src: 'tests/**', dest: 'docs/dev/' },
+          { expand: true, src: 'less/**', dest: 'docs/dev/' },
           { expand: true, src: 'lib/**', dest: 'docs/dev/' },
-          { expand: true, src: 'bower_components/**', dest: 'docs/dev/' },
-          { expand: true, src: '../node_modules/requirejs/require.js', dest: 'docs/dev/' },
-          { expand: true, src: 'build/**', dest: 'docs/dev/' },
-          { expand: true, src: 'less/**', dest: 'docs/dev/' }
+          { expand: true, src: 'node_modules/requirejs/require.js', dest: 'docs/dev/' },
+          { expand: true, src: 'patterns/**', dest: 'docs/dev/' },
+          { expand: true, src: 'tests/**', dest: 'docs/dev/' },
         ]
       },
     },
@@ -47,15 +47,20 @@ module.exports = function(grunt) {
         pattern: 'href="docs/dev/docs.min.css"',
         replacement: 'href="docs.min.css"'
       },
-      'docs-js': {
-        path: 'docs/dev/index.html',
-        pattern: '<script src="node_modules/grunt-contrib-less/node_modules/less/dist/less-1.6.1.js"></script>\n  <script src="node_modules/requirejs/require.js"></script>\n  <script src="js/config.js"></script>\n  <script>require\\(\\[\'mockup-bundles-docs\'\\]\\);</script>',
-        replacement: '<script src="docs.min.js"></script>'
-      },
+      //'docs-js': {
+      //  path: 'docs/dev/index.html',
+      //  pattern: '<script src="node_modules/requirejs/require.js"></script>\n  <script src="js/config.js"></script>\n  <script>\n    window.DEBUG = true;\n    require\\(\\[\'mockup-bundles-docs\'\\]\\);\n  </script>',
+      //  replacement: '<script src="docs.min.js"></script>'
+      //},
       'docs-legacy-js': {
         path: 'docs/dev/index.html',
         pattern: '<script src="bower_components/es5-shim/es5-shim.js"></script>\n    <script src="bower_components/es5-shim/es5-sham.js"></script>\n    <script src="bower_components/console-polyfill/index.js"></script>',
         replacement: '<script src="docs-legacy.js"></script>'
+      },
+      'docs-catalogurl': {
+        path: 'docs/dev/index.html',
+        pattern: 'data-i18ncatalogurl="/tests/json/i18n.json"',
+        replacement: 'data-i18ncatalogurl="/mockup/dev/tests/json/i18n.json"',
       }
     },
   }, {
diff --git a/mockup/index.html b/mockup/index.html
index 76d2d39..ff52446 100644
--- a/mockup/index.html
+++ b/mockup/index.html
@@ -20,14 +20,14 @@
   <![endif]-->
 
   <script src="node_modules/requirejs/require.js"></script>
-  <script src="mockup/js/config.js"></script>
+  <script src="js/config.js"></script>
   <script>
     window.DEBUG = true;
     require(['mockup-bundles-docs']);
   </script>
 </head>
 
-<body data-i18ncatalogurl="/mockup/tests/json/i18n.json">
+<body data-i18ncatalogurl="/tests/json/i18n.json">
 </body>
 
 </html>


