Repository: plone.app.event
Branch: refs/heads/master
Date: 2015-01-28T04:44:42+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.event/commit/33694a63b0390d71fcde5ce0de649f5590f2552c

setup_misc, which also did the first_weekday setup, isn't necessary anymore

Files changed:
M plone/app/event/configure.zcml
M plone/app/event/setuphandlers.py

diff --git a/plone/app/event/configure.zcml b/plone/app/event/configure.zcml
index 4220072..0b3ad18 100644
--- a/plone/app/event/configure.zcml
+++ b/plone/app/event/configure.zcml
@@ -46,10 +46,10 @@
 
   <genericsetup:importStep
       name="plone.app.event-catalog"
-      handler="plone.app.event.setuphandlers.setup_misc"
-      title="plone.app.event misc"
-      description="catalog and first_weekday setup">
-      <depends name="plone.app.registry" />
+      handler="plone.app.event.setuphandlers.setup_catalog"
+      title="plone.app.event catalog setup"
+      description="registers indices and metadata columns for plone.app.event">
+    <depends name="plone.app.registry" />
   </genericsetup:importStep>
 
   <utility
diff --git a/plone/app/event/setuphandlers.py b/plone/app/event/setuphandlers.py
index c37b39f..47bc18b 100644
--- a/plone/app/event/setuphandlers.py
+++ b/plone/app/event/setuphandlers.py
@@ -22,7 +22,7 @@ def getNonInstallableProfiles(self):
         return [u'plone.app.event:testing', ]
 
 
-def catalog_setup(context):
+def setup_catalog(context):
     """Setup plone.app.event's indices in the catalog.
 
     Doing it here instead of in profiles/default/catalog.xml means we
@@ -33,7 +33,10 @@ def catalog_setup(context):
         emptying-the-indexes-td2302709.html
         https://mail.zope.org/pipermail/zope-cmf/2007-March/025664.html
     """
-    catalog = getToolByName(context, 'portal_catalog')
+    if context.readDataFile('plone.app.event-default.txt') is None:
+        return
+    portal = context.getSite()
+    catalog = getToolByName(portal, 'portal_catalog')
     date_idxs = ['start', 'end']
     field_idxs = ['sync_uid']
     idxs = date_idxs + field_idxs
@@ -62,11 +65,3 @@ class extra(object):
             logger.info('Catalog metadata column %s created.' % name)
         except CatalogError:
             logger.info('Catalog metadata column %s already exists.' % name)
-
-
-def setup_misc(context):
-    if context.readDataFile('plone.app.event-default.txt') is None:
-        return
-
-    portal = context.getSite()
-    catalog_setup(portal)


