Repository: plone.app.folder


Branch: refs/heads/master
Date: 2015-09-20T17:34:17+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.folder/commit/60783715b8db3b571913ed14bccf37c23cdf6deb

Move portal_properties settings to configuration registry

commit dc77395988cacce7538d419ffee0e0aff74a92b9
Author: esteele &lt;eric@esteele.net&gt;
Date:   Fri Sep 18 09:51:22 2015 +0200

    Fix registry id

commit 0e58ac79ddf0786a954d119468ba36f7b9438194
Author: esteele &lt;eric@esteele.net&gt;
Date:   Thu Sep 17 18:36:32 2015 +0200

    Use registry lookup for types_use_view_action_in_listings

Files changed:
M CHANGES.rst
M src/plone/app/folder/nextprevious.py

diff --git a/CHANGES.rst b/CHANGES.rst
index dc872b8..0d5bc48 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.1.1 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Use registry lookup for types_use_view_action_in_listings.
+  [esteele]
 
 
 1.1.0 (2015-03-11)
diff --git a/src/plone/app/folder/nextprevious.py b/src/plone/app/folder/nextprevious.py
index 39cce2f..2694e5e 100644
--- a/src/plone/app/folder/nextprevious.py
+++ b/src/plone/app/folder/nextprevious.py
@@ -4,7 +4,9 @@
 from Products.CMFCore.utils import getToolByName
 from plone.app.folder.folder import IATUnifiedFolder
 from plone.app.layout.nextprevious.interfaces import INextPreviousProvider
+from plone.registry.interfaces import IRegistry
 from zope.component import adapter
+from zope.component import getUtility
 from zope.interface import implementer
 
 
@@ -15,8 +17,8 @@ class NextPrevious(object):
 
     def __init__(self, context):
         self.context = context
-        props = getToolByName(context, 'portal_properties').site_properties
-        self.vat = props.getProperty('typesUseViewActionInListings', ())
+        registry = getUtility(IRegistry)
+        self.vat = registry.get('plone.types_use_view_action_in_listings', [])
         self.security = getSecurityManager()
         order = context.getOrdering()
         if not isinstance(order, list):


