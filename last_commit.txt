Repository: plone.app.layout


Branch: refs/heads/master
Date: 2015-07-06T14:09:28-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.layout/commit/59da57948d3b372594bc1639d5845a43661a31cd

always show site root syndication links if enabled

Files changed:
M CHANGES.rst
M plone/app/layout/links/viewlets.py

diff --git a/CHANGES.rst b/CHANGES.rst
index f530f9c..74acb88 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.5.8 (unreleased)
 ------------------
 
+- always show site root syndication links if enabled
+  [vangheem]
+
 - by default, show site logo in social settings
   [vangheem]
 
diff --git a/plone/app/layout/links/viewlets.py b/plone/app/layout/links/viewlets.py
index 48d1534..33f9a88 100644
--- a/plone/app/layout/links/viewlets.py
+++ b/plone/app/layout/links/viewlets.py
@@ -101,6 +101,7 @@ def getRssLinks(self, obj):
     def update(self):
         super(RSSViewlet, self).update()
         self.rsslinks = []
+        portal = self.portal_state.portal()
         util = getMultiAdapter((self.context, self.request),
                                name="syndication-util")
         context_state = getMultiAdapter((self.context, self.request),
@@ -114,11 +115,14 @@ def update(self):
                     return
                 if settings.site_rss_items:
                     for uid in settings.site_rss_items:
+                        if not uid:
+                            continue
                         obj = uuidToObject(uid)
+                        if obj is None and uid[0] == '/':
+                            obj = portal.restrictedTraverse(uid.lstrip('/'), None)
                         if obj is not None:
                             self.rsslinks.extend(self.getRssLinks(obj))
-                    self.rsslinks.extend(self.getRssLinks(
-                        self.portal_state.portal()))
+                self.rsslinks.extend(self.getRssLinks(portal))
         else:
             if util.context_enabled():
                 self.rsslinks.extend(self.getRssLinks(self.context))


