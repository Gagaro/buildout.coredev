Repository: plone.app.widgets
Branch: refs/heads/master
Date: 2015-02-04T12:28:59-06:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.widgets/commit/31ab96809c46b22522abd5db2cf6db0dc66fc320

fix running robot tests in dev mode, mostly stupid timing issues. Really annoying. robot tests eat my soul

Files changed:
M plone/app/widgets/tests/robot/common.robot
M plone/app/widgets/tests/robot/test_datetime_widget.robot
M plone/app/widgets/tests/robot/test_querystring_widget.robot
M plone/app/widgets/tests/robot/test_select_widget.robot

diff --git a/plone/app/widgets/tests/robot/common.robot b/plone/app/widgets/tests/robot/common.robot
index 483e1f9..d158bc6 100644
--- a/plone/app/widgets/tests/robot/common.robot
+++ b/plone/app/widgets/tests/robot/common.robot
@@ -38,11 +38,11 @@ I edit
 I create a collection
   [Arguments]  ${title}
   Go to  ${PLONE_URL}/++add++Collection
-  Wait until page contains  Add Collection
-  Input text  name=form.widgets.IDublinCore.title  ${title}
+  Wait For Condition  return $('.autotoc-nav .active:visible').size() > 0
+  Execute Javascript  $('#form-widgets-IDublinCore-title').val('${title}'); return 0;
 
 I create a folder
   [Arguments]  ${title}
   Go to  ${PLONE_URL}/++add++Folder
-  Wait until page contains  Add Folder
-  Input text  name=form.widgets.IDublinCore.title  ${title}
+  Wait For Condition  return $('.autotoc-nav .active:visible').size() > 0
+  Execute Javascript  $('#form-widgets-IDublinCore-title').val('${title}'); return 0;
diff --git a/plone/app/widgets/tests/robot/test_datetime_widget.robot b/plone/app/widgets/tests/robot/test_datetime_widget.robot
index 88a235a..c8fa2a8 100644
--- a/plone/app/widgets/tests/robot/test_datetime_widget.robot
+++ b/plone/app/widgets/tests/robot/test_datetime_widget.robot
@@ -30,6 +30,7 @@ As a contributor I can enter the date and time
    When I fill datetime field  Publishing Date  2010  1  30  4:00 a.m.
     And When I save
     And When I edit
+    Wait For Condition  return $('.autotoc-nav .active:visible').size() > 0
     And When I open tab  Dates
    Then Page should contain datetime  Publishing Date  2010  1  30  4:00 a.m.
 
diff --git a/plone/app/widgets/tests/robot/test_querystring_widget.robot b/plone/app/widgets/tests/robot/test_querystring_widget.robot
index 92f4397..a1765cb 100644
--- a/plone/app/widgets/tests/robot/test_querystring_widget.robot
+++ b/plone/app/widgets/tests/robot/test_querystring_widget.robot
@@ -13,6 +13,7 @@ ${querywidget_selector}  \#formfield-form-widgets-ICollection-query
 Querystring Widget rows appear and disappear correctly
   Given I'm logged in as a 'Site Administrator'
     And I create a collection  My Collection
+        Wait For Condition  return $('.querystring-wrapper:visible').size() > 0
         Page should contain Element  css=${querywidget_selector} .querystring-criteria-wrapper:nth-child(1)
         Page should not contain Element  css=${querywidget_selector} .querystring-criteria-wrapper:nth-child(2)
    When I select criteria index in row  1  Expiration date
@@ -90,6 +91,8 @@ I select criteria index in row
   [Arguments]  ${number}  ${label}
   ${criteria_row} =  Convert to String  ${querywidget_selector} .querystring-criteria-wrapper:nth-child(${number})
   Click Element  css=${criteria_row} .querystring-criteria-index .select2-container a
+  Input Text  css=.select2-drop-active .select2-input  text=${label}
+  Press Key  css=.select2-drop-active .select2-input  \\13
   Press Key  jquery=:focus  ${label}\n
 
 I select criteria operator in row
diff --git a/plone/app/widgets/tests/robot/test_select_widget.robot b/plone/app/widgets/tests/robot/test_select_widget.robot
index 7b464ae..b98bf1c 100644
--- a/plone/app/widgets/tests/robot/test_select_widget.robot
+++ b/plone/app/widgets/tests/robot/test_select_widget.robot
@@ -41,6 +41,7 @@ The Select Widget autocomplete function works
 
 The Select Multiple Widget allows to select multiple values
   Given a form
+
    When I click on the element  2
     And When I click on the element  1
    Then the widget shows two elements  five  four
@@ -62,22 +63,26 @@ a form
 
 I type on the autocomplete field
   [Arguments]  ${text}
+  Wait For Condition  return $('.select2-choices:visible').size() > 0
   Open Dropdown  ${dropdown_select}  ${input_search}
   Input Text  ${input_search}  ${text}
   Click Element  ${results_label}
 
 I type on the multiple autocomplete field
   [Arguments]  ${text}
+  Wait For Condition  return $('.select2-choices:visible').size() > 0
   Execute Javascript  var $input = $('.select2-input'); $input.click().val('${text}'); var keyup = $.Event('keyup-change'); $input.trigger(keyup); return 0
   Click Element  ${results_label}
 
 I select the option
   [Arguments]  ${index}
+  Wait For Condition  return $('.select2-choices:visible').size() > 0
   Open Dropdown  ${dropdown_select}  ${input_search}
   Click Element  css=li.select2-results-dept-0:nth-child(${index})
 
 I click on the element
   [Arguments]  ${index}
+  Wait For Condition  return $('.select2-choices:visible').size() > 0
   Open Dropdown  css=#formfield-form-widgets-list_field input.select2-input  ${dropdown_multiple}
   Click Element  css=li.select2-results-dept-0:nth-child(${index})
 


