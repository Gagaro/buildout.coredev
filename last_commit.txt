Repository: plone.app.users
Branch: refs/heads/master
Date: 2015-05-18T19:32:16+03:00
Author: Alin Voinea (avoinea) <alin@eaudeweb.ro>
Commit: https://github.com/plone/plone.app.users/commit/7c31a7fde16a0f4971514e292dee4e0768c5ecf1

Refs #33 - Fix "Add new user" form when there are too many groups.

Conflicts:
	plone/app/users/browser/register.py

Files changed:
M CHANGES.rst
M plone/app/users/browser/register.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 9ffedf2..e8874eb 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ CHANGES
 2.2.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed "Add new user" form when there are too many groups.
+  Fixes https://github.com/plone/plone.app.users/issues/33
+  [avoinea]
 
 
 2.2.1 (2015-05-04)
diff --git a/plone/app/users/browser/register.py b/plone/app/users/browser/register.py
index bb238ea..bae04e5 100644
--- a/plone/app/users/browser/register.py
+++ b/plone/app/users/browser/register.py
@@ -676,10 +676,14 @@ def updateFields(self):
                 defaultFields['mail_me'].field.default = False
 
         # Append the manager-focused fields
-        allFields = defaultFields + field.Fields(IAddUserSchema)
-
-        allFields['groups'].widgetFactory = CheckBoxFieldWidget
-
+        portal_props = getToolByName(self.context, 'portal_properties')
+        props = portal_props.site_properties
+        many_groups = props.getProperty('many_groups', False)
+        if not many_groups:
+            allFields = defaultFields + field.Fields(IAddUserSchema)
+            allFields['groups'].widgetFactory = CheckBoxFieldWidget
+        else:
+            allFields = defaultFields
         self.fields = allFields
 
     def updateWidgets(self):


Repository: plone.app.users
Branch: refs/heads/master
Date: 2015-05-18T18:35:07+02:00
Author: Alin Voinea (avoinea) <alin@eaudeweb.ro>
Commit: https://github.com/plone/plone.app.users/commit/98b4d89c8e02600998201260d3330491335e0365

Merge pull request #39 from eea/master

Refs #33 - Fix "Add new user" form when there are too many groups.

Files changed:
M CHANGES.rst
M plone/app/users/browser/register.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 9ffedf2..e8874eb 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ CHANGES
 2.2.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed "Add new user" form when there are too many groups.
+  Fixes https://github.com/plone/plone.app.users/issues/33
+  [avoinea]
 
 
 2.2.1 (2015-05-04)
diff --git a/plone/app/users/browser/register.py b/plone/app/users/browser/register.py
index bb238ea..bae04e5 100644
--- a/plone/app/users/browser/register.py
+++ b/plone/app/users/browser/register.py
@@ -676,10 +676,14 @@ def updateFields(self):
                 defaultFields['mail_me'].field.default = False
 
         # Append the manager-focused fields
-        allFields = defaultFields + field.Fields(IAddUserSchema)
-
-        allFields['groups'].widgetFactory = CheckBoxFieldWidget
-
+        portal_props = getToolByName(self.context, 'portal_properties')
+        props = portal_props.site_properties
+        many_groups = props.getProperty('many_groups', False)
+        if not many_groups:
+            allFields = defaultFields + field.Fields(IAddUserSchema)
+            allFields['groups'].widgetFactory = CheckBoxFieldWidget
+        else:
+            allFields = defaultFields
         self.fields = allFields
 
     def updateWidgets(self):


