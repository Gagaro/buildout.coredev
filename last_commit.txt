Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-24T21:10:31-05:00
Author: Jure Cerjak (jcerjak) <jcerjak@termitnjak.si>
Commit: https://github.com/plone/Products.CMFPlone/commit/7a39b86717c03fd99ef7ae756d28d9920d182e67

Fix #817: show a flash message with info on caching

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/filter.py
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot

diff --git a/CHANGES.rst b/CHANGES.rst
index d150de6..b2bda0b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,10 @@ Changelog
 5.0rc4 (unreleased)
 -------------------
 
+- Fix #817: When saving the filter control panel show a flash message with
+  info on caching.
+  [jcerjak]
+
 - Remove Chrome Frame from ``X-UA-Compatible`` HTTP header as it's deprecated.
   [hvelarde]
 
diff --git a/Products/CMFPlone/controlpanel/browser/filter.py b/Products/CMFPlone/controlpanel/browser/filter.py
index c639c5b..6d573cc 100644
--- a/Products/CMFPlone/controlpanel/browser/filter.py
+++ b/Products/CMFPlone/controlpanel/browser/filter.py
@@ -15,12 +15,7 @@
 class FilterControlPanel(AutoExtensibleForm, form.EditForm):
     id = "FilterControlPanel"
     label = _(u"HTML Filtering Settings")
-    description = _(
-        'description_html_filtering',
-        default=u"HTML generation is heavily cached across Plone. "
-                u"After changing settings here, you may have to edit "
-                u"existing content to see the changes in these filter settings "
-                u"or restart your server.")
+    description = ""
     schema = IFilterSchema
     form_name = _(u"HTML Filtering Settings")
     control_panel_view = "filter-controlpanel"
@@ -73,8 +68,8 @@ def handleSave(self, action):  # NOQA
         if disable_filtering != safe_html._config['disable_transform']:
             safe_html._config['disable_transform'] = disable_filtering
 
-        for attr in ('stripped_combinations', 'class_blacklist', 'stripped_attributes',
-                     'style_whitelist'):
+        for attr in ('stripped_combinations', 'class_blacklist',
+                     'stripped_attributes', 'style_whitelist'):
             value = data[attr]
             if value is None:
                 if attr == 'stripped_combinations':
@@ -92,6 +87,11 @@ def handleSave(self, action):  # NOQA
         IStatusMessage(self.request).addStatusMessage(
             _(u"Changes saved."),
             "info")
+        IStatusMessage(self.request).addStatusMessage(
+            _(u"HTML generation is heavily cached across Plone. You may "
+              u"have to edit existing content or restart your server to see "
+              u"the changes."),
+            "warning")
         self.request.response.redirect(self.request.getURL())
 
 
diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
index 1565bbf..5f51bf7 100644
--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
@@ -69,6 +69,11 @@ Scenario: Configure Filter Control Panel to filter out classes
    When I add 'foobar' to the filtered classes
    Then the 'foobar' class is filtered out when a document is saved
 
+Scenario: Filter Control Panel displays information regarding caching when saved
+  Given a logged-in site administrator
+    and the filter control panel
+   When I save the form
+   Then success message should contain information regarding caching
 
 
 *** Keywords *****************************************************************
@@ -124,6 +129,10 @@ I add '${tags}' and '${attributes}' to the stripped out combinations
   Click Button  Save
   Wait until page contains  Changes saved
 
+I save the form
+  Click Button  Save
+  Wait until page contains  Changes saved
+
 
 # --- THEN -------------------------------------------------------------------
 
@@ -202,3 +211,6 @@ the 'display' style attribute is preserved when a document is saved
 
   XPath Should Match X Times  //*[@id='content-core']//h4  1  message=h4 tag should be present
   XPath Should Match X Times  //*[@id='content-core']//h4[@style]  1  message=style attribute with display:block should be present
+
+success message should contain information regarding caching
+  Element Should Contain  css=.portalMessage.warning  HTML generation is heavily cached across Plone. You may have to edit existing content or restart your server to see the changes.


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-24T21:10:53-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/153e8ef9922003ee2c4e71a4b02b4be5357d0e06

Merge pull request #1044 from plone/jcerjak-fix-817

Fix #817: When saving the filter control panel show a flash message with info on caching.

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/filter.py
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot

diff --git a/CHANGES.rst b/CHANGES.rst
index d150de6..b2bda0b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,10 @@ Changelog
 5.0rc4 (unreleased)
 -------------------
 
+- Fix #817: When saving the filter control panel show a flash message with
+  info on caching.
+  [jcerjak]
+
 - Remove Chrome Frame from ``X-UA-Compatible`` HTTP header as it's deprecated.
   [hvelarde]
 
diff --git a/Products/CMFPlone/controlpanel/browser/filter.py b/Products/CMFPlone/controlpanel/browser/filter.py
index c639c5b..6d573cc 100644
--- a/Products/CMFPlone/controlpanel/browser/filter.py
+++ b/Products/CMFPlone/controlpanel/browser/filter.py
@@ -15,12 +15,7 @@
 class FilterControlPanel(AutoExtensibleForm, form.EditForm):
     id = "FilterControlPanel"
     label = _(u"HTML Filtering Settings")
-    description = _(
-        'description_html_filtering',
-        default=u"HTML generation is heavily cached across Plone. "
-                u"After changing settings here, you may have to edit "
-                u"existing content to see the changes in these filter settings "
-                u"or restart your server.")
+    description = ""
     schema = IFilterSchema
     form_name = _(u"HTML Filtering Settings")
     control_panel_view = "filter-controlpanel"
@@ -73,8 +68,8 @@ def handleSave(self, action):  # NOQA
         if disable_filtering != safe_html._config['disable_transform']:
             safe_html._config['disable_transform'] = disable_filtering
 
-        for attr in ('stripped_combinations', 'class_blacklist', 'stripped_attributes',
-                     'style_whitelist'):
+        for attr in ('stripped_combinations', 'class_blacklist',
+                     'stripped_attributes', 'style_whitelist'):
             value = data[attr]
             if value is None:
                 if attr == 'stripped_combinations':
@@ -92,6 +87,11 @@ def handleSave(self, action):  # NOQA
         IStatusMessage(self.request).addStatusMessage(
             _(u"Changes saved."),
             "info")
+        IStatusMessage(self.request).addStatusMessage(
+            _(u"HTML generation is heavily cached across Plone. You may "
+              u"have to edit existing content or restart your server to see "
+              u"the changes."),
+            "warning")
         self.request.response.redirect(self.request.getURL())
 
 
diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
index 1565bbf..5f51bf7 100644
--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
@@ -69,6 +69,11 @@ Scenario: Configure Filter Control Panel to filter out classes
    When I add 'foobar' to the filtered classes
    Then the 'foobar' class is filtered out when a document is saved
 
+Scenario: Filter Control Panel displays information regarding caching when saved
+  Given a logged-in site administrator
+    and the filter control panel
+   When I save the form
+   Then success message should contain information regarding caching
 
 
 *** Keywords *****************************************************************
@@ -124,6 +129,10 @@ I add '${tags}' and '${attributes}' to the stripped out combinations
   Click Button  Save
   Wait until page contains  Changes saved
 
+I save the form
+  Click Button  Save
+  Wait until page contains  Changes saved
+
 
 # --- THEN -------------------------------------------------------------------
 
@@ -202,3 +211,6 @@ the 'display' style attribute is preserved when a document is saved
 
   XPath Should Match X Times  //*[@id='content-core']//h4  1  message=h4 tag should be present
   XPath Should Match X Times  //*[@id='content-core']//h4[@style]  1  message=style attribute with display:block should be present
+
+success message should contain information regarding caching
+  Element Should Contain  css=.portalMessage.warning  HTML generation is heavily cached across Plone. You may have to edit existing content or restart your server to see the changes.


