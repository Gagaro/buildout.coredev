Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-11-03T17:14:45+13:00
Author: kuetrzi () <https://github.com/kuetrzi>
Commit: https://github.com/plone/Products.CMFPlone/commit/1913eeee277a80592f32c76cb11feb07838f2717

change IImagingSchema default allowed sizes to unicode

Files changed:
A Products/CMFPlone/tests/testIImagingSchema.py
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 96dc1fa..497c78e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -80,6 +80,10 @@ Fixes:
   roles.
   [maurits]
 
+- Default values for interfaces.controlpanel.IImagingSchema.allowed_sizes
+  should be unicode.
+  [kuetrzi]
+
 
 5.0 (2015-09-27)
 ----------------
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index 56f4c66..077cfbe 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -1437,13 +1437,13 @@ class IImagingSchema(Interface):
                       'The required format is &lt;name&gt; &lt;width&gt;:&lt;height&gt;.'),
         value_type=schema.TextLine(),
         default=[
-            "large 768:768",
-            "preview 400:400",
-            "mini 200:200",
-            "thumb 128:128",
-            "tile 64:64",
-            "icon 32:32",
-            "listing 16:16"],
+            u"large 768:768",
+            u"preview 400:400",
+            u"mini 200:200",
+            u"thumb 128:128",
+            u"tile 64:64",
+            u"icon 32:32",
+            u"listing 16:16"],
         missing_value=[],
         required=False,
     )
diff --git a/Products/CMFPlone/tests/testIImagingSchema.py b/Products/CMFPlone/tests/testIImagingSchema.py
new file mode 100644
index 0000000..7136194
--- /dev/null
+++ b/Products/CMFPlone/tests/testIImagingSchema.py
@@ -0,0 +1,21 @@
+from plone.app.testing.bbb import PloneTestCase
+from Products.CMFPlone.interfaces.controlpanel import IImagingSchema
+from plone.registry.interfaces import IRegistry
+from zope.component import getUtility
+
+
+class TestImagingSchemaTool(PloneTestCase):
+
+  def test_AllowedSizes(self):
+      registry = getUtility(IRegistry)
+      imaging_settings = registry.forInterface(IImagingSchema, prefix='plone')
+
+      # Ensure we can save the defaults back to the registry
+      imaging_settings.allowed_sizes = imaging_settings.allowed_sizes
+
+      # Add a new image scale
+      sizes = imaging_settings.allowed_sizes
+      imaging_settings.allowed_sizes = sizes + [u"larger 800:800"]
+
+      # Set back to original
+      imaging_settings.allowed_sizes = sizes


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-11-04T12:32:28+01:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/4c1b92eb93b12e95ac0749992857f94474d6ca54

Merge pull request #1219 from plone/kuetrzi-fix-allowed-sizes

change IImagingSchema default allowed sizes to unicode

Files changed:
A Products/CMFPlone/tests/testIImagingSchema.py
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 96dc1fa..497c78e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -80,6 +80,10 @@ Fixes:
   roles.
   [maurits]
 
+- Default values for interfaces.controlpanel.IImagingSchema.allowed_sizes
+  should be unicode.
+  [kuetrzi]
+
 
 5.0 (2015-09-27)
 ----------------
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index 56f4c66..077cfbe 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -1437,13 +1437,13 @@ class IImagingSchema(Interface):
                       'The required format is &lt;name&gt; &lt;width&gt;:&lt;height&gt;.'),
         value_type=schema.TextLine(),
         default=[
-            "large 768:768",
-            "preview 400:400",
-            "mini 200:200",
-            "thumb 128:128",
-            "tile 64:64",
-            "icon 32:32",
-            "listing 16:16"],
+            u"large 768:768",
+            u"preview 400:400",
+            u"mini 200:200",
+            u"thumb 128:128",
+            u"tile 64:64",
+            u"icon 32:32",
+            u"listing 16:16"],
         missing_value=[],
         required=False,
     )
diff --git a/Products/CMFPlone/tests/testIImagingSchema.py b/Products/CMFPlone/tests/testIImagingSchema.py
new file mode 100644
index 0000000..7136194
--- /dev/null
+++ b/Products/CMFPlone/tests/testIImagingSchema.py
@@ -0,0 +1,21 @@
+from plone.app.testing.bbb import PloneTestCase
+from Products.CMFPlone.interfaces.controlpanel import IImagingSchema
+from plone.registry.interfaces import IRegistry
+from zope.component import getUtility
+
+
+class TestImagingSchemaTool(PloneTestCase):
+
+  def test_AllowedSizes(self):
+      registry = getUtility(IRegistry)
+      imaging_settings = registry.forInterface(IImagingSchema, prefix='plone')
+
+      # Ensure we can save the defaults back to the registry
+      imaging_settings.allowed_sizes = imaging_settings.allowed_sizes
+
+      # Add a new image scale
+      sizes = imaging_settings.allowed_sizes
+      imaging_settings.allowed_sizes = sizes + [u"larger 800:800"]
+
+      # Set back to original
+      imaging_settings.allowed_sizes = sizes


