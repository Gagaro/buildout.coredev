Repository: plone.app.iterate
Branch: refs/heads/master
Date: 2015-06-08T07:10:12Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/aa8df9dee699f1c62adcc19411bb196e71f1347e

don't remove acquisition on object for getToolByName call

Files changed:
M CHANGES.rst
M plone/app/iterate/subscribers/workflow.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4789d6f..15c8459 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 3.0.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Don't remove aquisition on object for getToolByName call
+  [tomgross]
 
 
 3.0.1 (2015-03-12)
diff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py
index 4c07065..e0281fb 100644
--- a/plone/app/iterate/subscribers/workflow.py
+++ b/plone/app/iterate/subscribers/workflow.py
@@ -38,7 +38,7 @@
 
 def handleCheckout( event ):
     # defer to setting
-    properties = getToolByName(aq_base(event.object), 'portal_properties')
+    properties = getToolByName(event.object, 'portal_properties')
     enabled = properties.site_properties.getProperty('enable_checkout_workflow')
     if not enabled:
         return


Repository: plone.app.iterate
Branch: refs/heads/master
Date: 2015-06-08T11:31:47Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.iterate/commit/1e06629864ffc7aaaeae54e5550499f4fcfd04c4

use aq_inner to remove potentially double wrapped stuff

Files changed:
M plone/app/iterate/subscribers/workflow.py

diff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py
index e0281fb..eb8313f 100644
--- a/plone/app/iterate/subscribers/workflow.py
+++ b/plone/app/iterate/subscribers/workflow.py
@@ -26,7 +26,7 @@
 
 """
 
-from Acquisition import aq_base
+from Acquisition import aq_base, aq_inner
 from Products.CMFCore.utils import getToolByName
 from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import WorkflowPolicyConfig
 from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import WorkflowPolicyConfig_id
@@ -38,7 +38,7 @@
 
 def handleCheckout( event ):
     # defer to setting
-    properties = getToolByName(event.object, 'portal_properties')
+    properties = getToolByName(aq_inner(event.object), 'portal_properties')
     enabled = properties.site_properties.getProperty('enable_checkout_workflow')
     if not enabled:
         return


Repository: plone.app.iterate
Branch: refs/heads/master
Date: 2015-06-08T18:09:44+02:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/plone.app.iterate/commit/cd49f57064c36dec333788d6956dd004bdfc0d8e

Merge pull request #14 from plone/tomgross-fixgettool

don't remove acquisition on object for getToolByName call

Files changed:
M CHANGES.rst
M plone/app/iterate/subscribers/workflow.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4789d6f..15c8459 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 3.0.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Don't remove aquisition on object for getToolByName call
+  [tomgross]
 
 
 3.0.1 (2015-03-12)
diff --git a/plone/app/iterate/subscribers/workflow.py b/plone/app/iterate/subscribers/workflow.py
index 4c07065..eb8313f 100644
--- a/plone/app/iterate/subscribers/workflow.py
+++ b/plone/app/iterate/subscribers/workflow.py
@@ -26,7 +26,7 @@
 
 """
 
-from Acquisition import aq_base
+from Acquisition import aq_base, aq_inner
 from Products.CMFCore.utils import getToolByName
 from Products.CMFPlacefulWorkflow.WorkflowPolicyConfig import WorkflowPolicyConfig
 from Products.CMFPlacefulWorkflow.PlacefulWorkflowTool import WorkflowPolicyConfig_id
@@ -38,7 +38,7 @@
 
 def handleCheckout( event ):
     # defer to setting
-    properties = getToolByName(aq_base(event.object), 'portal_properties')
+    properties = getToolByName(aq_inner(event.object), 'portal_properties')
     enabled = properties.site_properties.getProperty('enable_checkout_workflow')
     if not enabled:
         return


