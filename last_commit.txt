Repository: mockup
Branch: refs/heads/master
Date: 2015-03-26T08:24:45-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/081136c60c9cc82160761013b4208c7f309fac34

update related items tree widget integration to have a bit better
  user interaction. Automatically open folder nodes and implement double click

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.modal.less
M mockup/patterns/relateditems/pattern.js
M mockup/patterns/relateditems/pattern.relateditems.less
M mockup/patterns/tree/pattern.tree.less

diff --git a/CHANGES.rst b/CHANGES.rst
index 960bc1a..d38d5b3 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,11 +1,21 @@
 Changelog
 =========
 
-2.0.1 (unreleased)
+2.0.2 (unreleased)
 ------------------
 
-- be able to use tinymce plone plugins without image upload part
+- update related items tree widget integration to have a bit better
+  user interaction. Automatically open folder nodes and implement double click
+  [vangheem]
+
+- fix rendering issue with tinymce link/image overlay and tree selector
+  [vangheem]
 
+2.0.1 (2015-03-25)
+------------------
+
+- be able to use tinymce plone plugins without image upload part
+  [vangheem]
 
 2.0.0 (2015-03-17)
 ------------------
diff --git a/mockup/patterns/modal/pattern.modal.less b/mockup/patterns/modal/pattern.modal.less
index 1ac1589..8c21619 100644
--- a/mockup/patterns/modal/pattern.modal.less
+++ b/mockup/patterns/modal/pattern.modal.less
@@ -68,7 +68,12 @@ transition: opacity .5s linear;
     margin: 30px auto;
   }
 }
-.plone-modal-content {  background: #fff; overflow: hidden;}
+.plone-modal-content {
+  background: #fff;
+  /* XXX this is necessary for some content inside modals
+     to behave properly */
+  overflow: inherit;
+}
 .plone-modal-body {padding: 15px; position: relative;}
 .plone-modal-footer { text-align: right; border-top: 1px solid #e5e5e5; padding: 15px;}
 
diff --git a/mockup/patterns/relateditems/pattern.js b/mockup/patterns/relateditems/pattern.js
index 45b9b9e..c401c28 100644
--- a/mockup/patterns/relateditems/pattern.js
+++ b/mockup/patterns/relateditems/pattern.js
@@ -239,11 +239,13 @@ define([
         dataFilter: function(data) {
           var nodes = [];
           _.each(data.results, function(item) {
-            nodes.push({
+            var node = {
               label: item.Title,
               id: item.UID,
-              path: item.path
-            });
+              path: item.path,
+              folder: self.options.folderTypes.indexOf(item.Type) !== -1
+            };
+            nodes.push(node);
           });
           return nodes;
         }
@@ -253,10 +255,19 @@ define([
         if (node && !node._loaded) {
           self.currentPath = node.path;
           selectedNode = node;
-          treePattern.$el.tree('loadDataFromUrl', self.treeQuery.getUrl(), node);
+          treePattern.$el.tree('loadDataFromUrl', self.treeQuery.getUrl(), node, function(){
+            treePattern.$el.tree('openNode', node);
+          });
           node._loaded = true;
         }
       });
+      treePattern.$el.bind('tree.dblclick', function(e){
+        if(e.node){
+          self.currentPath = e.node.path;
+          self.browseTo(self.currentPath);
+          $treeContainer.fadeOut();
+        }
+      });
       treePattern.$el.bind('tree.refresh', function() {
         /* the purpose of this is that when new data is loaded, the selected
          * node is cleared. This re-selects it as a user browses structure of site */
diff --git a/mockup/patterns/relateditems/pattern.relateditems.less b/mockup/patterns/relateditems/pattern.relateditems.less
index e46d025..f1f68f7 100644
--- a/mockup/patterns/relateditems/pattern.relateditems.less
+++ b/mockup/patterns/relateditems/pattern.relateditems.less
@@ -113,6 +113,8 @@
         top: 4px;
         display: none;
         z-index: 10000;
+        min-width: 350px;
+        margin-top: 10px;
 
         .pat-tree {
             max-height: 400px;
diff --git a/mockup/patterns/tree/pattern.tree.less b/mockup/patterns/tree/pattern.tree.less
index 6947e29..8f42efd 100644
--- a/mockup/patterns/tree/pattern.tree.less
+++ b/mockup/patterns/tree/pattern.tree.less
@@ -1,3 +1,3 @@
 /* (inline) forces includes this file without processing it.
  * Necessary because of the IE hack in there, which causes ParseError. */
-@import (inline) "@{bowerPath}/jqtree/jqtree.css";
+@import (inline) "@{bowerPath}/jqtree/jqtree.css";
\ No newline at end of file


