Repository: plone.app.users
Branch: refs/heads/1.2.x
Date: 2015-05-18T19:22:47+03:00
Author: Alin Voinea (avoinea) <alin@eaudeweb.ro>
Commit: https://github.com/plone/plone.app.users/commit/c63a89ca31fdaf4fc22c6678a59487a6076bcbcc

Refs #33 - Fix "Add new user" form when there are too many groups.

Files changed:
M CHANGES.rst
M plone/app/users/browser/register.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 04e7878..5046c30 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 1.2.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed "Add new user" form when there are too many groups.
+  Fixes https://github.com/plone/plone.app.users/issues/33
+  [avoinea]
 
 
 1.2.1 (2014-10-21)
diff --git a/plone/app/users/browser/register.py b/plone/app/users/browser/register.py
index fe955c9..c446cd6 100644
--- a/plone/app/users/browser/register.py
+++ b/plone/app/users/browser/register.py
@@ -603,10 +603,15 @@ def form_fields(self):
             else:
                 defaultFields['mail_me'].field.default = False
 
-        # Append the manager-focused fields
-        allFields = defaultFields + form.Fields(IAddUserSchema)
-
-        allFields['groups'].custom_widget = MultiCheckBoxVocabularyWidget
+        portal_props = getToolByName(self.context, 'portal_properties')
+        props = portal_props.site_properties
+        many_groups = props.getProperty('many_groups', False)
+        if not many_groups:
+            # Append the manager-focused fields
+            allFields = defaultFields + form.Fields(IAddUserSchema)
+            allFields['groups'].custom_widget = MultiCheckBoxVocabularyWidget
+        else:
+            allFields = defaultFields
 
         return allFields
 


Repository: plone.app.users
Branch: refs/heads/1.2.x
Date: 2015-05-18T18:34:46+02:00
Author: Alin Voinea (avoinea) <alin@eaudeweb.ro>
Commit: https://github.com/plone/plone.app.users/commit/fb9109d5b5b36a62a00e41b0fb3746f87ff7f755

Merge pull request #40 from eea/1.2.x

Refs #33 - Fix "Add new user" form when there are too many groups.

Files changed:
M CHANGES.rst
M plone/app/users/browser/register.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 04e7878..5046c30 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 1.2.2 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed "Add new user" form when there are too many groups.
+  Fixes https://github.com/plone/plone.app.users/issues/33
+  [avoinea]
 
 
 1.2.1 (2014-10-21)
diff --git a/plone/app/users/browser/register.py b/plone/app/users/browser/register.py
index fe955c9..c446cd6 100644
--- a/plone/app/users/browser/register.py
+++ b/plone/app/users/browser/register.py
@@ -603,10 +603,15 @@ def form_fields(self):
             else:
                 defaultFields['mail_me'].field.default = False
 
-        # Append the manager-focused fields
-        allFields = defaultFields + form.Fields(IAddUserSchema)
-
-        allFields['groups'].custom_widget = MultiCheckBoxVocabularyWidget
+        portal_props = getToolByName(self.context, 'portal_properties')
+        props = portal_props.site_properties
+        many_groups = props.getProperty('many_groups', False)
+        if not many_groups:
+            # Append the manager-focused fields
+            allFields = defaultFields + form.Fields(IAddUserSchema)
+            allFields['groups'].custom_widget = MultiCheckBoxVocabularyWidget
+        else:
+            allFields = defaultFields
 
         return allFields
 


