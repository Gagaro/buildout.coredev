Repository: plone.app.multilingual


Branch: refs/heads/master
Date: 2015-09-14T18:09:21+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.multilingual/commit/a0fd7558297755fa45c0638f1eef7f79e2bfa977

Fix migration-view

Files changed:
M CHANGES.rst
M src/plone/app/multilingual/browser/templates/migration.pt

diff --git a/CHANGES.rst b/CHANGES.rst
index 169b249..599e948 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 3.0.10 (unreleased)
 -------------------
 
+- Fix migration-view.
+  [pbauer]
+
 - Fix translation-map.
   Fixes https://github.com/plone/plone.app.multilingual/issues/175
   [pbauer]
diff --git a/src/plone/app/multilingual/browser/templates/migration.pt b/src/plone/app/multilingual/browser/templates/migration.pt
index d642c80..003b7f3 100644
--- a/src/plone/app/multilingual/browser/templates/migration.pt
+++ b/src/plone/app/multilingual/browser/templates/migration.pt
@@ -8,97 +8,93 @@
 
 <body>
 
-<div metal:fill-slot="prefs_configlet_content">
-
-<script type="text/javascript">
-(function($) {
-
-    $().ready(function() {
-        $('#lp-migration-relocate-content').submit(function () {
-          var blacklist = $('textarea#blacklist')[0].value;
-          $('html, body').animate({
-              scrollTop: $('.results').offset().top
-          }, 2000);
-          var auth_key = $(this).find('input[name="_authenticator"]').val();
-          $('.results').load('@@relocate-content?_authenticator=' +  auth_key + ' #results',
-                              {'blacklist': blacklist.split('\n')},
-                              {dataType: 'json'}
-          );
-          return false;
-        });
-
-        $('#lp-migration-transfer-catalog').submit(function () {
-          $('html, body').animate({
-              scrollTop: $('.results').offset().top
-          }, 2000);
-          var auth_key = $(this).find('input[name="_authenticator"]').val();
-          $('.results').load('@@transfer-lp-catalog?_authenticator=' +  auth_key + ' #results');
-          return false;
-        });
-
-        $('#lp-migration-after-migration').submit(function () {
-          $('html, body').animate({
-              scrollTop: $('.results').offset().top
-          }, 2000);
-          var auth_key = $(this).find('input[name="_authenticator"]').val();
-          $('.results').load('@@after-migration-cleanup?_authenticator=' +  auth_key + ' #results');
-          return false;
-        });
-
-       $('#lp-migration-reindex-content').submit(function () {
-          $('html, body').animate({
-              scrollTop: $('.results').offset().top
-          }, 2000);
-          var auth_key = $(this).find('input[name="_authenticator"]').val();
-          $('.results').load('@@reindex-language-index?_authenticator=' +  auth_key + ' #results');
-          return false;
-        });
-    });
-
-})(jQuery);
-</script>
-
-  <div id="region-content" class="documentEditable">
-
-    <div id="edit-bar" i18n:domain="plone.app.multilingual">
-        <ul class="contentViews" id="content-views">
-          <li>
-            <a href=""
-               tal:attributes="href string:${portal_url}/@@language-controlpanel"
-               i18n:translate="label_general">General</a>
-          </li>
-          <li>
-            <a href=""
-               tal:attributes="href string:${portal_url}/@@multilingual-map"
-               i18n:translate="label_translation_map">Translation Map</a>
-          </li>
-          <li class="selected">
-            <a href=""
-               tal:attributes="href string:${portal_url}/@@lp-migration"
-               i18n:translate="label_migration">Migration</a>
-          </li>
-        </ul>
-        <div class="contentActions">&nbsp;</div>
-    </div>
-
-    <div class="documentContent" id="content">
-      <a name="documentContent"></a>
+<metal:block metal:fill-slot="prefs_configlet_main">
+
+  <script type="text/javascript">
+  (function($) {
+
+      $().ready(function() {
+          $('#lp-migration-relocate-content').submit(function () {
+            var blacklist = $('textarea#blacklist')[0].value;
+            $('html, body').animate({
+                scrollTop: $('.results').offset().top
+            }, 2000);
+            var auth_key = $(this).find('input[name="_authenticator"]').val();
+            $('.results').load('@@relocate-content?_authenticator=' +  auth_key + ' #results',
+                                {'blacklist': blacklist.split('\n')},
+                                {dataType: 'json'}
+            );
+            return false;
+          });
+
+          $('#lp-migration-transfer-catalog').submit(function () {
+            $('html, body').animate({
+                scrollTop: $('.results').offset().top
+            }, 2000);
+            var auth_key = $(this).find('input[name="_authenticator"]').val();
+            $('.results').load('@@transfer-lp-catalog?_authenticator=' +  auth_key + ' #results');
+            return false;
+          });
+
+          $('#lp-migration-after-migration').submit(function () {
+            $('html, body').animate({
+                scrollTop: $('.results').offset().top
+            }, 2000);
+            var auth_key = $(this).find('input[name="_authenticator"]').val();
+            $('.results').load('@@after-migration-cleanup?_authenticator=' +  auth_key + ' #results');
+            return false;
+          });
+
+         $('#lp-migration-reindex-content').submit(function () {
+            $('html, body').animate({
+                scrollTop: $('.results').offset().top
+            }, 2000);
+            var auth_key = $(this).find('input[name="_authenticator"]').val();
+            $('.results').load('@@reindex-language-index?_authenticator=' +  auth_key + ' #results');
+            return false;
+          });
+      });
+
+  })(jQuery);
+  </script>
+
+  <style>
+  .results {
+    border: 1px solid #ccc;
+    padding: 10px;
+    background-color: #eee;
+  }
+
+  </style>
+
+        <div i18n:domain="plone.app.multilingual">
+            <ul>
+              <li>
+                <a href=""
+                   tal:attributes="href string:${portal_url}/@@language-controlpanel"
+                   i18n:translate="label_general">General</a>
+              </li>
+              <li>
+                <a href=""
+                   tal:attributes="href string:${portal_url}/@@multilingual-map"
+                   i18n:translate="label_translation_map">Translation Map</a>
+              </li>
+              <li class="selected">
+                <a href=""
+                   tal:attributes="href string:${portal_url}/@@lp-migration"
+                   i18n:translate="label_migration">Migration</a>
+              </li>
+            </ul>
+        </div>
+
+        <h1 class="documentFirstHeading"
+            i18n:translate="heading_migration">Products.LinguaPlone Migration</h1>
 
         <div metal:use-macro="context/global_statusmessage/macros/portal_message">
         Portal status message
         </div>
 
-        <div class="configlet">
-
-            <h1 class="documentFirstHeading"
-                i18n:translate="heading_migration">Products.LinguaPlone Migration</h1>
-
-            <a href=""
-                class="link-parent"
-                tal:attributes="href string:${portal_url}/plone_control_panel"
-                i18n:translate="label_up_to_plone_setup">
-                    Up to Site Setup
-            </a>
+        <div id="content-core">
 
             <p i18n:translate="description_migrate">
 
@@ -271,9 +267,8 @@
               </p>
             </div>
         </div>
-      </div>
-    </div>
-</div>
+
+</metal:block>
 
 </body>
 </html>


