Repository: plone.app.testing
Branch: refs/heads/master
Date: 2015-04-13T18:19:26+02:00
Author: Patrick Gerken (do3cc) <do3cc@patrick-gerken.de>
Commit: https://github.com/plone/plone.app.testing/commit/d57a09966865809b27f6e3a1b4a1fdd851112a2a

Revert "Revert "Adding notification to make browser layers work""

This reverts commit da795e587641ffeb7e7d2183afa0786d62eb2214.

Files changed:
M plone/app/testing/layers.py

diff --git a/plone/app/testing/layers.py b/plone/app/testing/layers.py
index c4ce493..1bd69ae 100644
--- a/plone/app/testing/layers.py
+++ b/plone/app/testing/layers.py
@@ -4,6 +4,10 @@
 from plone.testing import Layer
 from plone.testing import zodb, zca, z2
 
+from zope.event import notify
+from zope.traversing.interfaces import BeforeTraverseEvent
+
+
 from plone.app.testing.interfaces import (
     PLONE_SITE_ID,
     PLONE_SITE_TITLE,
@@ -285,6 +289,8 @@ def setUpEnvironment(self, portal):
         # Reset skin data
         portal.clearCurrentSkin()
         portal.setupCurrentSkin(portal.REQUEST)
+        notify(BeforeTraverseEvent(portal, portal.REQUEST))
+
 
         # Pseudo-login as the test user
         from plone.app.testing import helpers


