Repository: plone.app.customerize


Branch: refs/heads/master
Date: 2015-09-17T10:00:34Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.customerize/commit/9f3fcd0a43496c0884f3afbd31ce0102f8c35be2

use layer instead of test_class for doctests

Files changed:
M plone/app/customerize/tests/testBrowserLayers.txt
M plone/app/customerize/tests/testCustomizeView.txt
M plone/app/customerize/tests/testDocTests.py
M setup.py

diff --git a/plone/app/customerize/tests/testBrowserLayers.txt b/plone/app/customerize/tests/testBrowserLayers.txt
index 19a7998..7c914a2 100644
--- a/plone/app/customerize/tests/testBrowserLayers.txt
+++ b/plone/app/customerize/tests/testBrowserLayers.txt
@@ -12,9 +12,14 @@ product is installed, we cannot view the view, though:
   >>> IMyLayer in registered_layers()
   False
   >>> import transaction
+  >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD
+  >>> portal = layer['portal']
 
-  >>> browser = self.site_administrator_browser
+  >>> from plone.testing.z2 import Browser
+  >>> browser = Browser(layer['app'])
   >>> browser.handleErrors = False
+  >>> browser.addHeader('Authorization', 'Basic %s:%s' % (
+  ...     SITE_OWNER_NAME, SITE_OWNER_PASSWORD))
   >>> browser.open('http://nohost/plone/@@layer-test-view')
   Traceback (most recent call last):
   ...
@@ -75,7 +80,7 @@ GenericSetup profile provided for testing, after which the standard viewlet
 should show up on the home page:
 
   >>> from Products.CMFCore.utils import getToolByName
-  >>> portal_setup = getToolByName(self.portal, 'portal_setup')
+  >>> portal_setup = getToolByName(portal, 'portal_setup')
   >>> _ = portal_setup.runAllImportStepsFromProfile('profile-plone.app.customerize.tests:testing')
   >>> transaction.commit()
 
diff --git a/plone/app/customerize/tests/testCustomizeView.txt b/plone/app/customerize/tests/testCustomizeView.txt
index 490a384..4f476be 100644
--- a/plone/app/customerize/tests/testCustomizeView.txt
+++ b/plone/app/customerize/tests/testCustomizeView.txt
@@ -1,8 +1,14 @@
 This tests a roundtrip of customizing, changing and deleting a template-based
 view via the ZMI:
 
-  >>> browser = self.site_administrator_browser
-  >>> browser.handleErrors = True
+  >>> import transaction
+  >>> portal = layer['portal']
+
+  >>> from plone.testing.z2 import Browser
+  >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD
+  >>> browser = Browser(layer['app'])
+  >>> browser.addHeader('Authorization', 'Basic %s:%s' % (
+  ...     SITE_OWNER_NAME, SITE_OWNER_PASSWORD))
 
 First we go directly to the portal tool used to manage the view
 customizations and check the overview of all registered views:
diff --git a/plone/app/customerize/tests/testDocTests.py b/plone/app/customerize/tests/testDocTests.py
index 8176fa1..bc67b86 100644
--- a/plone/app/customerize/tests/testDocTests.py
+++ b/plone/app/customerize/tests/testDocTests.py
@@ -1,44 +1,18 @@
 import doctest
-from unittest2 import TestCase
-from unittest2 import TestSuite
+from unittest import TestSuite
 
-from Testing.ZopeTestCase import FunctionalDocFileSuite
-
-from plone.testing.z2 import Browser
+from plone.testing import layered
 
 from plone.app.customerize.testing import \
     PLONE_APP_CUSTOMERIZE_FUNCTIONAL_TESTING
 
-from Testing.ZopeTestCase import Functional
-
-
-class CustomerizeFunctionalTestCase(TestCase, Functional):
-
-    layer = PLONE_APP_CUSTOMERIZE_FUNCTIONAL_TESTING
-
-    def setUp(self):
-        self.app = self.layer['app']
-        self.portal = self.layer['portal']
-        self.app.acl_users.userFolderAddUser('app', 'secret', ['Manager'], [])
-
-        import transaction
-        transaction.commit()
-
-        self.site_administrator_browser = Browser(self.app)
-        self.site_administrator_browser.handleErrors = False
-        self.site_administrator_browser.addHeader(
-            'Authorization',
-            'Basic %s:%s' % ('app', 'secret')
-        )
-
 
 def test_suite():
     suite = TestSuite()
     OPTIONFLAGS = (doctest.ELLIPSIS | doctest.NORMALIZE_WHITESPACE)
     for testfile in ('testBrowserLayers.txt', 'testCustomizeView.txt'):
-        suite.addTest(FunctionalDocFileSuite(testfile,
+        suite.addTest(layered(doctest.DocFileSuite(testfile,
                                 optionflags=OPTIONFLAGS,
-                                package="plone.app.customerize.tests",
-                                test_class=CustomerizeFunctionalTestCase),
-                     )
+                                package="plone.app.customerize.tests"),
+                     layer=PLONE_APP_CUSTOMERIZE_FUNCTIONAL_TESTING))
     return suite
diff --git a/setup.py b/setup.py
index bb8734d..fc1fbea 100644
--- a/setup.py
+++ b/setup.py
@@ -11,12 +11,14 @@
         'Development Status :: 5 - Production/Stable',
         'Environment :: Web Environment',
         'Framework :: Plone',
+        'Framework :: Plone :: 5.0',
         'Framework :: Zope2',
         'Intended Audience :: Other Audience',
         'Intended Audience :: System Administrators',
         'License :: OSI Approved :: GNU General Public License (GPL)',
         'Operating System :: OS Independent',
         'Programming Language :: Python',
+        'Programming Language :: Python :: 2.7',
         'Topic :: Internet :: WWW/HTTP :: Site Management',
       ],
       keywords='customerize plone views page templates zmi',


Repository: plone.app.customerize


Branch: refs/heads/master
Date: 2015-09-20T18:17:53+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/plone.app.customerize/commit/0739d63ebaeed91d475789c1914f935e5d06b93e

added changelog

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index ab1937e..ac11139 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -5,7 +5,8 @@ Changelog
 1.3.3 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Use layers for doctest
+  [tomgross]
 
 
 1.3.2 (2015-05-11)


Repository: plone.app.customerize


Branch: refs/heads/master
Date: 2015-09-21T09:24:08+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.customerize/commit/0acf91332b30b93b9d0f307b14845572b0fde6bb

Merge pull request #7 from plone/tomgross-doctestlayer

use layer instead of test_class for doctests

Files changed:
M CHANGES.rst
M plone/app/customerize/tests/testBrowserLayers.txt
M plone/app/customerize/tests/testCustomizeView.txt
M plone/app/customerize/tests/testDocTests.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ab1937e..ac11139 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -5,7 +5,8 @@ Changelog
 1.3.3 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Use layers for doctest
+  [tomgross]
 
 
 1.3.2 (2015-05-11)
diff --git a/plone/app/customerize/tests/testBrowserLayers.txt b/plone/app/customerize/tests/testBrowserLayers.txt
index 19a7998..7c914a2 100644
--- a/plone/app/customerize/tests/testBrowserLayers.txt
+++ b/plone/app/customerize/tests/testBrowserLayers.txt
@@ -12,9 +12,14 @@ product is installed, we cannot view the view, though:
   >>> IMyLayer in registered_layers()
   False
   >>> import transaction
+  >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD
+  >>> portal = layer['portal']
 
-  >>> browser = self.site_administrator_browser
+  >>> from plone.testing.z2 import Browser
+  >>> browser = Browser(layer['app'])
   >>> browser.handleErrors = False
+  >>> browser.addHeader('Authorization', 'Basic %s:%s' % (
+  ...     SITE_OWNER_NAME, SITE_OWNER_PASSWORD))
   >>> browser.open('http://nohost/plone/@@layer-test-view')
   Traceback (most recent call last):
   ...
@@ -75,7 +80,7 @@ GenericSetup profile provided for testing, after which the standard viewlet
 should show up on the home page:
 
   >>> from Products.CMFCore.utils import getToolByName
-  >>> portal_setup = getToolByName(self.portal, 'portal_setup')
+  >>> portal_setup = getToolByName(portal, 'portal_setup')
   >>> _ = portal_setup.runAllImportStepsFromProfile('profile-plone.app.customerize.tests:testing')
   >>> transaction.commit()
 
diff --git a/plone/app/customerize/tests/testCustomizeView.txt b/plone/app/customerize/tests/testCustomizeView.txt
index 490a384..4f476be 100644
--- a/plone/app/customerize/tests/testCustomizeView.txt
+++ b/plone/app/customerize/tests/testCustomizeView.txt
@@ -1,8 +1,14 @@
 This tests a roundtrip of customizing, changing and deleting a template-based
 view via the ZMI:
 
-  >>> browser = self.site_administrator_browser
-  >>> browser.handleErrors = True
+  >>> import transaction
+  >>> portal = layer['portal']
+
+  >>> from plone.testing.z2 import Browser
+  >>> from plone.app.testing import SITE_OWNER_NAME, SITE_OWNER_PASSWORD
+  >>> browser = Browser(layer['app'])
+  >>> browser.addHeader('Authorization', 'Basic %s:%s' % (
+  ...     SITE_OWNER_NAME, SITE_OWNER_PASSWORD))
 
 First we go directly to the portal tool used to manage the view
 customizations and check the overview of all registered views:
diff --git a/plone/app/customerize/tests/testDocTests.py b/plone/app/customerize/tests/testDocTests.py
index 8176fa1..bc67b86 100644
--- a/plone/app/customerize/tests/testDocTests.py
+++ b/plone/app/customerize/tests/testDocTests.py
@@ -1,44 +1,18 @@
 import doctest
-from unittest2 import TestCase
-from unittest2 import TestSuite
+from unittest import TestSuite
 
-from Testing.ZopeTestCase import FunctionalDocFileSuite
-
-from plone.testing.z2 import Browser
+from plone.testing import layered
 
 from plone.app.customerize.testing import \
     PLONE_APP_CUSTOMERIZE_FUNCTIONAL_TESTING
 
-from Testing.ZopeTestCase import Functional
-
-
-class CustomerizeFunctionalTestCase(TestCase, Functional):
-
-    layer = PLONE_APP_CUSTOMERIZE_FUNCTIONAL_TESTING
-
-    def setUp(self):
-        self.app = self.layer['app']
-        self.portal = self.layer['portal']
-        self.app.acl_users.userFolderAddUser('app', 'secret', ['Manager'], [])
-
-        import transaction
-        transaction.commit()
-
-        self.site_administrator_browser = Browser(self.app)
-        self.site_administrator_browser.handleErrors = False
-        self.site_administrator_browser.addHeader(
-            'Authorization',
-            'Basic %s:%s' % ('app', 'secret')
-        )
-
 
 def test_suite():
     suite = TestSuite()
     OPTIONFLAGS = (doctest.ELLIPSIS | doctest.NORMALIZE_WHITESPACE)
     for testfile in ('testBrowserLayers.txt', 'testCustomizeView.txt'):
-        suite.addTest(FunctionalDocFileSuite(testfile,
+        suite.addTest(layered(doctest.DocFileSuite(testfile,
                                 optionflags=OPTIONFLAGS,
-                                package="plone.app.customerize.tests",
-                                test_class=CustomerizeFunctionalTestCase),
-                     )
+                                package="plone.app.customerize.tests"),
+                     layer=PLONE_APP_CUSTOMERIZE_FUNCTIONAL_TESTING))
     return suite
diff --git a/setup.py b/setup.py
index bb8734d..fc1fbea 100644
--- a/setup.py
+++ b/setup.py
@@ -11,12 +11,14 @@
         'Development Status :: 5 - Production/Stable',
         'Environment :: Web Environment',
         'Framework :: Plone',
+        'Framework :: Plone :: 5.0',
         'Framework :: Zope2',
         'Intended Audience :: Other Audience',
         'Intended Audience :: System Administrators',
         'License :: OSI Approved :: GNU General Public License (GPL)',
         'Operating System :: OS Independent',
         'Programming Language :: Python',
+        'Programming Language :: Python :: 2.7',
         'Topic :: Internet :: WWW/HTTP :: Site Management',
       ],
       keywords='customerize plone views page templates zmi',


