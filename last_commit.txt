Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-03-07T11:10:24+02:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.theming/commit/68034654d3201915e4da77ab95fc81178c1947a5

Fix transform to not affect the result when theming is disabled

Files changed:
M docs/HISTORY.rst
M src/plone/app/theming/transform.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index e3c0460..9d5aa6b 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -4,6 +4,9 @@ Changelog
 1.3.0 (unreleased)
 ------------------
 
+- Fix transform to not affect the result when theming is disabled
+  [datakurre]
+
 - Integrate thememapper mockup pattern and fix theming control panel
   to be more usable
   [ebrehault]
diff --git a/src/plone/app/theming/transform.py b/src/plone/app/theming/transform.py
index 44c480c..bf5b933 100644
--- a/src/plone/app/theming/transform.py
+++ b/src/plone/app/theming/transform.py
@@ -149,6 +149,14 @@ def transformUnicode(self, result, encoding):
     def transformIterable(self, result, encoding):
         """Apply the transform if required
         """
+        # Obtain settings. Do nothing if not found
+        settings = self.getSettings()
+
+        if settings is None:
+            return None
+
+        if not isThemeEnabled(self.request, settings):
+            return None
 
         result = self.parseTree(result)
         if result is None:
@@ -161,7 +169,6 @@ def transformIterable(self, result, encoding):
         try:
             etree.clear_error_log()
 
-            settings = self.getSettings()
             if settings.doctype:
                 result.doctype = settings.doctype
                 if not result.doctype.endswith('\n'):


Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-03-10T10:01:22+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.theming/commit/100dba4bc937fbf5196f901746a3202f5a571748

Merge pull request #37 from plone/datakurre-fix-side-effects-when-disabled

Fix transform to not affect the result when theming is disabled

Files changed:
M docs/HISTORY.rst
M src/plone/app/theming/transform.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index e3c0460..9d5aa6b 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -4,6 +4,9 @@ Changelog
 1.3.0 (unreleased)
 ------------------
 
+- Fix transform to not affect the result when theming is disabled
+  [datakurre]
+
 - Integrate thememapper mockup pattern and fix theming control panel
   to be more usable
   [ebrehault]
diff --git a/src/plone/app/theming/transform.py b/src/plone/app/theming/transform.py
index 44c480c..bf5b933 100644
--- a/src/plone/app/theming/transform.py
+++ b/src/plone/app/theming/transform.py
@@ -149,6 +149,14 @@ def transformUnicode(self, result, encoding):
     def transformIterable(self, result, encoding):
         """Apply the transform if required
         """
+        # Obtain settings. Do nothing if not found
+        settings = self.getSettings()
+
+        if settings is None:
+            return None
+
+        if not isThemeEnabled(self.request, settings):
+            return None
 
         result = self.parseTree(result)
         if result is None:
@@ -161,7 +169,6 @@ def transformIterable(self, result, encoding):
         try:
             etree.clear_error_log()
 
-            settings = self.getSettings()
             if settings.doctype:
                 result.doctype = settings.doctype
                 if not result.doctype.endswith('\n'):


