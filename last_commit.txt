Repository: mockup
Branch: refs/heads/master
Date: 2015-06-04T21:51:41-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/f5bdbdede6e3520818e7f5367a4602defc8a4bed

be able to add new file to resource registry overrides

Files changed:
M CHANGES.rst
M mockup/patterns/resourceregistry/js/less.js
M mockup/patterns/resourceregistry/js/overrides.js
M mockup/patterns/resourceregistry/js/patternoptions.js
M mockup/patterns/resourceregistry/js/registry.js
M mockup/patterns/resourceregistry/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index a8d935a..c5a1de6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- be able to add new file to resource registry overrides
+  [vangheem]
+
 - fix livesearch word wrapping issue
   [vangheem]
 
diff --git a/mockup/patterns/resourceregistry/js/less.js b/mockup/patterns/resourceregistry/js/less.js
index 2fa7865..be906f8 100644
--- a/mockup/patterns/resourceregistry/js/less.js
+++ b/mockup/patterns/resourceregistry/js/less.js
@@ -14,7 +14,7 @@ define([
       '<div class="clearfix">' +
         '<div class="btn-group pull-right">' +
           '<button class="plone-btn plone-btn-default add-variable"><%- _t("Add variable") %></button>' +
-          '<button class="plone-btn plone-btn-default save"><%- _t("Save") %></button>' +
+          '<button class="plone-btn plone-btn-primary save"><%- _t("Save") %></button>' +
         '</div>' +
       '</div>' +
       '<div class="row clearfix">' +
diff --git a/mockup/patterns/resourceregistry/js/overrides.js b/mockup/patterns/resourceregistry/js/overrides.js
index e4d8973..f0fe6da 100644
--- a/mockup/patterns/resourceregistry/js/overrides.js
+++ b/mockup/patterns/resourceregistry/js/overrides.js
@@ -14,8 +14,14 @@ define([
     className: 'tab-pane overrides',
     editing: null,
     canSave: false,
+    newFile: false,
 
     template: _.template(
+      '<div class="clearfix">' +
+        '<div class="btn-group pull-right">' +
+          '<button class="plone-btn plone-btn-primary add-file"><%- _t("Add file") %></button> ' +
+        '</div>' +
+      '</div>' +
       '<form class="row">' +
         '<div class="col-md-12">' +
           '<p><%- _t("Only ++plone++ resources are available to override") %></p>' +
@@ -23,7 +29,7 @@ define([
         '</div>' +
       '</form>' +
       '<div class="row">' +
-        '<div class="col-md-12">' +
+        '<div class="col-md-12 edit-area">' +
           '<% if(view.editing){ %>' +
             '<p class="resource-name text-primary"><%- view.editing %></p> ' +
             '<div class="plone-btn-group">' +
@@ -36,9 +42,10 @@ define([
         '</div>' +
       '</div>'),
     events: {
-      'click button.plone-btn-danger': 'itemDeleted',
-      'click button.plone-btn-primary': 'itemSaved',
-      'click button.plone-btn-default': 'itemCancel'
+      'click .edit-area button.plone-btn-danger': 'itemDeleted',
+      'click .edit-area button.plone-btn-primary': 'itemSaved',
+      'click .edit-area button.plone-btn-default': 'itemCancel',
+      'click .plone-btn.add-file': 'addFile'
     },
 
     initialize: function(options){
@@ -50,6 +57,20 @@ define([
       return $.extend({}, { view: this }, this.options);
     },
 
+    addFile: function(){
+      var resource = window.prompt('Enter full path and filename', '++plone++static/' + _t('you-filename.js'));
+      if(resource.indexOf('++plone++static/') === -1){
+        window.alert(_t('Filename must start with ++plone++static/'));
+      }else{
+        if(this.options.data.overrides.indexOf(resource) === -1){
+          this.options.data.overrides.push(resource);
+        }
+        this.newFile = true;
+        this.editing = resource;
+        this.render();
+      }
+    },
+
     itemSaved: function(e){
       e.preventDefault();
       var that = this;
@@ -144,30 +165,40 @@ define([
         if(url[url.length - 1] !== '/'){
           url += '/';
         }
-        that.tabView.loading.show();
-        $.ajax({
-          // cache busting url
-          url: url + that.editing + '?' + utils.generateId(),
-          dataType: 'text'
-        }).done(function(data){
-          var $pre = $('<pre class="pat-texteditor" />');
-          $pre.text(data);
-          that.$editorContainer.empty().append($pre);
-          that.editor = new TextEditor($pre, {
-            width: $('.editor').width(),
-            height: 500
-          });
-          that.editor.setSyntax(that.editing);
-          that.tabView.loading.hide();
-          that.editor.editor.on('change', function(){
-            that.$el.find('.plone-btn-primary,.plone-btn-default').removeClass('disabled');
+        if(that.newFile){
+          that.showEditor('');
+          that.newFile = false;
+        }else{
+          that.tabView.loading.show();
+          $.ajax({
+            // cache busting url
+            url: url + that.editing + '?' + utils.generateId(),
+            dataType: 'text'
+          }).done(function(data){
+            that.showEditor(data);
+          }).fail(function(){
+            window.alert(_t('error loading resource for editing'));
+            that.tabView.loading.hide();
           });
-        }).fail(function(){
-          window.alert(_t('error loading resource for editing'));
-          that.tabView.loading.hide();
-        });
+        }
       }
-    }
+    },
+
+    showEditor: function(data){
+      var that = this;
+      var $pre = $('<pre class="pat-texteditor" />');
+      $pre.text(data);
+      that.$editorContainer.empty().append($pre);
+      that.editor = new TextEditor($pre, {
+        width: $('.editor').width(),
+        height: 500
+      });
+      that.editor.setSyntax(that.editing);
+      that.tabView.loading.hide();
+      that.editor.editor.on('change', function(){
+        that.$el.find('.plone-btn-primary,.plone-btn-default').removeClass('disabled');
+      });
+    }    
   });
 
   return OverridesView;
diff --git a/mockup/patterns/resourceregistry/js/patternoptions.js b/mockup/patterns/resourceregistry/js/patternoptions.js
index de297cf..d5321bd 100644
--- a/mockup/patterns/resourceregistry/js/patternoptions.js
+++ b/mockup/patterns/resourceregistry/js/patternoptions.js
@@ -14,7 +14,7 @@ define([
       '<div class="clearfix">' +
         '<div class="btn-group pull-right">' +
           '<button class="plone-btn plone-btn-default add-pattern"><%- _t("Add pattern") %></button>' +
-          '<button class="plone-btn plone-btn-default save"><%- _t("Save") %></button>' +
+          '<button class="plone-btn plone-btn-primary save"><%- _t("Save") %></button>' +
         '</div>' +
       '</div>' +
       '<div class="row clearfix">' +
diff --git a/mockup/patterns/resourceregistry/js/registry.js b/mockup/patterns/resourceregistry/js/registry.js
index 2dd1f7f..6138fe4 100644
--- a/mockup/patterns/resourceregistry/js/registry.js
+++ b/mockup/patterns/resourceregistry/js/registry.js
@@ -344,7 +344,7 @@ define([
     template: _.template(
       '<div class="clearfix">' +
         '<div class="plone-btn-group pull-right">' +
-          '<button class="plone-btn plone-btn-success save"><%- _t("Save") %></button>' +
+          '<button class="plone-btn plone-btn-primary save"><%- _t("Save") %></button>' +
           '<button class="plone-btn plone-btn-default cancel"><%- _t("Cancel") %></button>' +
         '</div>' +
         '<div class="plone-btn-group pull-right">' +
diff --git a/mockup/patterns/resourceregistry/pattern.js b/mockup/patterns/resourceregistry/pattern.js
index 288ce02..6489cf8 100644
--- a/mockup/patterns/resourceregistry/pattern.js
+++ b/mockup/patterns/resourceregistry/pattern.js
@@ -234,6 +234,7 @@ define([
     },
     init: function() {
       var self = this;
+      self.$el.empty();
       self.tabs = new TabView(self.options);
       self.$el.append(self.tabs.render().el);
     }


