Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T14:09:18+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/a5512ccf9572157c88a1ce68d1940937147da7e3

Add robot test for filter controlpanel that tests the combination of tags and attributes. Commented out because the functionality seems to broken.

Files changed:
M Products/CMFPlone/tests/robot/test_controlpanel_filter.robot

diff --git a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
index 8e22f63..601b60e 100644
--- a/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
+++ b/Products/CMFPlone/tests/robot/test_controlpanel_filter.robot
@@ -49,7 +49,12 @@ Scenario: Configure Filter Control Panel to strip out attributes
    When I add 'data-stripme' to the stripped attributes list
    Then the 'data-stripme' attribute is stripped when a document is saved
 
-#Scenario: Configure Filter Control Panel to strip out combinations
+Scenario: Configure Filter Control Panel to strip out combinations
+  Pass Execution  Functionality is broken. Maybe even in Plone 4.3?
+  Given a logged-in site administrator
+    and the filter control panel
+   When I add 'div h3' and 'data-foo' to the stripped out combinations
+   Then the 'data-foo' attribute of a 'div h3' combination is stripped when a document is saved
 
 Scenario: Configure Filter Control Panel to allow style attributes
   Given a logged-in site administrator
@@ -125,6 +130,14 @@ I add '${tag}' to the allowed style attributes
   Click Button  Save
   Wait until page contains  Changes saved
 
+I add '${tags}' and '${attributes}' to the stripped out combinations
+  Click Button  Add Stripped combinations
+  patterns are loaded
+  Input text  name=form.stripped_combinations.1.tags  ${tags}
+  Input text  name=form.stripped_combinations.1.attributes  ${attributes}
+  Click Button  Save
+  Wait until page contains  Changes saved
+
 
 # --- THEN -------------------------------------------------------------------
 
@@ -180,6 +193,18 @@ the 'foobar' class is filtered out when a document is saved
   XPath Should Match X Times  //*[@id='content-core']//h4  1  message=h4 tag should be present
   XPath Should Match X Times  //*[@id='content-core']//h4[@class='foobar']  0  message=class foobar should have been filtered out
 
+the 'data-foo' attribute of a 'div h3' combination is stripped when a document is saved
+  ${doc1_uid}=  Create content  id=doc1  title=Document 1  type=Document
+  Go To  ${PLONE_URL}/doc1/edit
+  patterns are loaded
+  Input RichText  <div><h3 data-foo="50">lorem ipsum</h3></div>
+  Click Button  Save
+  Wait until page contains  Changes saved
+  Page should contain  lorem ipsum
+  XPath Should Match X Times  //*[@id='content-core']//div/h3  1  message=h4 tag should be present
+  XPath Should Match X Times  //*[@id='content-core']//div/h3[@data-foo]  0  message=the data-foo attribute class should have been filtered out
+
+
 the 'display' style attribute is preserved when a document is saved
   ${doc1_uid}=  Create content  id=doc1  title=Document 1  type=Document
   Go To  ${PLONE_URL}/doc1/edit


