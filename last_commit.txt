Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2015-06-02T19:20:44+02:00
Author: Cillian de RÃ³iste (cillianderoiste) <deroiste@syslab.com>
Commit: https://github.com/plone/plone.app.robotframework/commit/d92f30300869a03eb878fc897c28a07a38c505cc

Add an extra argument to override watched file extensions

Also don't watch .pt files if the server is in debug mode.

Files changed:
M src/plone/app/robotframework/reload.py
M src/plone/app/robotframework/server.py

diff --git a/src/plone/app/robotframework/reload.py b/src/plone/app/robotframework/reload.py
index 143c59c..30b277b 100644
--- a/src/plone/app/robotframework/reload.py
+++ b/src/plone/app/robotframework/reload.py
@@ -19,14 +19,7 @@
 
 class Watcher(FileSystemEventHandler):
 
-    allowed_extensions = set(os.getenv('RELOAD_EXTENSIONS', (
-        'po',
-        'pt',
-        'py',
-        'xml',
-        'csv',
-        'zcml',
-    )))
+    allowed_extensions = set(('po', 'pt', 'py', 'xml', 'csv', 'zcml'))
 
     def __init__(self, paths, forkloop, minimum_wait=2.0):
         FileSystemEventHandler.__init__(self)
diff --git a/src/plone/app/robotframework/server.py b/src/plone/app/robotframework/server.py
index 6ed2eb5..4dc8608 100644
--- a/src/plone/app/robotframework/server.py
+++ b/src/plone/app/robotframework/server.py
@@ -61,7 +61,8 @@ def start(zope_layer_dotted_name):
 
 
 def start_reload(zope_layer_dotted_name, reload_paths=('src',),
-                 preload_layer_dotted_name='plone.app.testing.PLONE_FIXTURE'):
+                 preload_layer_dotted_name='plone.app.testing.PLONE_FIXTURE',
+                 extensions=None):
 
     print WAIT("Starting Zope 2 server")
 
@@ -69,7 +70,12 @@ def start_reload(zope_layer_dotted_name, reload_paths=('src',),
     zsl.start_zope_server(preload_layer_dotted_name)
 
     forkloop = ForkLoop()
-    Watcher(reload_paths, forkloop).start()
+    watcher = Watcher(reload_paths, forkloop)
+    if extensions:
+        watcher.allowed_extensions = extensions
+    elif HAS_DEBUG_MODE:
+        watcher.allowed_extensions.remove('pt')
+    watcher.start()
     forkloop.start()
 
     if forkloop.exit:
@@ -149,6 +155,9 @@ def server():
     if HAS_RELOAD:
         parser.add_argument('--reload-path', '-p', dest='reload_paths',
                             action='append')
+        parser.add_argument('--reload-extensions', '-x', dest='extensions',
+                            nargs='*', help=(
+                                'file extensions to watch for changes'))
         parser.add_argument('--preload-layer', '-l', dest='preload_layer')
         parser.add_argument('--no-reload', '-n', dest='reload',
                             action='store_false')
@@ -176,7 +185,8 @@ def server():
             pass
     else:
         start_reload(args.layer, args.reload_paths or ['src'],
-                     args.preload_layer or 'plone.app.testing.PLONE_FIXTURE')
+                     args.preload_layer or 'plone.app.testing.PLONE_FIXTURE',
+                     args.extensions)
 
 
 class RobotListener:


Repository: plone.app.robotframework


Branch: refs/heads/master
Date: 2015-07-23T18:31:41+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.robotframework/commit/26221c2033a425112406939dd5fe0819a76fbeb3

Merge pull request #40 from plone/file-extensions

Add an extra argument to override watched file extensions

Files changed:
M src/plone/app/robotframework/reload.py
M src/plone/app/robotframework/server.py

diff --git a/src/plone/app/robotframework/reload.py b/src/plone/app/robotframework/reload.py
index 143c59c..30b277b 100644
--- a/src/plone/app/robotframework/reload.py
+++ b/src/plone/app/robotframework/reload.py
@@ -19,14 +19,7 @@
 
 class Watcher(FileSystemEventHandler):
 
-    allowed_extensions = set(os.getenv('RELOAD_EXTENSIONS', (
-        'po',
-        'pt',
-        'py',
-        'xml',
-        'csv',
-        'zcml',
-    )))
+    allowed_extensions = set(('po', 'pt', 'py', 'xml', 'csv', 'zcml'))
 
     def __init__(self, paths, forkloop, minimum_wait=2.0):
         FileSystemEventHandler.__init__(self)
diff --git a/src/plone/app/robotframework/server.py b/src/plone/app/robotframework/server.py
index 6ed2eb5..4dc8608 100644
--- a/src/plone/app/robotframework/server.py
+++ b/src/plone/app/robotframework/server.py
@@ -61,7 +61,8 @@ def start(zope_layer_dotted_name):
 
 
 def start_reload(zope_layer_dotted_name, reload_paths=('src',),
-                 preload_layer_dotted_name='plone.app.testing.PLONE_FIXTURE'):
+                 preload_layer_dotted_name='plone.app.testing.PLONE_FIXTURE',
+                 extensions=None):
 
     print WAIT("Starting Zope 2 server")
 
@@ -69,7 +70,12 @@ def start_reload(zope_layer_dotted_name, reload_paths=('src',),
     zsl.start_zope_server(preload_layer_dotted_name)
 
     forkloop = ForkLoop()
-    Watcher(reload_paths, forkloop).start()
+    watcher = Watcher(reload_paths, forkloop)
+    if extensions:
+        watcher.allowed_extensions = extensions
+    elif HAS_DEBUG_MODE:
+        watcher.allowed_extensions.remove('pt')
+    watcher.start()
     forkloop.start()
 
     if forkloop.exit:
@@ -149,6 +155,9 @@ def server():
     if HAS_RELOAD:
         parser.add_argument('--reload-path', '-p', dest='reload_paths',
                             action='append')
+        parser.add_argument('--reload-extensions', '-x', dest='extensions',
+                            nargs='*', help=(
+                                'file extensions to watch for changes'))
         parser.add_argument('--preload-layer', '-l', dest='preload_layer')
         parser.add_argument('--no-reload', '-n', dest='reload',
                             action='store_false')
@@ -176,7 +185,8 @@ def server():
             pass
     else:
         start_reload(args.layer, args.reload_paths or ['src'],
-                     args.preload_layer or 'plone.app.testing.PLONE_FIXTURE')
+                     args.preload_layer or 'plone.app.testing.PLONE_FIXTURE',
+                     args.extensions)
 
 
 class RobotListener:


