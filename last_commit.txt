Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T06:46:20+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/8172065d24940b6d4bdfd8d37fef8034c9267487

Pep8.

Files changed:
M Products/CMFPlone/tests/testPortalCreation.py

diff --git a/Products/CMFPlone/tests/testPortalCreation.py b/Products/CMFPlone/tests/testPortalCreation.py
index 5befe76..029a32c 100644
--- a/Products/CMFPlone/tests/testPortalCreation.py
+++ b/Products/CMFPlone/tests/testPortalCreation.py
@@ -214,15 +214,26 @@ def testResourceRegistries(self):
     def testUnfriendlyTypesProperty(self):
         # We should have an types_not_searched property
         self.assertTrue(
-            self.properties.site_properties.hasProperty('types_not_searched'))
-        self.assertTrue('Plone Site' in self.properties.site_properties.getProperty('types_not_searched'))
+            self.properties.site_properties.hasProperty('types_not_searched')
+        )
+        self.assertTrue(
+            'Plone Site' in
+            self.properties.site_properties.getProperty('types_not_searched')
+        )
 
     def testNonDefaultPageTypes(self):
         # We should have a default_page_types property
         self.assertTrue(
-            self.properties.site_properties.hasProperty('default_page_types'))
-        self.assertTrue('Folder' not in self.properties.site_properties.getProperty('default_page_types'))
-        self.assertTrue('Topic' in self.properties.site_properties.getProperty('default_page_types'))
+            self.properties.site_properties.hasProperty('default_page_types')
+        )
+        self.assertTrue(
+            'Folder' not in
+            self.properties.site_properties.getProperty('default_page_types')
+        )
+        self.assertTrue(
+            'Topic' in
+            self.properties.site_properties.getProperty('default_page_types')
+        )
 
     def testNoMembersAction(self):
         # There should not be a Members action


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T06:46:48+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/639caf39e9df33b6501ef689b00592427a416b37

Pep8

Files changed:
M Products/CMFPlone/tests/testQuickInstallerTool.py

diff --git a/Products/CMFPlone/tests/testQuickInstallerTool.py b/Products/CMFPlone/tests/testQuickInstallerTool.py
index 8056401..1a323f5 100644
--- a/Products/CMFPlone/tests/testQuickInstallerTool.py
+++ b/Products/CMFPlone/tests/testQuickInstallerTool.py
@@ -33,7 +33,11 @@ def testUpgradeProfilesNotShown(self):
         self.assertFalse('plone.app.upgrade.v30' in self._available())
 
     def testLatestUpgradeProfiles(self):
-        xmlconfig.file('test_upgrades1.zcml', package=tests, context=self.layer['configurationContext'])
+        xmlconfig.file(
+            'test_upgrades1.zcml',
+            package=tests,
+            context=self.layer['configurationContext']
+        )
         latest = self.qi.getLatestUpgradeStep('Products.CMFPlone:testfixture')
         self.assertTrue(latest == '3')
 
@@ -41,7 +45,11 @@ def testLatestUpgradeProfiles2(self):
         # make sure strings don't break things
         # note that pkg_resources interprets 1 as
         # ''00000001', which is > 'banana'
-        xmlconfig.file('test_upgrades2.zcml', package=tests, context=self.layer['configurationContext'])
+        xmlconfig.file(
+            'test_upgrades2.zcml',
+            package=tests,
+            context=self.layer['configurationContext']
+        )
         latest = self.qi.getLatestUpgradeStep('Products.CMFPlone:testfixture')
         self.assertTrue(latest == '3')
 


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T06:47:14+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/e866947bac288c275927050ab4fefef91bfccf95

Clean up actionmenu robot tests and follow best practice.

Files changed:
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_actionmenu.robot

diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot
index 041e68e..cabc0a8 100644
--- a/Products/CMFPlone/tests/robot/keywords.robot
+++ b/Products/CMFPlone/tests/robot/keywords.robot
@@ -7,3 +7,6 @@ a logged-in site administrator
 
 a document '${title}'
   Create content  type=Document  id=doc  title=${title}
+
+patterns are loaded
+  Wait For Condition  return $('body.patterns-loaded').size() > 0
diff --git a/Products/CMFPlone/tests/robot/test_actionmenu.robot b/Products/CMFPlone/tests/robot/test_actionmenu.robot
index 5ef5b6e..195a1ce 100644
--- a/Products/CMFPlone/tests/robot/test_actionmenu.robot
+++ b/Products/CMFPlone/tests/robot/test_actionmenu.robot
@@ -1,38 +1,43 @@
-*** Settings ***
+*** Settings *****************************************************************
 
 Resource  plone/app/robotframework/keywords.robot
 Resource  plone/app/robotframework/saucelabs.robot
 
 Library  Remote  ${PLONE_URL}/RobotRemote
 
-Resource  common.robot
+Resource  keywords.robot
 
-Test Setup  Run keywords  Open SauceLabs test browser  Background
+Test Setup  Run keywords  Open SauceLabs test browser
 Test Teardown  Run keywords  Report test status  Close all browsers
 
-*** Variables ***
+
+*** Variables ****************************************************************
 
 ${TITLE}  An actionsmenu page
 ${PAGE_ID}  an-actionsmenu-page
 
-*** Test cases ***
+
+*** Test cases ***************************************************************
 
 # ---
 # Basic Contentactions menu
 # ---
 
 Scenario: Actions Menu rendered collapsed
-    Given an actionsmenu page
+    Given a logged-in site administrator
+      and an actionsmenu page
      Then delete link exists
       and delete link should not be visible
 
 Scenario: Clicking expands action menu
-    Given an actionsmenu page
+    Given a logged-in site administrator
+      and an actionsmenu page
      When menu link is clicked
      Then actions menu should be visible
 
 Scenario: Clicking again collapses action menu
-    Given an actionsmenu page
+    Given a logged-in site administrator
+      and an actionsmenu page
      When menu link is clicked
       and menu link is clicked
 
@@ -42,7 +47,8 @@ Scenario: Clicking again collapses action menu
 
 Scenario: Hovering mouse from expanded menu on other menu shows that menu
     Pass Execution  This functionality needs to be fixed for Plone 5, but let's not make it break the build for now.
-    Given an actionsmenu page
+    Given a logged-in site administrator
+      and an actionsmenu page
      When first menu link is clicked
       and mouse moves to second menu
      Then second menu should be visible
@@ -53,7 +59,8 @@ Scenario: Hovering mouse from expanded menu on other menu shows that menu
 # ---
 
 Scenario: Clicking outside of Contentactions menu
-    Given an actionsmenu page
+    Given a logged-in site administrator
+      and an actionsmenu page
      When menu link is clicked
       and I click outside of menu
      Then actions menu should not be visible
@@ -63,7 +70,8 @@ Scenario: Clicking outside of Contentactions menu
 # ---
 
 Scenario: Do a workflow change
-    Given an actionsmenu page
+    Given a logged-in site administrator
+      and an actionsmenu page
      When workflow link is clicked
      Then state should have changed
 
@@ -72,62 +80,27 @@ Scenario: Do a workflow change
 # ---
 
 Scenario:
-    Given an actionsmenu page
+    Given a logged-in site administrator
+      and an actionsmenu page
      When I copy the page
       and I paste
      Then I should see 'Item(s) pasted.' in the page
 
-*** Keywords ***
 
-Background
-    Given a site owner
-      and a test document
+*** Keywords *****************************************************************
 
-a test document
-    Go to  ${PLONE_URL}/++add++Document
-    Given patterns are loaded
-    Execute Javascript  $('#form-widgets-IDublinCore-title').val('${TITLE}'); return 0;
-    Click Button  Save
+# --- GIVEN ------------------------------------------------------------------
 
 an actionsmenu page
+    Create content  type=Document  title=${TITLE}
     Go to  ${PLONE_URL}/${PAGE_ID}
 
-delete link exists
-     Page Should Contain Element  xpath=//a[@id='plone-contentmenu-actions-delete']
-
-delete link should not be visible
-     Element Should Not Be Visible  xpath=//div[@class='contentActions']//a[@id='plone-contentmenu-actions-delete']
-
-menu link is clicked
-    Given patterns are loaded
-    Click link  xpath=//li[@id='plone-contentmenu-moreoptions']/a
-
-delete link should be visible
-    Given patterns are loaded
-    Element Should Be Visible  xpath=//div[@class='contentActions']//a[@id='plone-contentmenu-actions-delete']
-
-actions menu should be visible
-    Given patterns are loaded
-    Element Should Be Visible  xpath=//li[@id='plone-contentmenu-actions']
 
-first menu link is clicked
-    Given patterns are loaded
-    Click Link  xpath=(//div[@class="contentActions"]//a[contains(@class, 'actionMenuHeader')])[1]
+# --- WHEN -------------------------------------------------------------------
 
 mouse moves to second menu
     Click Link  xpath=(//div[@class="contentActions"]//a[contains(@class, 'actionMenuHeader')])[2]
 
-second menu should be visible
-    Element Should Be Visible  xpath=(//li[contains(@class, 'actionMenu')])[2]
-
-first menu should not be visible
-    Given patterns are loaded
-    Wait until keyword succeeds  10s  1s  Element Should Not Be Visible  xpath=(//li[contains(@class, 'actionMenu')])[1]//li
-
-actions menu should not be visible
-    Given patterns are loaded
-    Wait until keyword succeeds  10s  1s  Element Should Not Be Visible  xpath=//li[@id='plone-contentmenu-actions']
-
 I click outside of menu
     Click Element  xpath=//h1
 
@@ -157,11 +130,6 @@ workflow link is clicked softly
     Mouse Up  xpath=(//li[@id='plone-contentmenu-workflow']//a)[1]
     Wait until page contains  Item state changed.
 
-state should have changed
-    Wait until page contains  Item state changed
-    ${NEW_STATE} =  Get Text  xpath=(//span[contains(@class,'state-')])[2]
-    # Should Not Be Equal  ${NEW_STATE}  ${OLD_STATE}
-
 Open Menu
     [Arguments]  ${elementId}
     Element Should Not Be Visible  css=#${elementId} ul.actionMenuContent
@@ -183,6 +151,48 @@ I paste
     Open Action Menu
     Click Link  link=Paste
 
+
+# --- THEN -------------------------------------------------------------------
+
+delete link exists
+     Page Should Contain Element  xpath=//a[@id='plone-contentmenu-actions-delete']
+
+delete link should not be visible
+     Element Should Not Be Visible  xpath=//div[@class='contentActions']//a[@id='plone-contentmenu-actions-delete']
+
+menu link is clicked
+    Given patterns are loaded
+    Click link  xpath=//li[@id='plone-contentmenu-moreoptions']/a
+
+delete link should be visible
+    Given patterns are loaded
+    Element Should Be Visible  xpath=//div[@class='contentActions']//a[@id='plone-contentmenu-actions-delete']
+
+actions menu should be visible
+    Given patterns are loaded
+    Element Should Be Visible  xpath=//li[@id='plone-contentmenu-actions']
+
+first menu link is clicked
+    Given patterns are loaded
+    Click Link  xpath=(//div[@class="contentActions"]//a[contains(@class, 'actionMenuHeader')])[1]
+
 I should see '${message}' in the page
     Wait until page contains  ${message}
     Page should contain  ${message}
+
+state should have changed
+    Wait until page contains  Item state changed
+    ${NEW_STATE} =  Get Text  xpath=(//span[contains(@class,'state-')])[2]
+    # Should Not Be Equal  ${NEW_STATE}  ${OLD_STATE}
+
+second menu should be visible
+    Element Should Be Visible  xpath=(//li[contains(@class, 'actionMenu')])[2]
+
+first menu should not be visible
+    Given patterns are loaded
+    Wait until keyword succeeds  10s  1s  Element Should Not Be Visible  xpath=(//li[contains(@class, 'actionMenu')])[1]//li
+
+actions menu should not be visible
+    Given patterns are loaded
+    Wait until keyword succeeds  10s  1s  Element Should Not Be Visible  xpath=//li[@id='plone-contentmenu-actions']
+


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T07:05:00+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/9d66ad3b21dbb8760d3a2fa4017a40d714fdc1f4

Refactor edit robot tests to follow best practices.

Files changed:
M Products/CMFPlone/tests/robot/test_edit.robot

diff --git a/Products/CMFPlone/tests/robot/test_edit.robot b/Products/CMFPlone/tests/robot/test_edit.robot
index 0df094e..7d25191 100644
--- a/Products/CMFPlone/tests/robot/test_edit.robot
+++ b/Products/CMFPlone/tests/robot/test_edit.robot
@@ -1,29 +1,33 @@
-*** Settings ***
+*** Settings *****************************************************************
 
 Resource  plone/app/robotframework/keywords.robot
 Resource  plone/app/robotframework/saucelabs.robot
 
 Library  Remote  ${PLONE_URL}/RobotRemote
 
-Resource  common.robot
+Resource  keywords.robot
 
-Test Setup  Run keywords  Open SauceLabs test browser  Background
+Test Setup  Run keywords  Open SauceLabs test browser
 Test Teardown  Run keywords  Report test status  Close all browsers
 
-*** Variables ***
+
+*** Variables ****************************************************************
 
 ${TITLE}  An edited page
 ${PAGE_ID}  an-edited-page
 
-*** Test cases ***
+
+*** Test cases ***************************************************************
 
 Scenario: A page is opened to edit
-    Given an edited page
+    Given a logged-in site administrator
+      and an edited page
      Then i have the title input field
       and i can only see the default tab
 
 Scenario: Switch tabs
-    Given an edited page
+    Given a logged-in site administrator
+      and an edited page
      When i click the Categorization tab
      Then the Categorization tab is shown
       and no other tab is shown
@@ -32,7 +36,8 @@ Scenario: Adding a related item
     Pass Execution  Disabled until plone.app.widgets is merged
     # Order of the next two lines is important
     # First we're creating a new item and then editing the original page
-    Given at least one other item
+    Given a logged-in site administrator
+      and at least one other item
       and an edited page
      When i click the Categorization tab
       and i click the add related item button
@@ -44,7 +49,8 @@ Scenario: Adding a related item
 
 Scenario: DateTime widget follows form dropdowns values
     Pass Execution  Disabled until plone.app.widgets is merged
-    Given an edited page
+    Given a logged-in site administrator
+      and an edited page
      When i click the Dates tab
       and i select a date using the dropdowns
       and i click the calendar icon
@@ -52,27 +58,25 @@ Scenario: DateTime widget follows form dropdowns values
 
 Scenario: Form dropdowns follows DateTime widget values
     Pass Execution  Disabled until plone.app.widgets is merged
-    Given an edited page
+    Given a logged-in site administrator
+      and an edited page
      When i click the Dates tab
-     and i click the calendar icon
-     and i select a date using the widget
-    Then form dropdowns should not have the default values anymore
+      and i click the calendar icon
+      and i select a date using the widget
+     Then form dropdowns should not have the default values anymore
 
-*** Keywords ***
 
-Background
-    Given a site owner
-      and a test document
+*** Keywords *****************************************************************
 
-a test document
-    Go to  ${PLONE_URL}/++add++Document
-    Given patterns are loaded
-    Execute Javascript  $('#form-widgets-IDublinCore-title').val('${TITLE}'); return 0;
-    Click Button  Save
+# --- GIVEN ------------------------------------------------------------------
 
 an edited page
+    Create content  type=Document  title=${TITLE}
     Go to  ${PLONE_URL}/${PAGE_ID}/edit
 
+
+# --- WHEN -------------------------------------------------------------------
+
 I have the title input field
     Element Should Be Visible  xpath=//fieldset[@id='fieldset-default']
 
@@ -86,26 +90,9 @@ I click the ${tab} tab
     Given patterns are loaded
     Click link  ${tab}
 
-the categorization tab is shown
-    Element Should Be Visible  xpath=//fieldset[@id='fieldset-categorization']
-
-no other tab is shown
-    Element Should Not Be Visible  xpath=//fieldset[@id='fieldset-dates']
-    Element Should Not Be Visible  xpath=//fieldset[@id='fieldset-default']
-    Element Should Not Be Visible  xpath=//fieldset[@id='fieldset-settings']
-
-at least one other item
-    Go to  ${PLONE_URL}/++add++Document
-    Given patterns are loaded
-    Execute Javascript  $('#form-widgets-IDublinCore-title').val('${TITLE}'); return 0;
-    Click Button  Save
-
 I click the add related item button
     Click Button  xpath=//input[contains(@class, 'addreference')]
 
-an overlay pops up
-    Wait Until Page Contains Element  xpath=//div[contains(@class, 'overlay')]//input[@class='insertreference']
-
 I select a related item
     Click Element  xpath=//div[contains(@class, 'overlay')]//input[@class='insertreference']
     Wait until keyword succeeds  10s  1s  Xpath Should Match X Times  //ul[@id = 'ref_browser_items_relatedItems']/descendant::input  1
@@ -116,9 +103,6 @@ I close the overlay
 I save the page
    Click Button  Save
 
-the related item is shown in the page
-   Xpath Should Match X Times  //dl[@id = 'relatedItemBox']/dd  1
-
 I select a date using the dropdowns
     Select From List  xpath=//select[@id='edit_form_effectiveDate_0_year']  2001
     Select From List  xpath=//select[@id='edit_form_effectiveDate_0_month']  January
@@ -132,12 +116,15 @@ I click the calendar icon
     Click Element  xpath=//span[@id='edit_form_effectiveDate_0_popup']
     Element Should Be Visible  xpath=//div[@class='calendar']
 
-popup calendar should have the same date
-    Element Text Should Be  xpath=//div[@class='calendar']//thead//td[@class='title']  January, 2001
-
 I select a date using the widget
     Click Element  xpath=//div[@class='calendar']/table/thead/tr[2]/td[4]/div
 
+
+# --- THEN -------------------------------------------------------------------
+
+popup calendar should have the same date
+    Element Text Should Be  xpath=//div[@class='calendar']//thead//td[@class='title']  January, 2001
+
 form dropdowns should not have the default values anymore
     ${yearLabel} =  Get Selected List Label  xpath=//select[@id='edit_form_effectiveDate_0_year']
     Should Not Be Equal  ${yearLabel}  --
@@ -145,3 +132,23 @@ form dropdowns should not have the default values anymore
     Should Not Be Equal  ${monthLabel}  --
     ${dayLabel} =  Get Selected List Label  xpath=//select[@id='edit_form_effectiveDate_0_day']
     Should Not Be Equal  ${dayLabel}  --
+
+the related item is shown in the page
+   Xpath Should Match X Times  //dl[@id = 'relatedItemBox']/dd  1
+
+an overlay pops up
+    Wait Until Page Contains Element  xpath=//div[contains(@class, 'overlay')]//input[@class='insertreference']
+
+the categorization tab is shown
+    Element Should Be Visible  xpath=//fieldset[@id='fieldset-categorization']
+
+no other tab is shown
+    Element Should Not Be Visible  xpath=//fieldset[@id='fieldset-dates']
+    Element Should Not Be Visible  xpath=//fieldset[@id='fieldset-default']
+    Element Should Not Be Visible  xpath=//fieldset[@id='fieldset-settings']
+
+at least one other item
+    Go to  ${PLONE_URL}/++add++Document
+    Given patterns are loaded
+    Execute Javascript  $('#form-widgets-IDublinCore-title').val('${TITLE}'); return 0;
+    Click Button  Save


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T08:00:23+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/d009b7759454e156b68011f75bb44897521de001

Clean folder_contents robot tests and follow best practices.

Files changed:
M Products/CMFPlone/tests/robot/test_folder_contents.robot

diff --git a/Products/CMFPlone/tests/robot/test_folder_contents.robot b/Products/CMFPlone/tests/robot/test_folder_contents.robot
index 04c2b62..2b827fe 100644
--- a/Products/CMFPlone/tests/robot/test_folder_contents.robot
+++ b/Products/CMFPlone/tests/robot/test_folder_contents.robot
@@ -1,26 +1,26 @@
-*** Settings ***
+*** Settings *****************************************************************
 
 Resource  plone/app/robotframework/keywords.robot
 Resource  plone/app/robotframework/saucelabs.robot
 
 Library  Remote  ${PLONE_URL}/RobotRemote
 
-Resource  common.robot
+Resource  keywords.robot
 
 Test Setup  Open SauceLabs test browser
 Test Teardown  Run keywords  Report test status  Close all browsers
 
-*** Test cases ***
+
+*** Test cases ***************************************************************
 
 Scenario: Select All items
-    Given a site owner
-      And a test folder
-      And four dummy pages on test folder
-      And the folder contents view
+    Given a logged-in site administrator
+      and a folder with four pages
+      and the folder contents view
      When I select all the elements
      Then the selection count appears
-      And the four elements got selected
-      And the clear selection link appears
+      and the four elements got selected
+      and the clear selection link appears
 
 #Scenario: Clear selection
 #    Given a site owner
@@ -40,28 +40,24 @@ Scenario: Select All items
 #     When I reorder the elements
 #     Then the new order should be 4 > 3 > 2 > 1
 
-*** Keywords ***
+
+*** Keywords *****************************************************************
+
+a folder with four pages
+    ${folder_uid}=  Create content  type=Folder  title=My Folder
+    Create content  type=Document  title=Doc1  container=${folder_uid}
+    Create content  type=Document  title=Doc2  container=${folder_uid}
+    Create content  type=Document  title=Doc3  container=${folder_uid}
+    Create content  type=Document  title=Doc4  container=${folder_uid}
 
 the folder contents view
-    Go to  ${PLONE_URL}/${TEST_FOLDER}/folder_contents
+    Go to  ${PLONE_URL}/my-folder/folder_contents
     Page should contain element  css=.pat-structure
     Given folder contents pattern loaded
 
 I click the '${link_name}' link
     Click Link  ${link_name}
 
-four dummy pages on test folder
-    a document 'doc1' in the test folder
-    a document 'doc2' in the test folder
-    a document 'doc3' in the test folder
-    a document 'doc4' in the test folder
-
-a document '${title}' in the test folder
-    Go to  ${PLONE_URL}/${TEST_FOLDER}/++add++Document
-    Wait For Condition  return $('.autotoc-nav .active:visible').size() > 0
-    Execute Javascript  $('#form-widgets-IDublinCore-title').val('${title}'); return 0;
-    Click Button  Save
-
 I select all the elements
     Element should be visible  css=.pat-structure .select-all
     Click Element  css=.pat-structure .select-all
@@ -133,4 +129,4 @@ Should be above
     Should be true  ${locator1-position} < ${locator2-position}
 
 folder contents pattern loaded
-    Wait For Condition  return $('.pat-structure div.navbar').size() > 0
\ No newline at end of file
+    Wait For Condition  return $('.pat-structure div.navbar').size() > 0


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T08:42:18+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/9c9f8030f0f6cc5e08e7fc5607f053970712f0fc

Clean folder_contents robot tests and follow best practices.

Files changed:
M Products/CMFPlone/tests/robot/keywords.robot
M Products/CMFPlone/tests/robot/test_livesearch.robot

diff --git a/Products/CMFPlone/tests/robot/keywords.robot b/Products/CMFPlone/tests/robot/keywords.robot
index cabc0a8..23170ae 100644
--- a/Products/CMFPlone/tests/robot/keywords.robot
+++ b/Products/CMFPlone/tests/robot/keywords.robot
@@ -8,5 +8,12 @@ a logged-in site administrator
 a document '${title}'
   Create content  type=Document  id=doc  title=${title}
 
+a folder '${title}'
+  Create content  type=Folder  title=${title}
+
 patterns are loaded
   Wait For Condition  return $('body.patterns-loaded').size() > 0
+
+a folder with a document '${title}'
+  ${folder_uid}=  Create content  type=Folder  title=folder
+  Create content  type=Document  container=${folder_uid}  title=${title}
diff --git a/Products/CMFPlone/tests/robot/test_livesearch.robot b/Products/CMFPlone/tests/robot/test_livesearch.robot
index 7502aaa..d6dc731 100644
--- a/Products/CMFPlone/tests/robot/test_livesearch.robot
+++ b/Products/CMFPlone/tests/robot/test_livesearch.robot
@@ -1,41 +1,46 @@
-*** Settings ***
+*** Settings *****************************************************************
 
 Resource  plone/app/robotframework/keywords.robot
 Resource  plone/app/robotframework/saucelabs.robot
 
 Library  Remote  ${PLONE_URL}/RobotRemote
 
-Resource  common.robot
+Resource  keywords.robot
 
-Test Setup  Run keywords  Open SauceLabs test browser  Background
+Test Setup  Run keywords  Open SauceLabs test browser
 Test Teardown  Run keywords  Report test status  Close all browsers
 
-*** Test cases ***
+
+*** Test cases ***************************************************************
 
 Scenario: Simple Livesearch
     Pass Execution  Disabled until livesearch pattern is integrated
-    Given a document  Welcome to Plone
+    Given a logged-in site administrator
+      and a document  Welcome to Plone
      When I search for  Welcome
      Then the livesearch results should contain  Welcome to Plone
       and there should be '2' livesearch results
 
 Scenario: Livesearch for documents
     Pass Execution  Disabled until livesearch pattern is integrated
-    Given a document  My document
+    Given a logged-in site administrator
+      and a document  My document
      When I search for  My document
      Then the livesearch results should contain  My document
       and there should be '2' livesearch results
 
 Scenario: Livesearch for folder
     Pass Execution  Disabled until livesearch pattern is integrated
-    Given a folder  My folder
+    Given a logged-in site administrator
+      and a folder  My folder
      When I search for  My folder
      Then the livesearch results should contain  My folder
       and there should be '2' livesearch results
 
 Scenario: Livesearch in current folder only
     Pass Execution  Disabled until livesearch pattern is integrated
-    Given a folder 'folder' with a document 'Inside Document'
+    Given a logged-in site administrator
+      and a folder with a document 'Inside Document'
       and a document  Outside Document
      When I search the currentfolder only for  Inside Document
      Then the livesearch results should contain  Inside Document
@@ -43,11 +48,7 @@ Scenario: Livesearch in current folder only
       and there should be '2' livesearch results
 
 
-*** Keywords ***
-
-Background
-    Given a site owner
-      and a test folder
+*** Keywords *****************************************************************
 
 I search for
     [Arguments]  ${searchtext}


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-19T09:13:18+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.CMFPlone/commit/ad6b711293ed39898c4341de8e8071ee7002aa91

Make portlet robot test follow best practices.

Files changed:
M Products/CMFPlone/tests/robot/test_portlets.robot

diff --git a/Products/CMFPlone/tests/robot/test_portlets.robot b/Products/CMFPlone/tests/robot/test_portlets.robot
index f936739..c521774 100644
--- a/Products/CMFPlone/tests/robot/test_portlets.robot
+++ b/Products/CMFPlone/tests/robot/test_portlets.robot
@@ -1,24 +1,26 @@
-*** Settings ***
+*** Settings *****************************************************************
 
 Resource  plone/app/robotframework/keywords.robot
 Resource  plone/app/robotframework/saucelabs.robot
 
 Library  Remote  ${PLONE_URL}/RobotRemote
 
-Resource  common.robot
+Resource  keywords.robot
 
 Test Setup  Open SauceLabs test browser
 Test Teardown  Run keywords  Report test status  Close all browsers
 
-*** Test cases ***
+
+*** Test cases ***************************************************************
 
 Scenario: Add Login Portlet
-    Given a site owner
+    Given a logged-in site administrator
       and a manage portlets view
      When I add a 'Login' portlet to the left column
      Then I should see a 'Login' portlet in the left column
 
-*** Keywords ***
+
+*** Keywords *****************************************************************
 
 a manage portlets view
     Go to   ${PLONE_URL}/@@manage-portlets


