Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2015-08-14T03:05:09+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/fa1e6a88e6efd289a1a120b9c9a10e6a3871269b

Avoid DeprecationWarning: splitSchemaName: moved to plone.dexterity.schema.

Files changed:
M plone/app/dexterity/serialize.py

diff --git a/plone/app/dexterity/serialize.py b/plone/app/dexterity/serialize.py
index a78cc57..690870d 100644
--- a/plone/app/dexterity/serialize.py
+++ b/plone/app/dexterity/serialize.py
@@ -1,6 +1,6 @@
 # -*- coding: utf-8 -*-
 from plone.dexterity.interfaces import IDexterityFTI
-from plone.dexterity.utils import splitSchemaName
+from plone.dexterity.schema import splitSchemaName
 from plone.supermodel import serializeModel
 from plone.supermodel.utils import syncSchema
 from zope.component import queryUtility


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2015-08-14T03:06:08+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/90854414b00b65fb2c2035e324589dd359a7e62a

Avoid DeprecationWarning for getIcon.

Files changed:
M CHANGES.rst
M plone/app/dexterity/browser/types_listing_row.pt
M plone/app/dexterity/tests/editing.txt

diff --git a/CHANGES.rst b/CHANGES.rst
index 56b09de..c3ea6dc 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.1.8 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Avoid DeprecationWarning for getIcon.
+  [maurits]
 
 
 2.1.7 (2015-07-18)
diff --git a/plone/app/dexterity/browser/types_listing_row.pt b/plone/app/dexterity/browser/types_listing_row.pt
index af469b4..54d1666 100644
--- a/plone/app/dexterity/browser/types_listing_row.pt
+++ b/plone/app/dexterity/browser/types_listing_row.pt
@@ -1,4 +1,7 @@
 <tal:block define="tups view/getCombinedWidgets;
+                   portal context/@@plone_portal_state/portal;
+                   layout portal/@@plone_layout;
+                   getIcon python:layout.getIcon;
                    niceTitles view/getNiceTitles"
            repeat="tup tups">
 
@@ -9,10 +12,9 @@
 
     <img
        tal:define="fti view/getContent;
-                   icon fti/getIcon;
-                   portal_url context/context/context/portal_url"
+                   icon python:getIcon(fti);"
        tal:condition="python:icon and idx == 1"
-       tal:attributes="src string:${portal_url}/${icon};"
+       tal:attributes="src icon/url"
        width="16"
        height="16"
        />
diff --git a/plone/app/dexterity/tests/editing.txt b/plone/app/dexterity/tests/editing.txt
index e835caf..8410c0d 100644
--- a/plone/app/dexterity/tests/editing.txt
+++ b/plone/app/dexterity/tests/editing.txt
@@ -55,7 +55,7 @@ The new type should have the dublin core behavior assigned by default::
   >>> plonista = portal.portal_types.plonista
   >>> 'plone.app.dexterity.behaviors.metadata.IDublinCore' in plonista.behaviors
   True
-  >>> 'document_icon' in plonista.getIcon()
+  >>> 'document_icon' in plonista.getIconExprObject().text
   True
 
 The listing needs to not break if a type description was stored encoded.


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2015-08-14T03:06:34+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/e76faeb577360c8734e58ff7276f5d4373cc3c3c

Avoid another DeprecationWarning for getIcon.

Files changed:
M plone/app/dexterity/tests/editing.txt

diff --git a/plone/app/dexterity/tests/editing.txt b/plone/app/dexterity/tests/editing.txt
index 8410c0d..0177398 100644
--- a/plone/app/dexterity/tests/editing.txt
+++ b/plone/app/dexterity/tests/editing.txt
@@ -368,7 +368,7 @@ using the Container base class::
   >>> pf = getattr(portal.portal_types, 'plonista-folder')
   >>> pf.klass
   'plone.dexterity.content.Container'
-  >>> 'document_icon' in pf.getIcon()
+  >>> 'document_icon' in pf.getIconExprObject().text
   True
 
 We can configure the plonista-folder to allow contained content types::


