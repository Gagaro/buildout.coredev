Repository: plone.app.layout


Branch: refs/heads/master
Date: 2015-09-10T15:27:24+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.layout/commit/c29e1cb4251e478797dfed4cd6a52e3e4f0916ff

Fixed AttributeError for ac_permissions.

Happens in plone.app.portlets tests.

Files changed:
M plone/app/layout/globals/layout.py

diff --git a/plone/app/layout/globals/layout.py b/plone/app/layout/globals/layout.py
index ae2c3ef..af191c0 100644
--- a/plone/app/layout/globals/layout.py
+++ b/plone/app/layout/globals/layout.py
@@ -22,7 +22,7 @@
 from zope.interface import alsoProvides
 from zope.interface import implements
 from zope.publisher.browser import BrowserView
-from AccessControl.PermissionRole import rolesForPermissionOn
+
 
 class LayoutPolicy(BrowserView):
     """A view that gives access to various layout related functions.
@@ -181,9 +181,9 @@ def bodyClass(self, template, view):
 
         # permissions required. Useful to theme frontend and backend differently
         permissions = []
-        if not getattr(view, '__ac_permissions__'):
+        if not getattr(view, '__ac_permissions__', tuple()):
             permissions = ['none']
-        for permission,roles in getattr(view, '__ac_permissions__', tuple()):
+        for permission, roles in getattr(view, '__ac_permissions__', tuple()):
             permissions.append(normalizer.normalize(permission))
         if 'none' in permissions or 'view' in permissions:
             body_classes.append('frontend')


