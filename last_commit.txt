Repository: mockup


Branch: refs/heads/master
Date: 2015-08-12T10:42:40+02:00
Author: Alessandro Pisa (ale-rt) <alessandro.pisa@redturtle.it>
Commit: https://github.com/plone/mockup/commit/7d07fa8dd42f618876311d92fd828fcaa1acc290

first attempt to fix regexp

Files changed:
M mockup/patterns/modal/pattern.js
M mockup/tests/pattern-modal-test.js

diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 8c010f4..44e85b3 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -160,12 +160,12 @@ define([
           reg = /<body.*data-view-url=[\"'](.*)[\"'].*/im.exec(response);
           if (reg && reg.length > 1) {
             // view url as data attribute on body (Plone 5)
-            return reg[1];
+            return reg[1].split('"')[0];
           }
           reg = /<body.*data-base-url=[\"'](.*)[\"'].*/im.exec(response);
           if (reg && reg.length > 1) {
             // Base url as data attribute on body (Plone 5)
-            return reg[1];
+            return reg[1].split('"')[0];
           }
           reg = /<base.*href=[\"'](.*)[\"'].*/im.exec(response);
           if (reg && reg.length > 1) {
diff --git a/mockup/tests/pattern-modal-test.js b/mockup/tests/pattern-modal-test.js
index 693150e..c68f477 100644
--- a/mockup/tests/pattern-modal-test.js
+++ b/mockup/tests/pattern-modal-test.js
@@ -144,11 +144,11 @@ define([
           )).to.equal('testurl2');
           expect(modal.defaults.actionOptions.redirectToUrl(
             'ignore',
-            '<html><body data-base-url="testurl3"></body></html>'
+            '<html><body data-base-url="testurl3" rubbish="discarded"></body></html>'
           )).to.equal('testurl3');
           expect(modal.defaults.actionOptions.redirectToUrl(
             'ignore',
-            '<html><body data-view-url="testurl4"></body></html>'
+            '<html><body data-view-url="testurl4" rubbish="discarded"></body></html>'
           )).to.equal('testurl4');
           done();
         })


Repository: mockup


Branch: refs/heads/master
Date: 2015-08-12T18:18:14-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/17d3d127d4da496a029dddcec9677bc2618a0d24

Merge pull request #554 from plone/fix-check-data-view-url

Fix the regular expression

Files changed:
M mockup/patterns/modal/pattern.js
M mockup/tests/pattern-modal-test.js

diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 8c010f4..44e85b3 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -160,12 +160,12 @@ define([
           reg = /<body.*data-view-url=[\"'](.*)[\"'].*/im.exec(response);
           if (reg && reg.length > 1) {
             // view url as data attribute on body (Plone 5)
-            return reg[1];
+            return reg[1].split('"')[0];
           }
           reg = /<body.*data-base-url=[\"'](.*)[\"'].*/im.exec(response);
           if (reg && reg.length > 1) {
             // Base url as data attribute on body (Plone 5)
-            return reg[1];
+            return reg[1].split('"')[0];
           }
           reg = /<base.*href=[\"'](.*)[\"'].*/im.exec(response);
           if (reg && reg.length > 1) {
diff --git a/mockup/tests/pattern-modal-test.js b/mockup/tests/pattern-modal-test.js
index 693150e..c68f477 100644
--- a/mockup/tests/pattern-modal-test.js
+++ b/mockup/tests/pattern-modal-test.js
@@ -144,11 +144,11 @@ define([
           )).to.equal('testurl2');
           expect(modal.defaults.actionOptions.redirectToUrl(
             'ignore',
-            '<html><body data-base-url="testurl3"></body></html>'
+            '<html><body data-base-url="testurl3" rubbish="discarded"></body></html>'
           )).to.equal('testurl3');
           expect(modal.defaults.actionOptions.redirectToUrl(
             'ignore',
-            '<html><body data-view-url="testurl4"></body></html>'
+            '<html><body data-view-url="testurl4" rubbish="discarded"></body></html>'
           )).to.equal('testurl4');
           done();
         })


