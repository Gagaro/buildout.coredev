Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-07-24T08:42:06+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/9062dd53c0400d18a27aa58668ba2497d14c0d2b

Skip upgrade-step that resets all behaviors. Fixes #246.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/upgrades.py
M plone/app/contenttypes/upgrades.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index d55e89c..dea94d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 1.2b4 (unreleased)
 ------------------
 
+- Remove upgrade-step that resets all behaviors. Fixes #246.
+  [pbauer]
+
 - Add convenience-view @@export_all_relations to export all relations.
   [pbauer]
 
diff --git a/plone/app/contenttypes/upgrades.py b/plone/app/contenttypes/upgrades.py
index a3fedb7..9db4062 100644
--- a/plone/app/contenttypes/upgrades.py
+++ b/plone/app/contenttypes/upgrades.py
@@ -89,20 +89,8 @@ def migrate_to_richtext(context):
 
 
 def migrate_album_view(context):
-    """Migrate atct_album_view to album_view."""
-
-    # TODO: Don't reload the profile. Only change the settings.
-    context.runImportStepFromProfile(
-        'profile-plone.app.contenttypes:default',
-        'typeinfo',
-    )
-    catalog = getToolByName(context, 'portal_catalog')
-    search = catalog.unrestrictedSearchResults
-    for brain in search(portal_type='Folder'):
-        obj = brain.getObject()
-        current = context.getLayout()
-        if current == 'atct_album_view':
-            obj.setLayout('album_view')
+    """That task is now done by use_new_view_names (1103->1104)"""
+    pass
 
 
 def enable_shortname_behavior(context):
diff --git a/plone/app/contenttypes/upgrades.zcml b/plone/app/contenttypes/upgrades.zcml
index 7dc4a79..f4cf0f5 100644
--- a/plone/app/contenttypes/upgrades.zcml
+++ b/plone/app/contenttypes/upgrades.zcml
@@ -47,7 +47,7 @@
   <genericsetup:upgradeStep
       source="1101"
       destination="1102"
-      title="Update album_view"
+      title="Empty upgrade-step"
       description=""
       profile="plone.app.contenttypes:default"
       handler=".upgrades.migrate_album_view"


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-07-24T11:14:29+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/94f168c02a9e3ffa9f761e1bac5cdce398b06510

Merge pull request #248 from plone/skip_migrate_album_view

Skip upgrade-step that resets all behaviors. Fixes #246.

Files changed:
M CHANGES.rst
M plone/app/contenttypes/upgrades.py
M plone/app/contenttypes/upgrades.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index d55e89c..dea94d7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 1.2b4 (unreleased)
 ------------------
 
+- Remove upgrade-step that resets all behaviors. Fixes #246.
+  [pbauer]
+
 - Add convenience-view @@export_all_relations to export all relations.
   [pbauer]
 
diff --git a/plone/app/contenttypes/upgrades.py b/plone/app/contenttypes/upgrades.py
index a3fedb7..9db4062 100644
--- a/plone/app/contenttypes/upgrades.py
+++ b/plone/app/contenttypes/upgrades.py
@@ -89,20 +89,8 @@ def migrate_to_richtext(context):
 
 
 def migrate_album_view(context):
-    """Migrate atct_album_view to album_view."""
-
-    # TODO: Don't reload the profile. Only change the settings.
-    context.runImportStepFromProfile(
-        'profile-plone.app.contenttypes:default',
-        'typeinfo',
-    )
-    catalog = getToolByName(context, 'portal_catalog')
-    search = catalog.unrestrictedSearchResults
-    for brain in search(portal_type='Folder'):
-        obj = brain.getObject()
-        current = context.getLayout()
-        if current == 'atct_album_view':
-            obj.setLayout('album_view')
+    """That task is now done by use_new_view_names (1103->1104)"""
+    pass
 
 
 def enable_shortname_behavior(context):
diff --git a/plone/app/contenttypes/upgrades.zcml b/plone/app/contenttypes/upgrades.zcml
index 7dc4a79..f4cf0f5 100644
--- a/plone/app/contenttypes/upgrades.zcml
+++ b/plone/app/contenttypes/upgrades.zcml
@@ -47,7 +47,7 @@
   <genericsetup:upgradeStep
       source="1101"
       destination="1102"
-      title="Update album_view"
+      title="Empty upgrade-step"
       description=""
       profile="plone.app.contenttypes:default"
       handler=".upgrades.migrate_album_view"


