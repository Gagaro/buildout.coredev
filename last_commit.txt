Repository: plone.locking


Branch: refs/heads/master
Date: 2015-09-17T18:47:58+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.locking/commit/e628817a86afd18ee7a23cd0e2f7189c69e6808f

Use registry lookup for types_use_view_action_in_listings

Files changed:
M CHANGES.rst
M plone/locking/browser/locking.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cc9a64e..4f49fa6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,13 +4,15 @@ Changelog
 2.1.1 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Use registry lookup for types_use_view_action_in_listings
+  [esteele]
 
 
 2.1.0 (2015-09-07)
 ------------------
 
-- Pull lock_on_ttw_edit setting from 
+- Pull lock_on_ttw_edit setting from the configuration registry
+  [esteele]
 
 
 2.0.8 (2015-07-20)
diff --git a/plone/locking/browser/locking.py b/plone/locking/browser/locking.py
index 0a48808..9910c83 100644
--- a/plone/locking/browser/locking.py
+++ b/plone/locking/browser/locking.py
@@ -1,5 +1,6 @@
 
 from Acquisition import aq_inner
+from zope.component import getUtility
 from Products.Five import BrowserView
 from Products.CMFCore.utils import getToolByName
 
@@ -7,6 +8,7 @@
 from datetime import timedelta
 
 from plone.locking.interfaces import ILockable, IRefreshableLockable
+from plone.registry.interfaces import IRegistry
 from zope.i18nmessageid import MessageFactory
 
 _ = MessageFactory('plone')
@@ -26,11 +28,11 @@ def force_unlock(self, redirect=True):
         lockable.unlock()
         if redirect:
             url = self.context.absolute_url()
-            props_tool = getToolByName(self.context, 'portal_properties')
-            if props_tool:
-                types_use_view = props_tool.site_properties.typesUseViewActionInListings
-                if self.context.portal_type in types_use_view:
-                    url += '/view'
+            registry = getUtility(IRegistry)
+            types_use_view = registry.get(
+                'plone.types_view_action_in_listings', [])
+            if self.context.portal_type in types_use_view:
+                url += '/view'
 
             self.request.RESPONSE.redirect(url)
 


Repository: plone.locking


Branch: refs/heads/master
Date: 2015-09-18T09:52:52+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.locking/commit/f18ec0c43dfdbdf948ff8f2bd385c25e4c724ef3

Fix registry id

Files changed:
M plone/locking/browser/locking.py

diff --git a/plone/locking/browser/locking.py b/plone/locking/browser/locking.py
index 9910c83..4832f36 100644
--- a/plone/locking/browser/locking.py
+++ b/plone/locking/browser/locking.py
@@ -30,7 +30,7 @@ def force_unlock(self, redirect=True):
             url = self.context.absolute_url()
             registry = getUtility(IRegistry)
             types_use_view = registry.get(
-                'plone.types_view_action_in_listings', [])
+                'plone.types_use_view_action_in_listings', [])
             if self.context.portal_type in types_use_view:
                 url += '/view'
 


Repository: plone.locking


Branch: refs/heads/master
Date: 2015-09-20T17:29:45+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.locking/commit/532a94ec445addbefa28b877ac685c962805250f

Merge pull request #8 from plone/portal-properties-cleanup

Portal properties cleanup

Files changed:
M CHANGES.rst
M plone/locking/browser/locking.py

diff --git a/CHANGES.rst b/CHANGES.rst
index cc9a64e..4f49fa6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,13 +4,15 @@ Changelog
 2.1.1 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Use registry lookup for types_use_view_action_in_listings
+  [esteele]
 
 
 2.1.0 (2015-09-07)
 ------------------
 
-- Pull lock_on_ttw_edit setting from 
+- Pull lock_on_ttw_edit setting from the configuration registry
+  [esteele]
 
 
 2.0.8 (2015-07-20)
diff --git a/plone/locking/browser/locking.py b/plone/locking/browser/locking.py
index 0a48808..4832f36 100644
--- a/plone/locking/browser/locking.py
+++ b/plone/locking/browser/locking.py
@@ -1,5 +1,6 @@
 
 from Acquisition import aq_inner
+from zope.component import getUtility
 from Products.Five import BrowserView
 from Products.CMFCore.utils import getToolByName
 
@@ -7,6 +8,7 @@
 from datetime import timedelta
 
 from plone.locking.interfaces import ILockable, IRefreshableLockable
+from plone.registry.interfaces import IRegistry
 from zope.i18nmessageid import MessageFactory
 
 _ = MessageFactory('plone')
@@ -26,11 +28,11 @@ def force_unlock(self, redirect=True):
         lockable.unlock()
         if redirect:
             url = self.context.absolute_url()
-            props_tool = getToolByName(self.context, 'portal_properties')
-            if props_tool:
-                types_use_view = props_tool.site_properties.typesUseViewActionInListings
-                if self.context.portal_type in types_use_view:
-                    url += '/view'
+            registry = getUtility(IRegistry)
+            types_use_view = registry.get(
+                'plone.types_use_view_action_in_listings', [])
+            if self.context.portal_type in types_use_view:
+                url += '/view'
 
             self.request.RESPONSE.redirect(url)
 


