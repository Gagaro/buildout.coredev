Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-29T13:55:44-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/b629e75a01aab75987cae5bfc871c230fb3310aa

re-add cache busting r.js fix

Files changed:
M Products/CMFPlone/static/components/r.js/dist/r.js

diff --git a/Products/CMFPlone/static/components/r.js/dist/r.js b/Products/CMFPlone/static/components/r.js/dist/r.js
index ed177d8..0f16deb 100644
--- a/Products/CMFPlone/static/components/r.js/dist/r.js
+++ b/Products/CMFPlone/static/components/r.js/dist/r.js
@@ -25821,6 +25821,14 @@ define('build', function (require) {
             d.resolve(require._cachedRawText[path]);
             return d.promise;
         } else {
+            /* XXX Plone hack to always re-download resource TTW */
+            var url = path;
+            if(url.indexOf('?') === -1){
+                url += '?';
+            }else{
+                url += '&';
+            }
+            url = url + "bust=" +  (new Date()).getTime();
             return file.readFileAsync(path, encoding).then(function (text) {
                 require._cachedRawText[path] = text;
                 return text;


