Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-13T09:58:27-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/e3f88b57b3bf43493f7f1698b6923f5bb78d04ad

allow products to be installed that have both uninstall and install profiles. Previously, if profiles were read in a certain order, it would be understood as only an uninstall profile and then the addon would not show up here

Files changed:
M Products/CMFPlone/controlpanel/browser/quickinstaller.py

diff --git a/Products/CMFPlone/controlpanel/browser/quickinstaller.py b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
index 83414c5..28daa19 100644
--- a/Products/CMFPlone/controlpanel/browser/quickinstaller.py
+++ b/Products/CMFPlone/controlpanel/browser/quickinstaller.py
@@ -93,7 +93,10 @@ def marshall_addons(self):
                 product['profile_type'] = profile_type
             elif profile_type == 'uninstall':
                 product['uninstall_profile'] = profile
-                product['profile_type'] = profile_type
+                if 'profile_type' not in product:
+                    # if this is the only profile installed, it could just be an uninstall
+                    # profile
+                    product['profile_type'] = profile_type
             else:
                 if 'version' in profile:
                     product['upgrade_profiles'][profile['version']] = profile
@@ -119,6 +122,8 @@ def get_addons(self, apply_filter=None, product_name=None):
         addons = self.marshall_addons()
         filtered = {}
         for product_id, addon in addons.items():
+            if 'media' in product_id:
+                import pdb; pdb.set_trace()
             if product_name and addon['id'] != product_name:
                 continue
 


