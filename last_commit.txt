Repository: plone.protect


Branch: refs/heads/master
Date: 2015-11-02T12:18:23+01:00
Author: Lukas Graf (lukasgraf) <lukas.graf@4teamwork.ch>
Commit: https://github.com/plone/plone.protect/commit/e4253e5ed744f97dac020524529c45065c3f3a8d

Make sure transforms don't fail on redirects:

ProtectTransform.parseTree() previously returned a the result
(a list or a string) directly for redirects (301, 302), causing
transform() to fail because it always expects parseTree() to
return either None or an XMLSerializer object. By returning
None from parseTree() for redirects, we just avoid transforming
those completely.

Files changed:
M CHANGES.rst
M plone/protect/auto.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2e68ae3..82a9484 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*"
+- Make sure transforms don't fail on redirects.
+  [lgraf]
 
 
 3.0.15 (2015-10-30)
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index aa64686..6e4d784 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -67,10 +67,10 @@ def __init__(self, published, request):
         self.request = request
 
     def parseTree(self, result, encoding):
-        # if it's a redirect, the result is empty
+        # if it's a redirect, the result shall not be transformed
         request = getRequest()
         if request.response.status in (301, 302):
-            return result
+            return None
 
         if isinstance(result, XMLSerializer):
             return result


Repository: plone.protect


Branch: refs/heads/master
Date: 2015-11-02T07:57:38-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.protect/commit/1a624bb5c74660158a395606c35b0749b3c087c2

Merge pull request #30 from plone/lg-fix-transforms-on-redirects

Make sure transforms don't fail on redirects

Files changed:
M CHANGES.rst
M plone/protect/auto.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 2e68ae3..82a9484 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*"
+- Make sure transforms don't fail on redirects.
+  [lgraf]
 
 
 3.0.15 (2015-10-30)
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index aa64686..6e4d784 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -67,10 +67,10 @@ def __init__(self, published, request):
         self.request = request
 
     def parseTree(self, result, encoding):
-        # if it's a redirect, the result is empty
+        # if it's a redirect, the result shall not be transformed
         request = getRequest()
         if request.response.status in (301, 302):
-            return result
+            return None
 
         if isinstance(result, XMLSerializer):
             return result


