Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-06T14:10:16-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/703eef4e2d954339296da7bd797170084644a161

if portal root, syndication is allowed

Files changed:
M Products/CMFPlone/browser/syndication/utils.py
M Products/CMFPlone/browser/syndication/views.py

diff --git a/Products/CMFPlone/browser/syndication/utils.py b/Products/CMFPlone/browser/syndication/utils.py
index d297f79..93f0827 100644
--- a/Products/CMFPlone/browser/syndication/utils.py
+++ b/Products/CMFPlone/browser/syndication/utils.py
@@ -20,7 +20,7 @@ class SyndicationUtil(BrowserView):
     def allowed_feed_types(self):
         settings = IFeedSettings(self.context)
         factory = getUtility(IVocabularyFactory,
-            "plone.app.vocabularies.SyndicationFeedTypes")
+                             "plone.app.vocabularies.SyndicationFeedTypes")
         vocabulary = factory(self.context)
         types = []
         for typ in settings.feed_types:
diff --git a/Products/CMFPlone/browser/syndication/views.py b/Products/CMFPlone/browser/syndication/views.py
index 86a696c..6d064e0 100644
--- a/Products/CMFPlone/browser/syndication/views.py
+++ b/Products/CMFPlone/browser/syndication/views.py
@@ -23,7 +23,9 @@ def feed(self):
     def __call__(self):
         util = getMultiAdapter((self.context, self.request),
                                name='syndication-util')
-        if util.context_enabled(raise404=True):
+        context_state = getMultiAdapter((self.context, self.request),
+                                        name=u'plone_context_state')
+        if context_state.is_portal_root() or util.context_enabled(raise404=True):
             settings = IFeedSettings(self.context)
             if self.__name__ not in settings.feed_types:
                 raise NotFound
@@ -50,10 +52,10 @@ def __call__(self):
 
 class SettingsForm(form.EditForm):
     label = _(u'heading_syndication_properties',
-        default=u'Syndication Properties')
+              default=u'Syndication Properties')
     description = _(u'description_syndication_properties',
-        default=u'Syndication enables you to syndicate this folder so it can'
-                u'be synchronized from other web sites.')
+                    default=u'Syndication enables you to syndicate this folder so it can'
+                            u'be synchronized from other web sites.')
     fields = field.Fields(IFeedSettings)
 
     @button.buttonAndHandler(_(u'Save'), name='save')


