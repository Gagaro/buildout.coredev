Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-01-13T10:22:34+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/d1de2f4f80e4005d19f6efcda7951d9ff7404c20

whitespace

Files changed:
M Products/CMFPlone/resources/viewlets/__init__.py

diff --git a/Products/CMFPlone/resources/viewlets/__init__.py b/Products/CMFPlone/resources/viewlets/__init__.py
index 16b6374..2fc0fe7 100644
--- a/Products/CMFPlone/resources/viewlets/__init__.py
+++ b/Products/CMFPlone/resources/viewlets/__init__.py
@@ -1,4 +1,3 @@
-
 from Products.ResourceRegistries.interfaces.registries import IResourceRegistry
 from Products.ResourceRegistries.interfaces.registries import ICSSRegistry
 from Products.ResourceRegistries.interfaces.registries import IKSSRegistry


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-01-13T10:31:13+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/6966e636e9a2a6d0dd17762841c3e430c467017c

Fix the resource registry to save the automatically generated filepath to the compiled resource on the bundle object after compilation. The filepath is always in the '++plone++static/' namespace. This fix makes custom bundles actually includable.

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/resourceregistry.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b3d615b..3ada11c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,12 @@ Changelog
 5.0b1 (unreleased)
 ------------------
 
+- Fix the resource registry to save the automatically generated filepath to the
+  compiled resource on the bundle object after compilation. The filepath is
+  always in the '++plone++static/' namespace. This fix makes custom bundles
+  actually includable.
+  [thet]
+
 - Get icon from layout_view instead of plone_view.
   [pbauer]
 
diff --git a/Products/CMFPlone/controlpanel/browser/resourceregistry.py b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
index 77270bc..07cc30f 100644
--- a/Products/CMFPlone/controlpanel/browser/resourceregistry.py
+++ b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
@@ -240,6 +240,7 @@ def save_js_build(self):
         bundle = self.get_bundles().get(req.form['bundle'])
         if bundle:
             bundle.last_compilation = datetime.now()
+            bundle.jscompilation = '++plone++{}'.format(filepath)
         return json.dumps({
             'success': True,
             'filepath': '++plone++' + filepath
@@ -255,6 +256,7 @@ def save_less_build(self):
         bundle = self.get_bundles().get(req.form['bundle'])
         if bundle:
             bundle.last_compilation = datetime.now()
+            bundle.csscompilation = '++plone++{}'.format(filepath)
         return json.dumps({
             'success': True,
             'filepath': '++plone++' + filepath


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-01-13T08:04:19-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/e00f34bae6c4c33f85a134f48b4b33afcc0cb1eb

Merge pull request #350 from plone/thet-custombundlefix

custom bundle fix

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/resourceregistry.py
M Products/CMFPlone/resources/viewlets/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index b3d615b..3ada11c 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,12 @@ Changelog
 5.0b1 (unreleased)
 ------------------
 
+- Fix the resource registry to save the automatically generated filepath to the
+  compiled resource on the bundle object after compilation. The filepath is
+  always in the '++plone++static/' namespace. This fix makes custom bundles
+  actually includable.
+  [thet]
+
 - Get icon from layout_view instead of plone_view.
   [pbauer]
 
diff --git a/Products/CMFPlone/controlpanel/browser/resourceregistry.py b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
index 77270bc..07cc30f 100644
--- a/Products/CMFPlone/controlpanel/browser/resourceregistry.py
+++ b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
@@ -240,6 +240,7 @@ def save_js_build(self):
         bundle = self.get_bundles().get(req.form['bundle'])
         if bundle:
             bundle.last_compilation = datetime.now()
+            bundle.jscompilation = '++plone++{}'.format(filepath)
         return json.dumps({
             'success': True,
             'filepath': '++plone++' + filepath
@@ -255,6 +256,7 @@ def save_less_build(self):
         bundle = self.get_bundles().get(req.form['bundle'])
         if bundle:
             bundle.last_compilation = datetime.now()
+            bundle.csscompilation = '++plone++{}'.format(filepath)
         return json.dumps({
             'success': True,
             'filepath': '++plone++' + filepath
diff --git a/Products/CMFPlone/resources/viewlets/__init__.py b/Products/CMFPlone/resources/viewlets/__init__.py
index 16b6374..2fc0fe7 100644
--- a/Products/CMFPlone/resources/viewlets/__init__.py
+++ b/Products/CMFPlone/resources/viewlets/__init__.py
@@ -1,4 +1,3 @@
-
 from Products.ResourceRegistries.interfaces.registries import IResourceRegistry
 from Products.ResourceRegistries.interfaces.registries import ICSSRegistry
 from Products.ResourceRegistries.interfaces.registries import IKSSRegistry


