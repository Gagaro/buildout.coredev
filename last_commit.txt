Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-24T12:26:51+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.querystring/commit/3e7b902679c254912b28e6f257582a3db8b5c881

fix migration from p4 to p5

Files changed:
M plone/app/querystring/upgrades.py

diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index 8581806..67adfeb 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -42,6 +42,9 @@ def fix_select_all_existing_collections(context):
         obj = brain.getObject()
         fixed_querystring = list()
         for querystring in obj.query:
+            # transform querystring to dict
+            if not isinstance(querystring, dict):
+                querystring = dict(querystring)
             if querystring['i'] in indexes_to_fix:
                 for old_operator, new_operator in operator_mapping.items():
                     if querystring['o'] == old_operator:


Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-24T13:26:26+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.querystring/commit/db1c8114215a51e876ec1184c7fb10c3598fa759

Merge pull request #42 from plone/fix_upgrade

fix migration from p4 to p5

Files changed:
M plone/app/querystring/upgrades.py

diff --git a/plone/app/querystring/upgrades.py b/plone/app/querystring/upgrades.py
index 8581806..67adfeb 100644
--- a/plone/app/querystring/upgrades.py
+++ b/plone/app/querystring/upgrades.py
@@ -42,6 +42,9 @@ def fix_select_all_existing_collections(context):
         obj = brain.getObject()
         fixed_querystring = list()
         for querystring in obj.query:
+            # transform querystring to dict
+            if not isinstance(querystring, dict):
+                querystring = dict(querystring)
             if querystring['i'] in indexes_to_fix:
                 for old_operator, new_operator in operator_mapping.items():
                     if querystring['o'] == old_operator:


