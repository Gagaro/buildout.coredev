Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2015-11-21T19:57:00-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/79576d742f5b2520e8b8b75d64f285d1e346689d

in AjaxAutocompleteWidget, allowNewItems should be false for Choice fields

Files changed:
M CHANGES.rst
M plone/app/z3cform/tests/test_widgets.py
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a947ee4..59eaaae 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Don't allow adding new terms in the AjaxAutocompleteWidget
+  when it's used with a Choice field.
+  [davisagli]
 
 
 1.1.6 (2015-10-27)
diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index f964966..edcb662 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -754,6 +754,7 @@ def test_widget_choice(self):
                 'pattern_options': {
                     'separator': ';',
                     'maximumSelectionSize': 1,
+                    'allowNewItems': 'false',
                     'vocabularyUrl':
                     'http://127.0.0.1/++widget++choicefield/@@getSource',
                     },
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 13a5b6a..c74cbf0 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -322,6 +322,8 @@ def _base_args(self):
             field = self.field
         elif ICollection.providedBy(self.field):
             field = self.field.value_type
+        if IChoice.providedBy(field):
+            args['pattern_options']['allowNewItems'] = 'false'
         if not vocabulary_name and field is not None:
             vocabulary_name = field.vocabularyName
 


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2015-11-21T23:34:32-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.z3cform/commit/e9b6103b0ea27cd8573e06a8455bb5532d5d965a

Merge pull request #32 from plone/davisagli-fix-allowNewItems

in AjaxSelectWidget, allowNewItems should be false for Choice fields

Files changed:
M CHANGES.rst
M plone/app/z3cform/tests/test_widgets.py
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index a947ee4..59eaaae 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,9 @@ New:
 
 Fixes:
 
-- *add item here*
+- Don't allow adding new terms in the AjaxAutocompleteWidget
+  when it's used with a Choice field.
+  [davisagli]
 
 
 1.1.6 (2015-10-27)
diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index f964966..edcb662 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -754,6 +754,7 @@ def test_widget_choice(self):
                 'pattern_options': {
                     'separator': ';',
                     'maximumSelectionSize': 1,
+                    'allowNewItems': 'false',
                     'vocabularyUrl':
                     'http://127.0.0.1/++widget++choicefield/@@getSource',
                     },
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 13a5b6a..c74cbf0 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -322,6 +322,8 @@ def _base_args(self):
             field = self.field
         elif ICollection.providedBy(self.field):
             field = self.field.value_type
+        if IChoice.providedBy(field):
+            args['pattern_options']['allowNewItems'] = 'false'
         if not vocabulary_name and field is not None:
             vocabulary_name = field.vocabularyName
 


