Repository: mockup


Branch: refs/heads/master
Date: 2015-07-08T08:38:50-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/1aac2b7fd0168274b654d669a14a440ab98373b2

fix select2 widget use of allowNewItems so that we can restrict select2
  value to only what is in the vocabulary

Files changed:
M CHANGES.rst
M mockup/patterns/select2/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index eceabee..4cfcc4f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,10 +4,13 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- fix select2 widget's use of allowNewItems so that we can restrict select2
+  value to only what is in the vocabulary
+  [vangheem]
+
 - rename "columns" and "selected" structure popover classes to "attribute-columns"
   and "selected-items" to prevent the possibility of clashing with other css
   as they are common class names.
-  [vangheem]
 
 - Update structure pattern to have buttons be more generic and extensible
   [vangheem]
diff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js
index d600196..70fd5ef 100644
--- a/mockup/patterns/select2/pattern.js
+++ b/mockup/patterns/select2/pattern.js
@@ -4,6 +4,7 @@
  *    separator(string): Analagous to the separator constructor parameter from Select2. Defines a custom separator used to distinguish the tag values. Ex: a value of ";" will allow tags and initialValues to have values separated by ";" instead of the default ",". (',')
  *    initialValues(string): This can be a json encoded string, or a list of id:text values. Ex: Red:The Color Red,Orange:The Color Orange  This is used inside the initSelection method, if AJAX options are NOT set. (null)
  *    vocabularyUrl(string): This is a URL to a JSON-formatted file used to populate the list (null)
+ *    allowNewItems(string): All new items to be entered into the widget(true)
  *    OTHER OPTIONS(): For more options on select2 go to http://ivaynberg.github.io/select2/#documentation ()
  *
  * Documentation:
@@ -250,11 +251,9 @@ define([
                 results.push({id: queryTerm, text: queryTerm});
               }
 
-              if (haveResult || self.options.allowNewItems) {
-                $.each(data.results, function(i, item) {
-                  results.push(item);
-                });
-              }
+              $.each(data.results, function(i, item) {
+                results.push(item);
+              });
             }
             return { results: results };
           }


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-08T09:43:26-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/9237aeb3b0d22c00af14df855ad592aa30244037

fix test

Files changed:
M mockup/tests/pattern-select2-test.js

diff --git a/mockup/tests/pattern-select2-test.js b/mockup/tests/pattern-select2-test.js
index c49bdc9..3c08c45 100644
--- a/mockup/tests/pattern-select2-test.js
+++ b/mockup/tests/pattern-select2-test.js
@@ -237,10 +237,10 @@ define([
       this.clock.tick(1000);
 
       var $results = $('li.select2-result-selectable');
-      expect($results.size()).to.equal(0);
+      expect($results.size()).to.equal(3);
 
       var $noResults = $('li.select2-no-results');
-      expect($noResults.size()).to.equal(1);
+      expect($noResults.size()).to.equal(0);
     });
 
     it('HTML multiple select widget converted to hidden inuput, before applying select2', function() {


Repository: mockup


Branch: refs/heads/master
Date: 2015-07-08T17:07:25+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/mockup/commit/38d117b98552edcdc423cfbf1856becfcd4f1ab7

Merge pull request #517 from plone/fix-allowNewItems

fix select2 widget use of allowNewItems

Files changed:
M CHANGES.rst
M mockup/patterns/select2/pattern.js
M mockup/tests/pattern-select2-test.js

diff --git a/CHANGES.rst b/CHANGES.rst
index eceabee..4cfcc4f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,10 +4,13 @@ Changelog
 2.0.5 (unreleased)
 ------------------
 
+- fix select2 widget's use of allowNewItems so that we can restrict select2
+  value to only what is in the vocabulary
+  [vangheem]
+
 - rename "columns" and "selected" structure popover classes to "attribute-columns"
   and "selected-items" to prevent the possibility of clashing with other css
   as they are common class names.
-  [vangheem]
 
 - Update structure pattern to have buttons be more generic and extensible
   [vangheem]
diff --git a/mockup/patterns/select2/pattern.js b/mockup/patterns/select2/pattern.js
index d600196..70fd5ef 100644
--- a/mockup/patterns/select2/pattern.js
+++ b/mockup/patterns/select2/pattern.js
@@ -4,6 +4,7 @@
  *    separator(string): Analagous to the separator constructor parameter from Select2. Defines a custom separator used to distinguish the tag values. Ex: a value of ";" will allow tags and initialValues to have values separated by ";" instead of the default ",". (',')
  *    initialValues(string): This can be a json encoded string, or a list of id:text values. Ex: Red:The Color Red,Orange:The Color Orange  This is used inside the initSelection method, if AJAX options are NOT set. (null)
  *    vocabularyUrl(string): This is a URL to a JSON-formatted file used to populate the list (null)
+ *    allowNewItems(string): All new items to be entered into the widget(true)
  *    OTHER OPTIONS(): For more options on select2 go to http://ivaynberg.github.io/select2/#documentation ()
  *
  * Documentation:
@@ -250,11 +251,9 @@ define([
                 results.push({id: queryTerm, text: queryTerm});
               }
 
-              if (haveResult || self.options.allowNewItems) {
-                $.each(data.results, function(i, item) {
-                  results.push(item);
-                });
-              }
+              $.each(data.results, function(i, item) {
+                results.push(item);
+              });
             }
             return { results: results };
           }
diff --git a/mockup/tests/pattern-select2-test.js b/mockup/tests/pattern-select2-test.js
index c49bdc9..3c08c45 100644
--- a/mockup/tests/pattern-select2-test.js
+++ b/mockup/tests/pattern-select2-test.js
@@ -237,10 +237,10 @@ define([
       this.clock.tick(1000);
 
       var $results = $('li.select2-result-selectable');
-      expect($results.size()).to.equal(0);
+      expect($results.size()).to.equal(3);
 
       var $noResults = $('li.select2-no-results');
-      expect($noResults.size()).to.equal(1);
+      expect($noResults.size()).to.equal(0);
     });
 
     it('HTML multiple select widget converted to hidden inuput, before applying select2', function() {


