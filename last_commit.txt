Repository: plone.app.querystring


Branch: refs/heads/1.2.x
Date: 2015-08-03T18:12:51+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.querystring/commit/a59c1553e9df5d2b7aef73dbeb59253540d66b5f

Fixed possible problem with 'custom_query' parameter.

Theoretically a second invocation could inadvertently be using the
value from the first invocation.

Do not use a dictionary (or any mutable object) as a default value for
a keyword argument.

Files changed:
M CHANGES.rst
M plone/app/querystring/querybuilder.py

diff --git a/CHANGES.rst b/CHANGES.rst
index f5fb13e..c530b9f 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,10 @@ Changelog
 1.2.7 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed possible problem with ``custom_query`` parameter where
+  theoretically a second invocation could inadvertently be using the
+  value from the first invocation.
+  [maurits]
 
 
 1.2.6 (2015-05-31)
diff --git a/plone/app/querystring/querybuilder.py b/plone/app/querystring/querybuilder.py
index 99f1958..01117f7 100644
--- a/plone/app/querystring/querybuilder.py
+++ b/plone/app/querystring/querybuilder.py
@@ -38,7 +38,7 @@ def __init__(self, context, request):
 
     def __call__(self, query, batch=False, b_start=0, b_size=30,
                  sort_on=None, sort_order=None, limit=0, brains=False,
-                 custom_query={}):
+                 custom_query=None):
         """If there are results, make the query and return the results"""
         if self._results is None:
             self._results = self._makequery(
@@ -68,7 +68,7 @@ def html_results(self, query):
 
     def _makequery(self, query=None, batch=False, b_start=0, b_size=30,
                    sort_on=None, sort_order=None, limit=0, brains=False,
-                   custom_query={}):
+                   custom_query=None):
         """Parse the (form)query and return using multi-adapter"""
         parsedquery = queryparser.parseFormquery(
             self.context, query, sort_on, sort_order)


