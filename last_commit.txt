Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2015-09-29T23:50:53+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.upgrade/commit/a0736f65b7a34f144807bcdefaf276ce5d9b143a

Moved new QI/GS related steps to run for Plone 4.3.8 and 5.0.1.

Files changed:
M plone/app/upgrade/v43/configure.zcml
M plone/app/upgrade/v50/configure.zcml

diff --git a/plone/app/upgrade/v43/configure.zcml b/plone/app/upgrade/v43/configure.zcml
index e1e9928..6d237c8 100644
--- a/plone/app/upgrade/v43/configure.zcml
+++ b/plone/app/upgrade/v43/configure.zcml
@@ -182,6 +182,25 @@
             handler=".final.improveSyndication"
             />
 
+    </genericsetup:upgradeSteps>
+
+    <genericsetup:upgradeSteps
+        source="4310"
+        destination="4311"
+        profile="Products.CMFPlone:plone">
+
+        <genericsetup:upgradeStep
+            title="Miscellaneous"
+            description=""
+            handler="..utils.null_upgrade_step"
+            />
+    </genericsetup:upgradeSteps>
+
+    <genericsetup:upgradeSteps
+        source="4311"
+        destination="4312"
+        profile="Products.CMFPlone:plone">
+
        <genericsetup:upgradeStep
            title="Unmark installed profiles that are no longer available."
            description="This removes no longer interesting info."
@@ -202,16 +221,4 @@
 
     </genericsetup:upgradeSteps>
 
-    <genericsetup:upgradeSteps
-        source="4310"
-        destination="4311"
-        profile="Products.CMFPlone:plone">
-
-        <genericsetup:upgradeStep
-            title="Miscellaneous"
-            description=""
-            handler="..utils.null_upgrade_step"
-            />
-    </genericsetup:upgradeSteps>
-
 </configure>
diff --git a/plone/app/upgrade/v50/configure.zcml b/plone/app/upgrade/v50/configure.zcml
index 3ac392c..ea9357a 100644
--- a/plone/app/upgrade/v50/configure.zcml
+++ b/plone/app/upgrade/v50/configure.zcml
@@ -231,4 +231,29 @@
 
     </gs:upgradeSteps>
 
+    <gs:upgradeSteps
+        source="5011"
+        destination="5012"
+        profile="Products.CMFPlone:plone">
+
+       <gs:upgradeStep
+           title="Unmark installed profiles that are no longer available."
+           description="This removes no longer interesting info."
+           handler="plone.app.upgrade.v43.final.unmarkUnavailableProfiles"
+           />
+
+       <gs:upgradeStep
+           title="Mark products as installed for installed uninstallable profiles"
+           description="The profiles were meant to be hidden, not uninstallable."
+           handler="plone.app.upgrade.v43.final.markProductsInstalledForUninstallableProfiles"
+           />
+
+       <gs:upgradeStep
+           title="Cleanup uninstalled products"
+           description="Remove uninstalled products from QI and mark their profiles as unknown."
+           handler="plone.app.upgrade.v43.final.cleanupUninstalledProducts"
+           />
+
+    </gs:upgradeSteps>
+
 </configure>


