Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-12T23:01:57+03:00
Author: ichim-david (ichim-david) <ichim.david@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/dd63d130f6e7a45967a55ac9e8eb1e159d3d55b3

Fix #952 menu completely misplaced because of link duplication

Files changed:
M Products/CMFPlone/static/patterns/toolbar/src/toolbar.js

diff --git a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js
index ce51899..67ea3d5 100644
--- a/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js
+++ b/Products/CMFPlone/static/patterns/toolbar/src/toolbar.js
@@ -236,7 +236,9 @@ define([
           $('[id^="plone-contentmenu-"]').hide();
           $('.plone-toolbar-main').append('<li id="plone-toolbar-more-options"><a href="#"><span class="icon-moreOptions" aria-hidden="true"></span><span>' + _t('More') + '</span><span class="plone-toolbar-caret"></span></a></li>');
           $('#personal-bar-container').after('<ul id="plone-toolbar-more-subset" style="display: none"></ul>');
-          $( "[id^=plone-contentmenu-]" ).each(function() {
+          // we want only the list items with id that contains plone-contentmenu and not the children links
+          // of these lists therefore we iterate only over the list elements
+          $("li[id^=plone-contentmenu-]").each(function() {
             $(this).clone(true, true).appendTo( "#plone-toolbar-more-subset" );
             $('[id^=plone-contentmenu-]', '#plone-toolbar-more-subset').show();
           });


