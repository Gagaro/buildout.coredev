Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2015-10-01T02:39:08+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.Archetypes/commit/55f7a11ced2add27b16dee9bfd74e503e8e23c43

Do not patch registry in widget tests.

This was for types_use_folder_contents, which is no longer used.

Files changed:
M Products/Archetypes/tests/test_pawidgets.py

diff --git a/Products/Archetypes/tests/test_pawidgets.py b/Products/Archetypes/tests/test_pawidgets.py
index fd0d98b..1bf7707 100644
--- a/Products/Archetypes/tests/test_pawidgets.py
+++ b/Products/Archetypes/tests/test_pawidgets.py
@@ -321,10 +321,6 @@ class ExampleContent(object):
             implements(IAttributeUUID)
 
         with mock.patch('plone.app.widgets.utils.getUtility') as mock_method:
-            registry = Mock()
-            registry.get.return_value = ['SomeType']
-            mock_method.return_value = registry
-
             obj1 = ExampleContent()
             obj2 = ExampleContent()
             notify(ObjectCreatedEvent(obj1))
@@ -333,7 +329,6 @@ class ExampleContent(object):
             self.field.getName.return_value = 'fieldname'
             self.field.getAccessor.return_value = lambda: [obj1, obj2]
             self.field.multiValued = True
-            self.context.portal_registry.get.return_value = ['SomeType']
 
             widget = RelatedItemsWidget()
 
@@ -343,7 +338,7 @@ class ExampleContent(object):
                     'value': '{};{}'.format(IUUID(obj1), IUUID(obj2)),
                     'pattern': 'relateditems',
                     'pattern_options': {
-                        'folderTypes': ['SomeType'],
+                        'folderTypes': ['Folder'],
                         'homeText': u'Home',
                         'searchAllText': u'Entire site',
                         'searchText': u'Search',
@@ -377,10 +372,6 @@ class ExampleContent(object):
         self.field.multiValued = False
 
         with mock.patch('plone.app.widgets.utils.getUtility') as mock_method:
-            registry = Mock()
-            registry.get.return_value = ['SomeType']
-            mock_method.return_value = registry
-
             widget = RelatedItemsWidget()
 
             self.assertEqual(
@@ -389,7 +380,7 @@ class ExampleContent(object):
                     'value': '{}'.format(IUUID(obj1)),
                     'pattern': 'relateditems',
                     'pattern_options': {
-                        'folderTypes': ['SomeType'],
+                        'folderTypes': ['Folder'],
                         'homeText': u'Home',
                         'separator': ';',
                         'orderable': True,
@@ -412,10 +403,6 @@ def test_single_valued_empty(self):
         self.field.multiValued = False
 
         with mock.patch('plone.app.widgets.utils.getUtility') as mock_method:
-            registry = Mock()
-            registry.get.return_value = ['SomeType']
-            mock_method.return_value = registry
-
             widget = RelatedItemsWidget()
 
             self.assertEqual(
@@ -424,7 +411,7 @@ def test_single_valued_empty(self):
                     'value': '',
                     'pattern': 'relateditems',
                     'pattern_options': {
-                        'folderTypes': ['SomeType'],
+                        'folderTypes': ['Folder'],
                         'homeText': u'Home',
                         'separator': ';',
                         'orderable': True,
@@ -456,10 +443,6 @@ class ExampleContent(object):
         notify(ObjectCreatedEvent(obj2))
 
         with mock.patch('plone.app.widgets.utils.getUtility') as mock_method:
-            registry = Mock()
-            registry.get.return_value = ['SomeType']
-            mock_method.return_value = registry
-
             self.context.fieldvalue = lambda: obj1
 
             field1 = ReferenceField(
@@ -476,7 +459,7 @@ class ExampleContent(object):
                     'value': '{}'.format(IUUID(obj1)),
                     'pattern': 'relateditems',
                     'pattern_options': {
-                        'folderTypes': ['SomeType'],
+                        'folderTypes': ['Folder'],
                         'homeText': u'Home',
                         'separator': ';',
                         'orderable': True,
@@ -506,7 +489,7 @@ class ExampleContent(object):
                     'value': '{};{}'.format(IUUID(obj1), IUUID(obj2)),
                     'pattern': 'relateditems',
                     'pattern_options': {
-                        'folderTypes': ['SomeType'],
+                        'folderTypes': ['Folder'],
                         'homeText': u'Home',
                         'separator': ';',
                         'orderable': True,


