Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-04-16T13:29:48+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/1c24b1fc9a7d418c607273a8066ce3ec4ddbabb4

we dont have a batch in here

Files changed:
M plone/app/contenttypes/browser/templates/listing_album.pt

diff --git a/plone/app/contenttypes/browser/templates/listing_album.pt b/plone/app/contenttypes/browser/templates/listing_album.pt
index 61f46e6..7eede71 100644
--- a/plone/app/contenttypes/browser/templates/listing_album.pt
+++ b/plone/app/contenttypes/browser/templates/listing_album.pt
@@ -67,7 +67,7 @@
 
   <metal:empty metal:define-slot="no_items_in_listing">
     <p class="discreet"
-        tal:condition="not: view/batch"
+        tal:condition="python: not images and not albums"
         tal:content="view/no_items_message">
       There are currently no items in this folder.
     </p>


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-04-16T13:29:57+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/f458465ce6837d337f5e616ad1ecb97bfde74d58

Don't batch the already batched collection results. Fixes #221.

Files changed:
M docs/CHANGES.rst
M plone/app/contenttypes/browser/collection.py
M plone/app/contenttypes/browser/folder.py

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 6a25092..370ce78 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -11,6 +11,9 @@ Changelog
   changes in ``plone.app.z3cform``.
   [thet]
 
+- Don't batch the already batched collection results. Fixes #221.
+  [thet]
+
 - Update image_view_fullscreen.pt for mobile friendliness.
   [fulv]
 
diff --git a/plone/app/contenttypes/browser/collection.py b/plone/app/contenttypes/browser/collection.py
index bfafca0..017b241 100644
--- a/plone/app/contenttypes/browser/collection.py
+++ b/plone/app/contenttypes/browser/collection.py
@@ -34,7 +34,12 @@ def results(self, **kwargs):
         kwargs.setdefault('b_size', self.b_size)
         kwargs.setdefault('b_start', self.b_start)
 
-        return self.collection_behavior.results(**kwargs)
+        results = self.collection_behavior.results(**kwargs)
+        return results
+
+    def batch(self):
+        # collection is already batched.
+        return self.results()
 
     @property
     @memoize
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 2de8505..5005930 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -61,13 +61,16 @@ def results(self, **kwargs):
         kwargs.setdefault('b_size', self.b_size)
         kwargs.setdefault('b_start', self.b_start)
 
-        results = self.context.restrictedTraverse(
-            '@@folderListing')(**kwargs)
+        results = self.context.restrictedTraverse('@@folderListing')(**kwargs)
         return results
 
     def batch(self):
         batch = Batch(
-            self.results(), size=self.b_size, start=self.b_start, orphan=1)
+            self.results(),
+            size=self.b_size,
+            start=self.b_start,
+            orphan=1
+        )
         return batch
 
     def normalizeString(self, text):


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-04-16T13:30:54+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/56cf23cb0cf31249a6960c602cc9c527c2784bbc

reorder changelog

Files changed:
M docs/CHANGES.rst

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 370ce78..304975b 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 1.2a8 (unreleased)
 ------------------
 
+- Don't batch the already batched collection results. Fixes #221.
+  [thet]
+
 - I18n fixes.
   [vincentfretin]
 
@@ -11,9 +14,6 @@ Changelog
   changes in ``plone.app.z3cform``.
   [thet]
 
-- Don't batch the already batched collection results. Fixes #221.
-  [thet]
-
 - Update image_view_fullscreen.pt for mobile friendliness.
   [fulv]
 


