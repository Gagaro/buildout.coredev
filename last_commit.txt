Repository: plone.app.querystring


Branch: refs/heads/master
Date: 2015-08-20T07:24:13+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.querystring/commit/64c400f284f425248431ba1b6af937356e2a508d

Hide upgrade-profiles when creating a new site

Files changed:
A plone/app/querystring/hiddenprofiles.py
M CHANGES.rst
M plone/app/querystring/profiles.zcml

diff --git a/CHANGES.rst b/CHANGES.rst
index 0429385..72c272b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 1.3.4 (unreleased)
 ------------------
 
+- Hide upgrade-profiles when creating a new site.
+  [pbauer]
+
 - Use selection.all for portal_types, review_state and Creator operations.
   [frapell]
 
diff --git a/plone/app/querystring/hiddenprofiles.py b/plone/app/querystring/hiddenprofiles.py
new file mode 100644
index 0000000..00a2c3a
--- /dev/null
+++ b/plone/app/querystring/hiddenprofiles.py
@@ -0,0 +1,24 @@
+# -*- coding: utf-8 -*-
+from Products.CMFPlone.interfaces import INonInstallable as \
+    INonInstallableProfiles
+from zope.interface import implementer
+
+
+@implementer(INonInstallableProfiles)
+class HiddenProfiles(object):
+
+    def getNonInstallableProfiles(self):
+        """Returns a list of profiles that should not be available for
+           installation at portal creation time.
+
+           The usual use-case is to prevent extension profiles from showing up,
+           that will be installed as part of the site creation anyways.
+        """
+        return [
+            'plone.app.querystring:upgrade_to_3',
+            'plone.app.querystring:upgrade_to_5',
+            'plone.app.querystring:upgrade_to_6',
+            'plone.app.querystring:upgrade_to_7',
+            'plone.app.querystring:upgrade_to_8',
+            'plone.app.querystring:upgrade_to_9',
+        ]
diff --git a/plone/app/querystring/profiles.zcml b/plone/app/querystring/profiles.zcml
index 5889d72..be2354a 100644
--- a/plone/app/querystring/profiles.zcml
+++ b/plone/app/querystring/profiles.zcml
@@ -3,6 +3,12 @@
         xmlns:genericsetup="http://namespaces.zope.org/genericsetup"
         i18n_domain="plone">
 
+    <utility
+        factory=".hiddenprofiles.HiddenProfiles"
+        name="plone.app.querystring"
+        provides="Products.CMFPlone.interfaces.INonInstallable"
+        />
+
     <genericsetup:registerProfile
         name="default"
         title="Querystring parser/builder"


