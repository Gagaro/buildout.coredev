Repository: Products.contentmigration


Branch: refs/heads/master
Date: 2015-06-18T15:14:17Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/Products.contentmigration/commit/da22c4bdd15bfebe968411cef0ae79c2a57088de

add cmfdocument from CMFDefault to allow testing

Files changed:
A Products/contentmigration/testcontent.py
M Products/contentmigration/__init__.py
M Products/contentmigration/configure.zcml
M Products/contentmigration/profiles/testing/types/CMF_Document.xml
M Products/contentmigration/tests/layer.py

diff --git a/Products/contentmigration/__init__.py b/Products/contentmigration/__init__.py
index 3788810..9907604 100644
--- a/Products/contentmigration/__init__.py
+++ b/Products/contentmigration/__init__.py
@@ -1 +1,13 @@
-# And as if by magic, this folder is a python package
\ No newline at end of file
+# initialize cmf test content
+from Products.CMFCore import permissions
+
+def initialize(context):
+    import Products.contentmigration.testcontent
+    from Products.CMFCore import utils
+    utils.ContentInit(
+            'CMF Default Content',
+            content_types=(),
+            permission=permissions.AddPortalContent,
+            extra_constructors=(testcontent.addDocument,),
+            visibility=None,
+            ).initialize(context)
diff --git a/Products/contentmigration/configure.zcml b/Products/contentmigration/configure.zcml
index 5983c8e..d897ff3 100644
--- a/Products/contentmigration/configure.zcml
+++ b/Products/contentmigration/configure.zcml
@@ -1,5 +1,8 @@
 <configure
     xmlns="http://namespaces.zope.org/zope"
+    xmlns:five="http://namespaces.zope.org/five"
     i18n_domain="Products.contentmigration">
 
+  <five:registerPackage package="." initialize=".initialize" />
+
 </configure>
diff --git a/Products/contentmigration/profiles/testing/types/CMF_Document.xml b/Products/contentmigration/profiles/testing/types/CMF_Document.xml
index a8d1453..213b653 100644
--- a/Products/contentmigration/profiles/testing/types/CMF_Document.xml
+++ b/Products/contentmigration/profiles/testing/types/CMF_Document.xml
@@ -7,7 +7,7 @@
   They may also contain HTML, or "plain" text.</property>
  <property name="content_icon">document_icon.gif</property>
  <property name="content_meta_type">Document</property>
- <property name="product">CMFDefault</property>
+ <property name="product">contentmigration</property>
  <property name="factory">addDocument</property>
  <property name="immediate_view">document_view</property>
  <property name="global_allow">False</property>
diff --git a/Products/contentmigration/testcontent.py b/Products/contentmigration/testcontent.py
new file mode 100644
index 0000000..e38ad94
--- /dev/null
+++ b/Products/contentmigration/testcontent.py
@@ -0,0 +1,25 @@
+from App.class_init import InitializeClass
+from Products.Archetypes import atapi
+from Products.CMFCore.PortalContent import PortalContent
+from zope.component.factory import Factory
+
+def addDocument(self, id, title='', description='', text_format='', text=''):
+    """Add a Document.
+    """
+    o = Document(id, title, description, text_format, text)
+    self._setObject(id, o, suppress_events=True)
+
+
+class Document(PortalContent):
+    """ A Document """
+
+    def __init__(self, id, title='', description='', text_format='', text=''):
+        self.id = id
+        self.title = title
+        self.description = description
+
+    def Title(self):
+        return self.title
+
+InitializeClass(Document)
+DocumentFactory = Factory(Document)
diff --git a/Products/contentmigration/tests/layer.py b/Products/contentmigration/tests/layer.py
index 3a83b46..f410e7c 100644
--- a/Products/contentmigration/tests/layer.py
+++ b/Products/contentmigration/tests/layer.py
@@ -1,5 +1,16 @@
 from plone.app.testing import bbb
 from plone.app import testing
+from plone.testing import z2
+from Products.GenericSetup import EXTENSION, profile_registry
+
+
+def setupSampleTypeProfile():
+    profile_registry.registerProfile('CMF_sampletypes',
+        'CMF Sample Content Types',
+        'Extension profile including CMF sample content types',
+        'profiles/testing',
+        'Products.contentmigration',
+        EXTENSION)
 
 
 class PloneTestCaseFixture(bbb.PloneTestCaseFixture):
@@ -7,9 +18,14 @@ class PloneTestCaseFixture(bbb.PloneTestCaseFixture):
     defaultBases = (bbb.PTC_FIXTURE, )
 
     def setUpZope(self, app, configurationContext):
+        setupSampleTypeProfile()
         from Products import contentmigration
         self.loadZCML('testing.zcml', package=contentmigration)
         self.loadZCML('testing-schemaextender.zcml', package=contentmigration)
+        z2.installProduct(app, 'Products.contentmigration')
+
+    def setUpPloneSite(self, portal):
+        testing.applyProfile(portal, 'Products.contentmigration:CMF_sampletypes')
 
 PCM_FIXTURE = PloneTestCaseFixture()
 TestLayer = testing.FunctionalTesting(


Repository: Products.contentmigration


Branch: refs/heads/master
Date: 2015-06-18T15:15:31Z
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/Products.contentmigration/commit/7926c27dbd8addc8b1da42c685a01ea5979ff32a

document changes

Files changed:
M CHANGES.txt

diff --git a/CHANGES.txt b/CHANGES.txt
index 8e1bf95..1bf7805 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 2.1.11 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Remove implicit dependency on CMFDefault by moving testcontent to product
+  [tomgross]
 
 
 2.1.10 (2015-04-17)


Repository: Products.contentmigration


Branch: refs/heads/master
Date: 2015-06-18T20:42:47+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/Products.contentmigration/commit/0fe7ff26a969b2f1e304181141365c555bb1b699

provide necesssary method stubs for mock document test class

Files changed:
M Products/contentmigration/testcontent.py

diff --git a/Products/contentmigration/testcontent.py b/Products/contentmigration/testcontent.py
index e38ad94..8edb2e0 100644
--- a/Products/contentmigration/testcontent.py
+++ b/Products/contentmigration/testcontent.py
@@ -21,5 +21,12 @@ def __init__(self, id, title='', description='', text_format='', text=''):
     def Title(self):
         return self.title
 
+    def listCreators(self):
+        return ('test_user_1_',)
+
+    def Creator(self):
+        return self.listCreators()[0]
+
+
 InitializeClass(Document)
 DocumentFactory = Factory(Document)


Repository: Products.contentmigration


Branch: refs/heads/master
Date: 2015-06-19T09:54:28+02:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.contentmigration/commit/66a9551b6c4ff34619e0b559c36361d774f537ee

Merge pull request #8 from plone/tomgross-nocmfdefault

Remove implicit dependency on CMFDefault by moving testcontent to product

Files changed:
A Products/contentmigration/testcontent.py
M CHANGES.txt
M Products/contentmigration/__init__.py
M Products/contentmigration/configure.zcml
M Products/contentmigration/profiles/testing/types/CMF_Document.xml
M Products/contentmigration/tests/layer.py

diff --git a/CHANGES.txt b/CHANGES.txt
index 8e1bf95..1bf7805 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 2.1.11 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Remove implicit dependency on CMFDefault by moving testcontent to product
+  [tomgross]
 
 
 2.1.10 (2015-04-17)
diff --git a/Products/contentmigration/__init__.py b/Products/contentmigration/__init__.py
index 3788810..9907604 100644
--- a/Products/contentmigration/__init__.py
+++ b/Products/contentmigration/__init__.py
@@ -1 +1,13 @@
-# And as if by magic, this folder is a python package
\ No newline at end of file
+# initialize cmf test content
+from Products.CMFCore import permissions
+
+def initialize(context):
+    import Products.contentmigration.testcontent
+    from Products.CMFCore import utils
+    utils.ContentInit(
+            'CMF Default Content',
+            content_types=(),
+            permission=permissions.AddPortalContent,
+            extra_constructors=(testcontent.addDocument,),
+            visibility=None,
+            ).initialize(context)
diff --git a/Products/contentmigration/configure.zcml b/Products/contentmigration/configure.zcml
index 5983c8e..d897ff3 100644
--- a/Products/contentmigration/configure.zcml
+++ b/Products/contentmigration/configure.zcml
@@ -1,5 +1,8 @@
 <configure
     xmlns="http://namespaces.zope.org/zope"
+    xmlns:five="http://namespaces.zope.org/five"
     i18n_domain="Products.contentmigration">
 
+  <five:registerPackage package="." initialize=".initialize" />
+
 </configure>
diff --git a/Products/contentmigration/profiles/testing/types/CMF_Document.xml b/Products/contentmigration/profiles/testing/types/CMF_Document.xml
index a8d1453..213b653 100644
--- a/Products/contentmigration/profiles/testing/types/CMF_Document.xml
+++ b/Products/contentmigration/profiles/testing/types/CMF_Document.xml
@@ -7,7 +7,7 @@
   They may also contain HTML, or "plain" text.</property>
  <property name="content_icon">document_icon.gif</property>
  <property name="content_meta_type">Document</property>
- <property name="product">CMFDefault</property>
+ <property name="product">contentmigration</property>
  <property name="factory">addDocument</property>
  <property name="immediate_view">document_view</property>
  <property name="global_allow">False</property>
diff --git a/Products/contentmigration/testcontent.py b/Products/contentmigration/testcontent.py
new file mode 100644
index 0000000..8edb2e0
--- /dev/null
+++ b/Products/contentmigration/testcontent.py
@@ -0,0 +1,32 @@
+from App.class_init import InitializeClass
+from Products.Archetypes import atapi
+from Products.CMFCore.PortalContent import PortalContent
+from zope.component.factory import Factory
+
+def addDocument(self, id, title='', description='', text_format='', text=''):
+    """Add a Document.
+    """
+    o = Document(id, title, description, text_format, text)
+    self._setObject(id, o, suppress_events=True)
+
+
+class Document(PortalContent):
+    """ A Document """
+
+    def __init__(self, id, title='', description='', text_format='', text=''):
+        self.id = id
+        self.title = title
+        self.description = description
+
+    def Title(self):
+        return self.title
+
+    def listCreators(self):
+        return ('test_user_1_',)
+
+    def Creator(self):
+        return self.listCreators()[0]
+
+
+InitializeClass(Document)
+DocumentFactory = Factory(Document)
diff --git a/Products/contentmigration/tests/layer.py b/Products/contentmigration/tests/layer.py
index 3a83b46..f410e7c 100644
--- a/Products/contentmigration/tests/layer.py
+++ b/Products/contentmigration/tests/layer.py
@@ -1,5 +1,16 @@
 from plone.app.testing import bbb
 from plone.app import testing
+from plone.testing import z2
+from Products.GenericSetup import EXTENSION, profile_registry
+
+
+def setupSampleTypeProfile():
+    profile_registry.registerProfile('CMF_sampletypes',
+        'CMF Sample Content Types',
+        'Extension profile including CMF sample content types',
+        'profiles/testing',
+        'Products.contentmigration',
+        EXTENSION)
 
 
 class PloneTestCaseFixture(bbb.PloneTestCaseFixture):
@@ -7,9 +18,14 @@ class PloneTestCaseFixture(bbb.PloneTestCaseFixture):
     defaultBases = (bbb.PTC_FIXTURE, )
 
     def setUpZope(self, app, configurationContext):
+        setupSampleTypeProfile()
         from Products import contentmigration
         self.loadZCML('testing.zcml', package=contentmigration)
         self.loadZCML('testing-schemaextender.zcml', package=contentmigration)
+        z2.installProduct(app, 'Products.contentmigration')
+
+    def setUpPloneSite(self, portal):
+        testing.applyProfile(portal, 'Products.contentmigration:CMF_sampletypes')
 
 PCM_FIXTURE = PloneTestCaseFixture()
 TestLayer = testing.FunctionalTesting(


