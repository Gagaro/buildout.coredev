Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2015-10-14T15:42:57+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/361572edda90cef607b94407e219b69801faf79f

No longer rely on deprecated bobobase_modification_time from Persistence.Persistent.

Files changed:
M CHANGES.rst
M plone/app/dexterity/behaviors/tests/test_id.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4990f7f..e4e48e7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.1.15 (unreleased)
 -------------------
 
+- No longer rely on deprecated ``bobobase_modification_time`` from
+  ``Persistence.Persistent``.
+  [thet]
+
 - Update Traditional Chinese translation.
   [l34marr]
 
diff --git a/plone/app/dexterity/behaviors/tests/test_id.py b/plone/app/dexterity/behaviors/tests/test_id.py
index d768d2d..057854c 100644
--- a/plone/app/dexterity/behaviors/tests/test_id.py
+++ b/plone/app/dexterity/behaviors/tests/test_id.py
@@ -1,3 +1,4 @@
+from DateTime import DateTime
 from plone.app.dexterity.testing import DEXTERITY_FUNCTIONAL_TESTING
 from plone.app.testing import SITE_OWNER_NAME
 from plone.app.testing import SITE_OWNER_PASSWORD
@@ -80,14 +81,14 @@ def test_edit_item_doesnt_rename_if_same_id(self):
         self.browser.getControl('Title').value = 'title'
         self.browser.getControl('Short name').value = 'foo'
         self.browser.getControl('Save').click()
-        mtime = self.layer['portal'].foo.bobobase_modification_time()
+        mtime = DateTime(self.layer['portal'].foo._p_mtime)
         self.browser.getLink('Edit').click()
         self.browser.getControl('Short name').value = 'foo'
         self.browser.getControl('Save').click()
         self.assertEqual(self.browser.url, 'http://nohost/plone/foo')
         # assert that object has not been modified
         self.assertEqual(
-            mtime, self.layer['portal'].foo.bobobase_modification_time()
+            mtime, DateTime(self.layer['portal'].foo._p_mtime)
         )
 
         behaviors = list(self.layer['portal'].portal_types.Document.behaviors)


Repository: plone.app.dexterity


Branch: refs/heads/master
Date: 2015-10-15T12:26:47+03:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.dexterity/commit/b1135f191fdfaa7ee7d2b16a0aef410ebf578252

Merge pull request #186 from plone/thet-nobobomodification

Remove bobobase_modification_time

Files changed:
M CHANGES.rst
M plone/app/dexterity/behaviors/tests/test_id.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 4990f7f..e4e48e7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.1.15 (unreleased)
 -------------------
 
+- No longer rely on deprecated ``bobobase_modification_time`` from
+  ``Persistence.Persistent``.
+  [thet]
+
 - Update Traditional Chinese translation.
   [l34marr]
 
diff --git a/plone/app/dexterity/behaviors/tests/test_id.py b/plone/app/dexterity/behaviors/tests/test_id.py
index d768d2d..057854c 100644
--- a/plone/app/dexterity/behaviors/tests/test_id.py
+++ b/plone/app/dexterity/behaviors/tests/test_id.py
@@ -1,3 +1,4 @@
+from DateTime import DateTime
 from plone.app.dexterity.testing import DEXTERITY_FUNCTIONAL_TESTING
 from plone.app.testing import SITE_OWNER_NAME
 from plone.app.testing import SITE_OWNER_PASSWORD
@@ -80,14 +81,14 @@ def test_edit_item_doesnt_rename_if_same_id(self):
         self.browser.getControl('Title').value = 'title'
         self.browser.getControl('Short name').value = 'foo'
         self.browser.getControl('Save').click()
-        mtime = self.layer['portal'].foo.bobobase_modification_time()
+        mtime = DateTime(self.layer['portal'].foo._p_mtime)
         self.browser.getLink('Edit').click()
         self.browser.getControl('Short name').value = 'foo'
         self.browser.getControl('Save').click()
         self.assertEqual(self.browser.url, 'http://nohost/plone/foo')
         # assert that object has not been modified
         self.assertEqual(
-            mtime, self.layer['portal'].foo.bobobase_modification_time()
+            mtime, DateTime(self.layer['portal'].foo._p_mtime)
         )
 
         behaviors = list(self.layer['portal'].portal_types.Document.behaviors)


