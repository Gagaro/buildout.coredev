Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-18T13:21:52-07:00
Author: Fulvio Casali (fulv) <fulviocasali@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/ffd62f3954fe081ee3d6b6282f2d1fb34f91c45e

Fixes #1034.

Files changed:
M CHANGES.rst
M Products/CMFPlone/resources/browser/scripts.py
M Products/CMFPlone/resources/browser/styles.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 03fdc4d..9ce7992 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -7,6 +7,8 @@ Changelog
 
 5.0rc3 (unreleased)
 -------------------
+- Resolve deprecation warnings about portal_url
+  [fulv]
 
 - Fix #950: Missing personal toolbar when expanding the horizontal toolbar
   [ichim-david]
diff --git a/Products/CMFPlone/resources/browser/scripts.py b/Products/CMFPlone/resources/browser/scripts.py
index 6fc3a37..005dce5 100644
--- a/Products/CMFPlone/resources/browser/scripts.py
+++ b/Products/CMFPlone/resources/browser/scripts.py
@@ -19,7 +19,7 @@ def get_data(self, bundle, result):
                         url = urlparse(script.js)
                         if url.netloc == '':
                             # Local
-                            src = "%s/%s" % (self.portal_url, script.js)
+                            src = "%s/%s" % (self.site_url, script.js)
                         else:
                             src = "%s" % (script.js)
 
@@ -42,7 +42,7 @@ def get_data(self, bundle, result):
                     'bundle': bundle_name,
                     'conditionalcomment': bundle.conditionalcomment,
                     'src': '%s/%s?version=%s' % (
-                        self.portal_url, bundle.jscompilation,
+                        self.site_url, bundle.jscompilation,
                         bundle.last_compilation)
                 })
 
@@ -54,7 +54,7 @@ def scripts(self):
         # We always add jquery resource
         result.append({
             'src': '%s/%s' % (
-                self.portal_url,
+                self.site_url,
                 self.registry.records['plone.resources/jquery.js'].value),
             'conditionalcomment': None,
             'bundle': 'basic'
@@ -63,35 +63,35 @@ def scripts(self):
             # We need to add require.js and config.js
             result.append({
                 'src': '%s/%s' % (
-                    self.portal_url,
+                    self.site_url,
                     self.registry.records['plone.resources.less-variables'].value),  # noqa
                 'conditionalcomment': None,
                 'bundle': 'basic'
             })
             result.append({
                 'src': '%s/%s' % (
-                    self.portal_url,
+                    self.site_url,
                     self.registry.records['plone.resources.lessc'].value),
                 'conditionalcomment': None,
                 'bundle': 'basic'
             })
             # result.append({
             #     'src': '%s/%s' % (
-            #         self.portal_url,
+            #         self.site_url,
             #         self.registry.records['plone.resources.less-modify'].value),
             #     'conditionalcomment': None,
             #     'bundle': 'basic'
             # })
         result.append({
             'src': '%s/%s' % (
-                self.portal_url,
+                self.site_url,
                 self.registry.records['plone.resources.requirejs'].value),
             'conditionalcomment': None,
             'bundle': 'basic'
         })
         result.append({
             'src': '%s/%s' % (
-                self.portal_url,
+                self.site_url,
                 self.registry.records['plone.resources.configjs'].value),
             'conditionalcomment': None,
             'bundle': 'basic'
@@ -108,7 +108,7 @@ def scripts(self):
                         url = urlparse(data.js)
                         if url.netloc == '':
                             # Local
-                            src = "%s/%s" % (self.portal_url, data.js)
+                            src = "%s/%s" % (self.site_url, data.js)
                         else:
                             src = "%s" % (data.js)
 
@@ -129,7 +129,7 @@ def scripts(self):
                 'bundle': 'diazo',
                 'conditionalcomment': '',
                 'src': '%s/%s' % (
-                    self.portal_url, origin)
+                    self.site_url, origin)
             })
 
         return result
diff --git a/Products/CMFPlone/resources/browser/styles.py b/Products/CMFPlone/resources/browser/styles.py
index 577f020..924a4d0 100644
--- a/Products/CMFPlone/resources/browser/styles.py
+++ b/Products/CMFPlone/resources/browser/styles.py
@@ -19,7 +19,7 @@ def get_urls(self, style, bundle):
             url = urlparse(css)
             if url.netloc == '':
                 # Local
-                src = "%s/%s" % (self.portal_url, css)
+                src = "%s/%s" % (self.site_url, css)
             else:
                 src = "%s" % (css)
 
@@ -65,7 +65,7 @@ def get_data(self, bundle, result):
                     'rel': 'stylesheet',
                     'conditionalcomment': bundle.conditionalcomment,
                     'src': '%s/%s?version=%s' % (
-                        self.portal_url,
+                        self.site_url,
                         bundle.csscompilation,
                         bundle.last_compilation
                     )
@@ -94,7 +94,7 @@ def styles(self):
             url = urlparse(origin)
             if url.netloc == '':
                 # Local
-                src = "%s/%s" % (self.portal_url, origin)
+                src = "%s/%s" % (self.site_url, origin)
             else:
                 src = "%s" % (origin)
 


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-19T08:55:29-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/08fc692bebd9b729c243b9044e5446cd1e3d772f

Merge pull request #1035 from plone/fulv-#1034

Fixes #1034.

Files changed:
M CHANGES.rst
M Products/CMFPlone/resources/browser/scripts.py
M Products/CMFPlone/resources/browser/styles.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6ea210c..4840683 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -7,6 +7,8 @@ Changelog
 
 5.0rc3 (unreleased)
 -------------------
+- Resolve deprecation warnings about portal_url
+  [fulv]
 
 - Improve contrast for pending state when state menu active (closes `913`_).
 - Fix buttons positions on resource registry (closes `886`).
diff --git a/Products/CMFPlone/resources/browser/scripts.py b/Products/CMFPlone/resources/browser/scripts.py
index 6fc3a37..005dce5 100644
--- a/Products/CMFPlone/resources/browser/scripts.py
+++ b/Products/CMFPlone/resources/browser/scripts.py
@@ -19,7 +19,7 @@ def get_data(self, bundle, result):
                         url = urlparse(script.js)
                         if url.netloc == '':
                             # Local
-                            src = "%s/%s" % (self.portal_url, script.js)
+                            src = "%s/%s" % (self.site_url, script.js)
                         else:
                             src = "%s" % (script.js)
 
@@ -42,7 +42,7 @@ def get_data(self, bundle, result):
                     'bundle': bundle_name,
                     'conditionalcomment': bundle.conditionalcomment,
                     'src': '%s/%s?version=%s' % (
-                        self.portal_url, bundle.jscompilation,
+                        self.site_url, bundle.jscompilation,
                         bundle.last_compilation)
                 })
 
@@ -54,7 +54,7 @@ def scripts(self):
         # We always add jquery resource
         result.append({
             'src': '%s/%s' % (
-                self.portal_url,
+                self.site_url,
                 self.registry.records['plone.resources/jquery.js'].value),
             'conditionalcomment': None,
             'bundle': 'basic'
@@ -63,35 +63,35 @@ def scripts(self):
             # We need to add require.js and config.js
             result.append({
                 'src': '%s/%s' % (
-                    self.portal_url,
+                    self.site_url,
                     self.registry.records['plone.resources.less-variables'].value),  # noqa
                 'conditionalcomment': None,
                 'bundle': 'basic'
             })
             result.append({
                 'src': '%s/%s' % (
-                    self.portal_url,
+                    self.site_url,
                     self.registry.records['plone.resources.lessc'].value),
                 'conditionalcomment': None,
                 'bundle': 'basic'
             })
             # result.append({
             #     'src': '%s/%s' % (
-            #         self.portal_url,
+            #         self.site_url,
             #         self.registry.records['plone.resources.less-modify'].value),
             #     'conditionalcomment': None,
             #     'bundle': 'basic'
             # })
         result.append({
             'src': '%s/%s' % (
-                self.portal_url,
+                self.site_url,
                 self.registry.records['plone.resources.requirejs'].value),
             'conditionalcomment': None,
             'bundle': 'basic'
         })
         result.append({
             'src': '%s/%s' % (
-                self.portal_url,
+                self.site_url,
                 self.registry.records['plone.resources.configjs'].value),
             'conditionalcomment': None,
             'bundle': 'basic'
@@ -108,7 +108,7 @@ def scripts(self):
                         url = urlparse(data.js)
                         if url.netloc == '':
                             # Local
-                            src = "%s/%s" % (self.portal_url, data.js)
+                            src = "%s/%s" % (self.site_url, data.js)
                         else:
                             src = "%s" % (data.js)
 
@@ -129,7 +129,7 @@ def scripts(self):
                 'bundle': 'diazo',
                 'conditionalcomment': '',
                 'src': '%s/%s' % (
-                    self.portal_url, origin)
+                    self.site_url, origin)
             })
 
         return result
diff --git a/Products/CMFPlone/resources/browser/styles.py b/Products/CMFPlone/resources/browser/styles.py
index 577f020..924a4d0 100644
--- a/Products/CMFPlone/resources/browser/styles.py
+++ b/Products/CMFPlone/resources/browser/styles.py
@@ -19,7 +19,7 @@ def get_urls(self, style, bundle):
             url = urlparse(css)
             if url.netloc == '':
                 # Local
-                src = "%s/%s" % (self.portal_url, css)
+                src = "%s/%s" % (self.site_url, css)
             else:
                 src = "%s" % (css)
 
@@ -65,7 +65,7 @@ def get_data(self, bundle, result):
                     'rel': 'stylesheet',
                     'conditionalcomment': bundle.conditionalcomment,
                     'src': '%s/%s?version=%s' % (
-                        self.portal_url,
+                        self.site_url,
                         bundle.csscompilation,
                         bundle.last_compilation
                     )
@@ -94,7 +94,7 @@ def styles(self):
             url = urlparse(origin)
             if url.netloc == '':
                 # Local
-                src = "%s/%s" % (self.portal_url, origin)
+                src = "%s/%s" % (self.site_url, origin)
             else:
                 src = "%s" % (origin)
 


