Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-03-05T00:34:56-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/bb470b3291d6eaba8689b2d903eec33631ba8dc4

Revert "more fixes to installable products (and be sure to install the theme ;-)"

This reverts commit 9aa517323d1a54ae704f369ca1d6af3364079e41.

Files changed:
M Products/CMFPlone/browser/admin.py
M Products/CMFPlone/profiles/dependencies/metadata.xml
M Products/CMFPlone/setuphandlers.py

diff --git a/Products/CMFPlone/browser/admin.py b/Products/CMFPlone/browser/admin.py
index 3a30806..d1cfcc6 100644
--- a/Products/CMFPlone/browser/admin.py
+++ b/Products/CMFPlone/browser/admin.py
@@ -116,9 +116,12 @@ class FrontPage(BrowserView):
 
 class AddPloneSite(BrowserView):
 
-    # Profiles that are installed by default,
-    # but can be removed later.
-    default_extension_profiles = ()
+    default_extension_profiles = (
+        'plone.app.registry:default',
+        'plonetheme.classic:default',
+        'plone.app.theming:default',
+        'plonetheme.barceloneta:default',
+    )
 
     def profiles(self):
         base_profiles = []
@@ -127,7 +130,10 @@ def profiles(self):
         # profiles available for install/uninstall, but hidden at the time
         # the Plone site is created
         not_installable = [
+            'kupu:default',
+            'plonetheme.classic:uninstall',
             'Products.CMFPlacefulWorkflow:CMFPlacefulWorkflow',
+            'plone.app.z3cform:default',
         ]
         utils = getAllUtilitiesRegisteredFor(INonInstallable)
         for util in utils:
@@ -150,7 +156,8 @@ def _key(v):
 
         for info in profile_registry.listProfileInfo():
             if info.get('type') == BASE and \
-               info.get('for') in (IPloneSiteRoot, None):
+               info.get('for') in (IPloneSiteRoot, None) and \
+               info.get('id') != u'Products.kupu:default':
                 base_profiles.append(info)
 
         return dict(
diff --git a/Products/CMFPlone/profiles/dependencies/metadata.xml b/Products/CMFPlone/profiles/dependencies/metadata.xml
index 9034293..aeca717 100644
--- a/Products/CMFPlone/profiles/dependencies/metadata.xml
+++ b/Products/CMFPlone/profiles/dependencies/metadata.xml
@@ -8,7 +8,6 @@
     <dependency>profile-Products.CMFEditions:CMFEditions</dependency>
     <dependency>profile-Products.PloneLanguageTool:PloneLanguageTool</dependency>
     <dependency>profile-Products.PlonePAS:PlonePAS</dependency>
-    <dependency>profile-plone.app.caching:default</dependency>
     <dependency>profile-plone.app.discussion:default</dependency>
     <dependency>profile-plone.app.jquerytools:default</dependency>
     <dependency>profile-plone.app.registry:default</dependency>
@@ -17,6 +16,5 @@
     <dependency>profile-plone.portlet.collection:default</dependency>
     <dependency>profile-plone.portlet.static:default</dependency>
     <dependency>profile-plone.protect:default</dependency>
-    <dependency>profile-plonetheme.barceloneta:default</dependency>
   </dependencies>
 </metadata>
diff --git a/Products/CMFPlone/setuphandlers.py b/Products/CMFPlone/setuphandlers.py
index a2233c0..f9c0178 100644
--- a/Products/CMFPlone/setuphandlers.py
+++ b/Products/CMFPlone/setuphandlers.py
@@ -28,7 +28,6 @@ class HiddenProducts(object):
     def getNonInstallableProducts(self):
         return [
             'Archetypes', 'Products.Archetypes',
-            'ATContentTypes', 'Products.ATContentTypes',
             'CMFDefault', 'Products.CMFDefault',
             'CMFPlone', 'Products.CMFPlone', 'Products.CMFPlone.migrations',
             'CMFTopic', 'Products.CMFTopic',
@@ -44,32 +43,26 @@ def getNonInstallableProducts(self):
             'CMFDiffTool', 'Products.CMFDiffTool',
             'CMFEditions', 'Products.CMFEditions',
             'Products.NuPlone',
+            'plone.portlet.static',
+            'plone.portlet.collection',
             'borg.localrole',
+            'plone.keyring',
+            'plone.outputfilters',
+            'plone.protect',
+            'plone.app.jquery'
+            'plone.app.jquerytools',
             'plone.app.blob',
-            'plone.app.caching',
-            'plone.app.collection',
-            'plone.app.dexterity',
             'plone.app.discussion',
-            'plone.app.event',
             'plone.app.folder',
             'plone.app.imaging',
             'plone.app.intid',
-            'plone.app.jquery',
-            'plone.app.jquerytools',
             'plone.app.registry',
             'plone.app.referenceablebehavior',
             'plone.app.relationfield',
-            'plone.app.theming',
+            'plone.resource',
             'plone.app.widgets',
             'plone.app.z3cform',
-            'plone.formwidget.recurrence',
-            'plone.keyring',
-            'plone.outputfilters',
-            'plone.portlet.static',
-            'plone.portlet.collection',
-            'plone.protect',
-            'plone.resource',
-            'plonetheme.barceloneta',
+            'plone.formwidget.recurrence'
             ]
 
 


