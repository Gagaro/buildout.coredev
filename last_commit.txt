Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-02-16T17:13:12-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/0e351cc4b13b60da8f9a5a33925ece1ea43b6e81

fix 404 similar items markup, don't use plone_view.getIcon

Files changed:
M Products/CMFPlone/skins/plone_templates/default_error_message.pt

diff --git a/Products/CMFPlone/skins/plone_templates/default_error_message.pt b/Products/CMFPlone/skins/plone_templates/default_error_message.pt
index 05cb4f1..a77f725 100644
--- a/Products/CMFPlone/skins/plone_templates/default_error_message.pt
+++ b/Products/CMFPlone/skins/plone_templates/default_error_message.pt
@@ -73,53 +73,24 @@
 
                         <tal:firstparent condition="first_parent/absolute_url | nothing">
                             <li tal:define="result_url first_parent/absolute_url;
-                                               result_type python:hasattr(first_parent, 'getTypeInfo') and first_parent.getTypeInfo().getId();
-                                               item_icon python:plone_view.getIcon(first_parent);
-                                               url python:test(result_type in use_view_action, result_url+'/view', result_url);"
-                                       tal:condition="result_type">
-                                <a tal:define="item_wf_state_class python:'state-' + context.portal_workflow.getInfoFor(first_parent, 'review_state', '');"
-                                    tal:attributes="class python:'contenttype-' + normalizeString(result_type)"
-                                    href="#"
-                                     tal:attributes="href url;
-                                                     class string:$item_wf_state_class"
-                                     tal:content="first_parent/Title">
-                                  <img tal:replace="structure item_icon/html_tag" />
-                                    <span class="discreet" i18n:translate="results_by_author"
-                                      tal:condition="python: not isAnon or site_properties.allowAnonymousViewAbout">
-                                    by <span tal:omit-tag="" tal:content="first_parent/Creator" i18n:name="author">Author</span>,
-                                    <span tal:omit-tag="" tal:content="python:toLocalizedTime(first_parent.ModificationDate(), long_format=1)" i18n:name="date">Modification Date</span>
-                                    </span>
-
-                                </a>
-
+                                            result_type python:hasattr(first_parent, 'getTypeInfo') and first_parent.getTypeInfo().getId();
+                                            url python:result_url + '/view' if result_type in use_view_action else result_url;"
+                                tal:condition="result_type">
+                                <a href="${url}"
+                                   tal:define="item_wf_state_class python:' state-' + context.portal_workflow.getInfoFor(first_parent, 'review_state', '');"
+                                   tal:attributes="class python:'contenttype-' + normalizeString(result_type) + item_wf_state_class">${first_parent/Title}</a>
                                 <span tal:content="python:plone_view.cropText(first_parent.Description(), desc_length, desc_ellipsis)" class="discreet"> Description </span>
-
                             </li>
                         </tal:firstparent>
 
                         <tal:similar repeat="similar similar_items">
                             <li tal:define="result_url similar/getURL;
-                                               result_type similar/portal_type;
-                                               item_icon python:plone_view.getIcon(similar);
-                                               url python:test(result_type in use_view_action, result_url+'/view', result_url);">
-                                <a tal:define="item_wf_state_class string:state-${similar/review_state};"
-                                    tal:attributes="class python:'contenttype-' + normalizeString(result_type)"
-                                    href="#"
-                                     tal:attributes="href url;
-                                                     class string:$item_wf_state_class"
-                                     tal:content="similar/pretty_title_or_id">
-                                  <img tal:replace="structure item_icon/html_tag" />
-
-                                    <span class="discreet" i18n:translate="results_by_author"
-                                      tal:condition="python: not isAnon or site_properties.allowAnonymousViewAbout">
-                                    by <span tal:omit-tag="" tal:content="similar/Creator" i18n:name="author">Author</span>,
-                                    <span tal:omit-tag="" tal:content="python:toLocalizedTime(similar.ModificationDate, long_format=1)" i18n:name="date">Modification Date</span>
-                                    </span>
-
-                                </a>
-
+                                            result_type similar/portal_type;
+                                            url python:result_url + '/view' if result_type in use_view_action else result_url;">
+                                <a href="${url}"
+                                   tal:define="item_wf_state_class string: state-${similar/review_state};"
+                                   tal:attributes="class python:'contenttype-' + normalizeString(result_type) + item_wf_state_class">${similar/pretty_title_or_id}</a>
                                 <span tal:content="python:plone_view.cropText(similar.Description or '', desc_length, desc_ellipsis)" class="discreet"> Description </span>
-
                             </li>
                         </tal:similar>
 


