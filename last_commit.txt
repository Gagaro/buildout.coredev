Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-10-17T17:32:41+03:00
Author: Manabu TERADA (terapyon) <terada@cmscom.jp>
Commit: https://github.com/plone/plone.app.theming/commit/d6015cceed8acd6b6508f70f8cdc5686b69774b3

Fix Unicode Encode Error when to copy intu multi-byte title / description

Files changed:
M CHANGES.rst
M src/plone/app/theming/__init__.py
M src/plone/app/theming/tests/test_utils.py
M src/plone/app/theming/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 20b5e5b..61ec81d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,6 +9,8 @@ Changelog
   other cases.
   [maurits]
 
+- Fix Unicode Encode Error when to copy intu multi-byte title / description
+  [terapyon]
 
 1.2.14 (2015-09-27)
 -------------------
diff --git a/src/plone/app/theming/__init__.py b/src/plone/app/theming/__init__.py
index c08456a..ee73f1f 100644
--- a/src/plone/app/theming/__init__.py
+++ b/src/plone/app/theming/__init__.py
@@ -11,3 +11,4 @@
     from plone.app.theming import _roman
     import sys
     sys.modules['roman'] = _roman
+
diff --git a/src/plone/app/theming/tests/test_utils.py b/src/plone/app/theming/tests/test_utils.py
index 2cb6e0a..00c41cf 100644
--- a/src/plone/app/theming/tests/test_utils.py
+++ b/src/plone/app/theming/tests/test_utils.py
@@ -276,6 +276,26 @@ def test_createThemeFromTemplate_rel_path(self):
         self.assertEqual(theme.development_js, expected_dev_js)
         self.assertEqual(theme.production_js, expected_prod_js)
 
+    def test_createThemeFromTemplate_ja_str_title(self):
+        from plone.app.theming.utils import createThemeFromTemplate
+        title = "copy of test theme by 日本語"
+        description = "test theme by 日本語"
+        try:
+            createThemeFromTemplate(title, description,
+                                            baseOn="another-theme")
+        except UnicodeEncodeError:
+            self.fail(msg=u"Unicode Encode Error")
+
+    def test_createThemeFromTemplate_ja_unicode_title(self):
+        from plone.app.theming.utils import createThemeFromTemplate
+        title = u"copy of test theme by 日本語"
+        description = u"test theme by 日本語"
+        try:
+            createThemeFromTemplate(title, description,
+                                            baseOn="another-theme")
+        except UnicodeEncodeError:
+            self.fail(msg=u"Unicode Encode Error")
+
 
 class TestUnit(unittest.TestCase):
 
diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index 2c00005..8bfb0a8 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -514,6 +514,10 @@ def createThemeFromTemplate(title, description, baseOn='template'):
     if not manifest.has_section('theme'):
         manifest.add_section('theme')
 
+    if not isinstance(title, str):
+        title = title.encode('utf-8')
+    if not isinstance(description, str):
+        description = description.encode('utf-8')
     manifest.set('theme', 'title', title)
     manifest.set('theme', 'description', description)
 


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-10-17T17:36:28+03:00
Author: Manabu TERADA (terapyon) <terada@cmscom.jp>
Commit: https://github.com/plone/plone.app.theming/commit/1609b7406d7bf847effe2195e2cc644f5a25ae70

modify typo

Files changed:
M CHANGES.rst
M src/plone/app/theming/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 61ec81d..68250cf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,7 +9,7 @@ Changelog
   other cases.
   [maurits]
 
-- Fix Unicode Encode Error when to copy intu multi-byte title / description
+- Fix Unicode Encode Error when to copy into multi-byte title / description
   [terapyon]
 
 1.2.14 (2015-09-27)
diff --git a/src/plone/app/theming/__init__.py b/src/plone/app/theming/__init__.py
index ee73f1f..c08456a 100644
--- a/src/plone/app/theming/__init__.py
+++ b/src/plone/app/theming/__init__.py
@@ -11,4 +11,3 @@
     from plone.app.theming import _roman
     import sys
     sys.modules['roman'] = _roman
-


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-10-19T12:35:07+02:00
Author: Gil Forcada Codinachs (gforcada) <gil.forcada@freitag.de>
Commit: https://github.com/plone/plone.app.theming/commit/d52a8c96b52b5088616cbda126a676ed491f99d0

Merge pull request #87 from terapyon/master

Fix Unicode Encode Error when to copy into multi-byte title / desc

Files changed:
M CHANGES.rst
M src/plone/app/theming/tests/test_utils.py
M src/plone/app/theming/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 20b5e5b..68250cf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -9,6 +9,8 @@ Changelog
   other cases.
   [maurits]
 
+- Fix Unicode Encode Error when to copy into multi-byte title / description
+  [terapyon]
 
 1.2.14 (2015-09-27)
 -------------------
diff --git a/src/plone/app/theming/tests/test_utils.py b/src/plone/app/theming/tests/test_utils.py
index 2cb6e0a..00c41cf 100644
--- a/src/plone/app/theming/tests/test_utils.py
+++ b/src/plone/app/theming/tests/test_utils.py
@@ -276,6 +276,26 @@ def test_createThemeFromTemplate_rel_path(self):
         self.assertEqual(theme.development_js, expected_dev_js)
         self.assertEqual(theme.production_js, expected_prod_js)
 
+    def test_createThemeFromTemplate_ja_str_title(self):
+        from plone.app.theming.utils import createThemeFromTemplate
+        title = "copy of test theme by 日本語"
+        description = "test theme by 日本語"
+        try:
+            createThemeFromTemplate(title, description,
+                                            baseOn="another-theme")
+        except UnicodeEncodeError:
+            self.fail(msg=u"Unicode Encode Error")
+
+    def test_createThemeFromTemplate_ja_unicode_title(self):
+        from plone.app.theming.utils import createThemeFromTemplate
+        title = u"copy of test theme by 日本語"
+        description = u"test theme by 日本語"
+        try:
+            createThemeFromTemplate(title, description,
+                                            baseOn="another-theme")
+        except UnicodeEncodeError:
+            self.fail(msg=u"Unicode Encode Error")
+
 
 class TestUnit(unittest.TestCase):
 
diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index 2c00005..8bfb0a8 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -514,6 +514,10 @@ def createThemeFromTemplate(title, description, baseOn='template'):
     if not manifest.has_section('theme'):
         manifest.add_section('theme')
 
+    if not isinstance(title, str):
+        title = title.encode('utf-8')
+    if not isinstance(description, str):
+        description = description.encode('utf-8')
     manifest.set('theme', 'title', title)
     manifest.set('theme', 'description', description)
 


