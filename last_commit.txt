Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/619128c87546fc22731f492f902575408bfc8504

refactor and simplify folder_listing and dependend views to use @@folderListing and a browser view

Files changed:
A plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/configure.zcml
M plone/app/contenttypes/browser/templates/folder_listing.pt
M plone/app/contenttypes/browser/templates/folder_summary_view.pt
M plone/app/contenttypes/browser/templates/folder_tabular_view.pt

diff --git a/plone/app/contenttypes/browser/configure.zcml b/plone/app/contenttypes/browser/configure.zcml
index a3fc913..0384cec 100644
--- a/plone/app/contenttypes/browser/configure.zcml
+++ b/plone/app/contenttypes/browser/configure.zcml
@@ -128,6 +128,7 @@
     name="folder_listing"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
+    class=".folder.FolderView"
     template="templates/folder_listing.pt"
     permission="zope2.View"
     menu="plone_displayviews"
@@ -138,6 +139,7 @@
     name="folder_listing"
     for="Products.CMFPlone.interfaces.IPloneSiteRoot"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
+    class=".folder.FolderView"
     template="templates/folder_listing.pt"
     permission="zope2.View"
     menu="plone_displayviews"
@@ -166,6 +168,7 @@
     name="folder_summary_view"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
+    class=".folder.FolderView"
     template="templates/folder_summary_view.pt"
     permission="zope2.View"
     menu="plone_displayviews"
@@ -176,6 +179,7 @@
     name="folder_summary_view"
     for="Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
+    class=".folder.FolderView"
     template="templates/folder_summary_view.pt"
     permission="zope2.View"
     menu="plone_displayviews"
@@ -186,6 +190,18 @@
     name="folder_tabular_view"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
+    class=".folder.FolderView"
+    template="templates/folder_tabular_view.pt"
+    permission="zope2.View"
+    menu="plone_displayviews"
+    title="Tabular view"
+    />
+
+  <browser:page
+    name="folder_tabular_view"
+    for="Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot"
+    layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
+    class=".folder.FolderView"
     template="templates/folder_tabular_view.pt"
     permission="zope2.View"
     menu="plone_displayviews"
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
new file mode 100644
index 0000000..52a2c59
--- /dev/null
+++ b/plone/app/contenttypes/browser/folder.py
@@ -0,0 +1,71 @@
+# -*- coding: utf-8 -*-
+from Acquisition import aq_base
+from Products.Five import BrowserView
+from zope.component import getMultiAdapter
+from Products.CMFPlone.PloneBatch import Batch
+
+
+class FolderView(BrowserView):
+
+    def __init__(self, context, request):
+        super(FolderView, self).__init__(context, request)
+
+        self.plone_view = getMultiAdapter(
+            (context, request), name=u"plone")
+
+        self.portal_state = getMultiAdapter(
+            (context, request), name=u"plone_portal_state")
+        self.friendly_types = self.portal_state.friendly_types()
+        self.isAnon = self.portal_state.anonymous()
+        self.navigation_root_url = self.portal_state.navigation_root_url()
+
+        self.site_properties = context.restrictedTraverse(
+            'portal_properties').site_properties
+        self.use_view_action = getattr(
+            self.site_properties, 'typesUseViewActionInListings', ())
+        self.show_about = getattr(
+            self.site_properties, 'allowAnonymousViewAbout', not self.isAnon)
+
+        # TODO: REMOVE
+        self.more_url = getattr(request, 'more_url', 'folder_contents')
+
+        # TODO: eventually REMOVE
+        self.plone_layout = context.restrictedTraverse('@@plone_layout')
+
+        self.pas_member = context.restrictedTraverse('@@pas_member')
+
+        limit_display = getattr(request, 'limit_display', None)
+        limit_display = int(limit_display) if limit_display is not None else 20
+        b_size = getattr(request, 'b_size', None)
+        b_size = int(b_size) if b_size is not None else limit_display
+        b_start = getattr(request, 'b_start', None)
+        b_start = int(b_start) if b_start is not None else 0
+
+        contentFilter = getattr(request, 'contentFilter', None)
+        contentFilter = dict(contentFilter) if contentFilter else {}
+        contentFilter.setdefault('portal_type', self.friendly_types)
+        contentFilter.setdefault('batch', True)
+        contentFilter.setdefault('b_size', b_size)
+        contentFilter.setdefault('b_start', b_start)
+
+        self.folderContents = context.restrictedTraverse(
+            '@@folderListing')(**contentFilter)
+
+        self.batch = Batch(self.folderContents, b_size, b_start, orphan=1)
+
+        self.text_class = None
+
+    def normalizeString(self, text):
+        return self.plone_view.normalizeString(text)
+
+    def toLocalizedTime(self, time, long_format=None, time_only=None):
+        return self.plone_view.toLocalizedTime(time, long_format, time_only)
+
+    def text(self):
+        textfield = getattr(aq_base(self.context), 'text', None)
+        text = getattr(textfield, 'output', None)
+        if text:
+            self.text_class = 'stx' if textfield.contentType() in (
+                'text/structured', 'text/x-rst', 'text/restructured'
+            ) else 'plain'
+        return text
diff --git a/plone/app/contenttypes/browser/templates/folder_listing.pt b/plone/app/contenttypes/browser/templates/folder_listing.pt
index d63282c..7788b6b 100644
--- a/plone/app/contenttypes/browser/templates/folder_listing.pt
+++ b/plone/app/contenttypes/browser/templates/folder_listing.pt
@@ -9,60 +9,36 @@
 <body>
 
 <metal:content-core fill-slot="content-core">
-<metal:block define-macro="content-core"
-                    tal:define="templateId template/getId">
+<metal:block define-macro="content-core">
 
     <div metal:define-macro="text-field-view"
          id="parent-fieldname-text" class="stx"
-         tal:define="has_text exists:context/aq_explicit/text/output;
-                     text python:has_text and here.text.output or ''"
+         tal:define="text view/text"
          tal:condition="text"
-         tal:attributes="class python: context.Format() in ('text/structured',
-                                               'text/x-rst', ) and  'stx' or 'plain'">
+         tal:attributes="class view/text_class">
         <div metal:define-slot="inside" tal:replace="structure text">The body</div>
     </div>
 
     <metal:listingmacro define-macro="listing">
-    <tal:foldercontents define="contentFilter contentFilter|request/contentFilter|nothing;
-                        contentFilter python:contentFilter and dict(contentFilter) or {};
-                        limit_display limit_display|request/limit_display|nothing;
-                        limit_display python:limit_display and int(limit_display) or None;
-                        more_url more_url|request/more_url|string:folder_contents;
-                        is_a_topic python:context.portal_type=='Topic';
-                        friendly_types portal_state/friendly_types;
-                        dummy python:not is_a_topic and contentFilter.setdefault('portal_type', friendly_types);
-                        folderContents folderContents|nothing; folderContents python:folderContents or is_a_topic and context.queryCatalog(batch=True, **contentFilter) or context.getFolderContents(contentFilter, batch=True, b_size=limit_display or 100);
-                        site_properties context/portal_properties/site_properties;
-                        use_view_action site_properties/typesUseViewActionInListings|python:();
-                        Batch python:modules['Products.CMFPlone'].Batch;
-                        plone_layout context/@@plone_layout;
-                        b_start python:request.get('b_start', 0);
-                        batch python:isinstance(folderContents, Batch) and folderContents or Batch(folderContents, limit_display or 100, int(b_start), orphan=1);
-                        isAnon portal_state/anonymous;
-                        normalizeString nocall: context/plone_utils/normalizeString;
-                        toLocalizedTime nocall: plone_view/toLocalizedTime;
-                        show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
-                        navigation_root_url portal_state/navigation_root_url;
-                        pas_member context/@@pas_member;">
+    <tal:foldercontents define="batch view/batch">
     <tal:listing condition="batch">
 
         <ul metal:define-slot="entries">
             <li tal:repeat="item batch" metal:define-macro="entries">
-            <tal:block tal:define="item_url item/getURL|item/absolute_url;
-                                   item_id item/getId|item/id;
-                                   item_title_or_id item/pretty_title_or_id;
+            <tal:block tal:define="item_url item/getURL;
+                                   item_id item/getId;
+                                   item_title item/Title;
                                    item_description item/Description;
-                                   item_type item/portal_type;
-                                   item_type_title item/Type;
+                                   item_type item/PortalType;
                                    item_modified item/ModificationDate;
                                    item_created item/CreationDate;
-                                   item_icon python:plone_layout.getIcon(item);
-                                   item_type_class python:'contenttype-' + normalizeString(item_type);
-                                   item_wf_state item/review_state|python: context.portal_workflow.getInfoFor(item, 'review_state', '');
-                                   item_wf_state_class python:'state-' + normalizeString(item_wf_state);
+                                   item_icon item/getIcon;
+                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
+                                   item_wf_state item/review_state;
+                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
                                    item_creator item/Creator;
-                                   item_start item/start|item/StartDate|nothing;
-                                   item_end item/end|item/EndDate|nothing;
+                                   item_start item/start|nothing;
+                                   item_end item/end|nothing;
                                    item_sametime python: item_start == item_end;
                                    item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
                 <metal:block define-slot="entry">
@@ -71,11 +47,11 @@
                     tal:attributes="class item_type_event_class|nothing">
 
                     <span class="summary">
-                        <img tal:replace="structure item_icon/html_tag" />
+                        <img tal:replace="structure item_icon" />
                         <a href="#"
-                           tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;
+                           tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;
                                            class string:$item_type_class $item_wf_state_class url"
-                           tal:content="item_title_or_id">
+                           tal:content="item_title">
                             Item Title
                         </a>
                     </span>
@@ -121,11 +97,11 @@
                                    class="location"
                                    i18n:name="location">Oslo</span>,
                         </span>
-                        <tal:byline condition="show_about">
+                        <tal:byline condition="view/show_about">
                             &mdash;
 
                             <tal:name tal:condition="item_creator"
-                                tal:define="author python:pas_member.info(item_creator);
+                                tal:define="author python:view.pas_member.info(item_creator);
                                             creator_short_form author/username;
                                             creator_long_form string:?author=${author/username};
                                             creator_is_openid python:'/' in creator_short_form;
@@ -133,7 +109,7 @@
                               <span i18n:translate="label_by_author">
                                 by
                               <a href="#"
-                                 tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
+                                 tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
                                  tal:content="author/name_or_id"
                                  tal:omit-tag="not:author"
                                  i18n:name="author">
@@ -178,7 +154,7 @@
     </tal:listing>
     <metal:empty metal:define-slot="no_items_in_listing">
         <p class="discreet"
-           tal:condition="not: folderContents"
+           tal:condition="not: view/folderContents"
            i18n:translate="description_no_items_in_folder">
             There are currently no items in this folder.
         </p>
diff --git a/plone/app/contenttypes/browser/templates/folder_summary_view.pt b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
index c2d78c5..a0b4450 100644
--- a/plone/app/contenttypes/browser/templates/folder_summary_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
@@ -8,19 +8,47 @@
 
 <body>
 
-    <metal:content-core fill-slot="content-core">
-        <metal:block define-macro="listing" extend-macro="context/folder_listing/macros/content-core">
-            <!-- we don't want the dl -->
-            <metal:entries fill-slot="entries">
-                <metal:block use-macro="context/folder_listing/macros/entries">
-                    <metal:entry fill-slot="entry">
+<metal:content-core fill-slot="content-core">
+<metal:block define-macro="content-core">
+
+    <div metal:define-macro="text-field-view"
+         id="parent-fieldname-text" class="stx"
+         tal:define="text view/text"
+         tal:condition="text"
+         tal:attributes="class view/text_class">
+        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
+    </div>
+
+    <tal:foldercontents define="batch view/batch">
+    <tal:listing condition="batch">
+
+
+        <ul>
+            <li tal:repeat="item batch">
+            <tal:block tal:define="item_url item/getURL;
+                                   item_id item/getId;
+                                   item_title item/Title;
+                                   item_description item/Description;
+                                   item_type item/PortalType;
+                                   item_modified item/ModificationDate;
+                                   item_created item/CreationDate;
+                                   item_icon item/getIcon;
+                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
+                                   item_wf_state item/review_state;
+                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
+                                   item_creator item/Creator;
+                                   item_start item/start|nothing;
+                                   item_end item/end|nothing;
+                                   item_sametime python: item_start == item_end;
+                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
+
                 <div class="tileItem visualIEFloatFix"
                      tal:define="item_object item/getObject;">
 
                     <a href="#"
                        tal:define="real_object python:item_object.aq_explicit"
                        tal:condition="python:getattr(real_object, 'image', None)"
-                       tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url">
+                       tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url">
                         <img tal:define="images item_object/@@images;
                                          scale python: images.scale('image', scale='thumb')"
                              tal:condition="scale"
@@ -33,14 +61,14 @@
 
                         <a href="#"
                            class="summary url"
-                           tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;"
-                           tal:content="item_title_or_id">
+                           tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;"
+                           tal:content="item_title">
                             Item Title
                         </a>
 
                     </h2>
 
-                    <div class="documentByLine" tal:condition="python: site_properties.allowAnonymousViewAbout or not isAnon">
+                    <div class="documentByLine" tal:condition="python: view.site_properties.allowAnonymousViewAbout or not view.isAnon">
                     <tal:event condition="python: item_type == 'Event'">
                         <span tal:condition="python: item_type == 'Event' and item.location"
                               i18n:translate="label_event_byline_with_location">
@@ -49,11 +77,11 @@
                                    i18n:name="location">Oslo</span>, from
                              <abbr class="dtstart"
                                    tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
+                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
                                    i18n:name="start">from date</abbr> to
                              <abbr class="dtend"
                                    tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,long_format=1)"
+                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
                                    i18n:name="end">to date</abbr>)
                         </span>
                         <span tal:condition="python: item_type == 'Event' and not item.location"
@@ -61,11 +89,11 @@
                             (from
                              <abbr class="dtstart"
                                    tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
+                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
                                    i18n:name="start">from date</abbr> to
                              <abbr class="dtend"
                                    tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,long_format=1)"
+                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
                                    i18n:name="end">to date</abbr>)
                         </span>
                     </tal:event>
@@ -75,7 +103,7 @@
                           <span class="documentAuthor" i18n:translate="label_by_author">
                             by
                           <a href="#"
-                             tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
+                             tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
                              tal:content="author/name_or_id"
                              tal:omit-tag="not:author"
                              i18n:name="author">
@@ -103,7 +131,7 @@
 
                     <p class="tileFooter">
                         <a href=""
-                           tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;"
+                           tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;"
                            i18n:translate="read_more">
                         Read More&hellip;
                         </a>
@@ -112,11 +140,26 @@
                     <div class="visualClear"><!-- --></div>
 
                 </div>
-                    </metal:entry>
-                </metal:block>
-            </metal:entries>
-        </metal:block>
-    </metal:content-core>
+
+            </tal:block>
+            </li>
+        </ul>
+
+        <div metal:use-macro="context/batch_macros/macros/navigation" />
+
+    </tal:listing>
+    <metal:empty metal:define-slot="no_items_in_listing">
+        <p class="discreet"
+           tal:condition="not: view/folderContents"
+           i18n:translate="description_no_items_in_folder">
+            There are currently no items in this folder.
+        </p>
+    </metal:empty>
+
+    </tal:foldercontents>
+
+</metal:block>
+</metal:content-core>
 
 </body>
 </html>
diff --git a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
index c5e87a8..b0c69db 100644
--- a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
@@ -8,9 +8,20 @@
 
 <body>
 
-  <metal:content-core fill-slot="content-core">
-    <metal:block define-macro="listing" extend-macro="context/folder_listing/macros/content-core">
-      <metal:entries fill-slot="entries">
+<metal:content-core fill-slot="content-core">
+<metal:block define-macro="content-core">
+
+    <div metal:define-macro="text-field-view"
+         id="parent-fieldname-text" class="stx"
+         tal:define="text view/text"
+         tal:condition="text"
+         tal:attributes="class view/text_class">
+        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
+    </div>
+
+    <tal:foldercontents define="batch view/batch">
+    <tal:listing condition="batch">
+
 
           <div metal:use-macro="context/batch_macros/macros/navigation" />
           <div class="has-table">
@@ -22,47 +33,56 @@
                         <th class="nosort">&nbsp;<tal:title i18n:translate="listingheader_title"
                           >Title</tal:title>&nbsp;</th>
                         <th class="nosort"
-                            tal:condition="show_about">&nbsp;<tal:title i18n:translate="listingheader_author"
+                            tal:condition="view/show_about">&nbsp;<tal:title i18n:translate="listingheader_author"
                           >Author</tal:title>&nbsp;</th>
                         <th class="nosort">&nbsp;<tal:title i18n:translate="listingheader_type"
                           >Type</tal:title>&nbsp;</th>
                         <th class="nosort"
-                            tal:condition="show_about">&nbsp;<tal:modified i18n:translate="listingheader_modified"
+                            tal:condition="view/show_about">&nbsp;<tal:modified i18n:translate="listingheader_modified"
                           >Modified</tal:modified>&nbsp;</th>
                     </tr>
                 </thead>
 
                 <tbody>
-                    <metal:block use-macro="context/folder_listing/macros/entries">
-                        <metal:entry fill-slot="entry">
+
+            <tal:entries tal:repeat="item batch">
+            <tal:block tal:define="item_url item/getURL;
+                                   item_id item/getId;
+                                   item_title item/Title;
+                                   item_description item/Description;
+                                   item_type item/PortalType;
+                                   item_modified item/ModificationDate;
+                                   item_created item/CreationDate;
+                                   item_icon item/getIcon;
+                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
+                                   item_wf_state item/review_state;
+                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
+                                   item_creator item/Creator;
+                                   item_start item/start|nothing;
+                                   item_end item/end|nothing;
+                                   item_sametime python: item_start == item_end;
+                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
 
                     <tr metal:define-macro="listitem"
                         tal:define="oddrow repeat/item/odd;"
                         tal:attributes="class python: oddrow and 'even' or 'odd'">
 
                             <td>
-                                <img width="16" height="16"
-                                     src="" alt=""
-                                     tal:condition="item_icon/url"
-                                     tal:attributes="src item_icon/url;
-                                                     alt item_icon/description;
-                                                     title item_icon/title;
-                                                     width item_icon/width;
-                                                     height item_icon/height;" />
+                                <img tal:replace="structure item_icon" />
                                 <a href="#"
-                                   tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;
+                                   tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;
                                                    class string:$item_wf_state_class $item_type_class;
                                                    title item_description;"
-                                   tal:content="item_title_or_id">
+                                   tal:content="item_title">
                                     Item Title
                                 </a>
                             </td>
 
-                            <td tal:condition="show_about">
+                            <td tal:condition="view/show_about">
                                 <tal:name tal:condition="item_creator"
-                                  tal:define="author python:pas_member.info(item_creator)">
+                                  tal:define="author python:view.pas_member.info(item_creator)">
                                 <a href="#"
-                                   tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
+                                   tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
                                    tal:content="author/name_or_id"
                                    tal:omit-tag="not:author">
                                   Bob Dobalina
@@ -70,27 +90,40 @@
                                 </tal:name>
                             </td>
 
-                            <td tal:content="item_type_title"
+                            <td tal:content="item_type"
                                 i18n:translate="">
                                 Page
                             </td>
 
-                        <td tal:condition="show_about"
-                            tal:content="python:toLocalizedTime(item_modified,long_format=1)">
+                        <td tal:condition="view/show_about"
+                            tal:content="python:view.toLocalizedTime(item_modified,long_format=1)">
                           August 16, 2001 at 23:35:59
                         </td>
 
                     </tr>
 
-                        </metal:entry>
-                    </metal:block>
+            </tal:block>
+            </tal:entries>
+
                 </tbody>
             </table>
           </div>
-      </metal:entries>
-    </metal:block>
 
-  </metal:content-core>
+        <div metal:use-macro="context/batch_macros/macros/navigation" />
+
+    </tal:listing>
+    <metal:empty metal:define-slot="no_items_in_listing">
+        <p class="discreet"
+           tal:condition="not: view/folderContents"
+           i18n:translate="description_no_items_in_folder">
+            There are currently no items in this folder.
+        </p>
+    </metal:empty>
+
+    </tal:foldercontents>
+
+</metal:block>
+</metal:content-core>
 
 </body>
 </html>


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/f91ce1255823ed605cb4bfe0353f74eb6a93478e

refactor to unify folder and collection listings

Files changed:
M plone/app/contenttypes/behaviors/collection.py
M plone/app/contenttypes/browser/collection.py
M plone/app/contenttypes/browser/configure.zcml
M plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/templates/folder_listing.pt
M plone/app/contenttypes/browser/templates/folder_summary_view.pt
M plone/app/contenttypes/browser/templates/folder_tabular_view.pt

diff --git a/plone/app/contenttypes/behaviors/collection.py b/plone/app/contenttypes/behaviors/collection.py
index 871e570..58c0773 100644
--- a/plone/app/contenttypes/behaviors/collection.py
+++ b/plone/app/contenttypes/behaviors/collection.py
@@ -187,7 +187,8 @@ def selectedViewFields(self):
                            name='plone.app.contenttypes.metadatafields')
         for field in vocab(self.context):
             _mapping[field.value] = (field.value, field.title)
-        return [_mapping[field] for field in self.customViewFields]
+        ret = [_mapping[field] for field in self.customViewFields]
+        return ret
 
     # Getters and setters for our fields.
 
diff --git a/plone/app/contenttypes/browser/collection.py b/plone/app/contenttypes/browser/collection.py
index ddb2f6f..b8293b7 100644
--- a/plone/app/contenttypes/browser/collection.py
+++ b/plone/app/contenttypes/browser/collection.py
@@ -1,25 +1,39 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_inner
-from Products.Five import BrowserView
 from plone.app.contenttypes.behaviors.collection import ICollection
+from plone.app.contenttypes.browser.folder import FolderView
+from plone.app.contenttypes import _
+from Products.CMFPlone.PloneBatch import Batch
 
 
-class CollectionView(BrowserView):
+class CollectionView(FolderView):
 
     def results(self, **kwargs):
         context = aq_inner(self.context)
         wrapped = ICollection(context)
-        return wrapped.results(**kwargs)
+        return wrapped.results(self.b_start, **kwargs)
+
+    def batch(self):
+        batch = Batch(self.results(), self.b_start)
+        return batch
 
     def getFoldersAndImages(self, **kwargs):
         context = aq_inner(self.context)
         wrapped = ICollection(context)
         return wrapped.getFoldersAndImages(**kwargs)
 
-    def selectedViewFields(self):
+    def tabular_fields(self):
         """Returns a list of all metadata fields from the catalog that were
            selected.
         """
         context = aq_inner(self.context)
         wrapped = ICollection(context)
-        return wrapped.selectedViewFields()
+        fields = wrapped.selectedViewFields()
+        fields = [field[0] for field in fields]
+        return fields
+
+    def no_items_message(self):
+        return _(
+            'description_no_results_found',
+            default=u"No results were found."
+        )
diff --git a/plone/app/contenttypes/browser/configure.zcml b/plone/app/contenttypes/browser/configure.zcml
index 0384cec..2f4bad0 100644
--- a/plone/app/contenttypes/browser/configure.zcml
+++ b/plone/app/contenttypes/browser/configure.zcml
@@ -19,7 +19,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.interfaces.ICollection"
     class=".collection.CollectionView"
-    template="templates/standard_view.pt"
+    template="templates/folder_listing.pt"
     />
 
   <browser:page
@@ -27,7 +27,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.interfaces.ICollection"
     class=".collection.CollectionView"
-    template="templates/standard_view.pt"
+    template="templates/folder_listing.pt"
     />
 
   <!-- VIEWS FOR ANYTHING WITH THE COLLECTION BEHAVIOR.
@@ -41,7 +41,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/standard_view.pt"
+    template="templates/folder_listing.pt"
     />
 
   <browser:page
@@ -49,7 +49,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/summary_view.pt"
+    template="templates/folder_summary_view.pt"
     />
 
   <browser:page
@@ -65,7 +65,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/tabular_view.pt"
+    template="templates/folder_tabular_view.pt"
     />
 
   <browser:page
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 52a2c59..3d6a390 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -1,8 +1,10 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_base
+from Products.CMFPlone.PloneBatch import Batch
+from Products.CMFPlone.utils import safe_callable
 from Products.Five import BrowserView
+from plone.app.contenttypes import _
 from zope.component import getMultiAdapter
-from Products.CMFPlone.PloneBatch import Batch
 
 
 class FolderView(BrowserView):
@@ -30,31 +32,39 @@ def __init__(self, context, request):
         self.more_url = getattr(request, 'more_url', 'folder_contents')
 
         # TODO: eventually REMOVE
-        self.plone_layout = context.restrictedTraverse('@@plone_layout')
-
-        self.pas_member = context.restrictedTraverse('@@pas_member')
-
-        limit_display = getattr(request, 'limit_display', None)
-        limit_display = int(limit_display) if limit_display is not None else 20
-        b_size = getattr(request, 'b_size', None)
-        b_size = int(b_size) if b_size is not None else limit_display
-        b_start = getattr(request, 'b_start', None)
-        b_start = int(b_start) if b_start is not None else 0
+        self.plone_layout = getMultiAdapter(
+            (context, request), name=u"plone_layout")
 
-        contentFilter = getattr(request, 'contentFilter', None)
-        contentFilter = dict(contentFilter) if contentFilter else {}
-        contentFilter.setdefault('portal_type', self.friendly_types)
-        contentFilter.setdefault('batch', True)
-        contentFilter.setdefault('b_size', b_size)
-        contentFilter.setdefault('b_start', b_start)
-
-        self.folderContents = context.restrictedTraverse(
-            '@@folderListing')(**contentFilter)
-
-        self.batch = Batch(self.folderContents, b_size, b_start, orphan=1)
+        self.pas_member = getMultiAdapter(
+            (context, request), name=u"pas_member")
 
         self.text_class = None
 
+        limit_display = getattr(self.request, 'limit_display', None)
+        limit_display = int(limit_display) if limit_display is not None else 20
+        b_size = getattr(self.request, 'b_size', None)
+        self.b_size = int(b_size) if b_size is not None else limit_display
+        b_start = getattr(self.request, 'b_start', None)
+        self.b_start = int(b_start) if b_start is not None else 0
+
+    def _content_filter(self):
+        content_filter = getattr(self.request, 'contentFilter', None)
+        content_filter = dict(content_filter) if content_filter else {}
+        content_filter.setdefault('portal_type', self.friendly_types)
+        content_filter.setdefault('batch', True)
+        content_filter.setdefault('b_size', self.b_size)
+        content_filter.setdefault('b_start', self.b_start)
+        return content_filter
+
+    def results(self):
+        results = self.context.restrictedTraverse(
+            '@@folderListing')(**self._content_filter())
+        return results
+
+    def batch(self):
+        batch = Batch(self.results(), self.b_size, self.b_start, orphan=1)
+        return batch
+
     def normalizeString(self, text):
         return self.plone_view.normalizeString(text)
 
@@ -69,3 +79,43 @@ def text(self):
                 'text/structured', 'text/x-rst', 'text/restructured'
             ) else 'plain'
         return text
+
+    def tabular_fields(self):
+        ret = []
+        ret.append('Title')
+        if self.show_about:
+            ret.append('Creator')
+        ret.append('Type')
+        if self.show_about:
+            ret.append('ModificationDate')
+        return ret
+
+    def tabular_fielddata(self, item, fieldname):
+        value = getattr(item, fieldname, '')
+        if safe_callable(value):
+            value = value()
+        if fieldname in [
+                'CreationDate',
+                'ModificationDate',
+                'Date',
+                'EffectiveDate',
+                'ExpirationDate',
+                'effective',
+                'expires',
+                'start',
+                'end',
+                'created',
+                'modified',
+                'last_comment_date']:
+            value = self.toLocalizedTime(value, long_format=1)
+
+        return {
+            # 'title': _(fieldname, default=fieldname),
+            'value': value
+        }
+
+    def no_items_message(self):
+        return _(
+            'description_no_items_in_folder',
+            default=u"There are currently no items in this folder."
+        )
diff --git a/plone/app/contenttypes/browser/templates/folder_listing.pt b/plone/app/contenttypes/browser/templates/folder_listing.pt
index 7788b6b..6f3004b 100644
--- a/plone/app/contenttypes/browser/templates/folder_listing.pt
+++ b/plone/app/contenttypes/browser/templates/folder_listing.pt
@@ -20,11 +20,11 @@
     </div>
 
     <metal:listingmacro define-macro="listing">
-    <tal:foldercontents define="batch view/batch">
+    <tal:results define="batch view/batch">
     <tal:listing condition="batch">
 
-        <ul metal:define-slot="entries">
-            <li tal:repeat="item batch" metal:define-macro="entries">
+        <div metal:define-slot="entries">
+            <article tal:repeat="item batch" metal:define-macro="entries">
             <tal:block tal:define="item_url item/getURL;
                                    item_id item/getId;
                                    item_title item/Title;
@@ -42,9 +42,8 @@
                                    item_sametime python: item_start == item_end;
                                    item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
                 <metal:block define-slot="entry">
-                <span metal:define-macro="listitem"
-                    tal:define="item_type_event_class python: item_type == 'Event' and 'vevent' or None"
-                    tal:attributes="class item_type_event_class|nothing">
+                <header metal:define-macro="listitem"
+                    tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
 
                     <span class="summary">
                         <img tal:replace="structure item_icon" />
@@ -56,27 +55,28 @@
                         </a>
                     </span>
 
+                    <metal:block metal:define-macro="document_byline">
                     <span class="documentByLine">
                         <span tal:condition="python: item_type == 'Event' and item_sametime"
                               i18n:translate="label_event_byline_onlyfrom">
                              <abbr class="dtstart"
                                    tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
+                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
                                    i18n:name="start">from date</abbr>
                         </span>
                         <span tal:condition="python: item_type == 'Event' and item_samedate and not item_sametime"
                               i18n:translate="label_event_byline_samedate">
                              <abbr class="dtstart"
                                    tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start)"
+                                   tal:content="python:view.toLocalizedTime(item_start)"
                                    i18n:name="start">from date</abbr> from
                              <abbr class="dtstart"
                                    tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,time_only=1)"
+                                   tal:content="python:view.toLocalizedTime(item_start,time_only=1)"
                                    i18n:name="starttime">from time</abbr> to
                              <abbr class="dtend"
                                    tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,time_only=1)"
+                                   tal:content="python:view.toLocalizedTime(item_end,time_only=1)"
                                    i18n:name="end">to time</abbr>
                         </span>
                         <span tal:condition="python: item_type == 'Event' and not item_samedate and not item_sametime"
@@ -84,11 +84,11 @@
                               from
                                    <abbr class="dtstart"
                                    tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
+                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
                                    i18n:name="start">from date</abbr> to
                              <abbr class="dtend"
                                    tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,long_format=1)"
+                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
                                    i18n:name="end">to date</abbr>
                         </span>
                          <span tal:condition="python: item_type == 'Event' and item.location"
@@ -124,7 +124,7 @@
                                 <tal:mod i18n:translate="box_last_modified">
                                   last modified
                                 </tal:mod>
-                                <span tal:replace="python:toLocalizedTime(item_modified,long_format=1)">
+                                <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">
                                   August 16, 2001 at 23:35:59
                                 </span>
                             </tal:modified>
@@ -136,8 +136,9 @@
                             </metal:description>
                         </tal:byline>
                     </span>
+                    </metal:block>
 
-                </span>
+                </header>
 
                 <p class="description discreet"
                     tal:condition="item_description"
@@ -146,21 +147,22 @@
                 </p>
             </metal:block>
             </tal:block>
-            </li>
-        </ul>
+            </article>
+        </div>
 
         <div metal:use-macro="context/batch_macros/macros/navigation" />
 
     </tal:listing>
+
     <metal:empty metal:define-slot="no_items_in_listing">
         <p class="discreet"
-           tal:condition="not: view/folderContents"
-           i18n:translate="description_no_items_in_folder">
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
             There are currently no items in this folder.
         </p>
     </metal:empty>
 
-    </tal:foldercontents>
+    </tal:results>
     </metal:listingmacro>
 
 </metal:block>
diff --git a/plone/app/contenttypes/browser/templates/folder_summary_view.pt b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
index a0b4450..e67294a 100644
--- a/plone/app/contenttypes/browser/templates/folder_summary_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
@@ -19,12 +19,11 @@
         <div metal:define-slot="inside" tal:replace="structure text">The body</div>
     </div>
 
-    <tal:foldercontents define="batch view/batch">
+    <tal:results define="batch view/batch">
     <tal:listing condition="batch">
 
-
-        <ul>
-            <li tal:repeat="item batch">
+        <div>
+            <article tal:repeat="item batch">
             <tal:block tal:define="item_url item/getURL;
                                    item_id item/getId;
                                    item_title item/Title;
@@ -42,22 +41,20 @@
                                    item_sametime python: item_start == item_end;
                                    item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
 
-                <div class="tileItem visualIEFloatFix"
-                     tal:define="item_object item/getObject;">
+                <div class="tileItem visualIEFloatFix" tal:define="obj item/getObject">
 
                     <a href="#"
-                       tal:define="real_object python:item_object.aq_explicit"
-                       tal:condition="python:getattr(real_object, 'image', None)"
-                       tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url">
-                        <img tal:define="images item_object/@@images;
-                                         scale python: images.scale('image', scale='thumb')"
-                             tal:condition="scale"
-                             src="" alt=""
-                             tal:replace="structure python: scale.tag(css_class='tileImage')" />
+                        tal:condition="python:getattr(obj.aq_explicit, 'image', None)"
+                        tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url">
+                        <div class="tileImage">
+                            <img src="" alt=""
+                                 tal:define="scales obj/@@images;
+                                             scale python:scales.scale('image', 'thumb')"
+                                 tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
+                        </div>
                     </a>
 
-                    <h2 class="tileHeadline"
-                        metal:define-macro="listitem">
+                    <h2 class="tileHeadline" metal:define-macro="listitem">
 
                         <a href="#"
                            class="summary url"
@@ -68,60 +65,7 @@
 
                     </h2>
 
-                    <div class="documentByLine" tal:condition="python: view.site_properties.allowAnonymousViewAbout or not view.isAnon">
-                    <tal:event condition="python: item_type == 'Event'">
-                        <span tal:condition="python: item_type == 'Event' and item.location"
-                              i18n:translate="label_event_byline_with_location">
-                            (<span tal:content="string:${item/location}"
-                                   class="location"
-                                   i18n:name="location">Oslo</span>, from
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
-                                   i18n:name="end">to date</abbr>)
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and not item.location"
-                              i18n:translate="label_event_byline_without_location">
-                            (from
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
-                                   i18n:name="end">to date</abbr>)
-                        </span>
-                    </tal:event>
-                    <tal:newsitem condition="python: item_type == 'News Item'">
-                        <tal:name tal:condition="item_creator"
-                            tal:define="author python:pas_member.info(item_creator)">
-                          <span class="documentAuthor" i18n:translate="label_by_author">
-                            by
-                          <a href="#"
-                             tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
-                             tal:content="author/name_or_id"
-                             tal:omit-tag="not:author"
-                             i18n:name="author">
-                            Bob Dobalina
-                          </a>
-                          </span>
-                        </tal:name>
-                        &mdash;
-                        <span class="documentModified">
-                              <tal:mod i18n:translate="box_last_modified">
-                              last modified
-                              </tal:mod>
-                              <span tal:replace="python:toLocalizedTime(item_modified,long_format=1)">
-                                      August 16, 2001 at 23:35:59
-                              </span>
-                        </span>
-                    </tal:newsitem>
-                    </div>
+                    <div metal:use-macro="context/@@folder_listing/macros/document_byline|context/@@collection_view/macros/document_byline"></div>
 
                     <p class="tileBody" tal:condition="item_description">
                         <span class="description" tal:content="item_description">
@@ -142,21 +86,22 @@
                 </div>
 
             </tal:block>
-            </li>
-        </ul>
+            </article>
+        </div>
 
         <div metal:use-macro="context/batch_macros/macros/navigation" />
 
     </tal:listing>
+
     <metal:empty metal:define-slot="no_items_in_listing">
         <p class="discreet"
-           tal:condition="not: view/folderContents"
-           i18n:translate="description_no_items_in_folder">
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
             There are currently no items in this folder.
         </p>
     </metal:empty>
 
-    </tal:foldercontents>
+    </tal:results>
 
 </metal:block>
 </metal:content-core>
diff --git a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
index b0c69db..cf721bd 100644
--- a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
@@ -19,7 +19,7 @@
         <div metal:define-slot="inside" tal:replace="structure text">The body</div>
     </div>
 
-    <tal:foldercontents define="batch view/batch">
+    <tal:results define="batch view/batch">
     <tal:listing condition="batch">
 
 
@@ -30,16 +30,10 @@
                    i18n:attributes="summary summary_content_listing;">
                 <thead>
                     <tr>
-                        <th class="nosort">&nbsp;<tal:title i18n:translate="listingheader_title"
-                          >Title</tal:title>&nbsp;</th>
                         <th class="nosort"
-                            tal:condition="view/show_about">&nbsp;<tal:title i18n:translate="listingheader_author"
-                          >Author</tal:title>&nbsp;</th>
-                        <th class="nosort">&nbsp;<tal:title i18n:translate="listingheader_type"
-                          >Type</tal:title>&nbsp;</th>
-                        <th class="nosort"
-                            tal:condition="view/show_about">&nbsp;<tal:modified i18n:translate="listingheader_modified"
-                          >Modified</tal:modified>&nbsp;</th>
+                            i18n:translate=""
+                            tal:repeat="field view/tabular_fields"
+                            tal:content="field">Field name</th>
                     </tr>
                 </thead>
 
@@ -67,8 +61,12 @@
                         tal:define="oddrow repeat/item/odd;"
                         tal:attributes="class python: oddrow and 'even' or 'odd'">
 
-                            <td>
-                                <img tal:replace="structure item_icon" />
+                        <tal:block tal:repeat="field view/tabular_fields">
+                            <td tal:condition="python:field not in ['Title', 'Creator', 'getIcon']"
+                                tal:define="field_data python:view.tabular_fielddata(item, field)">
+                                <tal:block tal:replace="field_data/value" />
+                            </td>
+                            <td tal:condition="python:field == 'Title'">
                                 <a href="#"
                                    tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;
                                                    class string:$item_wf_state_class $item_type_class;
@@ -77,28 +75,15 @@
                                     Item Title
                                 </a>
                             </td>
-
-                            <td tal:condition="view/show_about">
-                                <tal:name tal:condition="item_creator"
-                                  tal:define="author python:view.pas_member.info(item_creator)">
+                            <td tal:condition="python:field == 'Creator'"
+                                tal:define="author python:view.pas_member.info(item_creator);
+                                            name python:author['fullname'] or author['username']">
                                 <a href="#"
+                                   tal:condition="author"
                                    tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
-                                   tal:content="author/name_or_id"
-                                   tal:omit-tag="not:author">
-                                  Bob Dobalina
-                                </a>
-                                </tal:name>
+                                   tal:content="name">Jos Henken</a>
                             </td>
-
-                            <td tal:content="item_type"
-                                i18n:translate="">
-                                Page
-                            </td>
-
-                        <td tal:condition="view/show_about"
-                            tal:content="python:view.toLocalizedTime(item_modified,long_format=1)">
-                          August 16, 2001 at 23:35:59
-                        </td>
+                        </tal:block>
 
                     </tr>
 
@@ -112,15 +97,16 @@
         <div metal:use-macro="context/batch_macros/macros/navigation" />
 
     </tal:listing>
+
     <metal:empty metal:define-slot="no_items_in_listing">
         <p class="discreet"
-           tal:condition="not: view/folderContents"
-           i18n:translate="description_no_items_in_folder">
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
             There are currently no items in this folder.
         </p>
     </metal:empty>
 
-    </tal:foldercontents>
+    </tal:results>
 
 </metal:block>
 </metal:content-core>


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/75b7490822d977ca4308f4bf2d4c69ddae03b095

little simplifications

Files changed:
M plone/app/contenttypes/browser/templates/folder_listing.pt
M plone/app/contenttypes/browser/templates/folder_summary_view.pt
M plone/app/contenttypes/browser/templates/folder_tabular_view.pt

diff --git a/plone/app/contenttypes/browser/templates/folder_listing.pt b/plone/app/contenttypes/browser/templates/folder_listing.pt
index 6f3004b..ae87cb5 100644
--- a/plone/app/contenttypes/browser/templates/folder_listing.pt
+++ b/plone/app/contenttypes/browser/templates/folder_listing.pt
@@ -40,7 +40,8 @@
                                    item_start item/start|nothing;
                                    item_end item/end|nothing;
                                    item_sametime python: item_start == item_end;
-                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
+                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False;
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
                 <metal:block define-slot="entry">
                 <header metal:define-macro="listitem"
                     tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
@@ -48,7 +49,7 @@
                     <span class="summary">
                         <img tal:replace="structure item_icon" />
                         <a href="#"
-                           tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;
+                           tal:attributes="href item_link;
                                            class string:$item_type_class $item_wf_state_class url"
                            tal:content="item_title">
                             Item Title
diff --git a/plone/app/contenttypes/browser/templates/folder_summary_view.pt b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
index e67294a..681238a 100644
--- a/plone/app/contenttypes/browser/templates/folder_summary_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
@@ -25,27 +25,18 @@
         <div>
             <article tal:repeat="item batch">
             <tal:block tal:define="item_url item/getURL;
-                                   item_id item/getId;
                                    item_title item/Title;
                                    item_description item/Description;
                                    item_type item/PortalType;
                                    item_modified item/ModificationDate;
-                                   item_created item/CreationDate;
-                                   item_icon item/getIcon;
-                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
-                                   item_wf_state item/review_state;
-                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
                                    item_creator item/Creator;
-                                   item_start item/start|nothing;
-                                   item_end item/end|nothing;
-                                   item_sametime python: item_start == item_end;
-                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
 
                 <div class="tileItem visualIEFloatFix" tal:define="obj item/getObject">
 
                     <a href="#"
                         tal:condition="python:getattr(obj.aq_explicit, 'image', None)"
-                        tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url">
+                        tal:attributes="href item_link">
                         <div class="tileImage">
                             <img src="" alt=""
                                  tal:define="scales obj/@@images;
@@ -58,7 +49,7 @@
 
                         <a href="#"
                            class="summary url"
-                           tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;"
+                           tal:attributes="href item_link"
                            tal:content="item_title">
                             Item Title
                         </a>
@@ -75,7 +66,7 @@
 
                     <p class="tileFooter">
                         <a href=""
-                           tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;"
+                           tal:attributes="href item_link"
                            i18n:translate="read_more">
                         Read More&hellip;
                         </a>
diff --git a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
index cf721bd..3bd8c4f 100644
--- a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
@@ -41,21 +41,14 @@
 
             <tal:entries tal:repeat="item batch">
             <tal:block tal:define="item_url item/getURL;
-                                   item_id item/getId;
                                    item_title item/Title;
                                    item_description item/Description;
                                    item_type item/PortalType;
-                                   item_modified item/ModificationDate;
-                                   item_created item/CreationDate;
-                                   item_icon item/getIcon;
                                    item_type_class python:'contenttype-' + view.normalizeString(item_type);
                                    item_wf_state item/review_state;
                                    item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
                                    item_creator item/Creator;
-                                   item_start item/start|nothing;
-                                   item_end item/end|nothing;
-                                   item_sametime python: item_start == item_end;
-                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
 
                     <tr metal:define-macro="listitem"
                         tal:define="oddrow repeat/item/odd;"
@@ -68,7 +61,7 @@
                             </td>
                             <td tal:condition="python:field == 'Title'">
                                 <a href="#"
-                                   tal:attributes="href python: item_type in view.use_view_action and item_url+'/view' or item_url;
+                                   tal:attributes="href item_link;
                                                    class string:$item_wf_state_class $item_type_class;
                                                    title item_description;"
                                    tal:content="item_title">


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/c2f2d2cf80b869ce4ef4eb8a0a99a83a5905695e

rename templates

Files changed:
A plone/app/contenttypes/browser/templates/listing.pt
A plone/app/contenttypes/browser/templates/listing_summary.pt
A plone/app/contenttypes/browser/templates/listing_tabular.pt
M plone/app/contenttypes/browser/configure.zcml
D plone/app/contenttypes/browser/templates/folder_listing.pt
D plone/app/contenttypes/browser/templates/folder_summary_view.pt
D plone/app/contenttypes/browser/templates/folder_tabular_view.pt
D plone/app/contenttypes/browser/templates/standard_view.pt
D plone/app/contenttypes/browser/templates/summary_view.pt
D plone/app/contenttypes/browser/templates/tabular_view.pt

diff --git a/plone/app/contenttypes/browser/configure.zcml b/plone/app/contenttypes/browser/configure.zcml
index 2f4bad0..6e1d53c 100644
--- a/plone/app/contenttypes/browser/configure.zcml
+++ b/plone/app/contenttypes/browser/configure.zcml
@@ -19,7 +19,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.interfaces.ICollection"
     class=".collection.CollectionView"
-    template="templates/folder_listing.pt"
+    template="templates/listing.pt"
     />
 
   <browser:page
@@ -27,7 +27,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.interfaces.ICollection"
     class=".collection.CollectionView"
-    template="templates/folder_listing.pt"
+    template="templates/listing.pt"
     />
 
   <!-- VIEWS FOR ANYTHING WITH THE COLLECTION BEHAVIOR.
@@ -41,7 +41,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/folder_listing.pt"
+    template="templates/listing.pt"
     />
 
   <browser:page
@@ -49,7 +49,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/folder_summary_view.pt"
+    template="templates/listing_summary.pt"
     />
 
   <browser:page
@@ -65,7 +65,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/folder_tabular_view.pt"
+    template="templates/listing_tabular.pt"
     />
 
   <browser:page
@@ -129,7 +129,7 @@
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
     class=".folder.FolderView"
-    template="templates/folder_listing.pt"
+    template="templates/listing.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Standard view"
@@ -140,7 +140,7 @@
     for="Products.CMFPlone.interfaces.IPloneSiteRoot"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
     class=".folder.FolderView"
-    template="templates/folder_listing.pt"
+    template="templates/listing.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Standard view"
@@ -169,7 +169,7 @@
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
     class=".folder.FolderView"
-    template="templates/folder_summary_view.pt"
+    template="templates/listing_summary.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Summary view"
@@ -180,7 +180,7 @@
     for="Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
     class=".folder.FolderView"
-    template="templates/folder_summary_view.pt"
+    template="templates/listing_summary.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Summary view"
@@ -191,7 +191,7 @@
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
     class=".folder.FolderView"
-    template="templates/folder_tabular_view.pt"
+    template="templates/listing_tabular.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Tabular view"
@@ -202,7 +202,7 @@
     for="Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
     class=".folder.FolderView"
-    template="templates/folder_tabular_view.pt"
+    template="templates/listing_tabular.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Tabular view"
diff --git a/plone/app/contenttypes/browser/templates/folder_listing.pt b/plone/app/contenttypes/browser/templates/folder_listing.pt
deleted file mode 100644
index ae87cb5..0000000
--- a/plone/app/contenttypes/browser/templates/folder_listing.pt
+++ /dev/null
@@ -1,173 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block define-macro="content-core">
-
-    <div metal:define-macro="text-field-view"
-         id="parent-fieldname-text" class="stx"
-         tal:define="text view/text"
-         tal:condition="text"
-         tal:attributes="class view/text_class">
-        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-    </div>
-
-    <metal:listingmacro define-macro="listing">
-    <tal:results define="batch view/batch">
-    <tal:listing condition="batch">
-
-        <div metal:define-slot="entries">
-            <article tal:repeat="item batch" metal:define-macro="entries">
-            <tal:block tal:define="item_url item/getURL;
-                                   item_id item/getId;
-                                   item_title item/Title;
-                                   item_description item/Description;
-                                   item_type item/PortalType;
-                                   item_modified item/ModificationDate;
-                                   item_created item/CreationDate;
-                                   item_icon item/getIcon;
-                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
-                                   item_wf_state item/review_state;
-                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
-                                   item_creator item/Creator;
-                                   item_start item/start|nothing;
-                                   item_end item/end|nothing;
-                                   item_sametime python: item_start == item_end;
-                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False;
-                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
-                <metal:block define-slot="entry">
-                <header metal:define-macro="listitem"
-                    tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
-
-                    <span class="summary">
-                        <img tal:replace="structure item_icon" />
-                        <a href="#"
-                           tal:attributes="href item_link;
-                                           class string:$item_type_class $item_wf_state_class url"
-                           tal:content="item_title">
-                            Item Title
-                        </a>
-                    </span>
-
-                    <metal:block metal:define-macro="document_byline">
-                    <span class="documentByLine">
-                        <span tal:condition="python: item_type == 'Event' and item_sametime"
-                              i18n:translate="label_event_byline_onlyfrom">
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr>
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and item_samedate and not item_sametime"
-                              i18n:translate="label_event_byline_samedate">
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start)"
-                                   i18n:name="start">from date</abbr> from
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,time_only=1)"
-                                   i18n:name="starttime">from time</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:view.toLocalizedTime(item_end,time_only=1)"
-                                   i18n:name="end">to time</abbr>
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and not item_samedate and not item_sametime"
-                              i18n:translate="label_event_byline">
-                              from
-                                   <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
-                                   i18n:name="end">to date</abbr>
-                        </span>
-                         <span tal:condition="python: item_type == 'Event' and item.location"
-                              i18n:translate="label_event_byline_location">&mdash;
-                             <span tal:content="string:${item/location}"
-                                   class="location"
-                                   i18n:name="location">Oslo</span>,
-                        </span>
-                        <tal:byline condition="view/show_about">
-                            &mdash;
-
-                            <tal:name tal:condition="item_creator"
-                                tal:define="author python:view.pas_member.info(item_creator);
-                                            creator_short_form author/username;
-                                            creator_long_form string:?author=${author/username};
-                                            creator_is_openid python:'/' in creator_short_form;
-                                            creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">
-                              <span i18n:translate="label_by_author">
-                                by
-                              <a href="#"
-                                 tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
-                                 tal:content="author/name_or_id"
-                                 tal:omit-tag="not:author"
-                                 i18n:name="author">
-                                Bob Dobalina
-                              </a>
-                              </span>
-
-                            </tal:name>
-
-                            <tal:modified condition="python: item_type != 'Event'">
-                                &mdash;
-                                <tal:mod i18n:translate="box_last_modified">
-                                  last modified
-                                </tal:mod>
-                                <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">
-                                  August 16, 2001 at 23:35:59
-                                </span>
-                            </tal:modified>
-
-                            <metal:description define-slot="description_slot">
-                                <tal:comment replace="nothing">
-                                    Place custom listing info for custom types here
-                                </tal:comment>
-                            </metal:description>
-                        </tal:byline>
-                    </span>
-                    </metal:block>
-
-                </header>
-
-                <p class="description discreet"
-                    tal:condition="item_description"
-                    tal:content="item_description">
-                    description
-                </p>
-            </metal:block>
-            </tal:block>
-            </article>
-        </div>
-
-        <div metal:use-macro="context/batch_macros/macros/navigation" />
-
-    </tal:listing>
-
-    <metal:empty metal:define-slot="no_items_in_listing">
-        <p class="discreet"
-           tal:condition="not: view/batch"
-           tal:content="view/no_items_message">
-            There are currently no items in this folder.
-        </p>
-    </metal:empty>
-
-    </tal:results>
-    </metal:listingmacro>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_summary_view.pt b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
deleted file mode 100644
index 681238a..0000000
--- a/plone/app/contenttypes/browser/templates/folder_summary_view.pt
+++ /dev/null
@@ -1,101 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block define-macro="content-core">
-
-    <div metal:define-macro="text-field-view"
-         id="parent-fieldname-text" class="stx"
-         tal:define="text view/text"
-         tal:condition="text"
-         tal:attributes="class view/text_class">
-        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-    </div>
-
-    <tal:results define="batch view/batch">
-    <tal:listing condition="batch">
-
-        <div>
-            <article tal:repeat="item batch">
-            <tal:block tal:define="item_url item/getURL;
-                                   item_title item/Title;
-                                   item_description item/Description;
-                                   item_type item/PortalType;
-                                   item_modified item/ModificationDate;
-                                   item_creator item/Creator;
-                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
-
-                <div class="tileItem visualIEFloatFix" tal:define="obj item/getObject">
-
-                    <a href="#"
-                        tal:condition="python:getattr(obj.aq_explicit, 'image', None)"
-                        tal:attributes="href item_link">
-                        <div class="tileImage">
-                            <img src="" alt=""
-                                 tal:define="scales obj/@@images;
-                                             scale python:scales.scale('image', 'thumb')"
-                                 tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
-                        </div>
-                    </a>
-
-                    <h2 class="tileHeadline" metal:define-macro="listitem">
-
-                        <a href="#"
-                           class="summary url"
-                           tal:attributes="href item_link"
-                           tal:content="item_title">
-                            Item Title
-                        </a>
-
-                    </h2>
-
-                    <div metal:use-macro="context/@@folder_listing/macros/document_byline|context/@@collection_view/macros/document_byline"></div>
-
-                    <p class="tileBody" tal:condition="item_description">
-                        <span class="description" tal:content="item_description">
-                            description
-                        </span>
-                    </p>
-
-                    <p class="tileFooter">
-                        <a href=""
-                           tal:attributes="href item_link"
-                           i18n:translate="read_more">
-                        Read More&hellip;
-                        </a>
-                    </p>
-
-                    <div class="visualClear"><!-- --></div>
-
-                </div>
-
-            </tal:block>
-            </article>
-        </div>
-
-        <div metal:use-macro="context/batch_macros/macros/navigation" />
-
-    </tal:listing>
-
-    <metal:empty metal:define-slot="no_items_in_listing">
-        <p class="discreet"
-           tal:condition="not: view/batch"
-           tal:content="view/no_items_message">
-            There are currently no items in this folder.
-        </p>
-    </metal:empty>
-
-    </tal:results>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
deleted file mode 100644
index 3bd8c4f..0000000
--- a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
+++ /dev/null
@@ -1,108 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block define-macro="content-core">
-
-    <div metal:define-macro="text-field-view"
-         id="parent-fieldname-text" class="stx"
-         tal:define="text view/text"
-         tal:condition="text"
-         tal:attributes="class view/text_class">
-        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-    </div>
-
-    <tal:results define="batch view/batch">
-    <tal:listing condition="batch">
-
-
-          <div metal:use-macro="context/batch_macros/macros/navigation" />
-          <div class="has-table">
-            <table class="listing"
-                   summary="Content listing"
-                   i18n:attributes="summary summary_content_listing;">
-                <thead>
-                    <tr>
-                        <th class="nosort"
-                            i18n:translate=""
-                            tal:repeat="field view/tabular_fields"
-                            tal:content="field">Field name</th>
-                    </tr>
-                </thead>
-
-                <tbody>
-
-            <tal:entries tal:repeat="item batch">
-            <tal:block tal:define="item_url item/getURL;
-                                   item_title item/Title;
-                                   item_description item/Description;
-                                   item_type item/PortalType;
-                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
-                                   item_wf_state item/review_state;
-                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
-                                   item_creator item/Creator;
-                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
-
-                    <tr metal:define-macro="listitem"
-                        tal:define="oddrow repeat/item/odd;"
-                        tal:attributes="class python: oddrow and 'even' or 'odd'">
-
-                        <tal:block tal:repeat="field view/tabular_fields">
-                            <td tal:condition="python:field not in ['Title', 'Creator', 'getIcon']"
-                                tal:define="field_data python:view.tabular_fielddata(item, field)">
-                                <tal:block tal:replace="field_data/value" />
-                            </td>
-                            <td tal:condition="python:field == 'Title'">
-                                <a href="#"
-                                   tal:attributes="href item_link;
-                                                   class string:$item_wf_state_class $item_type_class;
-                                                   title item_description;"
-                                   tal:content="item_title">
-                                    Item Title
-                                </a>
-                            </td>
-                            <td tal:condition="python:field == 'Creator'"
-                                tal:define="author python:view.pas_member.info(item_creator);
-                                            name python:author['fullname'] or author['username']">
-                                <a href="#"
-                                   tal:condition="author"
-                                   tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
-                                   tal:content="name">Jos Henken</a>
-                            </td>
-                        </tal:block>
-
-                    </tr>
-
-            </tal:block>
-            </tal:entries>
-
-                </tbody>
-            </table>
-          </div>
-
-        <div metal:use-macro="context/batch_macros/macros/navigation" />
-
-    </tal:listing>
-
-    <metal:empty metal:define-slot="no_items_in_listing">
-        <p class="discreet"
-           tal:condition="not: view/batch"
-           tal:content="view/no_items_message">
-            There are currently no items in this folder.
-        </p>
-    </metal:empty>
-
-    </tal:results>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
new file mode 100644
index 0000000..ae87cb5
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -0,0 +1,173 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+<metal:content-core fill-slot="content-core">
+<metal:block define-macro="content-core">
+
+    <div metal:define-macro="text-field-view"
+         id="parent-fieldname-text" class="stx"
+         tal:define="text view/text"
+         tal:condition="text"
+         tal:attributes="class view/text_class">
+        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
+    </div>
+
+    <metal:listingmacro define-macro="listing">
+    <tal:results define="batch view/batch">
+    <tal:listing condition="batch">
+
+        <div metal:define-slot="entries">
+            <article tal:repeat="item batch" metal:define-macro="entries">
+            <tal:block tal:define="item_url item/getURL;
+                                   item_id item/getId;
+                                   item_title item/Title;
+                                   item_description item/Description;
+                                   item_type item/PortalType;
+                                   item_modified item/ModificationDate;
+                                   item_created item/CreationDate;
+                                   item_icon item/getIcon;
+                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
+                                   item_wf_state item/review_state;
+                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
+                                   item_creator item/Creator;
+                                   item_start item/start|nothing;
+                                   item_end item/end|nothing;
+                                   item_sametime python: item_start == item_end;
+                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False;
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
+                <metal:block define-slot="entry">
+                <header metal:define-macro="listitem"
+                    tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
+
+                    <span class="summary">
+                        <img tal:replace="structure item_icon" />
+                        <a href="#"
+                           tal:attributes="href item_link;
+                                           class string:$item_type_class $item_wf_state_class url"
+                           tal:content="item_title">
+                            Item Title
+                        </a>
+                    </span>
+
+                    <metal:block metal:define-macro="document_byline">
+                    <span class="documentByLine">
+                        <span tal:condition="python: item_type == 'Event' and item_sametime"
+                              i18n:translate="label_event_byline_onlyfrom">
+                             <abbr class="dtstart"
+                                   tal:attributes="title python:item_start"
+                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
+                                   i18n:name="start">from date</abbr>
+                        </span>
+                        <span tal:condition="python: item_type == 'Event' and item_samedate and not item_sametime"
+                              i18n:translate="label_event_byline_samedate">
+                             <abbr class="dtstart"
+                                   tal:attributes="title python:item_start"
+                                   tal:content="python:view.toLocalizedTime(item_start)"
+                                   i18n:name="start">from date</abbr> from
+                             <abbr class="dtstart"
+                                   tal:attributes="title python:item_start"
+                                   tal:content="python:view.toLocalizedTime(item_start,time_only=1)"
+                                   i18n:name="starttime">from time</abbr> to
+                             <abbr class="dtend"
+                                   tal:attributes="title python:item_end"
+                                   tal:content="python:view.toLocalizedTime(item_end,time_only=1)"
+                                   i18n:name="end">to time</abbr>
+                        </span>
+                        <span tal:condition="python: item_type == 'Event' and not item_samedate and not item_sametime"
+                              i18n:translate="label_event_byline">
+                              from
+                                   <abbr class="dtstart"
+                                   tal:attributes="title python:item_start"
+                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
+                                   i18n:name="start">from date</abbr> to
+                             <abbr class="dtend"
+                                   tal:attributes="title python:item_end"
+                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
+                                   i18n:name="end">to date</abbr>
+                        </span>
+                         <span tal:condition="python: item_type == 'Event' and item.location"
+                              i18n:translate="label_event_byline_location">&mdash;
+                             <span tal:content="string:${item/location}"
+                                   class="location"
+                                   i18n:name="location">Oslo</span>,
+                        </span>
+                        <tal:byline condition="view/show_about">
+                            &mdash;
+
+                            <tal:name tal:condition="item_creator"
+                                tal:define="author python:view.pas_member.info(item_creator);
+                                            creator_short_form author/username;
+                                            creator_long_form string:?author=${author/username};
+                                            creator_is_openid python:'/' in creator_short_form;
+                                            creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">
+                              <span i18n:translate="label_by_author">
+                                by
+                              <a href="#"
+                                 tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
+                                 tal:content="author/name_or_id"
+                                 tal:omit-tag="not:author"
+                                 i18n:name="author">
+                                Bob Dobalina
+                              </a>
+                              </span>
+
+                            </tal:name>
+
+                            <tal:modified condition="python: item_type != 'Event'">
+                                &mdash;
+                                <tal:mod i18n:translate="box_last_modified">
+                                  last modified
+                                </tal:mod>
+                                <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">
+                                  August 16, 2001 at 23:35:59
+                                </span>
+                            </tal:modified>
+
+                            <metal:description define-slot="description_slot">
+                                <tal:comment replace="nothing">
+                                    Place custom listing info for custom types here
+                                </tal:comment>
+                            </metal:description>
+                        </tal:byline>
+                    </span>
+                    </metal:block>
+
+                </header>
+
+                <p class="description discreet"
+                    tal:condition="item_description"
+                    tal:content="item_description">
+                    description
+                </p>
+            </metal:block>
+            </tal:block>
+            </article>
+        </div>
+
+        <div metal:use-macro="context/batch_macros/macros/navigation" />
+
+    </tal:listing>
+
+    <metal:empty metal:define-slot="no_items_in_listing">
+        <p class="discreet"
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
+            There are currently no items in this folder.
+        </p>
+    </metal:empty>
+
+    </tal:results>
+    </metal:listingmacro>
+
+</metal:block>
+</metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
new file mode 100644
index 0000000..681238a
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -0,0 +1,101 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+<metal:content-core fill-slot="content-core">
+<metal:block define-macro="content-core">
+
+    <div metal:define-macro="text-field-view"
+         id="parent-fieldname-text" class="stx"
+         tal:define="text view/text"
+         tal:condition="text"
+         tal:attributes="class view/text_class">
+        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
+    </div>
+
+    <tal:results define="batch view/batch">
+    <tal:listing condition="batch">
+
+        <div>
+            <article tal:repeat="item batch">
+            <tal:block tal:define="item_url item/getURL;
+                                   item_title item/Title;
+                                   item_description item/Description;
+                                   item_type item/PortalType;
+                                   item_modified item/ModificationDate;
+                                   item_creator item/Creator;
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
+
+                <div class="tileItem visualIEFloatFix" tal:define="obj item/getObject">
+
+                    <a href="#"
+                        tal:condition="python:getattr(obj.aq_explicit, 'image', None)"
+                        tal:attributes="href item_link">
+                        <div class="tileImage">
+                            <img src="" alt=""
+                                 tal:define="scales obj/@@images;
+                                             scale python:scales.scale('image', 'thumb')"
+                                 tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
+                        </div>
+                    </a>
+
+                    <h2 class="tileHeadline" metal:define-macro="listitem">
+
+                        <a href="#"
+                           class="summary url"
+                           tal:attributes="href item_link"
+                           tal:content="item_title">
+                            Item Title
+                        </a>
+
+                    </h2>
+
+                    <div metal:use-macro="context/@@folder_listing/macros/document_byline|context/@@collection_view/macros/document_byline"></div>
+
+                    <p class="tileBody" tal:condition="item_description">
+                        <span class="description" tal:content="item_description">
+                            description
+                        </span>
+                    </p>
+
+                    <p class="tileFooter">
+                        <a href=""
+                           tal:attributes="href item_link"
+                           i18n:translate="read_more">
+                        Read More&hellip;
+                        </a>
+                    </p>
+
+                    <div class="visualClear"><!-- --></div>
+
+                </div>
+
+            </tal:block>
+            </article>
+        </div>
+
+        <div metal:use-macro="context/batch_macros/macros/navigation" />
+
+    </tal:listing>
+
+    <metal:empty metal:define-slot="no_items_in_listing">
+        <p class="discreet"
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
+            There are currently no items in this folder.
+        </p>
+    </metal:empty>
+
+    </tal:results>
+
+</metal:block>
+</metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt
new file mode 100644
index 0000000..3bd8c4f
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt
@@ -0,0 +1,108 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+<metal:content-core fill-slot="content-core">
+<metal:block define-macro="content-core">
+
+    <div metal:define-macro="text-field-view"
+         id="parent-fieldname-text" class="stx"
+         tal:define="text view/text"
+         tal:condition="text"
+         tal:attributes="class view/text_class">
+        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
+    </div>
+
+    <tal:results define="batch view/batch">
+    <tal:listing condition="batch">
+
+
+          <div metal:use-macro="context/batch_macros/macros/navigation" />
+          <div class="has-table">
+            <table class="listing"
+                   summary="Content listing"
+                   i18n:attributes="summary summary_content_listing;">
+                <thead>
+                    <tr>
+                        <th class="nosort"
+                            i18n:translate=""
+                            tal:repeat="field view/tabular_fields"
+                            tal:content="field">Field name</th>
+                    </tr>
+                </thead>
+
+                <tbody>
+
+            <tal:entries tal:repeat="item batch">
+            <tal:block tal:define="item_url item/getURL;
+                                   item_title item/Title;
+                                   item_description item/Description;
+                                   item_type item/PortalType;
+                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
+                                   item_wf_state item/review_state;
+                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
+                                   item_creator item/Creator;
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
+
+                    <tr metal:define-macro="listitem"
+                        tal:define="oddrow repeat/item/odd;"
+                        tal:attributes="class python: oddrow and 'even' or 'odd'">
+
+                        <tal:block tal:repeat="field view/tabular_fields">
+                            <td tal:condition="python:field not in ['Title', 'Creator', 'getIcon']"
+                                tal:define="field_data python:view.tabular_fielddata(item, field)">
+                                <tal:block tal:replace="field_data/value" />
+                            </td>
+                            <td tal:condition="python:field == 'Title'">
+                                <a href="#"
+                                   tal:attributes="href item_link;
+                                                   class string:$item_wf_state_class $item_type_class;
+                                                   title item_description;"
+                                   tal:content="item_title">
+                                    Item Title
+                                </a>
+                            </td>
+                            <td tal:condition="python:field == 'Creator'"
+                                tal:define="author python:view.pas_member.info(item_creator);
+                                            name python:author['fullname'] or author['username']">
+                                <a href="#"
+                                   tal:condition="author"
+                                   tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
+                                   tal:content="name">Jos Henken</a>
+                            </td>
+                        </tal:block>
+
+                    </tr>
+
+            </tal:block>
+            </tal:entries>
+
+                </tbody>
+            </table>
+          </div>
+
+        <div metal:use-macro="context/batch_macros/macros/navigation" />
+
+    </tal:listing>
+
+    <metal:empty metal:define-slot="no_items_in_listing">
+        <p class="discreet"
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
+            There are currently no items in this folder.
+        </p>
+    </metal:empty>
+
+    </tal:results>
+
+</metal:block>
+</metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/standard_view.pt b/plone/app/contenttypes/browser/templates/standard_view.pt
deleted file mode 100644
index 0664273..0000000
--- a/plone/app/contenttypes/browser/templates/standard_view.pt
+++ /dev/null
@@ -1,181 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-  <div metal:fill-slot="content-core">
-    <metal:block define-macro="content-core"
-                 tal:define="templateId template/getId">
-
-        <div metal:define-macro="text-field-view"
-             id="parent-fieldname-text" class="stx"
-             tal:define="has_text exists:context/aq_explicit/text/output;
-                         text python:has_text and here.text.output or ''"
-             tal:condition="text"
-             tal:attributes="class python:context.Format() in ('text/structured', 'text/x-rst', ) and 'stx' or 'plain'">
-            <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-        </div>
-
-        <metal:listingmacro define-macro="listing">
-        <tal:results define="b_start python:request.get('b_start', 0);
-                             batch python:view.results(b_start=b_start);
-                             site_properties context/portal_properties/site_properties;
-                             use_view_action site_properties/typesUseViewActionInListings|python:();
-                             isAnon portal_state/anonymous;
-                             normalizeString nocall: context/plone_utils/normalizeString;
-                             toLocalizedTime nocall: plone_view/toLocalizedTime;
-                             show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
-                             navigation_root_url portal_state/navigation_root_url;
-                             pas_member context/@@pas_member;">
-        <tal:listing condition="batch">
-
-            <div metal:define-slot="entries">
-                <article tal:repeat="item batch" metal:define-macro="entries">
-                <tal:block tal:define="item_url item/getURL;
-                                       item_id item/getId;
-                                       item_description item/Description;
-                                       item_type item/Type;
-                                       item_modified item/ModificationDate;
-                                       item_created item/CreationDate;
-                                       item_icon item/getIcon;
-                                       item_type_class item/ContentTypeClass;
-                                       item_wf_state_class python:'state-' + normalizeString(item.review_state());
-                                       item_creator item/Creator;
-                                       item_start python:(item.start or item.StartDate) if item_type == 'Event' else None;
-                                       item_end python:(item.end or item.EndDate) if item_type == 'Event' else None;
-                                       item_modified item/ModificationDate;
-                                       item_sametime python: item_start == item_end;
-                                       item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
-                    <metal:block define-slot="entry">
-                    <header metal:define-macro="listitem"
-                        tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
-
-                        <span class="summary">
-                            <img tal:replace="structure item_icon" />
-                            <a href="#"
-                               tal:attributes="href python:item_type in use_view_action and item_url+'/view' or item_url;
-                                               class string:$item_type_class $item_wf_state_class url"
-                               tal:content="item/Title">
-                                Item Title
-                            </a>
-                        </span>
-
-                        <metal:block metal:define-macro="document_byline">
-                        <span class="documentByLine">
-                            <span tal:condition="python: item_type == 'Event' and item_sametime"
-                                  i18n:translate="label_event_byline_onlyfrom">
-                                 <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                       i18n:name="start">from date</abbr>
-                            </span>
-                            <span tal:condition="python: item_type == 'Event' and item_samedate and not item_sametime"
-                                  i18n:translate="label_event_byline_samedate">
-                                 <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start)"
-                                       i18n:name="start">from date</abbr> from
-                                 <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start,time_only=1)"
-                                       i18n:name="starttime">from time</abbr> to
-                                 <abbr class="dtend"
-                                       tal:attributes="title python:item_end"
-                                       tal:content="python:toLocalizedTime(item_end,time_only=1)"
-                                       i18n:name="end">to time</abbr>
-                            </span>
-                            <span tal:condition="python: item_type == 'Event' and not item_samedate and not item_sametime"
-                                  i18n:translate="label_event_byline">
-                                  from
-                                       <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                       i18n:name="start">from date</abbr> to
-                                 <abbr class="dtend"
-                                       tal:attributes="title python:item_end"
-                                       tal:content="python:toLocalizedTime(item_end,long_format=1)"
-                                       i18n:name="end">to date</abbr>
-                            </span>
-                             <span tal:condition="python: item_type == 'Event' and item.location"
-                                  i18n:translate="label_event_byline_location">&mdash;
-                                 <span tal:content="string:${item/location}"
-                                       class="location"
-                                       i18n:name="location">Oslo</span>,
-                            </span>
-                            <tal:byline condition="show_about">
-                                &mdash;
-
-                                <tal:name tal:condition="item_creator"
-                                    tal:define="author python:pas_member.info(item_creator);
-                                                creator_short_form author/username;
-                                                creator_long_form string:?author=${author/username};
-                                                creator_is_openid python:'/' in creator_short_form;
-                                                creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">
-                                  <span i18n:translate="label_by_author">
-                                    by
-                                  <a href="#"
-                                     tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
-                                     tal:content="author/name_or_id"
-                                     tal:omit-tag="not:author"
-                                     i18n:name="author">
-                                    Bob Dobalina
-                                  </a>
-                                  </span>
-
-                                </tal:name>
-
-                                <tal:modified condition="python: item_type != 'Event'">
-                                    &mdash;
-                                    <tal:mod i18n:translate="box_last_modified">
-                                      last modified
-                                    </tal:mod>
-                                    <span tal:replace="python:toLocalizedTime(item_modified,long_format=1)">
-                                      August 16, 2001 at 23:35:59
-                                    </span>
-                                </tal:modified>
-
-                                <metal:description define-slot="description_slot">
-                                    <tal:comment replace="nothing">
-                                        Place custom listing info for custom types here
-                                    </tal:comment>
-                                </metal:description>
-                            </tal:byline>
-                        </span>
-                        </metal:block>
-
-                    </header>
-
-                    <span class="description"
-                        tal:condition="item_description"
-                        tal:content="item_description">
-                      description
-                    </span>
-                </metal:block>
-                </tal:block>
-                </article>
-            </div>
-
-            <div metal:use-macro="context/batch_macros/macros/navigation" />
-
-        </tal:listing>
-        <metal:empty metal:define-slot="no_items_in_listing">
-            <p class="discreet"
-               tal:condition="not: batch"
-               i18n:translate="description_no_items_in_folder">
-                There are currently no items in this folder.
-            </p>
-        </metal:empty>
-
-        </tal:results>
-        </metal:listingmacro>
-
-    </metal:block>
-  </div>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/summary_view.pt b/plone/app/contenttypes/browser/templates/summary_view.pt
deleted file mode 100644
index 880f1e0..0000000
--- a/plone/app/contenttypes/browser/templates/summary_view.pt
+++ /dev/null
@@ -1,67 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block use-macro="context/standard_view/macros/content-core">
-
-    <metal:entries fill-slot="entries">
-    <metal:block use-macro="context/standard_view/macros/entries">
-    <metal:entry fill-slot="entry">
-
-        <div class="tileItem visualIEFloatFix"
-             tal:define="obj item/getObject">
-            <a href="#"
-                  tal:condition="python:getattr(obj.aq_explicit, 'image', None)"
-                  tal:attributes="href item/getURL">
-                  <div class="tileImage">
-                      <img src="" alt=""
-                           tal:define="scales obj/@@images;
-                                       scale python:scales.scale('image', 'thumb')"
-                           tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
-                  </div>
-            </a>
-
-            <h2 class="tileHeadline" metal:define-macro="listitem">
-                <a href="#"
-                   class="summary url"
-                   tal:attributes="href python:item_type in use_view_action and item_url+'/view' or item_url;"
-                   tal:content="item/Title">
-                    Item Title
-                </a>
-            </h2>
-
-            <div metal:use-macro="context/standard_view/macros/document_byline"></div>
-
-            <p class="tileBody" tal:condition="item_description">
-                <span class="description" tal:content="item_description">
-                    description
-                </span>
-            </p>
-
-            <p class="tileFooter">
-                <a href=""
-                   tal:attributes="href python:item_type in use_view_action and item_url+'/view' or item_url;"
-                   i18n:translate="read_more">
-                Read More&hellip;
-                </a>
-            </p>
-
-            <div class="visualClear"><!-- --></div>
-        </div>
-
-    </metal:entry>
-    </metal:block>
-    </metal:entries>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/tabular_view.pt b/plone/app/contenttypes/browser/templates/tabular_view.pt
deleted file mode 100644
index 4f2ea22..0000000
--- a/plone/app/contenttypes/browser/templates/tabular_view.pt
+++ /dev/null
@@ -1,77 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-    <div metal:fill-slot="content-core"
-         tal:define="b_start python:request.get('b_start', 0);
-                     batch python:view.results(b_start=b_start);">
-
-         <div metal:define-macro="text-field-view"
-              id="parent-fieldname-text" class="stx"
-              tal:define="has_text exists:context/aq_explicit/text/output;
-                          text python:has_text and here.text.output or ''"
-              tal:condition="text"
-              tal:attributes="class python:here.Format() in ('text/structured', 'text/x-rst', ) and 'stx' or 'plain'">
-             <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-         </div>
-
-        <p class="discreet"
-           tal:condition="not: batch"
-           i18n:translate="description_no_items_in_folder">
-            There are currently no items in this folder.
-        </p>
-
-        <table class="listing" summary="Content listing"
-            i18n:attributes="summary"
-            tal:condition="batch"
-            tal:define="fields view/selectedViewFields;
-                        pas_member context/@@pas_member">
-            <thead>
-                <tr>
-                    <th class="nosort"
-                        i18n:translate=""
-                        tal:repeat="field fields"
-                        tal:content="python: field[1]">Field name</th>
-                </tr>
-            </thead>
-            <tbody>
-            <tal:block tal:repeat="item batch">
-                <tr tal:define="oddrow repeat/item/odd;"
-                    tal:attributes="class python:oddrow and 'even' or 'odd'" >
-                <tal:block tal:repeat="field fields">
-                    <td tal:condition="python:field[0] not in ['Title', 'Creator', ]"
-                        tal:define="field_data python:getattr(item, field[0])">
-                        <tal:block tal:replace="field_data" />
-                    </td>
-                    <td tal:condition="python:field[0] == 'Title'">
-                        <a href="#"
-                           tal:attributes="href item/getURL;
-                                           title item/Title"
-                           tal:content="item/Title">Item Title</a>
-                    </td>
-                    <td tal:condition="python:field[0] == 'Creator'"
-                        tal:define="author python:pas_member.info(item.Creator());
-                                    name python:author['fullname'] or author['username']">
-                        <a href="#"
-                           tal:condition="author"
-                           tal:attributes="href string:author/${author/username};
-                                           title name"
-                           tal:content="name">Jos Henken</a>
-                    </td>
-                </tal:block>
-                </tr>
-            </tal:block>
-            </tbody>
-        </table>
-
-        <div metal:use-macro="context/batch_macros/macros/navigation" />
-  </div>
-
-</body>
-</html>


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/eaee8a24ae6e26943afdb542c9d15a060bce951e

add title attribute to item links, indicating the portal type of the item

Files changed:
M plone/app/contenttypes/browser/templates/listing.pt
M plone/app/contenttypes/browser/templates/listing_summary.pt

diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
index ae87cb5..1af4f25 100644
--- a/plone/app/contenttypes/browser/templates/listing.pt
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -47,10 +47,10 @@
                     tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
 
                     <span class="summary">
-                        <img tal:replace="structure item_icon" />
                         <a href="#"
                            tal:attributes="href item_link;
-                                           class string:$item_type_class $item_wf_state_class url"
+                                           class string:$item_type_class $item_wf_state_class url;
+                                           title item_type"
                            tal:content="item_title">
                             Item Title
                         </a>
diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
index 681238a..eb4b257 100644
--- a/plone/app/contenttypes/browser/templates/listing_summary.pt
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -49,7 +49,8 @@
 
                         <a href="#"
                            class="summary url"
-                           tal:attributes="href item_link"
+                           tal:attributes="href item_link;
+                                           title item_type"
                            tal:content="item_title">
                             Item Title
                         </a>


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/9b6fc0ca25f82e5e683a7585122ddbf33db0f63b

changelog entry

Files changed:
M docs/CHANGES.rst

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 9cffa9d..386956f 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,6 +4,11 @@ Changelog
 1.2 (unreleased)
 ----------------
 
+- Refactor folder_listing, folder_summary_view, folder_tabular_view for folders
+  and standard_view (collection_view), summary_view and tabular_view for
+  collections to use the same templates and base view class.
+  [thet]
+
 - In the file view, render HTML5 ``<audio>`` or ``<video>`` tags for audio
   respectively video file types. Ancient browsers, which do not support that,
   just don't render these tags.


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/524ae422c3e5b2d294e62fd71a3ea2209dd03b85

reuse content-core macro from listing.pt

Files changed:
M plone/app/contenttypes/browser/templates/listing_summary.pt

diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
index eb4b257..af12928 100644
--- a/plone/app/contenttypes/browser/templates/listing_summary.pt
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -9,28 +9,11 @@
 <body>
 
 <metal:content-core fill-slot="content-core">
-<metal:block define-macro="content-core">
-
-    <div metal:define-macro="text-field-view"
-         id="parent-fieldname-text" class="stx"
-         tal:define="text view/text"
-         tal:condition="text"
-         tal:attributes="class view/text_class">
-        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-    </div>
-
-    <tal:results define="batch view/batch">
-    <tal:listing condition="batch">
-
-        <div>
-            <article tal:repeat="item batch">
-            <tal:block tal:define="item_url item/getURL;
-                                   item_title item/Title;
-                                   item_description item/Description;
-                                   item_type item/PortalType;
-                                   item_modified item/ModificationDate;
-                                   item_creator item/Creator;
-                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
+<metal:block use-macro="context/@@folder_listing/macros/content-core|context/@@standard_view/macros/content-core">
+
+    <metal:entries fill-slot="entries">
+    <metal:block use-macro="context/@@folder_listing/macros/entries|context/@@standard_view/macros/entries">
+    <metal:entry fill-slot="entry">
 
                 <div class="tileItem visualIEFloatFix" tal:define="obj item/getObject">
 
@@ -77,23 +60,9 @@
 
                 </div>
 
-            </tal:block>
-            </article>
-        </div>
-
-        <div metal:use-macro="context/batch_macros/macros/navigation" />
-
-    </tal:listing>
-
-    <metal:empty metal:define-slot="no_items_in_listing">
-        <p class="discreet"
-           tal:condition="not: view/batch"
-           tal:content="view/no_items_message">
-            There are currently no items in this folder.
-        </p>
-    </metal:empty>
-
-    </tal:results>
+    </metal:entry>
+    </metal:block>
+    </metal:entries>
 
 </metal:block>
 </metal:content-core>


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/380806ef1bb82397072a13ce822f6251ae3d9f0f

fix fullview

Refactor full_view and incorporate fixes from collective.fullview to
1) display the default views of it's items, 2) be recursively callable
and 3) have the same templates for folder and collections.

Files changed:
A plone/app/contenttypes/browser/full_view.py
A plone/app/contenttypes/browser/templates/full_view.pt
A plone/app/contenttypes/browser/templates/full_view_item.pt
M docs/CHANGES.rst
M plone/app/contenttypes/browser/configure.zcml
M plone/app/contenttypes/browser/folder.py
D plone/app/contenttypes/browser/templates/all_content.pt
D plone/app/contenttypes/browser/templates/folder_full_view.pt
D plone/app/contenttypes/browser/templates/folder_full_view_item.pt

diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 386956f..17b9a2b 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,6 +4,11 @@ Changelog
 1.2 (unreleased)
 ----------------
 
+- Refactor full_view and incorporate fixes from collective.fullview to
+  1) display the default views of it's items, 2) be recursively callable
+  and 3) have the same templates for folder and collections.
+  [thet] 
+
 - Refactor folder_listing, folder_summary_view, folder_tabular_view for folders
   and standard_view (collection_view), summary_view and tabular_view for
   collections to use the same templates and base view class.
diff --git a/plone/app/contenttypes/browser/configure.zcml b/plone/app/contenttypes/browser/configure.zcml
index 6e1d53c..e0fa89f 100644
--- a/plone/app/contenttypes/browser/configure.zcml
+++ b/plone/app/contenttypes/browser/configure.zcml
@@ -57,7 +57,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/all_content.pt"
+    template="templates/full_view.pt"
     />
 
   <browser:page
@@ -150,17 +150,19 @@
     name="folder_full_view"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_full_view.pt"
+    class=".folder.FolderView"
+    template="templates/full_view.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="All content"
     />
 
   <browser:page
-    name="folder_full_view_item"
+    name="full_view_item"
     for="Products.CMFCore.interfaces._content.IContentish"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_full_view_item.pt"
+    class=".full_view.FullViewItem"
+    template="templates/full_view_item.pt"
     permission="zope2.View"
     />
 
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 3d6a390..06414f2 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -28,13 +28,6 @@ def __init__(self, context, request):
         self.show_about = getattr(
             self.site_properties, 'allowAnonymousViewAbout', not self.isAnon)
 
-        # TODO: REMOVE
-        self.more_url = getattr(request, 'more_url', 'folder_contents')
-
-        # TODO: eventually REMOVE
-        self.plone_layout = getMultiAdapter(
-            (context, request), name=u"plone_layout")
-
         self.pas_member = getMultiAdapter(
             (context, request), name=u"pas_member")
 
diff --git a/plone/app/contenttypes/browser/full_view.py b/plone/app/contenttypes/browser/full_view.py
new file mode 100644
index 0000000..58201f7
--- /dev/null
+++ b/plone/app/contenttypes/browser/full_view.py
@@ -0,0 +1,35 @@
+from Products.Five.browser import BrowserView
+from Products.CMFCore.utils import getToolByName
+from zope.publisher.interfaces.browser import IBrowserView
+
+
+class FullViewItem(BrowserView):
+
+    def __init__(self, context, request):
+        super(FullViewItem, self).__init__(context, request)
+        self.item_type = self.context.portal_type
+
+    @property
+    def default_view(self):
+        context = self.context
+        item_layout = context.getLayout()
+        default_view = context.restrictedTraverse(item_layout)
+        return default_view
+
+    @property
+    def item_macros(self):
+        default_view = self.default_view
+        if IBrowserView.providedBy(default_view):
+            # IBrowserView
+            return default_view.index.macros
+        else:
+            # FSPageTemplate
+            return default_view.macros
+
+    @property
+    def item_url(self):
+        context = self.context
+        url = context.absolute_url()
+        props = getToolByName(context, 'portal_properties')
+        use_view_action = props.site_properties.typesUseViewActionInListings
+        return self.item_type in use_view_action and '%s/view' % url or url
diff --git a/plone/app/contenttypes/browser/templates/all_content.pt b/plone/app/contenttypes/browser/templates/all_content.pt
deleted file mode 100644
index 7c78024..0000000
--- a/plone/app/contenttypes/browser/templates/all_content.pt
+++ /dev/null
@@ -1,29 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block use-macro="context/standard_view/macros/content-core">
-
-    <metal:entries fill-slot="entries">
-    <metal:block use-macro="context/standard_view/macros/entries">
-    <metal:entry fill-slot="entry">
-
-        <div tal:define="realobject python:item.getObject()"
-             tal:replace="structure realobject/folder_full_view_item" />
-
-    </metal:entry>
-    </metal:block>
-    </metal:entries>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_full_view.pt b/plone/app/contenttypes/browser/templates/folder_full_view.pt
deleted file mode 100644
index cb2671b..0000000
--- a/plone/app/contenttypes/browser/templates/folder_full_view.pt
+++ /dev/null
@@ -1,26 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-    <metal:content-core fill-slot="content-core">
-        <metal:block use-macro="context/folder_listing/macros/content-core">
-            <!-- we don't want the dl -->
-            <metal:entries fill-slot="entries">
-                <metal:block use-macro="context/folder_listing/macros/entries">
-                    <metal:entry fill-slot="entry">
-                        <div tal:define="obj_view python:item.getObject().restrictedTraverse('folder_full_view_item')"
-                             tal:replace="structure python:obj_view()" />
-                    </metal:entry>
-                </metal:block>
-            </metal:entries>
-        </metal:block>
-    </metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_full_view_item.pt b/plone/app/contenttypes/browser/templates/folder_full_view_item.pt
deleted file mode 100644
index 55e3477..0000000
--- a/plone/app/contenttypes/browser/templates/folder_full_view_item.pt
+++ /dev/null
@@ -1,80 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      i18n:domain="plone"
-      tal:omit-tag="">
-
-<body tal:omit-tag="">
-
-    <div class="item visualIEFloatFix"
-         tal:define="portal_state context/@@plone_portal_state;
-                     context_state context/@@plone_context_state;
-                     plone_view context/@@plone;
-                     plone_layout context/@@plone_layout;
-                     lang portal_state/language;
-                     view nocall:view | nocall: plone_view;
-                     dummy python: plone_layout.mark_view(view);
-                     portal_url portal_state/portal_url;
-                     checkPermission nocall: context/portal_membership/checkPermission;
-                     site_properties context/portal_properties/site_properties;
-                     item_type context/portal_type;
-                     item_layout here/getLayout;
-                     override python: {'Link': 'link_view'};
-                     item_macro python:path('here/%s/macros/content-core | nothing' % override.get(item_type, item_layout));
-                     use_view_action site_properties/typesUseViewActionInListings|python:();
-                     item_url context/absolute_url;
-                     normalizeString nocall: context/plone_utils/normalizeString;
-                     item_type_class python: 'contenttype-' + normalizeString(item_type);
-                     kss_inline_editable python:False;
-                     rendering_error python:[];
-                     ">
-
-        <div tal:replace="structure provider:plone.abovecontenttitle" />
-
-        <h2 class="headline">
-            <a href="#" class="summary url" tal:content="context/Title"
-               tal:attributes="href python:item_url+'/view' if item_type in use_view_action else item_url;">
-               Title or id
-             </a>
-        </h2>
-
-        <div tal:replace="structure provider:plone.belowcontenttitle" />
-
-        <div class="description"
-             tal:content="context/Description"
-             tal:condition="context/Description">
-            Description
-        </div>
-
-        <tal:block tal:condition="item_macro" tal:on-error="python:rendering_error.append(True)">
-
-            <div tal:replace="structure provider:plone.abovecontentbody" />
-
-            <div metal:use-macro="item_macro">
-                content
-            </div>
-
-            <div tal:replace="structure provider:plone.belowcontentbody" />
-
-        </tal:block>
-
-        <tal:block tal:condition="rendering_error">
-            <!-- Error rendering item macro -->
-        </tal:block>
-
-        <p class="more" tal:condition="python:not(item_macro) or rendering_error">
-            <a href=""
-               tal:attributes="href python: item_url+'/view' if item_type in use_view_action else item_url;"
-               i18n:translate="read_more">
-                Read More&hellip;
-            </a>
-        </p>
-
-        <div class="visualClear"><!-- --></div>
-
-    </div>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/full_view.pt b/plone/app/contenttypes/browser/templates/full_view.pt
new file mode 100644
index 0000000..37974ec
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/full_view.pt
@@ -0,0 +1,29 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+    <metal:content-core fill-slot="content-core">
+    <metal:block define-macro="content-core">
+        <metal:listing use-macro="context/@@folder_listing/macros/content-core|context/@@collection_view/macros/content-core">
+            <!-- we don't want the dl -->
+            <metal:entries fill-slot="entries">
+                <metal:block use-macro="context/@@folder_listing/macros/entries|context/@@collection_view/macros/entries">
+                    <metal:entry fill-slot="entry">
+                        <div
+                            tal:define="obj item/getObject;"
+                            tal:replace="structure obj/@@full_view_item" />
+                    </metal:entry>
+                </metal:block>
+            </metal:entries>
+        </metal:listing>
+    </metal:block>
+    </metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/full_view_item.pt b/plone/app/contenttypes/browser/templates/full_view_item.pt
new file mode 100644
index 0000000..16eac28
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/full_view_item.pt
@@ -0,0 +1,73 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      i18n:domain="plone"
+      tal:omit-tag="">
+
+<body tal:omit-tag="">
+
+    <div class="item visualIEFloatFix"
+         tal:define="item_macro nocall:view/item_macros/content-core|nothing;
+                     item_url view/item_url;
+                     rendering_error python:[];">
+
+        <div tal:replace="structure provider:plone.abovecontenttitle" />
+
+        <h2 class="headline">
+            <a href="#" class="summary url" tal:content="context/Title"
+               tal:attributes="href item_url;">
+               Title
+             </a>
+        </h2>
+
+        <div tal:replace="structure provider:plone.belowcontenttitle" />
+
+        <div class="description"
+             tal:content="context/Description"
+             tal:condition="context/Description">
+            Description
+        </div>
+
+        <tal:block tal:condition="item_macro">
+        <!-- tal:on-error="python:rendering_error.append(True)"-->
+
+            <div tal:replace="structure provider:plone.abovecontentbody" />
+
+            <div tal:define="view nocall:view/default_view;
+                             portal_state context/@@plone_portal_state;
+                             context_state context/@@plone_context_state;
+                             plone_layout context/@@plone_layout;
+                             lang portal_state/language;
+                             dummy python: plone_layout.mark_view(view);
+                             portal_url portal_state/portal_url;
+                             checkPermission nocall: context/portal_membership/checkPermission;
+                             site_properties context/portal_properties/site_properties;">
+            <div metal:use-macro="item_macro">
+                content
+            </div>
+            </div>
+
+            <div tal:replace="structure provider:plone.belowcontentbody" />
+
+        </tal:block>
+
+        <tal:block tal:condition="rendering_error">
+            <!-- Error rendering item macro -->
+        </tal:block>
+
+        <p class="more" tal:condition="python:not(item_macro) or rendering_error">
+            <a href=""
+               tal:attributes="href item_url"
+               i18n:translate="read_more">
+                Read More&hellip;
+            </a>
+        </p>
+
+        <div class="visualClear"><!-- --></div>
+
+    </div>
+
+</body>
+</html>


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/d1773fbf2065589291f9cd99cef1824b6a456a9a

get show_about setting from registry, if available and fall back to BBB site_properties

Files changed:
M plone/app/contenttypes/browser/folder.py

diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 06414f2..7aaa31a 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -4,7 +4,15 @@
 from Products.CMFPlone.utils import safe_callable
 from Products.Five import BrowserView
 from plone.app.contenttypes import _
+from plone.registry.interfaces import IRegistry
 from zope.component import getMultiAdapter
+from zope.component import getUtility
+
+HAS_SECURITY_SETTINGS = True
+try:
+    from Products.CMFPlone.interfaces import ISecuritySchema
+except ImportError:
+    HAS_SECURITY_SETTINGS = False
 
 
 class FolderView(BrowserView):
@@ -12,6 +20,8 @@ class FolderView(BrowserView):
     def __init__(self, context, request):
         super(FolderView, self).__init__(context, request)
 
+        registry = getUtility(IRegistry)
+
         self.plone_view = getMultiAdapter(
             (context, request), name=u"plone")
 
@@ -21,12 +31,23 @@ def __init__(self, context, request):
         self.isAnon = self.portal_state.anonymous()
         self.navigation_root_url = self.portal_state.navigation_root_url()
 
+        # BBB
         self.site_properties = context.restrictedTraverse(
             'portal_properties').site_properties
         self.use_view_action = getattr(
             self.site_properties, 'typesUseViewActionInListings', ())
-        self.show_about = getattr(
-            self.site_properties, 'allowAnonymousViewAbout', not self.isAnon)
+
+        if HAS_SECURITY_SETTINGS:
+            security_settings = registry.forInterface(
+                ISecuritySchema, prefix="plone")
+            self.show_about = getattr(
+                security_settings, 'allow_anon_views_about', False
+            ) or not self.isAnon
+        else:
+            # BBB
+            self.show_about = getattr(
+                self.site_properties, 'allowAnonymousViewAbout', False
+            ) or not self.isAnon
 
         self.pas_member = getMultiAdapter(
             (context, request), name=u"pas_member")


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-19T22:51:02+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/55736b5567d874fc77fd1c64e5f69a98b39622c8

bugfixes

Files changed:
M plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/templates/folder_album_view.pt

diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 7aaa31a..bd5dd39 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -89,7 +89,7 @@ def text(self):
         textfield = getattr(aq_base(self.context), 'text', None)
         text = getattr(textfield, 'output', None)
         if text:
-            self.text_class = 'stx' if textfield.contentType() in (
+            self.text_class = 'stx' if textfield.mimeType in (
                 'text/structured', 'text/x-rst', 'text/restructured'
             ) else 'plain'
         return text
diff --git a/plone/app/contenttypes/browser/templates/folder_album_view.pt b/plone/app/contenttypes/browser/templates/folder_album_view.pt
index 010170b..e5b5609 100644
--- a/plone/app/contenttypes/browser/templates/folder_album_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_album_view.pt
@@ -88,8 +88,9 @@
          metal:use-macro="here/batch_macros/macros/navigation" />
 
     <tal:listing condition="otherContents"
-                 define="folderContents otherContents">
-        <metal:listing metal:use-macro="here/folder_listing/macros/listing">
+                 define="folderContents otherContents;
+                         view nocall:here/@@folder_listing">
+        <metal:listing metal:use-macro="view/macros/listing">
             <metal:empty metal:fill-slot="no_items_in_listing"></metal:empty>
         </metal:listing>
 


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-21T00:37:53+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/7d8d56f5d4ae9931e167366f576468c0e873fcc6

fix display of event dates in folder listing by reusing formatted_date from plone.app.event

Files changed:
M plone/app/contenttypes/browser/folder.py
M plone/app/contenttypes/browser/templates/listing.pt

diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index bd5dd39..91bce18 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -4,9 +4,11 @@
 from Products.CMFPlone.utils import safe_callable
 from Products.Five import BrowserView
 from plone.app.contenttypes import _
+from plone.event.interfaces import IEvent
 from plone.registry.interfaces import IRegistry
 from zope.component import getMultiAdapter
 from zope.component import getUtility
+from zope.contentprovider.interfaces import IContentProvider
 
 HAS_SECURITY_SETTINGS = True
 try:
@@ -128,6 +130,16 @@ def tabular_fielddata(self, item, fieldname):
             'value': value
         }
 
+    def is_event(self, obj):
+        return IEvent.providedBy(obj)
+
+    def formatted_date(self, item):
+        provider = getMultiAdapter(
+            (self.context, self.request, self),
+            IContentProvider, name='formatted_date'
+        )
+        return provider(item)
+
     def no_items_message(self):
         return _(
             'description_no_items_in_folder',
diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
index 1af4f25..dd38ae0 100644
--- a/plone/app/contenttypes/browser/templates/listing.pt
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -25,7 +25,8 @@
 
         <div metal:define-slot="entries">
             <article tal:repeat="item batch" metal:define-macro="entries">
-            <tal:block tal:define="item_url item/getURL;
+            <tal:block tal:define="obj item/getObject;
+                                   item_url item/getURL;
                                    item_id item/getId;
                                    item_title item/Title;
                                    item_description item/Description;
@@ -37,10 +38,6 @@
                                    item_wf_state item/review_state;
                                    item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
                                    item_creator item/Creator;
-                                   item_start item/start|nothing;
-                                   item_end item/end|nothing;
-                                   item_sametime python: item_start == item_end;
-                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False;
                                    item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
                 <metal:block define-slot="entry">
                 <header metal:define-macro="listitem"
@@ -58,46 +55,15 @@
 
                     <metal:block metal:define-macro="document_byline">
                     <span class="documentByLine">
-                        <span tal:condition="python: item_type == 'Event' and item_sametime"
-                              i18n:translate="label_event_byline_onlyfrom">
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr>
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and item_samedate and not item_sametime"
-                              i18n:translate="label_event_byline_samedate">
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start)"
-                                   i18n:name="start">from date</abbr> from
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,time_only=1)"
-                                   i18n:name="starttime">from time</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:view.toLocalizedTime(item_end,time_only=1)"
-                                   i18n:name="end">to time</abbr>
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and not item_samedate and not item_sametime"
-                              i18n:translate="label_event_byline">
-                              from
-                                   <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:view.toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:view.toLocalizedTime(item_end,long_format=1)"
-                                   i18n:name="end">to date</abbr>
-                        </span>
-                         <span tal:condition="python: item_type == 'Event' and item.location"
-                              i18n:translate="label_event_byline_location">&mdash;
-                             <span tal:content="string:${item/location}"
-                                   class="location"
-                                   i18n:name="location">Oslo</span>,
-                        </span>
+                        <tal:event condition="python:view.is_event(obj)">
+                            <tal:date tal:replace="structure python:view.formatted_date(obj)"/>
+                            <span tal:condition="item/location"
+                                  i18n:translate="label_event_byline_location">&mdash;
+                                <span tal:content="string:${item/location}"
+                                      class="location"
+                                      i18n:name="location">Oslo</span>,
+                            </span>
+                        </tal:event>
                         <tal:byline condition="view/show_about">
                             &mdash;
 


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-21T01:12:40+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/04c7a289137bbebd0262e05359dc45057d0ce339

fix collectio listings

Files changed:
M plone/app/contenttypes/browser/collection.py
M plone/app/contenttypes/browser/folder.py

diff --git a/plone/app/contenttypes/browser/collection.py b/plone/app/contenttypes/browser/collection.py
index b8293b7..a666659 100644
--- a/plone/app/contenttypes/browser/collection.py
+++ b/plone/app/contenttypes/browser/collection.py
@@ -3,19 +3,22 @@
 from plone.app.contenttypes.behaviors.collection import ICollection
 from plone.app.contenttypes.browser.folder import FolderView
 from plone.app.contenttypes import _
-from Products.CMFPlone.PloneBatch import Batch
 
 
 class CollectionView(FolderView):
 
-    def results(self, **kwargs):
+    def __init__(self, *args, **kwargs):
+        super(CollectionView, self).__init__(*args, **kwargs)
         context = aq_inner(self.context)
-        wrapped = ICollection(context)
-        return wrapped.results(self.b_start, **kwargs)
+        self.collection_behavior = ICollection(context)
+        self.b_size = self.collection_behavior.item_count
 
-    def batch(self):
-        batch = Batch(self.results(), self.b_start)
-        return batch
+    def results(self, **kwargs):
+        return self.collection_behavior.results(
+            b_start=self.b_start,
+            b_size=self.b_size,
+            **kwargs
+        )
 
     def getFoldersAndImages(self, **kwargs):
         context = aq_inner(self.context)
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
index 91bce18..1fbde08 100644
--- a/plone/app/contenttypes/browser/folder.py
+++ b/plone/app/contenttypes/browser/folder.py
@@ -78,7 +78,8 @@ def results(self):
         return results
 
     def batch(self):
-        batch = Batch(self.results(), self.b_size, self.b_start, orphan=1)
+        batch = Batch(
+            self.results(), size=self.b_size, start=self.b_start, orphan=1)
         return batch
 
     def normalizeString(self, text):


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-21T03:37:32+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/55e7827a4775a26cd2354975924b587d2c5ee774

deactivate old dev addons

Files changed:
M buildout.d/development.cfg

diff --git a/buildout.d/development.cfg b/buildout.d/development.cfg
index ae61c81..6ff9460 100644
--- a/buildout.d/development.cfg
+++ b/buildout.d/development.cfg
@@ -4,10 +4,10 @@ extends =
 
 eggs +=
     plone.reload
-    Products.PDBDebugMode
-    Products.DocFinderTab
-    aws.zope2zcmldoc
-    collective.profiler
+#    Products.PDBDebugMode
+#    Products.DocFinderTab
+#    aws.zope2zcmldoc
+#    collective.profiler
 
 extensions +=
     mr.developer


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-21T03:39:23+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.contenttypes/commit/64c37e685bf1feb0906c72da88b14b298706c563

fix tests with newer dexterity version

Conflicts:
	buildout.d/checkouts.cfg
	buildout.d/sources.cfg

Files changed:
M buildout.d/checkouts.cfg
M buildout.d/sources.cfg

diff --git a/buildout.d/checkouts.cfg b/buildout.d/checkouts.cfg
index d5798b1..6cb2d67 100644
--- a/buildout.d/checkouts.cfg
+++ b/buildout.d/checkouts.cfg
@@ -1,3 +1,4 @@
 [buildout]
 always-checkout = force
 auto-checkout +=
+    plone.app.dexterity
diff --git a/buildout.d/sources.cfg b/buildout.d/sources.cfg
index d253567..7ef2979 100644
--- a/buildout.d/sources.cfg
+++ b/buildout.d/sources.cfg
@@ -5,3 +5,4 @@ plone = git://github.com/plone
 plone_push = git@github.com:plone
 
 [sources]
+plone.app.dexterity = git ${remotes:plone}/plone.app.dexterity.git pushurl=${remotes:plone_push}/plone.app.dexterity.git branch=2.0.x


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2015-02-21T09:36:05+01:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/7a77dd92a77c49cacaa57b9aa16976dfc19a2660

Merge pull request #202 from plone/thet-unifiedlistings

I'm lovin' it. Thank you for the work!

I only found a small issue: You could create a collection of collections. Calling the full-view on that would lead to a infinite recusion (RuntimeError). Can we ignore that and assume that doing such a thing would be stupid anyway.

Files changed:
A plone/app/contenttypes/browser/folder.py
A plone/app/contenttypes/browser/full_view.py
A plone/app/contenttypes/browser/templates/full_view.pt
A plone/app/contenttypes/browser/templates/full_view_item.pt
A plone/app/contenttypes/browser/templates/listing.pt
A plone/app/contenttypes/browser/templates/listing_summary.pt
A plone/app/contenttypes/browser/templates/listing_tabular.pt
M buildout.d/checkouts.cfg
M buildout.d/development.cfg
M buildout.d/sources.cfg
M docs/CHANGES.rst
M plone/app/contenttypes/behaviors/collection.py
M plone/app/contenttypes/browser/collection.py
M plone/app/contenttypes/browser/configure.zcml
M plone/app/contenttypes/browser/templates/folder_album_view.pt
D plone/app/contenttypes/browser/templates/all_content.pt
D plone/app/contenttypes/browser/templates/folder_full_view.pt
D plone/app/contenttypes/browser/templates/folder_full_view_item.pt
D plone/app/contenttypes/browser/templates/folder_listing.pt
D plone/app/contenttypes/browser/templates/folder_summary_view.pt
D plone/app/contenttypes/browser/templates/folder_tabular_view.pt
D plone/app/contenttypes/browser/templates/standard_view.pt
D plone/app/contenttypes/browser/templates/summary_view.pt
D plone/app/contenttypes/browser/templates/tabular_view.pt

diff --git a/buildout.d/checkouts.cfg b/buildout.d/checkouts.cfg
index d5798b1..6cb2d67 100644
--- a/buildout.d/checkouts.cfg
+++ b/buildout.d/checkouts.cfg
@@ -1,3 +1,4 @@
 [buildout]
 always-checkout = force
 auto-checkout +=
+    plone.app.dexterity
diff --git a/buildout.d/development.cfg b/buildout.d/development.cfg
index ae61c81..6ff9460 100644
--- a/buildout.d/development.cfg
+++ b/buildout.d/development.cfg
@@ -4,10 +4,10 @@ extends =
 
 eggs +=
     plone.reload
-    Products.PDBDebugMode
-    Products.DocFinderTab
-    aws.zope2zcmldoc
-    collective.profiler
+#    Products.PDBDebugMode
+#    Products.DocFinderTab
+#    aws.zope2zcmldoc
+#    collective.profiler
 
 extensions +=
     mr.developer
diff --git a/buildout.d/sources.cfg b/buildout.d/sources.cfg
index d253567..7ef2979 100644
--- a/buildout.d/sources.cfg
+++ b/buildout.d/sources.cfg
@@ -5,3 +5,4 @@ plone = git://github.com/plone
 plone_push = git@github.com:plone
 
 [sources]
+plone.app.dexterity = git ${remotes:plone}/plone.app.dexterity.git pushurl=${remotes:plone_push}/plone.app.dexterity.git branch=2.0.x
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index 9cffa9d..17b9a2b 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -4,6 +4,16 @@ Changelog
 1.2 (unreleased)
 ----------------
 
+- Refactor full_view and incorporate fixes from collective.fullview to
+  1) display the default views of it's items, 2) be recursively callable
+  and 3) have the same templates for folder and collections.
+  [thet] 
+
+- Refactor folder_listing, folder_summary_view, folder_tabular_view for folders
+  and standard_view (collection_view), summary_view and tabular_view for
+  collections to use the same templates and base view class.
+  [thet]
+
 - In the file view, render HTML5 ``<audio>`` or ``<video>`` tags for audio
   respectively video file types. Ancient browsers, which do not support that,
   just don't render these tags.
diff --git a/plone/app/contenttypes/behaviors/collection.py b/plone/app/contenttypes/behaviors/collection.py
index 871e570..58c0773 100644
--- a/plone/app/contenttypes/behaviors/collection.py
+++ b/plone/app/contenttypes/behaviors/collection.py
@@ -187,7 +187,8 @@ def selectedViewFields(self):
                            name='plone.app.contenttypes.metadatafields')
         for field in vocab(self.context):
             _mapping[field.value] = (field.value, field.title)
-        return [_mapping[field] for field in self.customViewFields]
+        ret = [_mapping[field] for field in self.customViewFields]
+        return ret
 
     # Getters and setters for our fields.
 
diff --git a/plone/app/contenttypes/browser/collection.py b/plone/app/contenttypes/browser/collection.py
index ddb2f6f..a666659 100644
--- a/plone/app/contenttypes/browser/collection.py
+++ b/plone/app/contenttypes/browser/collection.py
@@ -1,25 +1,42 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_inner
-from Products.Five import BrowserView
 from plone.app.contenttypes.behaviors.collection import ICollection
+from plone.app.contenttypes.browser.folder import FolderView
+from plone.app.contenttypes import _
 
 
-class CollectionView(BrowserView):
+class CollectionView(FolderView):
 
-    def results(self, **kwargs):
+    def __init__(self, *args, **kwargs):
+        super(CollectionView, self).__init__(*args, **kwargs)
         context = aq_inner(self.context)
-        wrapped = ICollection(context)
-        return wrapped.results(**kwargs)
+        self.collection_behavior = ICollection(context)
+        self.b_size = self.collection_behavior.item_count
+
+    def results(self, **kwargs):
+        return self.collection_behavior.results(
+            b_start=self.b_start,
+            b_size=self.b_size,
+            **kwargs
+        )
 
     def getFoldersAndImages(self, **kwargs):
         context = aq_inner(self.context)
         wrapped = ICollection(context)
         return wrapped.getFoldersAndImages(**kwargs)
 
-    def selectedViewFields(self):
+    def tabular_fields(self):
         """Returns a list of all metadata fields from the catalog that were
            selected.
         """
         context = aq_inner(self.context)
         wrapped = ICollection(context)
-        return wrapped.selectedViewFields()
+        fields = wrapped.selectedViewFields()
+        fields = [field[0] for field in fields]
+        return fields
+
+    def no_items_message(self):
+        return _(
+            'description_no_results_found',
+            default=u"No results were found."
+        )
diff --git a/plone/app/contenttypes/browser/configure.zcml b/plone/app/contenttypes/browser/configure.zcml
index a3fc913..e0fa89f 100644
--- a/plone/app/contenttypes/browser/configure.zcml
+++ b/plone/app/contenttypes/browser/configure.zcml
@@ -19,7 +19,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.interfaces.ICollection"
     class=".collection.CollectionView"
-    template="templates/standard_view.pt"
+    template="templates/listing.pt"
     />
 
   <browser:page
@@ -27,7 +27,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.interfaces.ICollection"
     class=".collection.CollectionView"
-    template="templates/standard_view.pt"
+    template="templates/listing.pt"
     />
 
   <!-- VIEWS FOR ANYTHING WITH THE COLLECTION BEHAVIOR.
@@ -41,7 +41,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/standard_view.pt"
+    template="templates/listing.pt"
     />
 
   <browser:page
@@ -49,7 +49,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/summary_view.pt"
+    template="templates/listing_summary.pt"
     />
 
   <browser:page
@@ -57,7 +57,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/all_content.pt"
+    template="templates/full_view.pt"
     />
 
   <browser:page
@@ -65,7 +65,7 @@
     permission="zope2.View"
     for="plone.app.contenttypes.behaviors.collection.ISyndicatableCollection"
     class=".collection.CollectionView"
-    template="templates/tabular_view.pt"
+    template="templates/listing_tabular.pt"
     />
 
   <browser:page
@@ -128,7 +128,8 @@
     name="folder_listing"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_listing.pt"
+    class=".folder.FolderView"
+    template="templates/listing.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Standard view"
@@ -138,7 +139,8 @@
     name="folder_listing"
     for="Products.CMFPlone.interfaces.IPloneSiteRoot"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_listing.pt"
+    class=".folder.FolderView"
+    template="templates/listing.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Standard view"
@@ -148,17 +150,19 @@
     name="folder_full_view"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_full_view.pt"
+    class=".folder.FolderView"
+    template="templates/full_view.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="All content"
     />
 
   <browser:page
-    name="folder_full_view_item"
+    name="full_view_item"
     for="Products.CMFCore.interfaces._content.IContentish"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_full_view_item.pt"
+    class=".full_view.FullViewItem"
+    template="templates/full_view_item.pt"
     permission="zope2.View"
     />
 
@@ -166,7 +170,8 @@
     name="folder_summary_view"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_summary_view.pt"
+    class=".folder.FolderView"
+    template="templates/listing_summary.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Summary view"
@@ -176,7 +181,8 @@
     name="folder_summary_view"
     for="Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_summary_view.pt"
+    class=".folder.FolderView"
+    template="templates/listing_summary.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Summary view"
@@ -186,7 +192,19 @@
     name="folder_tabular_view"
     for="plone.dexterity.interfaces.IDexterityContainer"
     layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
-    template="templates/folder_tabular_view.pt"
+    class=".folder.FolderView"
+    template="templates/listing_tabular.pt"
+    permission="zope2.View"
+    menu="plone_displayviews"
+    title="Tabular view"
+    />
+
+  <browser:page
+    name="folder_tabular_view"
+    for="Products.CMFPlone.interfaces.siteroot.IPloneSiteRoot"
+    layer="plone.app.contenttypes.interfaces.IPloneAppContenttypesLayer"
+    class=".folder.FolderView"
+    template="templates/listing_tabular.pt"
     permission="zope2.View"
     menu="plone_displayviews"
     title="Tabular view"
diff --git a/plone/app/contenttypes/browser/folder.py b/plone/app/contenttypes/browser/folder.py
new file mode 100644
index 0000000..1fbde08
--- /dev/null
+++ b/plone/app/contenttypes/browser/folder.py
@@ -0,0 +1,148 @@
+# -*- coding: utf-8 -*-
+from Acquisition import aq_base
+from Products.CMFPlone.PloneBatch import Batch
+from Products.CMFPlone.utils import safe_callable
+from Products.Five import BrowserView
+from plone.app.contenttypes import _
+from plone.event.interfaces import IEvent
+from plone.registry.interfaces import IRegistry
+from zope.component import getMultiAdapter
+from zope.component import getUtility
+from zope.contentprovider.interfaces import IContentProvider
+
+HAS_SECURITY_SETTINGS = True
+try:
+    from Products.CMFPlone.interfaces import ISecuritySchema
+except ImportError:
+    HAS_SECURITY_SETTINGS = False
+
+
+class FolderView(BrowserView):
+
+    def __init__(self, context, request):
+        super(FolderView, self).__init__(context, request)
+
+        registry = getUtility(IRegistry)
+
+        self.plone_view = getMultiAdapter(
+            (context, request), name=u"plone")
+
+        self.portal_state = getMultiAdapter(
+            (context, request), name=u"plone_portal_state")
+        self.friendly_types = self.portal_state.friendly_types()
+        self.isAnon = self.portal_state.anonymous()
+        self.navigation_root_url = self.portal_state.navigation_root_url()
+
+        # BBB
+        self.site_properties = context.restrictedTraverse(
+            'portal_properties').site_properties
+        self.use_view_action = getattr(
+            self.site_properties, 'typesUseViewActionInListings', ())
+
+        if HAS_SECURITY_SETTINGS:
+            security_settings = registry.forInterface(
+                ISecuritySchema, prefix="plone")
+            self.show_about = getattr(
+                security_settings, 'allow_anon_views_about', False
+            ) or not self.isAnon
+        else:
+            # BBB
+            self.show_about = getattr(
+                self.site_properties, 'allowAnonymousViewAbout', False
+            ) or not self.isAnon
+
+        self.pas_member = getMultiAdapter(
+            (context, request), name=u"pas_member")
+
+        self.text_class = None
+
+        limit_display = getattr(self.request, 'limit_display', None)
+        limit_display = int(limit_display) if limit_display is not None else 20
+        b_size = getattr(self.request, 'b_size', None)
+        self.b_size = int(b_size) if b_size is not None else limit_display
+        b_start = getattr(self.request, 'b_start', None)
+        self.b_start = int(b_start) if b_start is not None else 0
+
+    def _content_filter(self):
+        content_filter = getattr(self.request, 'contentFilter', None)
+        content_filter = dict(content_filter) if content_filter else {}
+        content_filter.setdefault('portal_type', self.friendly_types)
+        content_filter.setdefault('batch', True)
+        content_filter.setdefault('b_size', self.b_size)
+        content_filter.setdefault('b_start', self.b_start)
+        return content_filter
+
+    def results(self):
+        results = self.context.restrictedTraverse(
+            '@@folderListing')(**self._content_filter())
+        return results
+
+    def batch(self):
+        batch = Batch(
+            self.results(), size=self.b_size, start=self.b_start, orphan=1)
+        return batch
+
+    def normalizeString(self, text):
+        return self.plone_view.normalizeString(text)
+
+    def toLocalizedTime(self, time, long_format=None, time_only=None):
+        return self.plone_view.toLocalizedTime(time, long_format, time_only)
+
+    def text(self):
+        textfield = getattr(aq_base(self.context), 'text', None)
+        text = getattr(textfield, 'output', None)
+        if text:
+            self.text_class = 'stx' if textfield.mimeType in (
+                'text/structured', 'text/x-rst', 'text/restructured'
+            ) else 'plain'
+        return text
+
+    def tabular_fields(self):
+        ret = []
+        ret.append('Title')
+        if self.show_about:
+            ret.append('Creator')
+        ret.append('Type')
+        if self.show_about:
+            ret.append('ModificationDate')
+        return ret
+
+    def tabular_fielddata(self, item, fieldname):
+        value = getattr(item, fieldname, '')
+        if safe_callable(value):
+            value = value()
+        if fieldname in [
+                'CreationDate',
+                'ModificationDate',
+                'Date',
+                'EffectiveDate',
+                'ExpirationDate',
+                'effective',
+                'expires',
+                'start',
+                'end',
+                'created',
+                'modified',
+                'last_comment_date']:
+            value = self.toLocalizedTime(value, long_format=1)
+
+        return {
+            # 'title': _(fieldname, default=fieldname),
+            'value': value
+        }
+
+    def is_event(self, obj):
+        return IEvent.providedBy(obj)
+
+    def formatted_date(self, item):
+        provider = getMultiAdapter(
+            (self.context, self.request, self),
+            IContentProvider, name='formatted_date'
+        )
+        return provider(item)
+
+    def no_items_message(self):
+        return _(
+            'description_no_items_in_folder',
+            default=u"There are currently no items in this folder."
+        )
diff --git a/plone/app/contenttypes/browser/full_view.py b/plone/app/contenttypes/browser/full_view.py
new file mode 100644
index 0000000..58201f7
--- /dev/null
+++ b/plone/app/contenttypes/browser/full_view.py
@@ -0,0 +1,35 @@
+from Products.Five.browser import BrowserView
+from Products.CMFCore.utils import getToolByName
+from zope.publisher.interfaces.browser import IBrowserView
+
+
+class FullViewItem(BrowserView):
+
+    def __init__(self, context, request):
+        super(FullViewItem, self).__init__(context, request)
+        self.item_type = self.context.portal_type
+
+    @property
+    def default_view(self):
+        context = self.context
+        item_layout = context.getLayout()
+        default_view = context.restrictedTraverse(item_layout)
+        return default_view
+
+    @property
+    def item_macros(self):
+        default_view = self.default_view
+        if IBrowserView.providedBy(default_view):
+            # IBrowserView
+            return default_view.index.macros
+        else:
+            # FSPageTemplate
+            return default_view.macros
+
+    @property
+    def item_url(self):
+        context = self.context
+        url = context.absolute_url()
+        props = getToolByName(context, 'portal_properties')
+        use_view_action = props.site_properties.typesUseViewActionInListings
+        return self.item_type in use_view_action and '%s/view' % url or url
diff --git a/plone/app/contenttypes/browser/templates/all_content.pt b/plone/app/contenttypes/browser/templates/all_content.pt
deleted file mode 100644
index 7c78024..0000000
--- a/plone/app/contenttypes/browser/templates/all_content.pt
+++ /dev/null
@@ -1,29 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block use-macro="context/standard_view/macros/content-core">
-
-    <metal:entries fill-slot="entries">
-    <metal:block use-macro="context/standard_view/macros/entries">
-    <metal:entry fill-slot="entry">
-
-        <div tal:define="realobject python:item.getObject()"
-             tal:replace="structure realobject/folder_full_view_item" />
-
-    </metal:entry>
-    </metal:block>
-    </metal:entries>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_album_view.pt b/plone/app/contenttypes/browser/templates/folder_album_view.pt
index 010170b..e5b5609 100644
--- a/plone/app/contenttypes/browser/templates/folder_album_view.pt
+++ b/plone/app/contenttypes/browser/templates/folder_album_view.pt
@@ -88,8 +88,9 @@
          metal:use-macro="here/batch_macros/macros/navigation" />
 
     <tal:listing condition="otherContents"
-                 define="folderContents otherContents">
-        <metal:listing metal:use-macro="here/folder_listing/macros/listing">
+                 define="folderContents otherContents;
+                         view nocall:here/@@folder_listing">
+        <metal:listing metal:use-macro="view/macros/listing">
             <metal:empty metal:fill-slot="no_items_in_listing"></metal:empty>
         </metal:listing>
 
diff --git a/plone/app/contenttypes/browser/templates/folder_full_view.pt b/plone/app/contenttypes/browser/templates/folder_full_view.pt
deleted file mode 100644
index cb2671b..0000000
--- a/plone/app/contenttypes/browser/templates/folder_full_view.pt
+++ /dev/null
@@ -1,26 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-    <metal:content-core fill-slot="content-core">
-        <metal:block use-macro="context/folder_listing/macros/content-core">
-            <!-- we don't want the dl -->
-            <metal:entries fill-slot="entries">
-                <metal:block use-macro="context/folder_listing/macros/entries">
-                    <metal:entry fill-slot="entry">
-                        <div tal:define="obj_view python:item.getObject().restrictedTraverse('folder_full_view_item')"
-                             tal:replace="structure python:obj_view()" />
-                    </metal:entry>
-                </metal:block>
-            </metal:entries>
-        </metal:block>
-    </metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_full_view_item.pt b/plone/app/contenttypes/browser/templates/folder_full_view_item.pt
deleted file mode 100644
index 55e3477..0000000
--- a/plone/app/contenttypes/browser/templates/folder_full_view_item.pt
+++ /dev/null
@@ -1,80 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      i18n:domain="plone"
-      tal:omit-tag="">
-
-<body tal:omit-tag="">
-
-    <div class="item visualIEFloatFix"
-         tal:define="portal_state context/@@plone_portal_state;
-                     context_state context/@@plone_context_state;
-                     plone_view context/@@plone;
-                     plone_layout context/@@plone_layout;
-                     lang portal_state/language;
-                     view nocall:view | nocall: plone_view;
-                     dummy python: plone_layout.mark_view(view);
-                     portal_url portal_state/portal_url;
-                     checkPermission nocall: context/portal_membership/checkPermission;
-                     site_properties context/portal_properties/site_properties;
-                     item_type context/portal_type;
-                     item_layout here/getLayout;
-                     override python: {'Link': 'link_view'};
-                     item_macro python:path('here/%s/macros/content-core | nothing' % override.get(item_type, item_layout));
-                     use_view_action site_properties/typesUseViewActionInListings|python:();
-                     item_url context/absolute_url;
-                     normalizeString nocall: context/plone_utils/normalizeString;
-                     item_type_class python: 'contenttype-' + normalizeString(item_type);
-                     kss_inline_editable python:False;
-                     rendering_error python:[];
-                     ">
-
-        <div tal:replace="structure provider:plone.abovecontenttitle" />
-
-        <h2 class="headline">
-            <a href="#" class="summary url" tal:content="context/Title"
-               tal:attributes="href python:item_url+'/view' if item_type in use_view_action else item_url;">
-               Title or id
-             </a>
-        </h2>
-
-        <div tal:replace="structure provider:plone.belowcontenttitle" />
-
-        <div class="description"
-             tal:content="context/Description"
-             tal:condition="context/Description">
-            Description
-        </div>
-
-        <tal:block tal:condition="item_macro" tal:on-error="python:rendering_error.append(True)">
-
-            <div tal:replace="structure provider:plone.abovecontentbody" />
-
-            <div metal:use-macro="item_macro">
-                content
-            </div>
-
-            <div tal:replace="structure provider:plone.belowcontentbody" />
-
-        </tal:block>
-
-        <tal:block tal:condition="rendering_error">
-            <!-- Error rendering item macro -->
-        </tal:block>
-
-        <p class="more" tal:condition="python:not(item_macro) or rendering_error">
-            <a href=""
-               tal:attributes="href python: item_url+'/view' if item_type in use_view_action else item_url;"
-               i18n:translate="read_more">
-                Read More&hellip;
-            </a>
-        </p>
-
-        <div class="visualClear"><!-- --></div>
-
-    </div>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_listing.pt b/plone/app/contenttypes/browser/templates/folder_listing.pt
deleted file mode 100644
index d63282c..0000000
--- a/plone/app/contenttypes/browser/templates/folder_listing.pt
+++ /dev/null
@@ -1,194 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block define-macro="content-core"
-                    tal:define="templateId template/getId">
-
-    <div metal:define-macro="text-field-view"
-         id="parent-fieldname-text" class="stx"
-         tal:define="has_text exists:context/aq_explicit/text/output;
-                     text python:has_text and here.text.output or ''"
-         tal:condition="text"
-         tal:attributes="class python: context.Format() in ('text/structured',
-                                               'text/x-rst', ) and  'stx' or 'plain'">
-        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-    </div>
-
-    <metal:listingmacro define-macro="listing">
-    <tal:foldercontents define="contentFilter contentFilter|request/contentFilter|nothing;
-                        contentFilter python:contentFilter and dict(contentFilter) or {};
-                        limit_display limit_display|request/limit_display|nothing;
-                        limit_display python:limit_display and int(limit_display) or None;
-                        more_url more_url|request/more_url|string:folder_contents;
-                        is_a_topic python:context.portal_type=='Topic';
-                        friendly_types portal_state/friendly_types;
-                        dummy python:not is_a_topic and contentFilter.setdefault('portal_type', friendly_types);
-                        folderContents folderContents|nothing; folderContents python:folderContents or is_a_topic and context.queryCatalog(batch=True, **contentFilter) or context.getFolderContents(contentFilter, batch=True, b_size=limit_display or 100);
-                        site_properties context/portal_properties/site_properties;
-                        use_view_action site_properties/typesUseViewActionInListings|python:();
-                        Batch python:modules['Products.CMFPlone'].Batch;
-                        plone_layout context/@@plone_layout;
-                        b_start python:request.get('b_start', 0);
-                        batch python:isinstance(folderContents, Batch) and folderContents or Batch(folderContents, limit_display or 100, int(b_start), orphan=1);
-                        isAnon portal_state/anonymous;
-                        normalizeString nocall: context/plone_utils/normalizeString;
-                        toLocalizedTime nocall: plone_view/toLocalizedTime;
-                        show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
-                        navigation_root_url portal_state/navigation_root_url;
-                        pas_member context/@@pas_member;">
-    <tal:listing condition="batch">
-
-        <ul metal:define-slot="entries">
-            <li tal:repeat="item batch" metal:define-macro="entries">
-            <tal:block tal:define="item_url item/getURL|item/absolute_url;
-                                   item_id item/getId|item/id;
-                                   item_title_or_id item/pretty_title_or_id;
-                                   item_description item/Description;
-                                   item_type item/portal_type;
-                                   item_type_title item/Type;
-                                   item_modified item/ModificationDate;
-                                   item_created item/CreationDate;
-                                   item_icon python:plone_layout.getIcon(item);
-                                   item_type_class python:'contenttype-' + normalizeString(item_type);
-                                   item_wf_state item/review_state|python: context.portal_workflow.getInfoFor(item, 'review_state', '');
-                                   item_wf_state_class python:'state-' + normalizeString(item_wf_state);
-                                   item_creator item/Creator;
-                                   item_start item/start|item/StartDate|nothing;
-                                   item_end item/end|item/EndDate|nothing;
-                                   item_sametime python: item_start == item_end;
-                                   item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
-                <metal:block define-slot="entry">
-                <span metal:define-macro="listitem"
-                    tal:define="item_type_event_class python: item_type == 'Event' and 'vevent' or None"
-                    tal:attributes="class item_type_event_class|nothing">
-
-                    <span class="summary">
-                        <img tal:replace="structure item_icon/html_tag" />
-                        <a href="#"
-                           tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;
-                                           class string:$item_type_class $item_wf_state_class url"
-                           tal:content="item_title_or_id">
-                            Item Title
-                        </a>
-                    </span>
-
-                    <span class="documentByLine">
-                        <span tal:condition="python: item_type == 'Event' and item_sametime"
-                              i18n:translate="label_event_byline_onlyfrom">
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr>
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and item_samedate and not item_sametime"
-                              i18n:translate="label_event_byline_samedate">
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start)"
-                                   i18n:name="start">from date</abbr> from
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,time_only=1)"
-                                   i18n:name="starttime">from time</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,time_only=1)"
-                                   i18n:name="end">to time</abbr>
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and not item_samedate and not item_sametime"
-                              i18n:translate="label_event_byline">
-                              from
-                                   <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,long_format=1)"
-                                   i18n:name="end">to date</abbr>
-                        </span>
-                         <span tal:condition="python: item_type == 'Event' and item.location"
-                              i18n:translate="label_event_byline_location">&mdash;
-                             <span tal:content="string:${item/location}"
-                                   class="location"
-                                   i18n:name="location">Oslo</span>,
-                        </span>
-                        <tal:byline condition="show_about">
-                            &mdash;
-
-                            <tal:name tal:condition="item_creator"
-                                tal:define="author python:pas_member.info(item_creator);
-                                            creator_short_form author/username;
-                                            creator_long_form string:?author=${author/username};
-                                            creator_is_openid python:'/' in creator_short_form;
-                                            creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">
-                              <span i18n:translate="label_by_author">
-                                by
-                              <a href="#"
-                                 tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
-                                 tal:content="author/name_or_id"
-                                 tal:omit-tag="not:author"
-                                 i18n:name="author">
-                                Bob Dobalina
-                              </a>
-                              </span>
-
-                            </tal:name>
-
-                            <tal:modified condition="python: item_type != 'Event'">
-                                &mdash;
-                                <tal:mod i18n:translate="box_last_modified">
-                                  last modified
-                                </tal:mod>
-                                <span tal:replace="python:toLocalizedTime(item_modified,long_format=1)">
-                                  August 16, 2001 at 23:35:59
-                                </span>
-                            </tal:modified>
-
-                            <metal:description define-slot="description_slot">
-                                <tal:comment replace="nothing">
-                                    Place custom listing info for custom types here
-                                </tal:comment>
-                            </metal:description>
-                        </tal:byline>
-                    </span>
-
-                </span>
-
-                <p class="description discreet"
-                    tal:condition="item_description"
-                    tal:content="item_description">
-                    description
-                </p>
-            </metal:block>
-            </tal:block>
-            </li>
-        </ul>
-
-        <div metal:use-macro="context/batch_macros/macros/navigation" />
-
-    </tal:listing>
-    <metal:empty metal:define-slot="no_items_in_listing">
-        <p class="discreet"
-           tal:condition="not: folderContents"
-           i18n:translate="description_no_items_in_folder">
-            There are currently no items in this folder.
-        </p>
-    </metal:empty>
-
-    </tal:foldercontents>
-    </metal:listingmacro>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_summary_view.pt b/plone/app/contenttypes/browser/templates/folder_summary_view.pt
deleted file mode 100644
index c2d78c5..0000000
--- a/plone/app/contenttypes/browser/templates/folder_summary_view.pt
+++ /dev/null
@@ -1,122 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-    <metal:content-core fill-slot="content-core">
-        <metal:block define-macro="listing" extend-macro="context/folder_listing/macros/content-core">
-            <!-- we don't want the dl -->
-            <metal:entries fill-slot="entries">
-                <metal:block use-macro="context/folder_listing/macros/entries">
-                    <metal:entry fill-slot="entry">
-                <div class="tileItem visualIEFloatFix"
-                     tal:define="item_object item/getObject;">
-
-                    <a href="#"
-                       tal:define="real_object python:item_object.aq_explicit"
-                       tal:condition="python:getattr(real_object, 'image', None)"
-                       tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url">
-                        <img tal:define="images item_object/@@images;
-                                         scale python: images.scale('image', scale='thumb')"
-                             tal:condition="scale"
-                             src="" alt=""
-                             tal:replace="structure python: scale.tag(css_class='tileImage')" />
-                    </a>
-
-                    <h2 class="tileHeadline"
-                        metal:define-macro="listitem">
-
-                        <a href="#"
-                           class="summary url"
-                           tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;"
-                           tal:content="item_title_or_id">
-                            Item Title
-                        </a>
-
-                    </h2>
-
-                    <div class="documentByLine" tal:condition="python: site_properties.allowAnonymousViewAbout or not isAnon">
-                    <tal:event condition="python: item_type == 'Event'">
-                        <span tal:condition="python: item_type == 'Event' and item.location"
-                              i18n:translate="label_event_byline_with_location">
-                            (<span tal:content="string:${item/location}"
-                                   class="location"
-                                   i18n:name="location">Oslo</span>, from
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,long_format=1)"
-                                   i18n:name="end">to date</abbr>)
-                        </span>
-                        <span tal:condition="python: item_type == 'Event' and not item.location"
-                              i18n:translate="label_event_byline_without_location">
-                            (from
-                             <abbr class="dtstart"
-                                   tal:attributes="title python:item_start"
-                                   tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                   i18n:name="start">from date</abbr> to
-                             <abbr class="dtend"
-                                   tal:attributes="title python:item_end"
-                                   tal:content="python:toLocalizedTime(item_end,long_format=1)"
-                                   i18n:name="end">to date</abbr>)
-                        </span>
-                    </tal:event>
-                    <tal:newsitem condition="python: item_type == 'News Item'">
-                        <tal:name tal:condition="item_creator"
-                            tal:define="author python:pas_member.info(item_creator)">
-                          <span class="documentAuthor" i18n:translate="label_by_author">
-                            by
-                          <a href="#"
-                             tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
-                             tal:content="author/name_or_id"
-                             tal:omit-tag="not:author"
-                             i18n:name="author">
-                            Bob Dobalina
-                          </a>
-                          </span>
-                        </tal:name>
-                        &mdash;
-                        <span class="documentModified">
-                              <tal:mod i18n:translate="box_last_modified">
-                              last modified
-                              </tal:mod>
-                              <span tal:replace="python:toLocalizedTime(item_modified,long_format=1)">
-                                      August 16, 2001 at 23:35:59
-                              </span>
-                        </span>
-                    </tal:newsitem>
-                    </div>
-
-                    <p class="tileBody" tal:condition="item_description">
-                        <span class="description" tal:content="item_description">
-                            description
-                        </span>
-                    </p>
-
-                    <p class="tileFooter">
-                        <a href=""
-                           tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;"
-                           i18n:translate="read_more">
-                        Read More&hellip;
-                        </a>
-                    </p>
-
-                    <div class="visualClear"><!-- --></div>
-
-                </div>
-                    </metal:entry>
-                </metal:block>
-            </metal:entries>
-        </metal:block>
-    </metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt b/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
deleted file mode 100644
index c5e87a8..0000000
--- a/plone/app/contenttypes/browser/templates/folder_tabular_view.pt
+++ /dev/null
@@ -1,96 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="context/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-  <metal:content-core fill-slot="content-core">
-    <metal:block define-macro="listing" extend-macro="context/folder_listing/macros/content-core">
-      <metal:entries fill-slot="entries">
-
-          <div metal:use-macro="context/batch_macros/macros/navigation" />
-          <div class="has-table">
-            <table class="listing"
-                   summary="Content listing"
-                   i18n:attributes="summary summary_content_listing;">
-                <thead>
-                    <tr>
-                        <th class="nosort">&nbsp;<tal:title i18n:translate="listingheader_title"
-                          >Title</tal:title>&nbsp;</th>
-                        <th class="nosort"
-                            tal:condition="show_about">&nbsp;<tal:title i18n:translate="listingheader_author"
-                          >Author</tal:title>&nbsp;</th>
-                        <th class="nosort">&nbsp;<tal:title i18n:translate="listingheader_type"
-                          >Type</tal:title>&nbsp;</th>
-                        <th class="nosort"
-                            tal:condition="show_about">&nbsp;<tal:modified i18n:translate="listingheader_modified"
-                          >Modified</tal:modified>&nbsp;</th>
-                    </tr>
-                </thead>
-
-                <tbody>
-                    <metal:block use-macro="context/folder_listing/macros/entries">
-                        <metal:entry fill-slot="entry">
-
-                    <tr metal:define-macro="listitem"
-                        tal:define="oddrow repeat/item/odd;"
-                        tal:attributes="class python: oddrow and 'even' or 'odd'">
-
-                            <td>
-                                <img width="16" height="16"
-                                     src="" alt=""
-                                     tal:condition="item_icon/url"
-                                     tal:attributes="src item_icon/url;
-                                                     alt item_icon/description;
-                                                     title item_icon/title;
-                                                     width item_icon/width;
-                                                     height item_icon/height;" />
-                                <a href="#"
-                                   tal:attributes="href python: item_type in use_view_action and item_url+'/view' or item_url;
-                                                   class string:$item_wf_state_class $item_type_class;
-                                                   title item_description;"
-                                   tal:content="item_title_or_id">
-                                    Item Title
-                                </a>
-                            </td>
-
-                            <td tal:condition="show_about">
-                                <tal:name tal:condition="item_creator"
-                                  tal:define="author python:pas_member.info(item_creator)">
-                                <a href="#"
-                                   tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
-                                   tal:content="author/name_or_id"
-                                   tal:omit-tag="not:author">
-                                  Bob Dobalina
-                                </a>
-                                </tal:name>
-                            </td>
-
-                            <td tal:content="item_type_title"
-                                i18n:translate="">
-                                Page
-                            </td>
-
-                        <td tal:condition="show_about"
-                            tal:content="python:toLocalizedTime(item_modified,long_format=1)">
-                          August 16, 2001 at 23:35:59
-                        </td>
-
-                    </tr>
-
-                        </metal:entry>
-                    </metal:block>
-                </tbody>
-            </table>
-          </div>
-      </metal:entries>
-    </metal:block>
-
-  </metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/full_view.pt b/plone/app/contenttypes/browser/templates/full_view.pt
new file mode 100644
index 0000000..37974ec
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/full_view.pt
@@ -0,0 +1,29 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+    <metal:content-core fill-slot="content-core">
+    <metal:block define-macro="content-core">
+        <metal:listing use-macro="context/@@folder_listing/macros/content-core|context/@@collection_view/macros/content-core">
+            <!-- we don't want the dl -->
+            <metal:entries fill-slot="entries">
+                <metal:block use-macro="context/@@folder_listing/macros/entries|context/@@collection_view/macros/entries">
+                    <metal:entry fill-slot="entry">
+                        <div
+                            tal:define="obj item/getObject;"
+                            tal:replace="structure obj/@@full_view_item" />
+                    </metal:entry>
+                </metal:block>
+            </metal:entries>
+        </metal:listing>
+    </metal:block>
+    </metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/full_view_item.pt b/plone/app/contenttypes/browser/templates/full_view_item.pt
new file mode 100644
index 0000000..16eac28
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/full_view_item.pt
@@ -0,0 +1,73 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      i18n:domain="plone"
+      tal:omit-tag="">
+
+<body tal:omit-tag="">
+
+    <div class="item visualIEFloatFix"
+         tal:define="item_macro nocall:view/item_macros/content-core|nothing;
+                     item_url view/item_url;
+                     rendering_error python:[];">
+
+        <div tal:replace="structure provider:plone.abovecontenttitle" />
+
+        <h2 class="headline">
+            <a href="#" class="summary url" tal:content="context/Title"
+               tal:attributes="href item_url;">
+               Title
+             </a>
+        </h2>
+
+        <div tal:replace="structure provider:plone.belowcontenttitle" />
+
+        <div class="description"
+             tal:content="context/Description"
+             tal:condition="context/Description">
+            Description
+        </div>
+
+        <tal:block tal:condition="item_macro">
+        <!-- tal:on-error="python:rendering_error.append(True)"-->
+
+            <div tal:replace="structure provider:plone.abovecontentbody" />
+
+            <div tal:define="view nocall:view/default_view;
+                             portal_state context/@@plone_portal_state;
+                             context_state context/@@plone_context_state;
+                             plone_layout context/@@plone_layout;
+                             lang portal_state/language;
+                             dummy python: plone_layout.mark_view(view);
+                             portal_url portal_state/portal_url;
+                             checkPermission nocall: context/portal_membership/checkPermission;
+                             site_properties context/portal_properties/site_properties;">
+            <div metal:use-macro="item_macro">
+                content
+            </div>
+            </div>
+
+            <div tal:replace="structure provider:plone.belowcontentbody" />
+
+        </tal:block>
+
+        <tal:block tal:condition="rendering_error">
+            <!-- Error rendering item macro -->
+        </tal:block>
+
+        <p class="more" tal:condition="python:not(item_macro) or rendering_error">
+            <a href=""
+               tal:attributes="href item_url"
+               i18n:translate="read_more">
+                Read More&hellip;
+            </a>
+        </p>
+
+        <div class="visualClear"><!-- --></div>
+
+    </div>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/listing.pt b/plone/app/contenttypes/browser/templates/listing.pt
new file mode 100644
index 0000000..dd38ae0
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/listing.pt
@@ -0,0 +1,139 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+<metal:content-core fill-slot="content-core">
+<metal:block define-macro="content-core">
+
+    <div metal:define-macro="text-field-view"
+         id="parent-fieldname-text" class="stx"
+         tal:define="text view/text"
+         tal:condition="text"
+         tal:attributes="class view/text_class">
+        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
+    </div>
+
+    <metal:listingmacro define-macro="listing">
+    <tal:results define="batch view/batch">
+    <tal:listing condition="batch">
+
+        <div metal:define-slot="entries">
+            <article tal:repeat="item batch" metal:define-macro="entries">
+            <tal:block tal:define="obj item/getObject;
+                                   item_url item/getURL;
+                                   item_id item/getId;
+                                   item_title item/Title;
+                                   item_description item/Description;
+                                   item_type item/PortalType;
+                                   item_modified item/ModificationDate;
+                                   item_created item/CreationDate;
+                                   item_icon item/getIcon;
+                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
+                                   item_wf_state item/review_state;
+                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
+                                   item_creator item/Creator;
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
+                <metal:block define-slot="entry">
+                <header metal:define-macro="listitem"
+                    tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
+
+                    <span class="summary">
+                        <a href="#"
+                           tal:attributes="href item_link;
+                                           class string:$item_type_class $item_wf_state_class url;
+                                           title item_type"
+                           tal:content="item_title">
+                            Item Title
+                        </a>
+                    </span>
+
+                    <metal:block metal:define-macro="document_byline">
+                    <span class="documentByLine">
+                        <tal:event condition="python:view.is_event(obj)">
+                            <tal:date tal:replace="structure python:view.formatted_date(obj)"/>
+                            <span tal:condition="item/location"
+                                  i18n:translate="label_event_byline_location">&mdash;
+                                <span tal:content="string:${item/location}"
+                                      class="location"
+                                      i18n:name="location">Oslo</span>,
+                            </span>
+                        </tal:event>
+                        <tal:byline condition="view/show_about">
+                            &mdash;
+
+                            <tal:name tal:condition="item_creator"
+                                tal:define="author python:view.pas_member.info(item_creator);
+                                            creator_short_form author/username;
+                                            creator_long_form string:?author=${author/username};
+                                            creator_is_openid python:'/' in creator_short_form;
+                                            creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">
+                              <span i18n:translate="label_by_author">
+                                by
+                              <a href="#"
+                                 tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
+                                 tal:content="author/name_or_id"
+                                 tal:omit-tag="not:author"
+                                 i18n:name="author">
+                                Bob Dobalina
+                              </a>
+                              </span>
+
+                            </tal:name>
+
+                            <tal:modified condition="python: item_type != 'Event'">
+                                &mdash;
+                                <tal:mod i18n:translate="box_last_modified">
+                                  last modified
+                                </tal:mod>
+                                <span tal:replace="python:view.toLocalizedTime(item_modified,long_format=1)">
+                                  August 16, 2001 at 23:35:59
+                                </span>
+                            </tal:modified>
+
+                            <metal:description define-slot="description_slot">
+                                <tal:comment replace="nothing">
+                                    Place custom listing info for custom types here
+                                </tal:comment>
+                            </metal:description>
+                        </tal:byline>
+                    </span>
+                    </metal:block>
+
+                </header>
+
+                <p class="description discreet"
+                    tal:condition="item_description"
+                    tal:content="item_description">
+                    description
+                </p>
+            </metal:block>
+            </tal:block>
+            </article>
+        </div>
+
+        <div metal:use-macro="context/batch_macros/macros/navigation" />
+
+    </tal:listing>
+
+    <metal:empty metal:define-slot="no_items_in_listing">
+        <p class="discreet"
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
+            There are currently no items in this folder.
+        </p>
+    </metal:empty>
+
+    </tal:results>
+    </metal:listingmacro>
+
+</metal:block>
+</metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/listing_summary.pt b/plone/app/contenttypes/browser/templates/listing_summary.pt
new file mode 100644
index 0000000..af12928
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/listing_summary.pt
@@ -0,0 +1,71 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+<metal:content-core fill-slot="content-core">
+<metal:block use-macro="context/@@folder_listing/macros/content-core|context/@@standard_view/macros/content-core">
+
+    <metal:entries fill-slot="entries">
+    <metal:block use-macro="context/@@folder_listing/macros/entries|context/@@standard_view/macros/entries">
+    <metal:entry fill-slot="entry">
+
+                <div class="tileItem visualIEFloatFix" tal:define="obj item/getObject">
+
+                    <a href="#"
+                        tal:condition="python:getattr(obj.aq_explicit, 'image', None)"
+                        tal:attributes="href item_link">
+                        <div class="tileImage">
+                            <img src="" alt=""
+                                 tal:define="scales obj/@@images;
+                                             scale python:scales.scale('image', 'thumb')"
+                                 tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
+                        </div>
+                    </a>
+
+                    <h2 class="tileHeadline" metal:define-macro="listitem">
+
+                        <a href="#"
+                           class="summary url"
+                           tal:attributes="href item_link;
+                                           title item_type"
+                           tal:content="item_title">
+                            Item Title
+                        </a>
+
+                    </h2>
+
+                    <div metal:use-macro="context/@@folder_listing/macros/document_byline|context/@@collection_view/macros/document_byline"></div>
+
+                    <p class="tileBody" tal:condition="item_description">
+                        <span class="description" tal:content="item_description">
+                            description
+                        </span>
+                    </p>
+
+                    <p class="tileFooter">
+                        <a href=""
+                           tal:attributes="href item_link"
+                           i18n:translate="read_more">
+                        Read More&hellip;
+                        </a>
+                    </p>
+
+                    <div class="visualClear"><!-- --></div>
+
+                </div>
+
+    </metal:entry>
+    </metal:block>
+    </metal:entries>
+
+</metal:block>
+</metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/listing_tabular.pt b/plone/app/contenttypes/browser/templates/listing_tabular.pt
new file mode 100644
index 0000000..3bd8c4f
--- /dev/null
+++ b/plone/app/contenttypes/browser/templates/listing_tabular.pt
@@ -0,0 +1,108 @@
+<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
+      xmlns:tal="http://xml.zope.org/namespaces/tal"
+      xmlns:metal="http://xml.zope.org/namespaces/metal"
+      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
+      lang="en"
+      metal:use-macro="context/main_template/macros/master"
+      i18n:domain="plone">
+
+<body>
+
+<metal:content-core fill-slot="content-core">
+<metal:block define-macro="content-core">
+
+    <div metal:define-macro="text-field-view"
+         id="parent-fieldname-text" class="stx"
+         tal:define="text view/text"
+         tal:condition="text"
+         tal:attributes="class view/text_class">
+        <div metal:define-slot="inside" tal:replace="structure text">The body</div>
+    </div>
+
+    <tal:results define="batch view/batch">
+    <tal:listing condition="batch">
+
+
+          <div metal:use-macro="context/batch_macros/macros/navigation" />
+          <div class="has-table">
+            <table class="listing"
+                   summary="Content listing"
+                   i18n:attributes="summary summary_content_listing;">
+                <thead>
+                    <tr>
+                        <th class="nosort"
+                            i18n:translate=""
+                            tal:repeat="field view/tabular_fields"
+                            tal:content="field">Field name</th>
+                    </tr>
+                </thead>
+
+                <tbody>
+
+            <tal:entries tal:repeat="item batch">
+            <tal:block tal:define="item_url item/getURL;
+                                   item_title item/Title;
+                                   item_description item/Description;
+                                   item_type item/PortalType;
+                                   item_type_class python:'contenttype-' + view.normalizeString(item_type);
+                                   item_wf_state item/review_state;
+                                   item_wf_state_class python:'state-' + view.normalizeString(item_wf_state);
+                                   item_creator item/Creator;
+                                   item_link python:item_type in view.use_view_action and item_url+'/view' or item_url">
+
+                    <tr metal:define-macro="listitem"
+                        tal:define="oddrow repeat/item/odd;"
+                        tal:attributes="class python: oddrow and 'even' or 'odd'">
+
+                        <tal:block tal:repeat="field view/tabular_fields">
+                            <td tal:condition="python:field not in ['Title', 'Creator', 'getIcon']"
+                                tal:define="field_data python:view.tabular_fielddata(item, field)">
+                                <tal:block tal:replace="field_data/value" />
+                            </td>
+                            <td tal:condition="python:field == 'Title'">
+                                <a href="#"
+                                   tal:attributes="href item_link;
+                                                   class string:$item_wf_state_class $item_type_class;
+                                                   title item_description;"
+                                   tal:content="item_title">
+                                    Item Title
+                                </a>
+                            </td>
+                            <td tal:condition="python:field == 'Creator'"
+                                tal:define="author python:view.pas_member.info(item_creator);
+                                            name python:author['fullname'] or author['username']">
+                                <a href="#"
+                                   tal:condition="author"
+                                   tal:attributes="href string:${view/navigation_root_url}/author/${item_creator}"
+                                   tal:content="name">Jos Henken</a>
+                            </td>
+                        </tal:block>
+
+                    </tr>
+
+            </tal:block>
+            </tal:entries>
+
+                </tbody>
+            </table>
+          </div>
+
+        <div metal:use-macro="context/batch_macros/macros/navigation" />
+
+    </tal:listing>
+
+    <metal:empty metal:define-slot="no_items_in_listing">
+        <p class="discreet"
+           tal:condition="not: view/batch"
+           tal:content="view/no_items_message">
+            There are currently no items in this folder.
+        </p>
+    </metal:empty>
+
+    </tal:results>
+
+</metal:block>
+</metal:content-core>
+
+</body>
+</html>
diff --git a/plone/app/contenttypes/browser/templates/standard_view.pt b/plone/app/contenttypes/browser/templates/standard_view.pt
deleted file mode 100644
index 0664273..0000000
--- a/plone/app/contenttypes/browser/templates/standard_view.pt
+++ /dev/null
@@ -1,181 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-  <div metal:fill-slot="content-core">
-    <metal:block define-macro="content-core"
-                 tal:define="templateId template/getId">
-
-        <div metal:define-macro="text-field-view"
-             id="parent-fieldname-text" class="stx"
-             tal:define="has_text exists:context/aq_explicit/text/output;
-                         text python:has_text and here.text.output or ''"
-             tal:condition="text"
-             tal:attributes="class python:context.Format() in ('text/structured', 'text/x-rst', ) and 'stx' or 'plain'">
-            <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-        </div>
-
-        <metal:listingmacro define-macro="listing">
-        <tal:results define="b_start python:request.get('b_start', 0);
-                             batch python:view.results(b_start=b_start);
-                             site_properties context/portal_properties/site_properties;
-                             use_view_action site_properties/typesUseViewActionInListings|python:();
-                             isAnon portal_state/anonymous;
-                             normalizeString nocall: context/plone_utils/normalizeString;
-                             toLocalizedTime nocall: plone_view/toLocalizedTime;
-                             show_about python:not isAnon or site_properties.allowAnonymousViewAbout;
-                             navigation_root_url portal_state/navigation_root_url;
-                             pas_member context/@@pas_member;">
-        <tal:listing condition="batch">
-
-            <div metal:define-slot="entries">
-                <article tal:repeat="item batch" metal:define-macro="entries">
-                <tal:block tal:define="item_url item/getURL;
-                                       item_id item/getId;
-                                       item_description item/Description;
-                                       item_type item/Type;
-                                       item_modified item/ModificationDate;
-                                       item_created item/CreationDate;
-                                       item_icon item/getIcon;
-                                       item_type_class item/ContentTypeClass;
-                                       item_wf_state_class python:'state-' + normalizeString(item.review_state());
-                                       item_creator item/Creator;
-                                       item_start python:(item.start or item.StartDate) if item_type == 'Event' else None;
-                                       item_end python:(item.end or item.EndDate) if item_type == 'Event' else None;
-                                       item_modified item/ModificationDate;
-                                       item_sametime python: item_start == item_end;
-                                       item_samedate python: (item_end - item_start &lt; 1) if item_type == 'Event' else False">
-                    <metal:block define-slot="entry">
-                    <header metal:define-macro="listitem"
-                        tal:attributes="class python:item_type == 'Event' and 'vevent' or ''">
-
-                        <span class="summary">
-                            <img tal:replace="structure item_icon" />
-                            <a href="#"
-                               tal:attributes="href python:item_type in use_view_action and item_url+'/view' or item_url;
-                                               class string:$item_type_class $item_wf_state_class url"
-                               tal:content="item/Title">
-                                Item Title
-                            </a>
-                        </span>
-
-                        <metal:block metal:define-macro="document_byline">
-                        <span class="documentByLine">
-                            <span tal:condition="python: item_type == 'Event' and item_sametime"
-                                  i18n:translate="label_event_byline_onlyfrom">
-                                 <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                       i18n:name="start">from date</abbr>
-                            </span>
-                            <span tal:condition="python: item_type == 'Event' and item_samedate and not item_sametime"
-                                  i18n:translate="label_event_byline_samedate">
-                                 <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start)"
-                                       i18n:name="start">from date</abbr> from
-                                 <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start,time_only=1)"
-                                       i18n:name="starttime">from time</abbr> to
-                                 <abbr class="dtend"
-                                       tal:attributes="title python:item_end"
-                                       tal:content="python:toLocalizedTime(item_end,time_only=1)"
-                                       i18n:name="end">to time</abbr>
-                            </span>
-                            <span tal:condition="python: item_type == 'Event' and not item_samedate and not item_sametime"
-                                  i18n:translate="label_event_byline">
-                                  from
-                                       <abbr class="dtstart"
-                                       tal:attributes="title python:item_start"
-                                       tal:content="python:toLocalizedTime(item_start,long_format=1)"
-                                       i18n:name="start">from date</abbr> to
-                                 <abbr class="dtend"
-                                       tal:attributes="title python:item_end"
-                                       tal:content="python:toLocalizedTime(item_end,long_format=1)"
-                                       i18n:name="end">to date</abbr>
-                            </span>
-                             <span tal:condition="python: item_type == 'Event' and item.location"
-                                  i18n:translate="label_event_byline_location">&mdash;
-                                 <span tal:content="string:${item/location}"
-                                       class="location"
-                                       i18n:name="location">Oslo</span>,
-                            </span>
-                            <tal:byline condition="show_about">
-                                &mdash;
-
-                                <tal:name tal:condition="item_creator"
-                                    tal:define="author python:pas_member.info(item_creator);
-                                                creator_short_form author/username;
-                                                creator_long_form string:?author=${author/username};
-                                                creator_is_openid python:'/' in creator_short_form;
-                                                creator_id python:(creator_short_form, creator_long_form)[creator_is_openid];">
-                                  <span i18n:translate="label_by_author">
-                                    by
-                                  <a href="#"
-                                     tal:attributes="href string:${navigation_root_url}/author/${item_creator}"
-                                     tal:content="author/name_or_id"
-                                     tal:omit-tag="not:author"
-                                     i18n:name="author">
-                                    Bob Dobalina
-                                  </a>
-                                  </span>
-
-                                </tal:name>
-
-                                <tal:modified condition="python: item_type != 'Event'">
-                                    &mdash;
-                                    <tal:mod i18n:translate="box_last_modified">
-                                      last modified
-                                    </tal:mod>
-                                    <span tal:replace="python:toLocalizedTime(item_modified,long_format=1)">
-                                      August 16, 2001 at 23:35:59
-                                    </span>
-                                </tal:modified>
-
-                                <metal:description define-slot="description_slot">
-                                    <tal:comment replace="nothing">
-                                        Place custom listing info for custom types here
-                                    </tal:comment>
-                                </metal:description>
-                            </tal:byline>
-                        </span>
-                        </metal:block>
-
-                    </header>
-
-                    <span class="description"
-                        tal:condition="item_description"
-                        tal:content="item_description">
-                      description
-                    </span>
-                </metal:block>
-                </tal:block>
-                </article>
-            </div>
-
-            <div metal:use-macro="context/batch_macros/macros/navigation" />
-
-        </tal:listing>
-        <metal:empty metal:define-slot="no_items_in_listing">
-            <p class="discreet"
-               tal:condition="not: batch"
-               i18n:translate="description_no_items_in_folder">
-                There are currently no items in this folder.
-            </p>
-        </metal:empty>
-
-        </tal:results>
-        </metal:listingmacro>
-
-    </metal:block>
-  </div>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/summary_view.pt b/plone/app/contenttypes/browser/templates/summary_view.pt
deleted file mode 100644
index 880f1e0..0000000
--- a/plone/app/contenttypes/browser/templates/summary_view.pt
+++ /dev/null
@@ -1,67 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-<metal:content-core fill-slot="content-core">
-<metal:block use-macro="context/standard_view/macros/content-core">
-
-    <metal:entries fill-slot="entries">
-    <metal:block use-macro="context/standard_view/macros/entries">
-    <metal:entry fill-slot="entry">
-
-        <div class="tileItem visualIEFloatFix"
-             tal:define="obj item/getObject">
-            <a href="#"
-                  tal:condition="python:getattr(obj.aq_explicit, 'image', None)"
-                  tal:attributes="href item/getURL">
-                  <div class="tileImage">
-                      <img src="" alt=""
-                           tal:define="scales obj/@@images;
-                                       scale python:scales.scale('image', 'thumb')"
-                           tal:replace="structure python:scale and scale.tag(css_class='tileImage') or None" />
-                  </div>
-            </a>
-
-            <h2 class="tileHeadline" metal:define-macro="listitem">
-                <a href="#"
-                   class="summary url"
-                   tal:attributes="href python:item_type in use_view_action and item_url+'/view' or item_url;"
-                   tal:content="item/Title">
-                    Item Title
-                </a>
-            </h2>
-
-            <div metal:use-macro="context/standard_view/macros/document_byline"></div>
-
-            <p class="tileBody" tal:condition="item_description">
-                <span class="description" tal:content="item_description">
-                    description
-                </span>
-            </p>
-
-            <p class="tileFooter">
-                <a href=""
-                   tal:attributes="href python:item_type in use_view_action and item_url+'/view' or item_url;"
-                   i18n:translate="read_more">
-                Read More&hellip;
-                </a>
-            </p>
-
-            <div class="visualClear"><!-- --></div>
-        </div>
-
-    </metal:entry>
-    </metal:block>
-    </metal:entries>
-
-</metal:block>
-</metal:content-core>
-
-</body>
-</html>
diff --git a/plone/app/contenttypes/browser/templates/tabular_view.pt b/plone/app/contenttypes/browser/templates/tabular_view.pt
deleted file mode 100644
index 4f2ea22..0000000
--- a/plone/app/contenttypes/browser/templates/tabular_view.pt
+++ /dev/null
@@ -1,77 +0,0 @@
-<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
-      xmlns:tal="http://xml.zope.org/namespaces/tal"
-      xmlns:metal="http://xml.zope.org/namespaces/metal"
-      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
-      lang="en"
-      metal:use-macro="here/main_template/macros/master"
-      i18n:domain="plone">
-
-<body>
-
-    <div metal:fill-slot="content-core"
-         tal:define="b_start python:request.get('b_start', 0);
-                     batch python:view.results(b_start=b_start);">
-
-         <div metal:define-macro="text-field-view"
-              id="parent-fieldname-text" class="stx"
-              tal:define="has_text exists:context/aq_explicit/text/output;
-                          text python:has_text and here.text.output or ''"
-              tal:condition="text"
-              tal:attributes="class python:here.Format() in ('text/structured', 'text/x-rst', ) and 'stx' or 'plain'">
-             <div metal:define-slot="inside" tal:replace="structure text">The body</div>
-         </div>
-
-        <p class="discreet"
-           tal:condition="not: batch"
-           i18n:translate="description_no_items_in_folder">
-            There are currently no items in this folder.
-        </p>
-
-        <table class="listing" summary="Content listing"
-            i18n:attributes="summary"
-            tal:condition="batch"
-            tal:define="fields view/selectedViewFields;
-                        pas_member context/@@pas_member">
-            <thead>
-                <tr>
-                    <th class="nosort"
-                        i18n:translate=""
-                        tal:repeat="field fields"
-                        tal:content="python: field[1]">Field name</th>
-                </tr>
-            </thead>
-            <tbody>
-            <tal:block tal:repeat="item batch">
-                <tr tal:define="oddrow repeat/item/odd;"
-                    tal:attributes="class python:oddrow and 'even' or 'odd'" >
-                <tal:block tal:repeat="field fields">
-                    <td tal:condition="python:field[0] not in ['Title', 'Creator', ]"
-                        tal:define="field_data python:getattr(item, field[0])">
-                        <tal:block tal:replace="field_data" />
-                    </td>
-                    <td tal:condition="python:field[0] == 'Title'">
-                        <a href="#"
-                           tal:attributes="href item/getURL;
-                                           title item/Title"
-                           tal:content="item/Title">Item Title</a>
-                    </td>
-                    <td tal:condition="python:field[0] == 'Creator'"
-                        tal:define="author python:pas_member.info(item.Creator());
-                                    name python:author['fullname'] or author['username']">
-                        <a href="#"
-                           tal:condition="author"
-                           tal:attributes="href string:author/${author/username};
-                                           title name"
-                           tal:content="name">Jos Henken</a>
-                    </td>
-                </tal:block>
-                </tr>
-            </tal:block>
-            </tbody>
-        </table>
-
-        <div metal:use-macro="context/batch_macros/macros/navigation" />
-  </div>
-
-</body>
-</html>


