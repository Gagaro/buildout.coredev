Repository: mockup


Branch: refs/heads/master
Date: 2015-07-20T14:46:19-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/abddde0e322fbcf9a6bb8a32ccc3c2bcee91d000

switch to tab where link/image data is loaded from on tinymce pattern

Files changed:
M CHANGES.rst
M mockup/patterns/tinymce/js/links.js
M mockup/patterns/tinymce/templates/image.xml
M mockup/patterns/tinymce/templates/link.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index 4cc8e23..7922a1e 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,12 @@ Changelog
 2.0.6 (unreleased)
 ------------------
 
-- no changes yet
+- switch to tab where link/image data is loaded from on tinymce pattern
+  [vangheem]
+
+- detect valid url on tinymce external
+  [vangheem]
+
 
 2.0.5 (2015-07-18)
 ------------------
diff --git a/mockup/patterns/tinymce/js/links.js b/mockup/patterns/tinymce/js/links.js
index cf98016..f5057ca 100644
--- a/mockup/patterns/tinymce/js/links.js
+++ b/mockup/patterns/tinymce/js/links.js
@@ -51,6 +51,24 @@ define([
     }
   });
 
+  var ExternalLink = LinkType.extend({
+    init: function() {
+      LinkType.prototype.init.call(this);
+      this.getEl().on('change', function(){
+        // check here if we should automatically add in http:// to url
+        var val = $(this).val();
+        if((new RegExp("https?\:\/\/")).test(val)){
+          // already valid url
+          return;
+        }
+        var domain = $(this).val().split('/')[0];
+        if(domain.indexOf('.') !== -1){
+          $(this).val('http://' + val);
+        }
+      });
+    }
+  });
+
   var InternalLink = LinkType.extend({
     init: function() {
       LinkType.prototype.init.call(this);
@@ -382,7 +400,7 @@ define([
       linkTypeClassMapping: {
         'internal': InternalLink,
         'upload': UploadLink,
-        'external': LinkType,
+        'external': ExternalLink,
         'email': EmailLink,
         'anchor': AnchorLink,
         'image': ImageLink,
@@ -630,7 +648,10 @@ define([
             self.linkType = linkType;
             self.linkTypes[self.linkType].load(self.imgElm);
             var scale = self.dom.getAttrib(self.imgElm, 'data-scale');
-            self.$scale.val(scale);
+            if(scale){
+              self.$scale.val(scale);
+            }
+            $('#tinylink-' + self.linkType, self.modal.$modal).trigger('click');
           }else if (src) {
             self.guessImageLink(src);
           }
@@ -653,6 +674,7 @@ define([
         if (linkType) {
           self.linkType = linkType;
           self.linkTypes[self.linkType].load(self.anchorElm);
+          $('#tinylink-' + self.linkType, self.modal.$modal).trigger('click');
         }else if (href) {
           self.guessAnchorLink(href);
         }
diff --git a/mockup/patterns/tinymce/templates/image.xml b/mockup/patterns/tinymce/templates/image.xml
index a78a0c4..24a48b6 100644
--- a/mockup/patterns/tinymce/templates/image.xml
+++ b/mockup/patterns/tinymce/templates/image.xml
@@ -10,7 +10,7 @@
 
         <% if(_.contains(linkTypes, 'image')){ %>
       <fieldset class="linkType image" data-linkType="image">
-        <legend>Image</legend>
+        <legend id="tinylink-image">Image</legend>
         <div class="form-inline">
           <div class="form-group main">
             <input type="text" name="image" />
@@ -32,14 +32,14 @@
 
       <% if(_.contains(linkTypes, 'uploadImage')){ %>
       <fieldset class="linkType uploadImage" data-linkType="uploadImage">
-        <legend>Upload</legend>
+        <legend id="tinylink-uploadImage">Upload</legend>
         <div class="uploadify-me"></div>
       </fieldset>
       <% } %>
 
       <% if(_.contains(linkTypes, 'externalImage')){ %>
       <fieldset class="linkType externalImage" data-linkType="externalImage">
-        <legend>External image</legend>
+        <legend id="tinylink-externalImage">External image</legend>
         <div>
           <div class="form-group main">
             <label><%- externalImageText %></label>
diff --git a/mockup/patterns/tinymce/templates/link.xml b/mockup/patterns/tinymce/templates/link.xml
index a12aadf..829e4c0 100644
--- a/mockup/patterns/tinymce/templates/link.xml
+++ b/mockup/patterns/tinymce/templates/link.xml
@@ -9,7 +9,7 @@
          data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">
 
       <fieldset class="linkType internal" data-linkType="internal">
-        <legend>Internal</legend>
+        <legend id="tinylink-internal">Internal</legend>
         <div>
           <div class="form-group main">
             <!-- this gives the name to the "linkType" -->
@@ -20,13 +20,13 @@
 
       <% if(upload){ %>
       <fieldset class="linkType upload" data-linkType="upload">
-        <legend>Upload</legend>
+        <legend id="tinylink-upload">Upload</legend>
         <div class="uploadify-me"></div>
       </fieldset>
       <% } %>
 
       <fieldset class="linkType external" data-linkType="external">
-        <legend>External</legend>
+        <legend id="tinylink-external">External</legend>
         <div class="form-group main">
           <label for="external"><%- externalText %></label>
           <input type="text" name="external" />
@@ -34,7 +34,7 @@
       </fieldset>
 
       <fieldset class="linkType email" data-linkType="email">
-        <legend>Email</legend>
+        <legend id="tinylink-email">Email</legend>
         <div class="form-inline">
           <div class="form-group main">
             <label><%- emailText %></label>
@@ -48,7 +48,7 @@
       </fieldset>
 
       <fieldset class="linkType anchor" data-linkType="anchor">
-        <legend>Anchor</legend>
+        <legend id="tinylink-anchor">Anchor</legend>
         <div>
           <div class="form-group main">
             <label>Select an anchor</label>


