Repository: plone.subrequest


Branch: refs/heads/master
Date: 2015-09-03T16:28:38-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.subrequest/commit/dc746c32f12ba95f704fc03fbf87f8d0a1d603c8

propagate IDisableCSRFProtection interface on subrequest to parent request object

Files changed:
M CHANGES.rst
M plone/subrequest/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 17eba91..172152a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.6.11 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- propagate IDisableCSRFProtection interface on subrequest to parent request object
+  [vangheem]
 
 
 1.6.10 (2015-08-14)
diff --git a/plone/subrequest/__init__.py b/plone/subrequest/__init__.py
index 871cceb..d0ce772 100644
--- a/plone/subrequest/__init__.py
+++ b/plone/subrequest/__init__.py
@@ -24,8 +24,12 @@
 
 try:
     from plone.protect.auto import SAFE_WRITE_KEY
+    from plone.protect.interfaces import IDisableCSRFProtection
 except ImportError:
     SAFE_WRITE_KEY = 'plone.protect.safe_oids'
+    from zope.interface import Interface
+    class IDisableCSRFProtection(Interface):
+        pass
 
 
 __all__ = ['subrequest', 'SubResponse']
@@ -154,6 +158,8 @@ def subrequest(url, root=None, stdout=None):
                 parent_request.environ[SAFE_WRITE_KEY] = []
             parent_request.environ[SAFE_WRITE_KEY].extend(
                 request.environ[SAFE_WRITE_KEY])
+        if IDisableCSRFProtection.providedBy(request):
+            alsoProvides(parent_request, IDisableCSRFProtection)
         request.clear()
         setRequest(parent_request)
         setSite(parent_site)


Repository: plone.subrequest


Branch: refs/heads/master
Date: 2015-09-04T12:24:00-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.subrequest/commit/7cd4d41865e3e122c167c79c1db54111a9011340

Merge pull request #5 from plone/propagate-idisabledcsrfprotection

propagate IDisableCSRFProtection interface on subrequest to parent request object

Files changed:
M CHANGES.rst
M plone/subrequest/__init__.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 17eba91..172152a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.6.11 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- propagate IDisableCSRFProtection interface on subrequest to parent request object
+  [vangheem]
 
 
 1.6.10 (2015-08-14)
diff --git a/plone/subrequest/__init__.py b/plone/subrequest/__init__.py
index 871cceb..d0ce772 100644
--- a/plone/subrequest/__init__.py
+++ b/plone/subrequest/__init__.py
@@ -24,8 +24,12 @@
 
 try:
     from plone.protect.auto import SAFE_WRITE_KEY
+    from plone.protect.interfaces import IDisableCSRFProtection
 except ImportError:
     SAFE_WRITE_KEY = 'plone.protect.safe_oids'
+    from zope.interface import Interface
+    class IDisableCSRFProtection(Interface):
+        pass
 
 
 __all__ = ['subrequest', 'SubResponse']
@@ -154,6 +158,8 @@ def subrequest(url, root=None, stdout=None):
                 parent_request.environ[SAFE_WRITE_KEY] = []
             parent_request.environ[SAFE_WRITE_KEY].extend(
                 request.environ[SAFE_WRITE_KEY])
+        if IDisableCSRFProtection.providedBy(request):
+            alsoProvides(parent_request, IDisableCSRFProtection)
         request.clear()
         setRequest(parent_request)
         setSite(parent_site)


