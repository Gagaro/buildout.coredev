Repository: plone.app.form
Branch: refs/heads/2.2.x
Date: 2015-04-27T21:46:01+02:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/plone.app.form/commit/925abd99ba1a805a6bf87cf45a7caaa202e11a99

Revert "Merge pull request #10 from plone/issue-8-localization"

This reverts commit da0259af9b40544d8fd4f3db54e1151717219f6c, reversing
changes made to 0ece9601a8c463e54207ba162a2c1604e5a14b47.

Files changed:
M CHANGES.txt
M plone/app/form/widgets/datecomponents.py
M plone/app/form/widgets/datecomponents.txt

diff --git a/CHANGES.txt b/CHANGES.txt
index b03e330..9d67f5c 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,9 +4,7 @@ Changelog
 2.2.5 (unreleased)
 ------------------
 
-- Preventing AM/PM issue when some locales are set.
-  This fix https://github.com/plone/plone.app.form/issues/8
-  [keul]
+- Nothing changed yet.
 
 
 2.2.4 (2014-01-27)
diff --git a/plone/app/form/widgets/datecomponents.py b/plone/app/form/widgets/datecomponents.py
index 177c4b7..f61c0ee 100644
--- a/plone/app/form/widgets/datecomponents.py
+++ b/plone/app/form/widgets/datecomponents.py
@@ -215,7 +215,7 @@ def result(self, date=None,
 
             for x in ('AM', 'PM'):
                 d={'id': x, 'value': x, 'selected': None}
-                if x==p.upper() and not default:
+                if x==p and not default:
                     d['selected']=1
                 ampm.append(d)
 
diff --git a/plone/app/form/widgets/datecomponents.txt b/plone/app/form/widgets/datecomponents.txt
index 0499260..4595df6 100644
--- a/plone/app/form/widgets/datecomponents.txt
+++ b/plone/app/form/widgets/datecomponents.txt
@@ -158,23 +158,6 @@ test is run.
   >>> parseDate(parts)
   (2499, '12', '31', '00', '00')
 
-Now testing if Python env localization will not affects the AM/PM behavior of the
-view (preventing regression of issue https://github.com/plone/plone.app.form/issues/8).
-The EN_us locale will not suffer of the issue while other (DE_de or IT_it) do.
-
-  >>> import locale
-  >>> default_locale = locale.getlocale()
-  >>> testdate = DateTime.DateTime('2015/04/17 09:00:00')
-  >>> locale.setlocale(locale.LC_ALL, "EN_us")
-  'EN_us'
-  >>> view.result(testdate, use_ampm=True)['ampm']
-  [{'selected': None, 'id': '--', 'value': 'AM'}, {'selected': 1, 'id': 'AM', 'value': 'AM'}, {'selected': None, 'id': 'PM', 'value': 'PM'}]
-  >>> locale.setlocale(locale.LC_ALL, "IT_it")
-  'IT_it'
-  >>> view.result(testdate, use_ampm=True)['ampm']
-  [{'selected': None, 'id': '--', 'value': 'AM'}, {'selected': 1, 'id': 'AM', 'value': 'AM'}, {'selected': None, 'id': 'PM', 'value': 'PM'}]  
-  >>> dummy = locale.setlocale(locale.LC_ALL, default_locale)
-
 un-monkey patch
   >>> DateTime.DateTime.localZone = realLocalZone
   >>> datecomponents.PLONE_CEILING = DateTime.DateTime(2500, 0)


