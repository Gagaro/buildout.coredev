Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2015-09-14T18:12:17+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.upgrade/commit/eae2a4c22f67895d94037c3de1a008f23449cde7

Add missing tool lookup.

Files changed:
M plone/app/upgrade/v50/betas.py

diff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py
index e8734b2..7b1273d 100644
--- a/plone/app/upgrade/v50/betas.py
+++ b/plone/app/upgrade/v50/betas.py
@@ -445,8 +445,19 @@ def to50rc3(context):
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v50:to50rc3')
     portal = getSite()
 
+    pprop = getToolByName(portal, 'portal_properties')
+    site_properties = pprop['site_properties']
+    registry = getUtility(IRegistry)
+
     site_properties_to_remove = ['invalid_ids']
 
     for p in site_properties_to_remove:
         if portal.hasProperty(p):
             portal._delProperty(p)
+
+    properties_to_migrate = ['external_links_open_new_window']
+    for p in properties_to_migrate:
+        if site_properties.hasProperty(p):
+            value = site_properties.getProperty(p)
+            registry['plone.%s' % p] = value
+            site_properties._delProperty(p)


