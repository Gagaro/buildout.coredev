Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-11-22T20:37:49-03:00
Author: Davi Lima (davilima6) <davilima6@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/616a10841a56a18a807d21ded431e76359764f3f

Update Site Setup link in all control panels (fixes plone/Products.CMFPlone#1255)

Files changed:
M CHANGES.rst
M src/plone/app/theming/browser/controlpanel.pt
M src/plone/app/theming/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1778b16..aa8bb0a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Update Site Setup link in all control panels (fixes https://github.com/plone/Products.CMFPlone/issues/1255)
+  [davilima6]
 
 
 1.2.15 (2015-10-28)
diff --git a/src/plone/app/theming/browser/controlpanel.pt b/src/plone/app/theming/browser/controlpanel.pt
index de3904a..f1e7b6a 100644
--- a/src/plone/app/theming/browser/controlpanel.pt
+++ b/src/plone/app/theming/browser/controlpanel.pt
@@ -71,9 +71,8 @@
             <h1 class="documentFirstHeading"
                 i18n:translate="heading_theme_settings">Theme settings</h1>
 
-            <a href=""
-                class="link-parent"
-                tal:attributes="href string:${context/portal_url}/plone_control_panel"
+            <a id="setup-link" class="link-parent"
+                tal:attributes="href string:${context/portal_url}/@@overview-controlpanel"
                 i18n:translate="label_up_to_plone_setup">
                     Up to Site Setup
             </a>
@@ -113,8 +112,6 @@
                     loadLinksWithinModal: true;
                     content: .content"
                 i18n:translate="">Help</a>
-
-
         </div>
 
         <div id="themesList">
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index af89571..61bc5f0 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -103,7 +103,7 @@ def update(self):
             IStatusMessage(self.request).add(_(u"Changes cancelled"))
 
             portalUrl = getToolByName(self.context, 'portal_url')()
-            self.redirect("{0:s}/plone_control_panel".format(portalUrl))
+            self.redirect("{0:s}/@@overview-controlpanel".format(portalUrl))
 
             return False
 
@@ -173,7 +173,7 @@ def update(self):
                         'error_invalid_parameter_expressions',
                         default=u"Please ensure you enter one expression per "
                                 u"line, in the format <name> = <expression>."
-                        )
+                    )
                     self.errors['parameterExpressions'] = message
 
             themeBase = form.get('themeBase', None)
@@ -416,15 +416,15 @@ def themeList(self):
             if theme.__name__ == TEMPLATE_THEME:
                 continue
 
-            #We've overwritten this theme, skip it
+            # We've overwritten this theme, skip it
             if complete.__contains__(theme.__name__):
                 continue
 
             override = False
 
-            #Is there more than one theme with the same name?
-            if len( filter(lambda x: x.__name__ == theme.__name__, self.availableThemes) ) > 1:
-                #Then we make sure we're using the TTW version, not the filesystem version.
+            # Is there more than one theme with the same name?
+            if len(filter(lambda x: x.__name__ == theme.__name__, self.availableThemes)) > 1:
+                # Then we make sure we're using the TTW version, not the filesystem version.
                 theme = filter(lambda x: x.__name__ == theme.__name__, self.zodbThemes)[0]
                 override = True
 


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-11-23T09:25:35-06:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/b8f2ad27e306cb07dd7f305fd3c65c89525b9699

Merge pull request #89 from plone/fix_sitesetup_link

Update Site Setup link in all control panels

Files changed:
M CHANGES.rst
M src/plone/app/theming/browser/controlpanel.pt
M src/plone/app/theming/browser/controlpanel.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 1778b16..aa8bb0a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -10,7 +10,8 @@ New:
 
 Fixes:
 
-- *add item here*
+- Update Site Setup link in all control panels (fixes https://github.com/plone/Products.CMFPlone/issues/1255)
+  [davilima6]
 
 
 1.2.15 (2015-10-28)
diff --git a/src/plone/app/theming/browser/controlpanel.pt b/src/plone/app/theming/browser/controlpanel.pt
index de3904a..f1e7b6a 100644
--- a/src/plone/app/theming/browser/controlpanel.pt
+++ b/src/plone/app/theming/browser/controlpanel.pt
@@ -71,9 +71,8 @@
             <h1 class="documentFirstHeading"
                 i18n:translate="heading_theme_settings">Theme settings</h1>
 
-            <a href=""
-                class="link-parent"
-                tal:attributes="href string:${context/portal_url}/plone_control_panel"
+            <a id="setup-link" class="link-parent"
+                tal:attributes="href string:${context/portal_url}/@@overview-controlpanel"
                 i18n:translate="label_up_to_plone_setup">
                     Up to Site Setup
             </a>
@@ -113,8 +112,6 @@
                     loadLinksWithinModal: true;
                     content: .content"
                 i18n:translate="">Help</a>
-
-
         </div>
 
         <div id="themesList">
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index af89571..61bc5f0 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -103,7 +103,7 @@ def update(self):
             IStatusMessage(self.request).add(_(u"Changes cancelled"))
 
             portalUrl = getToolByName(self.context, 'portal_url')()
-            self.redirect("{0:s}/plone_control_panel".format(portalUrl))
+            self.redirect("{0:s}/@@overview-controlpanel".format(portalUrl))
 
             return False
 
@@ -173,7 +173,7 @@ def update(self):
                         'error_invalid_parameter_expressions',
                         default=u"Please ensure you enter one expression per "
                                 u"line, in the format <name> = <expression>."
-                        )
+                    )
                     self.errors['parameterExpressions'] = message
 
             themeBase = form.get('themeBase', None)
@@ -416,15 +416,15 @@ def themeList(self):
             if theme.__name__ == TEMPLATE_THEME:
                 continue
 
-            #We've overwritten this theme, skip it
+            # We've overwritten this theme, skip it
             if complete.__contains__(theme.__name__):
                 continue
 
             override = False
 
-            #Is there more than one theme with the same name?
-            if len( filter(lambda x: x.__name__ == theme.__name__, self.availableThemes) ) > 1:
-                #Then we make sure we're using the TTW version, not the filesystem version.
+            # Is there more than one theme with the same name?
+            if len(filter(lambda x: x.__name__ == theme.__name__, self.availableThemes)) > 1:
+                # Then we make sure we're using the TTW version, not the filesystem version.
                 theme = filter(lambda x: x.__name__ == theme.__name__, self.zodbThemes)[0]
                 override = True
 


