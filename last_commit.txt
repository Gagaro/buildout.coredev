Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2015-09-07T23:31:52+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.Archetypes/commit/aab85dd4cc4d5a0460eb5c2a3efeca8575106dbd

No longer needlessly importing TestSuite and makeSuite.

Files changed:
M Products/Archetypes/tests/test_baseobject.py
M Products/Archetypes/tests/test_browser_utils.py
M Products/Archetypes/tests/test_classgen.py
M Products/Archetypes/tests/test_fields.py
M Products/Archetypes/tests/test_languagevocabulary.py
M Products/Archetypes/tests/test_metadata.py
M Products/Archetypes/tests/test_referenceCatalog.py
M Products/Archetypes/tests/test_schemata.py
M Products/Archetypes/tests/test_varschema.py

diff --git a/Products/Archetypes/tests/test_baseobject.py b/Products/Archetypes/tests/test_baseobject.py
index 765e48e..6f5fbf7 100644
--- a/Products/Archetypes/tests/test_baseobject.py
+++ b/Products/Archetypes/tests/test_baseobject.py
@@ -23,8 +23,6 @@
 #
 ################################################################################
 
-from unittest import TestSuite, makeSuite
-
 from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
 from Products.Archetypes.tests.utils import mkDummyInContext
 
diff --git a/Products/Archetypes/tests/test_browser_utils.py b/Products/Archetypes/tests/test_browser_utils.py
index 6f30082..1b7bf7d 100644
--- a/Products/Archetypes/tests/test_browser_utils.py
+++ b/Products/Archetypes/tests/test_browser_utils.py
@@ -1,5 +1,3 @@
-from unittest import TestSuite, makeSuite
-
 from zope.component import getMultiAdapter
 
 from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
diff --git a/Products/Archetypes/tests/test_classgen.py b/Products/Archetypes/tests/test_classgen.py
index 69e8419..23d4365 100644
--- a/Products/Archetypes/tests/test_classgen.py
+++ b/Products/Archetypes/tests/test_classgen.py
@@ -26,7 +26,6 @@
 """
 
 import unittest
-from unittest import TestSuite, makeSuite
 
 from DateTime import DateTime
 from AccessControl import ClassSecurityInfo
diff --git a/Products/Archetypes/tests/test_fields.py b/Products/Archetypes/tests/test_fields.py
index 5ca9fa9..018bd3b 100644
--- a/Products/Archetypes/tests/test_fields.py
+++ b/Products/Archetypes/tests/test_fields.py
@@ -23,8 +23,6 @@
 #
 ################################################################################
 
-from unittest import TestSuite, makeSuite
-
 import os
 import PIL
 
diff --git a/Products/Archetypes/tests/test_languagevocabulary.py b/Products/Archetypes/tests/test_languagevocabulary.py
index 9c088e1..6afbfa6 100644
--- a/Products/Archetypes/tests/test_languagevocabulary.py
+++ b/Products/Archetypes/tests/test_languagevocabulary.py
@@ -1,5 +1,3 @@
-from unittest import TestSuite, makeSuite
-
 from Products.CMFCore.utils import getToolByName
 
 from Products.Archetypes.atapi import BaseSchema
diff --git a/Products/Archetypes/tests/test_metadata.py b/Products/Archetypes/tests/test_metadata.py
index 59e536b..b8a8e87 100644
--- a/Products/Archetypes/tests/test_metadata.py
+++ b/Products/Archetypes/tests/test_metadata.py
@@ -23,8 +23,6 @@
 #
 ################################################################################
 
-from unittest import TestSuite, makeSuite
-
 from Acquisition import aq_base
 from Acquisition import aq_parent
 
diff --git a/Products/Archetypes/tests/test_referenceCatalog.py b/Products/Archetypes/tests/test_referenceCatalog.py
index f439268..d79be48 100644
--- a/Products/Archetypes/tests/test_referenceCatalog.py
+++ b/Products/Archetypes/tests/test_referenceCatalog.py
@@ -23,8 +23,6 @@
 #
 ################################################################################
 
-from unittest import TestSuite, makeSuite
-
 from zope import component
 from zope import interface
 from zope.event import notify
diff --git a/Products/Archetypes/tests/test_schemata.py b/Products/Archetypes/tests/test_schemata.py
index 9be8e15..20caa17 100644
--- a/Products/Archetypes/tests/test_schemata.py
+++ b/Products/Archetypes/tests/test_schemata.py
@@ -23,8 +23,6 @@
 #
 ################################################################################
 
-from unittest import TestSuite, makeSuite
-
 import operator
 
 from Products.Archetypes.tests.atsitetestcase import ATSiteTestCase
diff --git a/Products/Archetypes/tests/test_varschema.py b/Products/Archetypes/tests/test_varschema.py
index 89dcf47..3f7400f 100644
--- a/Products/Archetypes/tests/test_varschema.py
+++ b/Products/Archetypes/tests/test_varschema.py
@@ -23,8 +23,6 @@
 #
 ################################################################################
 
-from unittest import TestSuite, makeSuite
-
 from Products.Archetypes.tests.attestcase import ATTestCase
 from Products.Archetypes.atapi import BaseSchema, BaseContent, Schema, \
     StringField, registerType, process_types, listTypes


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2015-09-08T00:01:43+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.Archetypes/commit/0fcbcdbd7371bda9fab9132b7616f1082b6109b0

Added changelog entry for merged pull request #48.

Files changed:
M CHANGES.txt

diff --git a/CHANGES.txt b/CHANGES.txt
index 7a5b9f9..7d90ee2 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,7 +4,8 @@ Changelog
 1.10.9 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Compare picklist entry value, not text.
+  [paulrentschler]
 
 
 1.10.8 (2015-07-18)


Repository: Products.Archetypes


Branch: refs/heads/master
Date: 2015-09-08T00:04:58+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/Products.Archetypes/commit/62657cd9bc81429b3b26201f44522da3a98272ea

Defend 'defaultRights' method against broken portal_metadata.

Its schemas are instances of CMFDefault classes, which normally are
no longer available in Plone 5.  The relevant code has been
duplicated in ATContentTypes.

We might need to write migration code in plone.app.upgrade to migrate
existing Plone 4 portal_metadata settings.

Files changed:
M CHANGES.txt
M Products/Archetypes/ExtensibleMetadata.py

diff --git a/CHANGES.txt b/CHANGES.txt
index 7d90ee2..afad75c 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,6 +4,12 @@ Changelog
 1.10.9 (unreleased)
 -------------------
 
+- Defend `defaultRights` method against broken portal_metadata.
+  Its schemas are instances of CMFDefault classes, which normally are
+  no longer available in Plone 5.  The relevant code has been
+  duplicated in ATContentTypes.
+  [maurits]
+
 - Compare picklist entry value, not text.
   [paulrentschler]
 
diff --git a/Products/Archetypes/ExtensibleMetadata.py b/Products/Archetypes/ExtensibleMetadata.py
index 47df224..70f15ce 100644
--- a/Products/Archetypes/ExtensibleMetadata.py
+++ b/Products/Archetypes/ExtensibleMetadata.py
@@ -229,6 +229,9 @@ def defaultRights(self):
         if mdtool is None:
             return ''
         for sid, schema in mdtool.listSchemas():
+            if not hasattr(schema, 'listPolicies'):
+                # Broken class from CMFDefault.
+                continue
             for pid, policy in schema.listPolicies(typ=self.Type()):
                 if pid != 'Rights' and not policy.supply_default:
                     continue


