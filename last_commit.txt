Repository: plone.app.querystring


Branch: refs/heads/1.2.x
Date: 2015-09-09T17:47:34-03:00
Author: Winston Ferreira (winstonf88) <winstonf88@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/814a44c23d01158a14c70569d28a58eb54d7ea53

Fixed QuerystringRegistryReader.mapSortableIndex so it doesnt return ZCTextIndexes

Files changed:
M plone/app/querystring/registryreader.py

diff --git a/plone/app/querystring/registryreader.py b/plone/app/querystring/registryreader.py
index 8060a2f..633ede6 100644
--- a/plone/app/querystring/registryreader.py
+++ b/plone/app/querystring/registryreader.py
@@ -6,6 +6,9 @@
 from zope.i18nmessageid import Message
 from zope.interface import implements
 from zope.schema.interfaces import IVocabularyFactory
+from Products.ZCTextIndex.interfaces import IZCTextIndex
+from Products.CMFCore.utils import getToolByName
+
 import logging
 
 logger = logging.getLogger("plone.app.querystring")
@@ -102,9 +105,11 @@ def mapOperations(self, values):
 
     def mapSortableIndexes(self, values):
         """Map sortable indexes"""
+        catalog = getToolByName(self.context, 'portal_catalog')._catalog
         sortables = {}
         for key, field in values.get('%s.field' % self.prefix).iteritems():
-            if field['sortable']:
+            if field['sortable'] and \
+               not IZCTextIndex.providedBy(catalog.getIndex(key)):
                 sortables[key] = values.get('%s.field.%s' % (self.prefix, key))
         values['sortable'] = sortables
         return values


Repository: plone.app.querystring


Branch: refs/heads/1.2.x
Date: 2015-09-09T18:31:37-03:00
Author: Winston Ferreira (winstonf88) <winstonf88@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/61aeaefba60bf712ba720543b5deb5aae90f325b

updated change log

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 745059c..31c13e8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.2.8 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed Sortable Indexes to not return ZCTextIndex type indexes.
+  [winstonf88]
 
 
 1.2.7 (2015-08-13)


Repository: plone.app.querystring


Branch: refs/heads/1.2.x
Date: 2015-09-17T12:03:02-03:00
Author: Winston Ferreira (winstonf88) <winstonf88@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/c48b5d8e7d593cbdcce19367cbf9ae0034d28d3d

bugfix

Files changed:
M plone/app/querystring/registryreader.py

diff --git a/plone/app/querystring/registryreader.py b/plone/app/querystring/registryreader.py
index 633ede6..92b492b 100644
--- a/plone/app/querystring/registryreader.py
+++ b/plone/app/querystring/registryreader.py
@@ -8,6 +8,7 @@
 from zope.schema.interfaces import IVocabularyFactory
 from Products.ZCTextIndex.interfaces import IZCTextIndex
 from Products.CMFCore.utils import getToolByName
+from zope.component.hooks import getSite
 
 import logging
 
@@ -105,7 +106,7 @@ def mapOperations(self, values):
 
     def mapSortableIndexes(self, values):
         """Map sortable indexes"""
-        catalog = getToolByName(self.context, 'portal_catalog')._catalog
+        catalog = getToolByName(getSite(), 'portal_catalog')._catalog
         sortables = {}
         for key, field in values.get('%s.field' % self.prefix).iteritems():
             if field['sortable'] and \


Repository: plone.app.querystring


Branch: refs/heads/1.2.x
Date: 2015-09-18T10:08:56-03:00
Author: Winston Ferreira (winstonf88) <winstonf88@gmail.com>
Commit: https://github.com/plone/plone.app.querystring/commit/125d90e769acb1f1bd4ee55ae55bef73bfd53959

Fixed import order

Files changed:
M plone/app/querystring/registryreader.py

diff --git a/plone/app/querystring/registryreader.py b/plone/app/querystring/registryreader.py
index 92b492b..8c849e0 100644
--- a/plone/app/querystring/registryreader.py
+++ b/plone/app/querystring/registryreader.py
@@ -1,14 +1,14 @@
 from .interfaces import IQuerystringRegistryReader
 from operator import attrgetter
+from Products.CMFCore.utils import getToolByName
+from Products.ZCTextIndex.interfaces import IZCTextIndex
 from zope.component import queryUtility
+from zope.component.hooks import getSite
 from zope.globalrequest import getRequest
 from zope.i18n import translate
 from zope.i18nmessageid import Message
 from zope.interface import implements
 from zope.schema.interfaces import IVocabularyFactory
-from Products.ZCTextIndex.interfaces import IZCTextIndex
-from Products.CMFCore.utils import getToolByName
-from zope.component.hooks import getSite
 
 import logging
 


Repository: plone.app.querystring


Branch: refs/heads/1.2.x
Date: 2015-09-18T18:18:23+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.querystring/commit/d87d6e640eac31ebcb6139c74d67382323b15f1a

Merge pull request #50 from plone/issue_37_1.2.x

Fixed QuerystringRegistryReader.mapSortableIndex so it doesnt return â€¦

Files changed:
M CHANGES.rst
M plone/app/querystring/registryreader.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 745059c..31c13e8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.2.8 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed Sortable Indexes to not return ZCTextIndex type indexes.
+  [winstonf88]
 
 
 1.2.7 (2015-08-13)
diff --git a/plone/app/querystring/registryreader.py b/plone/app/querystring/registryreader.py
index 8060a2f..8c849e0 100644
--- a/plone/app/querystring/registryreader.py
+++ b/plone/app/querystring/registryreader.py
@@ -1,11 +1,15 @@
 from .interfaces import IQuerystringRegistryReader
 from operator import attrgetter
+from Products.CMFCore.utils import getToolByName
+from Products.ZCTextIndex.interfaces import IZCTextIndex
 from zope.component import queryUtility
+from zope.component.hooks import getSite
 from zope.globalrequest import getRequest
 from zope.i18n import translate
 from zope.i18nmessageid import Message
 from zope.interface import implements
 from zope.schema.interfaces import IVocabularyFactory
+
 import logging
 
 logger = logging.getLogger("plone.app.querystring")
@@ -102,9 +106,11 @@ def mapOperations(self, values):
 
     def mapSortableIndexes(self, values):
         """Map sortable indexes"""
+        catalog = getToolByName(getSite(), 'portal_catalog')._catalog
         sortables = {}
         for key, field in values.get('%s.field' % self.prefix).iteritems():
-            if field['sortable']:
+            if field['sortable'] and \
+               not IZCTextIndex.providedBy(catalog.getIndex(key)):
                 sortables[key] = values.get('%s.field.%s' % (self.prefix, key))
         values['sortable'] = sortables
         return values


