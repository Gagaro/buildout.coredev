Repository: Products.PortalTransforms
Branch: refs/heads/master
Date: 2015-03-06T15:19:40+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.PortalTransforms/commit/79047c656c035a651bffd28f6e66cb7c5acedef0

Do not fail tests if a mimetype already has been registered in the tests.

Files changed:
M CHANGES.rst
M Products/PortalTransforms/tests/test_engine.py

diff --git a/CHANGES.rst b/CHANGES.rst
index d99c880..be1fa84 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.1.5 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Do not fail tests if a mimetype already has been registered in the tests. 
+  [timo]
 
 
 2.1.4 (2014-09-07)
diff --git a/Products/PortalTransforms/tests/test_engine.py b/Products/PortalTransforms/tests/test_engine.py
index ae2df8a..bd313ef 100644
--- a/Products/PortalTransforms/tests/test_engine.py
+++ b/Products/PortalTransforms/tests/test_engine.py
@@ -209,7 +209,8 @@ def testPolicy(self):
         self.engine.registerTransform(DummyHtmlFilter2())
         required = ['dummy_html_filter1', 'dummy_html_filter2']
 
-        self.engine.manage_addPolicy(mt, required)
+        if mt not in self.engine._policies:
+            self.engine.manage_addPolicy(mt, required)
         expected_policy = [('text/x-html-safe',
                             ('dummy_html_filter1', 'dummy_html_filter2'))]
         self.assertEqual(self.engine.listPolicies(), expected_policy)
@@ -259,7 +260,8 @@ def testCacheWithVHost(self):
         mt = 'text/x-html-safe'
         self.engine.registerTransform(QuxToVHost())
         required = ['qux_to_vhost']
-        self.engine.manage_addPolicy(mt, required)
+        if mt not in self.engine._policies:
+            self.engine.manage_addPolicy(mt, required)
 
         data = '<a href="qux">vhost link</a>'
 


