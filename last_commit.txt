Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-23T18:52:56+02:00
Author: Aleix Llus√† Serra () <a.llusa@iskra.cat>
Commit: https://github.com/plone/Products.CMFPlone/commit/9cd88385f8cb63644952603eca65c8b2b3a9d91c

Fix mail controlpanel not keeping password field when saving

https://github.com/plone/Products.CMFPlone/issues/1067

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/mail.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6d23a48..aafa3bf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0rc4 (unreleased)
 -------------------
 
+- Fix mail controlpanel not keeping password field when saving
+  [allusa]
+
 - Remove trying to install plone.protect to global site manager
   as that is now handled by plone.protect
   [vangheem]
diff --git a/Products/CMFPlone/controlpanel/browser/mail.py b/Products/CMFPlone/controlpanel/browser/mail.py
index a8fa85a..9263d64 100644
--- a/Products/CMFPlone/controlpanel/browser/mail.py
+++ b/Products/CMFPlone/controlpanel/browser/mail.py
@@ -36,6 +36,10 @@ def save(self):
         if errors:
             self.status = self.formErrorsMessage
             return False
+        #keep password field
+        if (data.get('smtp_userid') is not None
+            and data.get('smtp_pass') is None):
+            del data['smtp_pass']
         self.applyChanges(data)
         return True
 


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-09-24T09:14:12+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/b478b34a059647109f8ec3bc9e53d963c42120c0

Merge pull request #1068 from plone/mail-keep-password

Fix #1067: mail controlpanel not keeping password field when saving

Files changed:
M CHANGES.rst
M Products/CMFPlone/controlpanel/browser/mail.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 6d23a48..aafa3bf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0rc4 (unreleased)
 -------------------
 
+- Fix mail controlpanel not keeping password field when saving
+  [allusa]
+
 - Remove trying to install plone.protect to global site manager
   as that is now handled by plone.protect
   [vangheem]
diff --git a/Products/CMFPlone/controlpanel/browser/mail.py b/Products/CMFPlone/controlpanel/browser/mail.py
index a8fa85a..9263d64 100644
--- a/Products/CMFPlone/controlpanel/browser/mail.py
+++ b/Products/CMFPlone/controlpanel/browser/mail.py
@@ -36,6 +36,10 @@ def save(self):
         if errors:
             self.status = self.formErrorsMessage
             return False
+        #keep password field
+        if (data.get('smtp_userid') is not None
+            and data.get('smtp_pass') is None):
+            del data['smtp_pass']
         self.applyChanges(data)
         return True
 


