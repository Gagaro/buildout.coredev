Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-01-03T18:15:34-08:00
Author: David Glick (davisagli) <david@glicksoftware.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/5289fe2ac99cdc413a221ba92568eb3433a8c79a

fix tab markup for author view

Files changed:
M Products/CMFPlone/browser/templates/author.pt
M docs/CHANGES.rst

diff --git a/Products/CMFPlone/browser/templates/author.pt b/Products/CMFPlone/browser/templates/author.pt
index 89815ed..d7c4678 100644
--- a/Products/CMFPlone/browser/templates/author.pt
+++ b/Products/CMFPlone/browser/templates/author.pt
@@ -53,27 +53,6 @@
                         portrait author/portrait | nothing;
                         member_info view/member_info">
 
-            <div id="edit-bar" tal:condition="isOwner">
-                <h5 class="hiddenStructure">Views</h5>
-                <ul id="content-views"
-                    class="contentViews">
-                  <li class="selected">
-                    <a href=""
-                       tal:define="member_url view/member_info/url"
-                       tal:attributes="href string:${portal_url}/author/${member_url}"
-                       i18n:translate="label_view">View</a>
-                  </li>
-                  <li>
-                    <a href=""
-                       tal:attributes="href string:${portal_url}/@@personal-information"
-                       i18n:translate="label_edit">Edit</a>
-                  </li>
-                </ul>
-                <div class="contentActions">&nbsp;</div>
-                 <!-- end simulated tabs -->
-            </div>
-
-
             <div metal:use-macro="context/global_statusmessage/macros/portal_message">
                 Portal status message
             </div>
@@ -92,158 +71,167 @@
                     Author ID
                 </h1>
 
-               <img src=""
-                    alt="User portrait picture"
-                    class="portraitPhoto"
-                    tal:attributes="src portrait/absolute_url" />
-
-                <div class="documentDescription"
-                     tal:content="authorinfo/description">
-                    Author description.
-                </div>
-
-                <div id="content-core">
-                    <div class="discreet">
-                        <tal:location condition="authorinfo/location"
-                                      i18n:translate="text_location">
-                            Location:
-                            <span tal:content="authorinfo/location"
-                                  tal:omit-tag=""
-                                  i18n:name="location">
-                                Some location
-                            </span>
-                        </tal:location>
-
-                        <tal:language condition="authorinfo/language">
-                        &mdash;
-                        <span i18n:translate="label_main_language">
-                            Main Language:
-                        </span>
-                        <span tal:replace="authorinfo/language">
-                          Some language
-                        </span>
-                        </tal:language>
-                    </div>
-
-                    <div class="visualClear"><!-- --></div>
-
-                    <p tal:condition="python:view.home_folder(username)">
-                      <a href="#"
-                         tal:attributes="href python:view.home_folder(username).absolute_url()"
-                         i18n:translate="label_author_internal_home_page">
-                        Author's home page in this site&hellip;
-                      </a>
-                    </p>
-
-                    <p tal:condition="python: not view.home_folder(username) and authorinfo['home_page']">
-                      <a href="#"
-                         rel="nofollow"
-                         tal:attributes="href authorinfo/home_page"
-                         i18n:translate="label_author_external_home_page">
-                        Author's external home page&hellip;
-                      </a>
-                    </p>
-
-                    <tal:noemailsetup tal:condition="python:not (email_from_address or isAnon)">
-                        <p class="discreet"
-                           i18n:translate="text_no_email_setup">
-                            This site doesn't have a valid email setup, so you cannot use
-                            any contact forms.
-                        </p>
-                    </tal:noemailsetup>
-
-                    <tal:noemail tal:condition="python:not isAnon and not member_info.get('email', None)">
-                        <p class="discreet"
-                           i18n:translate="text_no_member_email">
-                            You do not have an email address, so you
-                            cannot use any contact forms. Please edit
-                            your personal information.
-                        </p>
-                    </tal:noemail>
-
-                    <tal:mailsetup tal:condition="python:email_from_address and authorinfo['has_email']">
-
-                        <div class="formControls" tal:condition="isAnon">
-                        <form
-                          tal:attributes="action string:$portal_url/login">
-                           <input class="standalone"
-                               type="submit"
-                               value="Log in to send feedback"
-                               i18n:attributes="value label_login_to_send_feedback;"
-                               />
-                        </form>
-                        </div>
-
-                        <!-- feedback form -->
-
-
-                        <tal:owner tal:condition="python: not isOwner and not isAnon and member_info.get('email', None)">
-                            <p class="discreet"
-                               i18n:translate="description_author_feedback">
-                                If you want to contact this author, fill in the form
-                                below.
-                            </p>
-
-
-                            <tal:with-form-as-view define="form nocall:view/feedback_form;
-                                                           view nocall:form">
-                              <metal:block use-macro="form/@@ploneform-macros/titlelessform" />
-                            </tal:with-form-as-view>
-
-                        </tal:owner>
-                    </tal:mailsetup>
-
-                    <!-- listing of content created by this user -->
-                    <tal:authorContent
-                        define="author_content view/author_content;"
-                        condition="author_content">
-
-                        <h2 i18n:translate="heading_author_content">
-                            Latest content created by this user
-                        </h2>
-
-                        <div metal:define-macro="user_content_listing">
-                        <table class="vertical listing"
-                               summary="Lists content written by an author grouped by content type"
-                               i18n:attributes="summary summary_author_content_list;">
-                            <thead>
-                              <tr>
-                                  <th>Date</th>
-                                  <th>Content</th>
-                              </tr>
-                            </thead>
-                            <tal:repeat repeat="item author_content">
+                <div class="autotabs" tal:omit-tag="not:isOwner">
+                  <nav class="autotoc-nav" tal:condition="isOwner">
+                    <a class="active"
+                       href="${portal_url}/author/${view/member_info/url}"
+                       i18n:translate="label_view">View</a>
+                    <a href="${portal_url}/@@personal-information"
+                       i18n:translate="label_edit">Edit</a>
+                  </nav>
+
+                  <img src=""
+                      alt="User portrait picture"
+                      class="portraitPhoto"
+                      tal:attributes="src portrait/absolute_url" />
+
+                  <div class="documentDescription"
+                       tal:content="authorinfo/description">
+                      Author description.
+                  </div>
+
+                  <div id="content-core">
+                      <div class="discreet">
+                          <tal:location condition="authorinfo/location"
+                                        i18n:translate="text_location">
+                              Location:
+                              <span tal:content="authorinfo/location"
+                                    tal:omit-tag=""
+                                    i18n:name="location">
+                                  Some location
+                              </span>
+                          </tal:location>
+
+                          <tal:language condition="authorinfo/language">
+                          &mdash;
+                          <span i18n:translate="label_main_language">
+                              Main Language:
+                          </span>
+                          <span tal:replace="authorinfo/language">
+                            Some language
+                          </span>
+                          </tal:language>
+                      </div>
+
+                      <div class="visualClear"><!-- --></div>
+
+                      <p tal:condition="python:view.home_folder(username)">
+                        <a href="#"
+                           tal:attributes="href python:view.home_folder(username).absolute_url()"
+                           i18n:translate="label_author_internal_home_page">
+                          Author's home page in this site&hellip;
+                        </a>
+                      </p>
+
+                      <p tal:condition="python: not view.home_folder(username) and authorinfo['home_page']">
+                        <a href="#"
+                           rel="nofollow"
+                           tal:attributes="href authorinfo/home_page"
+                           i18n:translate="label_author_external_home_page">
+                          Author's external home page&hellip;
+                        </a>
+                      </p>
+
+                      <tal:noemailsetup tal:condition="python:not (email_from_address or isAnon)">
+                          <p class="discreet"
+                             i18n:translate="text_no_email_setup">
+                              This site doesn't have a valid email setup, so you cannot use
+                              any contact forms.
+                          </p>
+                      </tal:noemailsetup>
+
+                      <tal:noemail tal:condition="python:not isAnon and not member_info.get('email', None)">
+                          <p class="discreet"
+                             i18n:translate="text_no_member_email">
+                              You do not have an email address, so you
+                              cannot use any contact forms. Please edit
+                              your personal information.
+                          </p>
+                      </tal:noemail>
+
+                      <tal:mailsetup tal:condition="python:email_from_address and authorinfo['has_email']">
+
+                          <div class="formControls" tal:condition="isAnon">
+                          <form
+                            tal:attributes="action string:$portal_url/login">
+                             <input class="standalone"
+                                 type="submit"
+                                 value="Log in to send feedback"
+                                 i18n:attributes="value label_login_to_send_feedback;"
+                                 />
+                          </form>
+                          </div>
+
+                          <!-- feedback form -->
+
+
+                          <tal:owner tal:condition="python: not isOwner and not isAnon and member_info.get('email', None)">
+                              <p class="discreet"
+                                 i18n:translate="description_author_feedback">
+                                  If you want to contact this author, fill in the form
+                                  below.
+                              </p>
+
+
+                              <tal:with-form-as-view define="form nocall:view/feedback_form;
+                                                             view nocall:form">
+                                <metal:block use-macro="form/@@ploneform-macros/titlelessform" />
+                              </tal:with-form-as-view>
+
+                          </tal:owner>
+                      </tal:mailsetup>
+
+                      <!-- listing of content created by this user -->
+                      <tal:authorContent
+                          define="author_content view/author_content;"
+                          condition="author_content">
+
+                          <h2 i18n:translate="heading_author_content">
+                              Latest content created by this user
+                          </h2>
+
+                          <div metal:define-macro="user_content_listing">
+                          <table class="vertical listing"
+                                 summary="Lists content written by an author grouped by content type"
+                                 i18n:attributes="summary summary_author_content_list;">
+                              <thead>
                                 <tr>
-                                    <th tal:content="item/date"
-                                        style="white-space: nowrap">
-                                        Date
-                                    </th>
-                                    <td>
-                                      <a href=""
-                                         tal:attributes="href item/url"
-                                         tal:content="item/title">title</a>
-                                    </td>
+                                    <th>Date</th>
+                                    <th>Content</th>
                                 </tr>
-                            </tal:repeat>
-                        </table>
-                        </div>
-
-                        <p>
-                        <a href=""
-                           tal:attributes="href string:$here_url/search?Creator=${username}&amp;sort_on=created&amp;sort_order=reverse"
-                           i18n:translate="go_to_search_author_content">
-                            All content created by
-                            <span i18n:name="user" tal:omit-tag="" tal:content="python:authorinfo['fullname'] or username"/>&hellip;
-                        </a>
-                        </p>
-
-                    </tal:authorContent>
+                              </thead>
+                              <tal:repeat repeat="item author_content">
+                                  <tr>
+                                      <th tal:content="item/date"
+                                          style="white-space: nowrap">
+                                          Date
+                                      </th>
+                                      <td>
+                                        <a href=""
+                                           tal:attributes="href item/url"
+                                           tal:content="item/title">title</a>
+                                      </td>
+                                  </tr>
+                              </tal:repeat>
+                          </table>
+                          </div>
+
+                          <p>
+                          <a href=""
+                             tal:attributes="href string:$here_url/search?Creator=${username}&amp;sort_on=created&amp;sort_order=reverse"
+                             i18n:translate="go_to_search_author_content">
+                              All content created by
+                              <span i18n:name="user" tal:omit-tag="" tal:content="python:authorinfo['fullname'] or username"/>&hellip;
+                          </a>
+                          </p>
+
+                      </tal:authorContent>
+                  </div>
                 </div>
-            </article>
-
 
+            </article>
 
-            </tal:haveAuthor>
+        </tal:haveAuthor>
 
     </tal:main-macro>
 
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index ab5f994..b3bd019 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -8,7 +8,7 @@ Changelog
 5.0a1 (unreleased)
 ------------------
 
-- Fix user/group control panel markup for Plone 5.
+- Fix contentViews (tabs) markup for Plone 5.
   [davisagli]
 
 - folder_position script: make position and id optional.  Default


