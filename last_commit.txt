Repository: plone.app.discussion
Branch: refs/heads/master
Date: 2015-05-30T15:20:32-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.discussion/commit/e2192e59737e8b201d6c21e87fdaea58476d3675

use modal pattern for comment edit

Files changed:
M plone/app/discussion/browser/comments.pt

diff --git a/plone/app/discussion/browser/comments.pt b/plone/app/discussion/browser/comments.pt
index 8e69b15..03c3a79 100644
--- a/plone/app/discussion/browser/comments.pt
+++ b/plone/app/discussion/browser/comments.pt
@@ -9,7 +9,8 @@
                        has_replies python:view.has_replies(canReview);
                        showCommenterImage view/show_commenter_image;
                        errors options/state/getErrors|nothing;
-                       wtool context/@@plone_tools/workflow;"
+                       wtool context/@@plone_tools/workflow;
+                       auth_token context/@@authenticator/token|nothing"
            tal:condition="python:isDiscussionAllowed or has_replies"
            i18n:domain="plone">
 
@@ -115,19 +116,26 @@
                                    />
                         </form>
 
-                        <form name="edit"
-                              action=""
-                              method="get"
-                              class="commentactionsform"
-                              tal:condition="python:isEditCommentAllowed and canEdit"
-                              tal:attributes="action string:${reply/absolute_url}/@@edit-comment">
-                            <input name="form.button.EditComment"
-                                   class="context"
-                                   type="submit"
-                                   value="Edit"
-                                   i18n:attributes="value label_edit;"
-                                   />
-                        </form>
+                        <tal:edit tal:condition="python:isEditCommentAllowed and canEdit">
+                          <!-- plone 5 will have auth_token available
+                               so we'll use modal pattern -->
+                          <a class="commentactionsform pat-plone-modal"
+                             tal:condition="auth_token"
+                             tal:attributes="href string:${reply/absolute_url}/@@edit-comment?_authenticator=${auth_token}">Edit</a>
+                          <form name="edit"
+                                action=""
+                                method="get"
+                                class="commentactionsform"
+                                tal:condition="not: auth_token"
+                                tal:attributes="action string:${reply/absolute_url}/@@edit-comment">
+                              <input name="form.button.EditComment"
+                                     class="context"
+                                     type="submit"
+                                     value="Edit"
+                                     i18n:attributes="value label_edit;"
+                                     />
+                          </form>
+                        </tal:edit>
 
 
                         <!-- Workflow actions (e.g. 'publish') -->


