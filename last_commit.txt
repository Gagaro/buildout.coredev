Repository: plone.protect


Branch: refs/heads/master
Date: 2015-10-27T15:55:22+01:00
Author: Gil Forcada Codinachs (gforcada) <gil.forcada@freitag.de>
Commit: https://github.com/plone/plone.protect/commit/6348b574d7875b577c42c17316147d8c53c314c8

Do not parse empty responses

Usually they are due to redirects.

Files changed:
M plone/protect/auto.py

diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 393b724..d51f33a 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -31,6 +31,7 @@
 from zope.component import adapts
 from zope.component import getUtility
 from zope.interface import implements, Interface
+from zope.globalrequest import getRequest
 
 try:
     from zope.component.hooks import getSite
@@ -66,6 +67,11 @@ def __init__(self, published, request):
         self.request = request
 
     def parseTree(self, result, encoding):
+        # if it's a redirect, the result is empty
+        request = getRequest()
+        if request.response.status in (301, 302):
+            return result
+
         if isinstance(result, XMLSerializer):
             return result
 


Repository: plone.protect


Branch: refs/heads/master
Date: 2015-10-27T15:56:25+01:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/plone.protect/commit/d97680bfc3f52628b7f2d3fb1ccc192a84739de7

Update CHANGES.rst

Files changed:
M CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 0dd4502..cc6a646 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Changelog
   manually.
   [alecm]
 
+- Avoid parsing redirect responses (this avoids a warning on the log files).
+  [gforcada]
+
 3.0.14 (2015-10-08)
 -------------------
 


Repository: plone.protect


Branch: refs/heads/master
Date: 2015-10-27T15:56:32+01:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/plone.protect/commit/e7d7493051fab72f163f9617540299c4e444c243

Merge branch 'gforcada-patch-1'

Files changed:
M CHANGES.rst
M plone/protect/auto.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0dd4502..cc6a646 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -17,6 +17,9 @@ Changelog
   manually.
   [alecm]
 
+- Avoid parsing redirect responses (this avoids a warning on the log files).
+  [gforcada]
+
 3.0.14 (2015-10-08)
 -------------------
 
diff --git a/plone/protect/auto.py b/plone/protect/auto.py
index 393b724..d51f33a 100644
--- a/plone/protect/auto.py
+++ b/plone/protect/auto.py
@@ -31,6 +31,7 @@
 from zope.component import adapts
 from zope.component import getUtility
 from zope.interface import implements, Interface
+from zope.globalrequest import getRequest
 
 try:
     from zope.component.hooks import getSite
@@ -66,6 +67,11 @@ def __init__(self, published, request):
         self.request = request
 
     def parseTree(self, result, encoding):
+        # if it's a redirect, the result is empty
+        request = getRequest()
+        if request.response.status in (301, 302):
+            return result
+
         if isinstance(result, XMLSerializer):
             return result
 


