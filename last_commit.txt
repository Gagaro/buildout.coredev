Repository: mockup
Branch: refs/heads/master
Date: 2015-05-22T16:43:11-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/6c4fa14322e81f5eb0d2bf2b8f10da5babfde58a

fix weird issue with selecting multiple links and images on a page
  while you are editing

Files changed:
M CHANGES.rst
M mockup/patterns/tinymce/js/links.js
M mockup/patterns/tinymce/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 77b470d..b4414da 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.0.4 (Unreleased)
 ------------------
 
+- fix weird issue with selecting multiple links and images on a page
+  while you are editing
+  [vangheem]
+
 - Update to jQuery 1.11.3 and moment 2.10.3.
   [thet]
 
diff --git a/mockup/patterns/tinymce/js/links.js b/mockup/patterns/tinymce/js/links.js
index 95a1e41..52c94fa 100644
--- a/mockup/patterns/tinymce/js/links.js
+++ b/mockup/patterns/tinymce/js/links.js
@@ -530,7 +530,7 @@ define([
       // upload init
       if(self.options.upload){
         self.$upload = $('.uploadify-me', self.modal.$modal);
-        self.options.upload.relatedItems = self.options.relatedItems;
+        self.options.upload.relatedItems = $.extend(true, {}, self.options.relatedItems);
         self.options.upload.relatedItems.selectableTypes = self.options.folderTypes;
         self.$upload.addClass('pat-upload').patternUpload(self.options.upload);
         self.$upload.on('uploadAllCompleted', function(evt, data) {
diff --git a/mockup/patterns/tinymce/pattern.js b/mockup/patterns/tinymce/pattern.js
index c4bc4cf..3bb6575 100644
--- a/mockup/patterns/tinymce/pattern.js
+++ b/mockup/patterns/tinymce/pattern.js
@@ -277,10 +277,10 @@ define([
     generateImageUrl: function(data, scale_name) {
       var self = this;
       var url = self.generateUrl(data);
-      if (scale_name !== ""){
+      if (scale_name !== ''){
         var part = scale_name;
-        for(var i=0; i<self.options.scales.length; i++){
-          if(self.options.scales[i].name == scale_name){
+        for(var i=0; i<self.options.scales.length; i=i+1){
+          if(self.options.scales[i].name === scale_name){
             part = self.options.scales[i].part;
           }
         }


