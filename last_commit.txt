Repository: plone.app.dexterity


Branch: refs/heads/2.0.x
Date: 2015-08-13T17:52:53+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/a471115af001563702bdbb639438aeb282cd598e

Avoid DeprecationWarning: splitSchemaName: moved to plone.dexterity.schema.

Files changed:
M plone/app/dexterity/serialize.py

diff --git a/plone/app/dexterity/serialize.py b/plone/app/dexterity/serialize.py
index b2070e3..36ebf3b 100644
--- a/plone/app/dexterity/serialize.py
+++ b/plone/app/dexterity/serialize.py
@@ -2,7 +2,7 @@
 from plone.supermodel.utils import syncSchema
 from plone.supermodel import serializeModel
 from plone.dexterity.interfaces import IDexterityFTI
-from plone.dexterity.utils import splitSchemaName
+from plone.dexterity.schema import splitSchemaName
 
 
 def serializeSchemaContext(schema_context, event=None):


Repository: plone.app.dexterity


Branch: refs/heads/2.0.x
Date: 2015-08-14T02:42:30+02:00
Author: Maurits van Rees (mauritsvanrees) <maurits@vanrees.org>
Commit: https://github.com/plone/plone.app.dexterity/commit/f79c434b6d9292216b2751d05d29364f27a7b9a3

Avoid DeprecationWarning for getIcon.

Files changed:
M CHANGES.rst
M plone/app/dexterity/browser/types_listing_row.pt
M plone/app/dexterity/tests/editing.txt

diff --git a/CHANGES.rst b/CHANGES.rst
index a4e7bdf..c866a4a 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.15 (unreleased)
 -------------------
 
+- Avoid DeprecationWarning for getIcon.
+  [maurits]
+
 - Remove superfluous ``for`` in behaviors zcml w/o factory. No more warnings
   logged by ``plone.behavior``.  See also plone/plone.behavior#2.
   [jensens]
diff --git a/plone/app/dexterity/browser/types_listing_row.pt b/plone/app/dexterity/browser/types_listing_row.pt
index af469b4..54d1666 100644
--- a/plone/app/dexterity/browser/types_listing_row.pt
+++ b/plone/app/dexterity/browser/types_listing_row.pt
@@ -1,4 +1,7 @@
 <tal:block define="tups view/getCombinedWidgets;
+                   portal context/@@plone_portal_state/portal;
+                   layout portal/@@plone_layout;
+                   getIcon python:layout.getIcon;
                    niceTitles view/getNiceTitles"
            repeat="tup tups">
 
@@ -9,10 +12,9 @@
 
     <img
        tal:define="fti view/getContent;
-                   icon fti/getIcon;
-                   portal_url context/context/context/portal_url"
+                   icon python:getIcon(fti);"
        tal:condition="python:icon and idx == 1"
-       tal:attributes="src string:${portal_url}/${icon};"
+       tal:attributes="src icon/url"
        width="16"
        height="16"
        />
diff --git a/plone/app/dexterity/tests/editing.txt b/plone/app/dexterity/tests/editing.txt
index 3856eb6..eaa3b09 100644
--- a/plone/app/dexterity/tests/editing.txt
+++ b/plone/app/dexterity/tests/editing.txt
@@ -55,7 +55,7 @@ The new type should have the dublin core behavior assigned by default::
   >>> plonista = portal.portal_types.plonista
   >>> 'plone.app.dexterity.behaviors.metadata.IDublinCore' in plonista.behaviors
   True
-  >>> 'document_icon' in plonista.getIcon()
+  >>> 'document_icon' in plonista.getIconExprObject().text
   True
 
 The listing needs to not break if a type description was stored encoded.


