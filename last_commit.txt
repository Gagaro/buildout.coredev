Repository: plone.formwidget.datetime


Branch: refs/heads/master
Date: 2015-10-12T17:01:10+02:00
Author: Elio Schmutz (elioschmutz) <e.schmutz@4teamwork.ch>
Commit: https://github.com/plone/plone.formwidget.datetime/commit/fa7baf412beaa2506a5eafc7ede443a8ba2a350a

Add defaultvalue for hour and minute for z3cform Datetime widget.

Files changed:
M CHANGES.rst
M plone/formwidget/datetime/tests/test_DatetimeWidget.py
M plone/formwidget/datetime/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 864b539..c138e95 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 1.2 (unreleased)
 ----------------
 
-- Nothing changed yet.
+- Add defaultvalue for hour and minute for z3cform Datetime widget.
+  Fixes: https://github.com/plone/plone.formwidget.datetime/issues/14
+  [elioschmutz]
 
 
 1.1 (2014-11-06)
diff --git a/plone/formwidget/datetime/tests/test_DatetimeWidget.py b/plone/formwidget/datetime/tests/test_DatetimeWidget.py
index 78ddc2c..b1b5538 100644
--- a/plone/formwidget/datetime/tests/test_DatetimeWidget.py
+++ b/plone/formwidget/datetime/tests/test_DatetimeWidget.py
@@ -128,3 +128,18 @@ def test_extract__default_in_without_error(self):
             len(instance.extract()),
             5
         )
+
+    def test_extract__no_time(self):
+        instance = self.createInstance()
+        instance.request = {
+            'field-day': '21',
+            'field-month': '11',
+            'field-year': '2011',
+            'field-hour': '',
+            'field-minute': '',
+        }
+        default = mock.Mock()
+        self.assertEqual(
+            instance.extract(default),
+            ('2011', '11', '21', '00', '00')
+        )
diff --git a/plone/formwidget/datetime/z3cform/widget.py b/plone/formwidget/datetime/z3cform/widget.py
index 92b1a33..0300440 100644
--- a/plone/formwidget/datetime/z3cform/widget.py
+++ b/plone/formwidget/datetime/z3cform/widget.py
@@ -76,8 +76,8 @@ def extract(self, default=NOVALUE):
         day = self.request.get(self.name + '-day', default)
         month = self.request.get(self.name + '-month', default)
         year = self.request.get(self.name + '-year', default)
-        hour = self.request.get(self.name + '-hour', default)
-        minute = self.request.get(self.name + '-minute', default)
+        hour = self.request.get(self.name + '-hour', default) or '00'
+        minute = self.request.get(self.name + '-minute', default) or '00'
         timezone = self.request.get(self.name + '-timezone', default)
 
         if (self.ampm is True


Repository: plone.formwidget.datetime


Branch: refs/heads/master
Date: 2015-10-27T17:58:44+01:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.formwidget.datetime/commit/3d50dccbb414cfdaa69b52e184399e0fb3d49611

Merge pull request #15 from elioschmutz/fix-z3cform-widget-without-time

Add defaultvalue for hour and minute for z3cform Datetime widget.

Files changed:
M CHANGES.rst
M plone/formwidget/datetime/tests/test_DatetimeWidget.py
M plone/formwidget/datetime/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 864b539..c138e95 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 1.2 (unreleased)
 ----------------
 
-- Nothing changed yet.
+- Add defaultvalue for hour and minute for z3cform Datetime widget.
+  Fixes: https://github.com/plone/plone.formwidget.datetime/issues/14
+  [elioschmutz]
 
 
 1.1 (2014-11-06)
diff --git a/plone/formwidget/datetime/tests/test_DatetimeWidget.py b/plone/formwidget/datetime/tests/test_DatetimeWidget.py
index 78ddc2c..b1b5538 100644
--- a/plone/formwidget/datetime/tests/test_DatetimeWidget.py
+++ b/plone/formwidget/datetime/tests/test_DatetimeWidget.py
@@ -128,3 +128,18 @@ def test_extract__default_in_without_error(self):
             len(instance.extract()),
             5
         )
+
+    def test_extract__no_time(self):
+        instance = self.createInstance()
+        instance.request = {
+            'field-day': '21',
+            'field-month': '11',
+            'field-year': '2011',
+            'field-hour': '',
+            'field-minute': '',
+        }
+        default = mock.Mock()
+        self.assertEqual(
+            instance.extract(default),
+            ('2011', '11', '21', '00', '00')
+        )
diff --git a/plone/formwidget/datetime/z3cform/widget.py b/plone/formwidget/datetime/z3cform/widget.py
index 92b1a33..0300440 100644
--- a/plone/formwidget/datetime/z3cform/widget.py
+++ b/plone/formwidget/datetime/z3cform/widget.py
@@ -76,8 +76,8 @@ def extract(self, default=NOVALUE):
         day = self.request.get(self.name + '-day', default)
         month = self.request.get(self.name + '-month', default)
         year = self.request.get(self.name + '-year', default)
-        hour = self.request.get(self.name + '-hour', default)
-        minute = self.request.get(self.name + '-minute', default)
+        hour = self.request.get(self.name + '-hour', default) or '00'
+        minute = self.request.get(self.name + '-minute', default) or '00'
         timezone = self.request.get(self.name + '-timezone', default)
 
         if (self.ampm is True


