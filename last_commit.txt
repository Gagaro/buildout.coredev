Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2015-07-07T16:27:27+02:00
Author: Tom Gross (tomgross) <itconsense@gmail.com>
Commit: https://github.com/plone/Products.ATContentTypes/commit/f9be352da6121a512869b36d0625078f61932de4

createObject moved to Archetpyes

Files changed:
D Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
D Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata

diff --git a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
deleted file mode 100644
index 8de0040..0000000
--- a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
+++ /dev/null
@@ -1,66 +0,0 @@
-## Controller Python Script "createObject"
-##bind container=container
-##bind context=context
-##bind namespace=
-##bind script=script
-##bind state=state
-##bind subpath=traverse_subpath
-##parameters=id=None,type_name=None,script_id=None
-##title=
-
-from Products.CMFPlone.utils import transaction_note
-from Products.CMFPlone import PloneMessageFactory as _
-from Products.CMFCore.utils import getToolByName
-
-REQUEST = context.REQUEST
-response = REQUEST.response
-response.setHeader('Expires', 'Sat, 01 Jan 2000 00:00:00 GMT')
-response.setHeader('Cache-Control', 'no-cache')
-
-authenticator = context.restrictedTraverse("@@authenticator")
-
-if id is None:
-    id = context.generateUniqueId(type_name)
-else:
-    id = id.replace('$', '$$')
-
-if type_name is None:
-    raise Exception('Type name not specified')
-
-types_tool = getToolByName(context, 'portal_types')
-
-fti = types_tool.getTypeInfo(type_name)
-if fti is None:
-    raise KeyError("Type name not found: %s." % type_name)
-
-if not fti.queryMethodID('edit'):
-    state.setStatus('success_no_edit')
-
-if type_name in context.portal_factory.getFactoryTypes():
-    new_url = 'portal_factory/' + type_name + '/' + id
-    if state.getStatus() != 'success_no_edit':
-        new_url = new_url + '/edit?_authenticator='  + authenticator.token()
-    state.set(status='factory', next_action='redirect_to:string:%s' % new_url)
-    # If there's an issue with object creation, let the factory handle it
-    return state
-else:
-    new_id = context.invokeFactory(id=id, type_name=type_name)
-    if new_id is None or new_id == '':
-        new_id = id
-    o = getattr(context, new_id, None)
-    tname = o.getTypeInfo().Title()
-    message = _(u'${tname} has been created.', mapping={u'tname': tname})
-    transaction_note('Created %s with id %s in %s' % (
-                        o.getTypeInfo().getId(),
-                        new_id,
-                        context.absolute_url()))
-
-if o is None:
-    raise Exception
-
-if script_id:
-    state.setId(script_id)
-
-if message:
-    context.plone_utils.addPortalMessage(message)
-return state.set(context=o)
diff --git a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata
deleted file mode 100644
index 4a42d8d..0000000
--- a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata
+++ /dev/null
@@ -1,5 +0,0 @@
-[actions]
-action.success=redirect_to_action:string:edit
-action.success_no_edit=redirect_to_action:string:view
-action.success_workspaces=redirect_to_action:string:edit
-action.success_workspaces_no_edit=redirect_to_action:string:view


Repository: Products.ATContentTypes


Branch: refs/heads/master
Date: 2015-07-13T15:41:54+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/Products.ATContentTypes/commit/9aa3cfe147fd3743df1ccbb5eac78ba422fd087e

Merge pull request #21 from plone/tomgross-nocreateobject

createObject moved to Archetpyes

Files changed:
D Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
D Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata

diff --git a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
deleted file mode 100644
index 8de0040..0000000
--- a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy
+++ /dev/null
@@ -1,66 +0,0 @@
-## Controller Python Script "createObject"
-##bind container=container
-##bind context=context
-##bind namespace=
-##bind script=script
-##bind state=state
-##bind subpath=traverse_subpath
-##parameters=id=None,type_name=None,script_id=None
-##title=
-
-from Products.CMFPlone.utils import transaction_note
-from Products.CMFPlone import PloneMessageFactory as _
-from Products.CMFCore.utils import getToolByName
-
-REQUEST = context.REQUEST
-response = REQUEST.response
-response.setHeader('Expires', 'Sat, 01 Jan 2000 00:00:00 GMT')
-response.setHeader('Cache-Control', 'no-cache')
-
-authenticator = context.restrictedTraverse("@@authenticator")
-
-if id is None:
-    id = context.generateUniqueId(type_name)
-else:
-    id = id.replace('$', '$$')
-
-if type_name is None:
-    raise Exception('Type name not specified')
-
-types_tool = getToolByName(context, 'portal_types')
-
-fti = types_tool.getTypeInfo(type_name)
-if fti is None:
-    raise KeyError("Type name not found: %s." % type_name)
-
-if not fti.queryMethodID('edit'):
-    state.setStatus('success_no_edit')
-
-if type_name in context.portal_factory.getFactoryTypes():
-    new_url = 'portal_factory/' + type_name + '/' + id
-    if state.getStatus() != 'success_no_edit':
-        new_url = new_url + '/edit?_authenticator='  + authenticator.token()
-    state.set(status='factory', next_action='redirect_to:string:%s' % new_url)
-    # If there's an issue with object creation, let the factory handle it
-    return state
-else:
-    new_id = context.invokeFactory(id=id, type_name=type_name)
-    if new_id is None or new_id == '':
-        new_id = id
-    o = getattr(context, new_id, None)
-    tname = o.getTypeInfo().Title()
-    message = _(u'${tname} has been created.', mapping={u'tname': tname})
-    transaction_note('Created %s with id %s in %s' % (
-                        o.getTypeInfo().getId(),
-                        new_id,
-                        context.absolute_url()))
-
-if o is None:
-    raise Exception
-
-if script_id:
-    state.setId(script_id)
-
-if message:
-    context.plone_utils.addPortalMessage(message)
-return state.set(context=o)
diff --git a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata b/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata
deleted file mode 100644
index 4a42d8d..0000000
--- a/Products/ATContentTypes/skins/ATContentTypes/createObject.cpy.metadata
+++ /dev/null
@@ -1,5 +0,0 @@
-[actions]
-action.success=redirect_to_action:string:edit
-action.success_no_edit=redirect_to_action:string:view
-action.success_workspaces=redirect_to_action:string:edit
-action.success_workspaces_no_edit=redirect_to_action:string:view


