Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-08-20T10:40:39-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/a7f44ee5a81b7bacd06ac302fb21dcb668265a21

Added cache invalidation option

Files changed:
M src/plone/app/theming/browser/controlpanel.pt
M src/plone/app/theming/browser/controlpanel.py

diff --git a/src/plone/app/theming/browser/controlpanel.pt b/src/plone/app/theming/browser/controlpanel.pt
index 261abf0..70b3a5b 100644
--- a/src/plone/app/theming/browser/controlpanel.pt
+++ b/src/plone/app/theming/browser/controlpanel.pt
@@ -169,6 +169,12 @@
                                     class="plone-btn plone-btn-default"
                                     type="submit"
                                     name="form.button.Disable">Deactivate</button>
+                                <button
+                                    tal:condition="theme/selected"
+                                    i18n:translate=""
+                                    class="plone-btn plone-btn-default"
+                                    type="submit"
+                                    name="form.button.InvalidateCache">Clear Cache</button>
                             </form>
 
                             <a href="#" class="plone-btn plone-btn-default pat-plone-modal"
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index 6546558..2918e37 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -11,6 +11,7 @@
 from plone.app.theming.interfaces import _
 from plone.app.theming.plugins.utils import getPluginSettings
 from plone.app.theming.plugins.utils import getPlugins
+from plone.app.theming.utils import theming_policy
 from plone.app.theming.utils import applyTheme
 from plone.app.theming.utils import createThemeFromTemplate
 from plone.app.theming.utils import extractThemeInfo
@@ -147,6 +148,12 @@ def update(self):
             self._setup()
             return True
 
+        if 'form.button.InvalidateCache' in form:
+            self.authorize()
+            policy = theming_policy()
+            policy.invalidateCache()
+            return True
+
         if 'form.button.Disable' in form:
             self.authorize()
 


Repository: plone.app.theming


Branch: refs/heads/master
Date: 2015-08-20T10:49:33-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.theming/commit/300fd62624ade972396f258d5a1a9b148177c5e1

Merge pull request #75 from plone/cacheclear

Added cache invalidation option

Files changed:
M src/plone/app/theming/browser/controlpanel.pt
M src/plone/app/theming/browser/controlpanel.py

diff --git a/src/plone/app/theming/browser/controlpanel.pt b/src/plone/app/theming/browser/controlpanel.pt
index 261abf0..70b3a5b 100644
--- a/src/plone/app/theming/browser/controlpanel.pt
+++ b/src/plone/app/theming/browser/controlpanel.pt
@@ -169,6 +169,12 @@
                                     class="plone-btn plone-btn-default"
                                     type="submit"
                                     name="form.button.Disable">Deactivate</button>
+                                <button
+                                    tal:condition="theme/selected"
+                                    i18n:translate=""
+                                    class="plone-btn plone-btn-default"
+                                    type="submit"
+                                    name="form.button.InvalidateCache">Clear Cache</button>
                             </form>
 
                             <a href="#" class="plone-btn plone-btn-default pat-plone-modal"
diff --git a/src/plone/app/theming/browser/controlpanel.py b/src/plone/app/theming/browser/controlpanel.py
index 6546558..2918e37 100644
--- a/src/plone/app/theming/browser/controlpanel.py
+++ b/src/plone/app/theming/browser/controlpanel.py
@@ -11,6 +11,7 @@
 from plone.app.theming.interfaces import _
 from plone.app.theming.plugins.utils import getPluginSettings
 from plone.app.theming.plugins.utils import getPlugins
+from plone.app.theming.utils import theming_policy
 from plone.app.theming.utils import applyTheme
 from plone.app.theming.utils import createThemeFromTemplate
 from plone.app.theming.utils import extractThemeInfo
@@ -147,6 +148,12 @@ def update(self):
             self._setup()
             return True
 
+        if 'form.button.InvalidateCache' in form:
+            self.authorize()
+            policy = theming_policy()
+            policy.invalidateCache()
+            return True
+
         if 'form.button.Disable' in form:
             self.authorize()
 


