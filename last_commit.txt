Repository: plone.namedfile


Branch: refs/heads/master
Date: 2015-10-14T15:44:00+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.namedfile/commit/09f91853a25c801b483301821246d09e4e83d126

No longer rely on deprecated bobobase_modification_time from Persistence.Persistent.

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c7dcf18..71e561d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 3.0.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- No longer rely on deprecated ``bobobase_modification_time`` from
+  ``Persistence.Persistent``.
+  [thet]
 
 
 3.0.3 (2015-08-14)
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index 63d2b59..4311516 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -1,5 +1,6 @@
 from Acquisition import aq_base
 from AccessControl.ZopeGuards import guarded_getattr
+from DateTime import DateTime
 from logging import exception
 from plone.namedfile.interfaces import IAvailableSizes
 from plone.namedfile.interfaces import IStableImageScale
@@ -17,7 +18,6 @@
 from zope.publisher.interfaces import IPublishTraverse, NotFound
 from zope.app.file.file import FileChunk
 from plone.protect.interfaces import IDisableCSRFProtection
-from zope.interface import alsoProvides
 
 _marker = object()
 
@@ -282,7 +282,7 @@ def modified(self):
             if hasattr(context, 'modified') and callable(context.modified):
                 date = context.modified()
             else:
-                date = context.bobobase_modification_time()
+                date = DateTime(context._p_mtime)
         except AttributeError:
             date = self.context.modified().millis()
         return date.millis()


Repository: plone.namedfile


Branch: refs/heads/master
Date: 2015-10-15T12:35:53+03:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.namedfile/commit/02ff23e7a481002f0088f4898338cdb6b9236ae4

Merge pull request #15 from plone/thet-nobobomodification

Remove bobobase_modification_time

Files changed:
M CHANGES.rst
M plone/namedfile/scaling.py

diff --git a/CHANGES.rst b/CHANGES.rst
index c7dcf18..71e561d 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,9 @@ Changelog
 3.0.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- No longer rely on deprecated ``bobobase_modification_time`` from
+  ``Persistence.Persistent``.
+  [thet]
 
 
 3.0.3 (2015-08-14)
diff --git a/plone/namedfile/scaling.py b/plone/namedfile/scaling.py
index 63d2b59..4311516 100644
--- a/plone/namedfile/scaling.py
+++ b/plone/namedfile/scaling.py
@@ -1,5 +1,6 @@
 from Acquisition import aq_base
 from AccessControl.ZopeGuards import guarded_getattr
+from DateTime import DateTime
 from logging import exception
 from plone.namedfile.interfaces import IAvailableSizes
 from plone.namedfile.interfaces import IStableImageScale
@@ -17,7 +18,6 @@
 from zope.publisher.interfaces import IPublishTraverse, NotFound
 from zope.app.file.file import FileChunk
 from plone.protect.interfaces import IDisableCSRFProtection
-from zope.interface import alsoProvides
 
 _marker = object()
 
@@ -282,7 +282,7 @@ def modified(self):
             if hasattr(context, 'modified') and callable(context.modified):
                 date = context.modified()
             else:
-                date = context.bobobase_modification_time()
+                date = DateTime(context._p_mtime)
         except AttributeError:
             date = self.context.modified().millis()
         return date.millis()


