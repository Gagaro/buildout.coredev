Repository: plone.app.textfield
Branch: refs/heads/master
Date: 2015-01-22T18:01:44+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/plone.app.textfield/commit/2a9117a9577d7e6b10319260a3cb73010c06d97d

Revert "Fix marshaler decode to always set raw value as unicode"

Files changed:
M docs/HISTORY.rst
M plone/app/textfield/marshaler.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index 4fae0b8..7da4a34 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -4,20 +4,6 @@ Changelog
 1.2.5 (unreleased)
 ------------------
 
-- Fix marshaler decode to always decode raw value into unicode
-  [datakurre]
-
-- Remove utils.getSiteEncoding, which was deprecated and not used anywhere.
-  [thet]
-
-- For Plone 5, support getting markup control panel settings from the registry,
-  while still supporting normal portal_properties access for Plone < 5.
-  [thet]
-
-- Resolved an interesting circular import case, which wasnt effective because
-  of sort order of imports
-  [thet]
-
 - For Plone 5, support getting markup control panel settings from the registry,
   while still supporting normal portal_properties access for Plone < 5.
   [thet]
diff --git a/plone/app/textfield/marshaler.py b/plone/app/textfield/marshaler.py
index baf0bdb..482647e 100644
--- a/plone/app/textfield/marshaler.py
+++ b/plone/app/textfield/marshaler.py
@@ -32,12 +32,8 @@ def decode(
                 charset='utf-8',
                 contentType=None,
                 primary=False):
-            try:
-                unicode_value = value.decode(charset)
-            except UnicodeEncodeError:
-                unicode_value = value  # was already unicode
             return RichTextValue(
-                raw=unicode_value,
+                raw=value,
                 mimeType=contentType or self.field.default_mime_type,
                 outputMimeType=self.field.output_mime_type,
                 encoding=charset


Repository: plone.app.textfield
Branch: refs/heads/master
Date: 2015-01-22T18:01:54+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/plone.app.textfield/commit/23bc04dde24be84b7e733593007c244880a06073

Merge pull request #14 from plone/revert-13-datakurre-fix-decode

Revert "Fix marshaler decode to always set raw value as unicode"

Files changed:
M docs/HISTORY.rst
M plone/app/textfield/marshaler.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index 4fae0b8..7da4a34 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -4,20 +4,6 @@ Changelog
 1.2.5 (unreleased)
 ------------------
 
-- Fix marshaler decode to always decode raw value into unicode
-  [datakurre]
-
-- Remove utils.getSiteEncoding, which was deprecated and not used anywhere.
-  [thet]
-
-- For Plone 5, support getting markup control panel settings from the registry,
-  while still supporting normal portal_properties access for Plone < 5.
-  [thet]
-
-- Resolved an interesting circular import case, which wasnt effective because
-  of sort order of imports
-  [thet]
-
 - For Plone 5, support getting markup control panel settings from the registry,
   while still supporting normal portal_properties access for Plone < 5.
   [thet]
diff --git a/plone/app/textfield/marshaler.py b/plone/app/textfield/marshaler.py
index baf0bdb..482647e 100644
--- a/plone/app/textfield/marshaler.py
+++ b/plone/app/textfield/marshaler.py
@@ -32,12 +32,8 @@ def decode(
                 charset='utf-8',
                 contentType=None,
                 primary=False):
-            try:
-                unicode_value = value.decode(charset)
-            except UnicodeEncodeError:
-                unicode_value = value  # was already unicode
             return RichTextValue(
-                raw=unicode_value,
+                raw=value,
                 mimeType=contentType or self.field.default_mime_type,
                 outputMimeType=self.field.output_mime_type,
                 encoding=charset


