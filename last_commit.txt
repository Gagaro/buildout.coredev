Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2015-09-17T11:45:27+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/8365d9f9253c781b472830421369bfe06382b69a

Allow time options to be customized for DatetimeWidget.

Files changed:
M CHANGES.rst
M plone/app/z3cform/tests/test_widgets.py
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3317cde..f97ec80 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.1.5 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Allow time options to be customized for DatetimeWidget.
+  [thet]
 
 
 1.1.4 (2015-09-16)
diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index 18b4e68..223ded4 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -178,7 +178,10 @@ def setUp(self):
         self.request = TestRequest(environ={'HTTP_ACCEPT_LANGUAGE': 'en'})
         self.field = Datetime(__name__='datetimefield')
         self.widget = DatetimeWidget(self.request)
-        self.widget.pattern_options = {'date': {'firstDay': 0}}
+        self.widget.pattern_options = {
+            'date': {'firstDay': 0},
+            'time': {'interval': 15}
+        }
 
     def test_widget(self):
         current_year = datetime.today().year
@@ -213,7 +216,8 @@ def test_widget(self):
                     'time': {
                         'placeholder': u'Enter time...',
                         'today': u'Today',
-                        'format': 'h:i a'
+                        'format': 'h:i a',
+                        'interval': 15
                     }
                 }
             },
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 6c240d9..cc4c8af 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -183,7 +183,11 @@ def _base_args(self):
 
         args.setdefault('pattern_options', {})
         if 'time' in args['pattern_options']:
+            # Time gets set in parent class to false. Remove.
             del args['pattern_options']['time']
+        if 'time' in self.pattern_options:
+            # Re-apply custom set time options.
+            args['pattern_options']['time'] = self.pattern_options['time']
         args['pattern_options'] = dict_merge(
             get_datetime_options(self.request),
             args['pattern_options'])


Repository: plone.app.z3cform


Branch: refs/heads/master
Date: 2015-09-17T18:18:25+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.z3cform/commit/77d9868ba16311c3c4c0c6e5e952b04d63793eae

Merge pull request #24 from plone/thet-customize-time

Allow time options to be customized for DatetimeWidget.

Files changed:
M CHANGES.rst
M plone/app/z3cform/tests/test_widgets.py
M plone/app/z3cform/widget.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 3317cde..f97ec80 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.1.5 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Allow time options to be customized for DatetimeWidget.
+  [thet]
 
 
 1.1.4 (2015-09-16)
diff --git a/plone/app/z3cform/tests/test_widgets.py b/plone/app/z3cform/tests/test_widgets.py
index 18b4e68..223ded4 100644
--- a/plone/app/z3cform/tests/test_widgets.py
+++ b/plone/app/z3cform/tests/test_widgets.py
@@ -178,7 +178,10 @@ def setUp(self):
         self.request = TestRequest(environ={'HTTP_ACCEPT_LANGUAGE': 'en'})
         self.field = Datetime(__name__='datetimefield')
         self.widget = DatetimeWidget(self.request)
-        self.widget.pattern_options = {'date': {'firstDay': 0}}
+        self.widget.pattern_options = {
+            'date': {'firstDay': 0},
+            'time': {'interval': 15}
+        }
 
     def test_widget(self):
         current_year = datetime.today().year
@@ -213,7 +216,8 @@ def test_widget(self):
                     'time': {
                         'placeholder': u'Enter time...',
                         'today': u'Today',
-                        'format': 'h:i a'
+                        'format': 'h:i a',
+                        'interval': 15
                     }
                 }
             },
diff --git a/plone/app/z3cform/widget.py b/plone/app/z3cform/widget.py
index 6c240d9..cc4c8af 100644
--- a/plone/app/z3cform/widget.py
+++ b/plone/app/z3cform/widget.py
@@ -183,7 +183,11 @@ def _base_args(self):
 
         args.setdefault('pattern_options', {})
         if 'time' in args['pattern_options']:
+            # Time gets set in parent class to false. Remove.
             del args['pattern_options']['time']
+        if 'time' in self.pattern_options:
+            # Re-apply custom set time options.
+            args['pattern_options']['time'] = self.pattern_options['time']
         args['pattern_options'] = dict_merge(
             get_datetime_options(self.request),
             args['pattern_options'])


