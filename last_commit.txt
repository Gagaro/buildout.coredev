Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-02-09T09:34:38-06:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/ce7c5c4dcdeee37655c603613739656822345904

on registry settings save, make sure to reset last import time

Files changed:
M Products/CMFPlone/controlpanel/browser/resourceregistry.py

diff --git a/Products/CMFPlone/controlpanel/browser/resourceregistry.py b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
index ff4937c..0383094 100644
--- a/Products/CMFPlone/controlpanel/browser/resourceregistry.py
+++ b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
@@ -150,6 +150,11 @@ def save_registry(self):
             IBundleRegistry, "plone.bundles",
             json.loads(req.get('bundles')))
 
+        # it'd be difficult to know if the legacy bundle settings
+        # changed or not so we need to just set the last import date
+        # back so it gets re-built
+        self.registry.records['plone.resources.last_legacy_import'].value = datetime.now()
+
         return json.dumps({
             'success': True
         })


