Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-08-19T09:24:23+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/6296fe75e95c5341fac06aa7bbaaf6c26177982d

pep8

Files changed:
M plone/__init__.py
M plone/app/__init__.py
M plone/app/contenttypes/browser/full_view.py
M plone/app/contenttypes/indexers.py
M plone/app/contenttypes/migration/utils.py
M plone/app/contenttypes/tests/test_migration.py
M plone/app/contenttypes/tests/test_migration_custom.py

diff --git a/plone/__init__.py b/plone/__init__.py
index b31d1bd..076cb05 100644
--- a/plone/__init__.py
+++ b/plone/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
 try:
     __import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/app/__init__.py b/plone/app/__init__.py
index b31d1bd..076cb05 100644
--- a/plone/app/__init__.py
+++ b/plone/app/__init__.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 # See http://peak.telecommunity.com/DevCenter/setuptools#namespace-packages
 try:
     __import__('pkg_resources').declare_namespace(__name__)
diff --git a/plone/app/contenttypes/browser/full_view.py b/plone/app/contenttypes/browser/full_view.py
index 58201f7..46f9741 100644
--- a/plone/app/contenttypes/browser/full_view.py
+++ b/plone/app/contenttypes/browser/full_view.py
@@ -1,3 +1,4 @@
+# -*- coding: utf-8 -*-
 from Products.Five.browser import BrowserView
 from Products.CMFCore.utils import getToolByName
 from zope.publisher.interfaces.browser import IBrowserView
diff --git a/plone/app/contenttypes/indexers.py b/plone/app/contenttypes/indexers.py
index c5a1b9f..568a182 100644
--- a/plone/app/contenttypes/indexers.py
+++ b/plone/app/contenttypes/indexers.py
@@ -75,9 +75,10 @@ def SearchableText_file(obj):
                                            transformed_value.getData())
     except (ConflictError, KeyboardInterrupt):
         raise
-    except:
+    except Exception, msg:
         logger.exception('exception while trying to convert '
-                         'blob contents to "text/plain" for %r', obj)
+                         'blob contents to "text/plain" for %r. Error: %s',
+                         (obj, str(msg)))
         return SearchableText(obj)
 
 
diff --git a/plone/app/contenttypes/migration/utils.py b/plone/app/contenttypes/migration/utils.py
index 686a4d4..22abb17 100644
--- a/plone/app/contenttypes/migration/utils.py
+++ b/plone/app/contenttypes/migration/utils.py
@@ -1,6 +1,5 @@
 # -*- coding: utf-8 -*-
 from Acquisition import aq_base
-from Acquisition import aq_inner
 from Products.Archetypes.config import REFERENCE_CATALOG
 from Products.Archetypes.interfaces.referenceable import IReferenceable
 from Products.CMFCore.utils import getToolByName
@@ -322,7 +321,7 @@ def restore_references(context):
     del IAnnotations(context)[key]
 
 
-def link_items(
+def link_items(  # noqa
     context,
     source_obj,
     target_obj,
diff --git a/plone/app/contenttypes/tests/test_migration.py b/plone/app/contenttypes/tests/test_migration.py
index 90476dc..20e41fd 100644
--- a/plone/app/contenttypes/tests/test_migration.py
+++ b/plone/app/contenttypes/tests/test_migration.py
@@ -1,7 +1,5 @@
 # -*- coding: utf-8 -*-
-from Acquisition import aq_base
 from Products.CMFCore.utils import getToolByName
-from Products.CMFPlone.utils import safe_hasattr
 from five.intid.intid import IntIds
 from five.intid.site import addUtility
 from lxml import etree
@@ -1817,7 +1815,6 @@ def test_default_pages_are_kept_during_migration(self):
         at_folder = self.portal['folder']
 
         at_folder.invokeFactory('Document', 'subdocument')
-        at_subdocument = at_folder['subdocument']
 
         self.portal.setLayout('folder_summary_view')
         self.portal.setDefaultPage('document')
@@ -1828,7 +1825,6 @@ def test_default_pages_are_kept_during_migration(self):
         self.portal.invokeFactory('Folder', 'folder2')
         at_folder2 = self.portal['folder2']
         at_folder2.invokeFactory('Document', 'subdocument2')
-        at_subdocument2 = at_folder2['subdocument2']
         at_folder2.setLayout('folder_listing')
 
         # migrate content
@@ -1838,7 +1834,7 @@ def test_default_pages_are_kept_during_migration(self):
             (self.portal, self.request),
             name=u'migrate_from_atct'
         )
-        results = migration_view(from_form=True)
+        migration_view(from_form=True)
         dx_folder = self.portal['folder']
         dx_folder2 = self.portal['folder2']
 
@@ -2081,8 +2077,6 @@ def test_atct_migration_form(self):
         # add some at content:
         self.portal.invokeFactory('Document', 'doc1')
         transaction.commit()
-        qi = self.portal.portal_quickinstaller
-        portal_types = self.portal.portal_types
         from zExceptions import NotFound
         self.assertRaises(NotFound, self.browser.open, '%s/@@atct_migrator' % self.portal_url)  # noqa
         self.browser.open('%s/@@pac_installer' % self.portal_url)
diff --git a/plone/app/contenttypes/tests/test_migration_custom.py b/plone/app/contenttypes/tests/test_migration_custom.py
index b56c767..b4d0f31 100644
--- a/plone/app/contenttypes/tests/test_migration_custom.py
+++ b/plone/app/contenttypes/tests/test_migration_custom.py
@@ -13,7 +13,6 @@
 from plone.app.testing import SITE_OWNER_PASSWORD
 from plone.app.testing import TEST_USER_ID
 from plone.app.testing import applyProfile
-from plone.app.testing import applyProfile
 from plone.app.testing import login
 from plone.app.testing import setRoles
 from plone.testing.z2 import Browser


Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-08-19T09:26:36+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/35151fc8e5d920ff1196bc0e2242fb5946ff9ddd

no longer use buildout.plonetest

Files changed:
M buildout.cfg
M travis.cfg

diff --git a/buildout.cfg b/buildout.cfg
index 1fcde43..abd6853 100644
--- a/buildout.cfg
+++ b/buildout.cfg
@@ -1,6 +1,8 @@
 [buildout]
 extends = http://dist.plone.org/release/5.0-latest/versions.cfg
 extensions = mr.developer
+package-name = plone.app.contenttypes
+package-extras = [test]
 parts =
     instance
     test
@@ -8,8 +10,10 @@ parts =
     releaser
     i18ndude
     omelette
+    robot
     createcoverage
-
+eggs =
+test-eggs =
 develop = .
 
 
@@ -19,13 +23,17 @@ user = admin:admin
 http-address = 8080
 eggs =
     Plone
-    Pillow
-    plone.app.contenttypes [test]
+    plone.app.upgrade
+    ${buildout:package-name}
+    ${buildout:eggs}
+zcml =
+    ${buildout:package-name}
+environment-vars = zope_i18n_compile_mo_files true
 
 
 [code-analysis]
 recipe = plone.recipe.codeanalysis
-directory = ${buildout:directory}/src/plone
+directory = ${buildout:directory}/plone
 flake8-exclude = bootstrap.py,bootstrap-buildout.py,docs,*.egg.,omelette
 flake8-max-complexity = 15
 flake8-extensions =
@@ -41,8 +49,12 @@ eggs = ${instance:eggs}
 
 [test]
 recipe = zc.recipe.testrunner
-eggs = ${instance:eggs}
-defaults = ['-s', 'plone.app.contenttypes', '--auto-color', '--auto-progress']
+defaults = ['-s', '${buildout:package-name}', '--auto-color', '--auto-progress']
+eggs =
+    Plone
+    plone.app.upgrade
+    ${buildout:package-name} ${buildout:package-extras}
+    ${buildout:test-eggs}
 
 
 [robot]
diff --git a/travis.cfg b/travis.cfg
index b50e9e4..c067c00 100644
--- a/travis.cfg
+++ b/travis.cfg
@@ -1,12 +1,12 @@
 [buildout]
-extends =
-    https://raw.githubusercontent.com/collective/buildout.plonetest/master/test-5.0.x.cfg
-    buildout.cfg
-parts = test createcoverage code-analysis
+extends = buildout.cfg
+
+# caches, see also .travis.yaml
+# one should not depend on '/home/travis' but it seems stable in containers.
+eggs-directory = /home/travis/buildout-cache/eggs
+download-cache = /home/travis/buildout-cache/downloads
 
 [code-analysis]
+recipe = plone.recipe.codeanalysis
+pre-commit-hook = False
 return-status-codes = True
-
-[createcoverage]
-recipe = zc.recipe.egg
-eggs = createcoverage


