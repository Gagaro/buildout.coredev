Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-08-05T00:45:37+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/f6a0bf1f8b8e770a63aea106b5e5cc15ee517251

@@tinymce-controlpanel content_css attribute must be a list

Files changed:
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py
M Products/CMFPlone/patterns/__init__.py
M Products/CMFPlone/profiles/dependencies/registry.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index eab71eb..c78bd2b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -36,6 +36,11 @@ Changelog
 - Rework language selection in @@plone-addsite.
   [jaroel]
 
+- Turn @@tinymce-controlpanel ``content_css`` field into a list, so we can add
+  several CSS URLs (useful when add-ons need to provide extra TinyMCE styles),
+  and fix TinyMCE config getter so it considers the ``content_css`` value.
+  [ebrehault]
+
 
 5.0b3 (2015-07-20)
 ------------------
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index 3f13d1a..791cc2d 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -397,7 +397,7 @@ class ITinyMCELayoutSchema(Interface):
         default=None,
         required=False)
 
-    content_css = schema.TextLine(
+    content_css = schema.List(
         title=_(u"Choose the CSS used in WYSIWYG Editor Area"),
         description=_(u"This option enables you to specify a custom CSS file "
                       "that provides content CSS. "
@@ -405,7 +405,10 @@ class ITinyMCELayoutSchema(Interface):
                       "(the editable area). In addition to what is listed here, "
                       "the plone bundle CSS and diazo themes using the "
                       "tinymce-content-css setting are also added."),
-        default=u'++plone++static/components/tinymce/skins/lightgray/content.min.css',
+        value_type=schema.TextLine(),
+        default=[
+            u'++plone++static/components/tinymce/skins/lightgray/content.min.css',
+        ],
         required=False)
 
     header_styles = schema.List(
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index 404cc72..2f7f79f 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -34,6 +34,8 @@ def get_content_css(self):
             '%s/++plone++static/plone-compiled.css' % self.portal_url,
             '%s/++plone++static/tinymce-styles.css' % self.portal_url
         ]
+        for url in self.settings.content_css:
+            files.append('%s/%s' % (self.portal_url, url))
         theme = self.get_theme()
         if (theme and hasattr(theme, 'tinymce_content_css') and
                 theme.tinymce_content_css):
diff --git a/Products/CMFPlone/profiles/dependencies/registry.xml b/Products/CMFPlone/profiles/dependencies/registry.xml
index 6a15ec0..a66fd19 100644
--- a/Products/CMFPlone/profiles/dependencies/registry.xml
+++ b/Products/CMFPlone/profiles/dependencies/registry.xml
@@ -88,7 +88,9 @@
   <records interface="Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings" />
   <records interface="Products.CMFPlone.interfaces.ITinyMCESchema"
            prefix="plone">
-    <value key="content_css">++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</value>
+    <value key="content_css">
+      <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</element>
+    </value>
   </records>
   <record name="plone.resources.development">
     <field type="plone.registry.field.Bool">


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-08-05T00:53:47+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/19760ccbc46489c55557de1e9ed3a8dc8bcabe77

update profile version

Files changed:
M Products/CMFPlone/profiles/default/metadata.xml

diff --git a/Products/CMFPlone/profiles/default/metadata.xml b/Products/CMFPlone/profiles/default/metadata.xml
index 6fa4df2..cdc956c 100644
--- a/Products/CMFPlone/profiles/default/metadata.xml
+++ b/Products/CMFPlone/profiles/default/metadata.xml
@@ -1,4 +1,4 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>5006</version>
+  <version>5007</version>
 </metadata>


Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-08-05T07:45:06+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/bb2d9c13049e8b906b15ad1d876c2d1f5b5cdfe6

Merge pull request #794 from plone/ebr-tiny-css-content-list

@@tinymce-controlpanel content_css attribute must be a list

Files changed:
M CHANGES.rst
M Products/CMFPlone/interfaces/controlpanel.py
M Products/CMFPlone/patterns/__init__.py
M Products/CMFPlone/profiles/default/metadata.xml
M Products/CMFPlone/profiles/dependencies/registry.xml

diff --git a/CHANGES.rst b/CHANGES.rst
index eab71eb..c78bd2b 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -36,6 +36,11 @@ Changelog
 - Rework language selection in @@plone-addsite.
   [jaroel]
 
+- Turn @@tinymce-controlpanel ``content_css`` field into a list, so we can add
+  several CSS URLs (useful when add-ons need to provide extra TinyMCE styles),
+  and fix TinyMCE config getter so it considers the ``content_css`` value.
+  [ebrehault]
+
 
 5.0b3 (2015-07-20)
 ------------------
diff --git a/Products/CMFPlone/interfaces/controlpanel.py b/Products/CMFPlone/interfaces/controlpanel.py
index 3f13d1a..791cc2d 100644
--- a/Products/CMFPlone/interfaces/controlpanel.py
+++ b/Products/CMFPlone/interfaces/controlpanel.py
@@ -397,7 +397,7 @@ class ITinyMCELayoutSchema(Interface):
         default=None,
         required=False)
 
-    content_css = schema.TextLine(
+    content_css = schema.List(
         title=_(u"Choose the CSS used in WYSIWYG Editor Area"),
         description=_(u"This option enables you to specify a custom CSS file "
                       "that provides content CSS. "
@@ -405,7 +405,10 @@ class ITinyMCELayoutSchema(Interface):
                       "(the editable area). In addition to what is listed here, "
                       "the plone bundle CSS and diazo themes using the "
                       "tinymce-content-css setting are also added."),
-        default=u'++plone++static/components/tinymce/skins/lightgray/content.min.css',
+        value_type=schema.TextLine(),
+        default=[
+            u'++plone++static/components/tinymce/skins/lightgray/content.min.css',
+        ],
         required=False)
 
     header_styles = schema.List(
diff --git a/Products/CMFPlone/patterns/__init__.py b/Products/CMFPlone/patterns/__init__.py
index 404cc72..2f7f79f 100644
--- a/Products/CMFPlone/patterns/__init__.py
+++ b/Products/CMFPlone/patterns/__init__.py
@@ -34,6 +34,8 @@ def get_content_css(self):
             '%s/++plone++static/plone-compiled.css' % self.portal_url,
             '%s/++plone++static/tinymce-styles.css' % self.portal_url
         ]
+        for url in self.settings.content_css:
+            files.append('%s/%s' % (self.portal_url, url))
         theme = self.get_theme()
         if (theme and hasattr(theme, 'tinymce_content_css') and
                 theme.tinymce_content_css):
diff --git a/Products/CMFPlone/profiles/default/metadata.xml b/Products/CMFPlone/profiles/default/metadata.xml
index 6fa4df2..cdc956c 100644
--- a/Products/CMFPlone/profiles/default/metadata.xml
+++ b/Products/CMFPlone/profiles/default/metadata.xml
@@ -1,4 +1,4 @@
 <?xml version="1.0"?>
 <metadata>
-  <version>5006</version>
+  <version>5007</version>
 </metadata>
diff --git a/Products/CMFPlone/profiles/dependencies/registry.xml b/Products/CMFPlone/profiles/dependencies/registry.xml
index 6a15ec0..a66fd19 100644
--- a/Products/CMFPlone/profiles/dependencies/registry.xml
+++ b/Products/CMFPlone/profiles/dependencies/registry.xml
@@ -88,7 +88,9 @@
   <records interface="Products.CMFPlone.interfaces.syndication.ISiteSyndicationSettings" />
   <records interface="Products.CMFPlone.interfaces.ITinyMCESchema"
            prefix="plone">
-    <value key="content_css">++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</value>
+    <value key="content_css">
+      <element>++plone++static/components/tinymce-builded/js/tinymce/skins/lightgray/content.min.css</element>
+    </value>
   </records>
   <record name="plone.resources.development">
     <field type="plone.registry.field.Bool">


