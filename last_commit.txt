Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-04-23T03:16:12+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.theming/commit/ad1c7bf2f01e2baa970805dcddd8b3456ef91526

Fix load pluginSettings for the enabled theme before calling plugins for onEnabled

Files changed:
M src/plone/app/theming/utils.py

diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index 6cce4e4..beea0c2 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -563,6 +563,15 @@ def applyTheme(theme):
             for name, plugin in plugins:
                 plugin.onDisabled(currentTheme, pluginSettings[name],
                                   pluginSettings)
+
+        themeDirectory = queryResourceDirectory(
+            THEME_RESOURCE_NAME, settings.currentTheme)
+        if themeDirectory is not None:
+            plugins = getPlugins()
+            pluginSettings = getPluginSettings(themeDirectory, plugins)
+
+        if pluginSettings is not None:
+            for name, plugin in plugins:
                 plugin.onEnabled(theme, pluginSettings[name], pluginSettings)
         notify(ThemeAppliedEvent(theme))
 


Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-04-23T03:16:32+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.theming/commit/9de57a7d7ef1b42b34a4821fa2498cec19a138d6

Update changelog

Files changed:
M docs/HISTORY.rst

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index 80617b8..25f29e9 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -10,6 +10,10 @@ Changelog
 - pat-modal pattern has been renamed to pat-plone-modal
   [jcbrand]
 
+- Fix load pluginSettings for the enabled theme before calling plugins for
+  onEnabled
+  [datakurre]
+
 
 1.2.2 (2015-03-22)
 ------------------


Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-04-23T03:16:32+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.theming/commit/fb4ae8fd0ae2375665125632f473aeb17d1cbe6d

Fix to properly pass the theme name to onEnabled-plugins

Files changed:
M src/plone/app/theming/utils.py

diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index beea0c2..9c14afa 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -564,15 +564,17 @@ def applyTheme(theme):
                 plugin.onDisabled(currentTheme, pluginSettings[name],
                                   pluginSettings)
 
+        currentTheme = settings.currentTheme
         themeDirectory = queryResourceDirectory(
-            THEME_RESOURCE_NAME, settings.currentTheme)
+            THEME_RESOURCE_NAME, currentTheme)
         if themeDirectory is not None:
             plugins = getPlugins()
             pluginSettings = getPluginSettings(themeDirectory, plugins)
 
         if pluginSettings is not None:
             for name, plugin in plugins:
-                plugin.onEnabled(theme, pluginSettings[name], pluginSettings)
+                plugin.onEnabled(currentTheme, pluginSettings[name],
+                                 pluginSettings)
         notify(ThemeAppliedEvent(theme))
 
 


Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-04-23T03:16:32+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.app.theming/commit/2bd67ee0d6ce247af7c0aa780a08e2df7d4c25b2

Update changelog

Files changed:
M docs/HISTORY.rst

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index 25f29e9..b0e022f 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -11,7 +11,7 @@ Changelog
   [jcbrand]
 
 - Fix load pluginSettings for the enabled theme before calling plugins for
-  onEnabled
+  onEnabled and call onEnabled plugins with correct parameters
   [datakurre]
 
 


Repository: plone.app.theming
Branch: refs/heads/master
Date: 2015-04-30T12:54:48+02:00
Author: Jens W. Klein (jensens) <jk@kleinundpartner.at>
Commit: https://github.com/plone/plone.app.theming/commit/7595dbb6607a0bb79e886d72e5ad59878ecfd380

Merge pull request #40 from plone/datakurre-fix-on-enabled-pluginsupport

 Fix on support for IThemePlugin.onEnabled

Files changed:
M docs/HISTORY.rst
M src/plone/app/theming/utils.py

diff --git a/docs/HISTORY.rst b/docs/HISTORY.rst
index 80617b8..b0e022f 100644
--- a/docs/HISTORY.rst
+++ b/docs/HISTORY.rst
@@ -10,6 +10,10 @@ Changelog
 - pat-modal pattern has been renamed to pat-plone-modal
   [jcbrand]
 
+- Fix load pluginSettings for the enabled theme before calling plugins for
+  onEnabled and call onEnabled plugins with correct parameters
+  [datakurre]
+
 
 1.2.2 (2015-03-22)
 ------------------
diff --git a/src/plone/app/theming/utils.py b/src/plone/app/theming/utils.py
index 6cce4e4..9c14afa 100644
--- a/src/plone/app/theming/utils.py
+++ b/src/plone/app/theming/utils.py
@@ -563,7 +563,18 @@ def applyTheme(theme):
             for name, plugin in plugins:
                 plugin.onDisabled(currentTheme, pluginSettings[name],
                                   pluginSettings)
-                plugin.onEnabled(theme, pluginSettings[name], pluginSettings)
+
+        currentTheme = settings.currentTheme
+        themeDirectory = queryResourceDirectory(
+            THEME_RESOURCE_NAME, currentTheme)
+        if themeDirectory is not None:
+            plugins = getPlugins()
+            pluginSettings = getPluginSettings(themeDirectory, plugins)
+
+        if pluginSettings is not None:
+            for name, plugin in plugins:
+                plugin.onEnabled(currentTheme, pluginSettings[name],
+                                 pluginSettings)
         notify(ThemeAppliedEvent(theme))
 
 


