Repository: mockup
Branch: refs/heads/master
Date: 2015-04-09T21:19:26+02:00
Author: Eric BREHAULT (ebrehault) <ebrehault@gmail.com>
Commit: https://github.com/plone/mockup/commit/e192d7adf5f15e093b6c1cfe41a87fc2eb34754e

Fix #475 change file tab color if non-saved changes

Files changed:
M mockup/patterns/filemanager/pattern.filemanager.less
M mockup/patterns/filemanager/pattern.js

diff --git a/mockup/patterns/filemanager/pattern.filemanager.less b/mockup/patterns/filemanager/pattern.filemanager.less
index 05bb626..eb47545 100644
--- a/mockup/patterns/filemanager/pattern.filemanager.less
+++ b/mockup/patterns/filemanager/pattern.filemanager.less
@@ -149,7 +149,7 @@
             float: left;
             padding: 8px 0px;
             text-decoration: none;
-            color: #333;
+            color: @gray-dark;
             +a {
                 padding-left: 4px;
             }
@@ -157,6 +157,9 @@
                 outline: none;
             }
         }
+        &.modified > a {
+            color: @brand-warning;
+        }
     }
     
 
diff --git a/mockup/patterns/filemanager/pattern.js b/mockup/patterns/filemanager/pattern.js
index 978d92e..5616b5d 100644
--- a/mockup/patterns/filemanager/pattern.js
+++ b/mockup/patterns/filemanager/pattern.js
@@ -228,7 +228,7 @@ define([
             _authenticator: utils.getAuthenticator()
           },
           success: function(data) {
-            /* XXX unhighlight save button */
+            $('[data-path="'+self.getNodePath()+'"]').removeClass("modified");
           }
         });
       });
@@ -348,6 +348,11 @@ define([
       self.ace.setSyntax(path);
       self.ace.setText(self.fileData[path].contents);
       self.ace.editor.clearSelection();
+      self.ace.editor.on('change', function() {
+        if (self.ace.editor.curOp && self.ace.editor.curOp.command.name) {
+          $('[data-path="'+path+'"]').addClass("modified");
+        }
+      });
     },
     getSelectedNode: function() {
       return this.$tree.tree('getSelectedNode');


