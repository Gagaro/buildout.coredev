Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-01-26T14:18:54+01:00
Author: Peter Holzer (agitator) <hpeter@agitator.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/9806b6cccde2505330f517f1f21a5262ff2eacda

Extended ulocalized_time for target_language

Conflicts:
	docs/CHANGES.rst

Files changed:
M CHANGES.rst
M Products/CMFPlone/i18nl10n.py
M docs/CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 5d00a9b..2320471 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0b1 (unreleased)
 ------------------
 
+- Extended ulocalized_time for target_language
+  [agitator]
+
 - Caching for ``@@site-logo``.
   [thet]
 
diff --git a/Products/CMFPlone/i18nl10n.py b/Products/CMFPlone/i18nl10n.py
index a98edb4..6f8b01a 100644
--- a/Products/CMFPlone/i18nl10n.py
+++ b/Products/CMFPlone/i18nl10n.py
@@ -105,7 +105,7 @@ def get_formatstring_from_registry(msgid):
     return registry.get(record_name, None)
 
 def ulocalized_time(time, long_format=None, time_only=False, context=None,
-                    domain='plonelocales', request=None):
+                    domain='plonelocales', request=None, target_language=None):
     """unicode aware localized time method (l10n)"""
 
     if time_only:
@@ -169,7 +169,8 @@ def ulocalized_time(time, long_format=None, time_only=False, context=None,
 
     # 2. the normal case: translation machinery,
     # that is the ".../LC_MESSAGES/plonelocales.po" files
-    formatstring = translate(msgid, domain, mapping, request)
+    formatstring = translate(msgid, domain, mapping, request,
+                             target_language=target_language)
 
     # 3. if both failed, fall back to hardcoded ISO style
     if formatstring == msgid:
@@ -221,10 +222,12 @@ def ulocalized_time(time, long_format=None, time_only=False, context=None,
     # translate translateable elements
     for key in name_elements:
         mapping[key] = translate(mapping[key], domain,
-                                 context=request, default=mapping[key])
+                                 context=request, default=mapping[key],
+                                 target_language=target_language)
 
     # translate the time string
-    return translate(msgid, domain, mapping, request)
+    return translate(msgid, domain, mapping, request,
+                     target_language=target_language)
 
 def _numbertoenglishname(number, format=None, attr='_days'):
     # returns the english name of day or month number
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
index b3bd019..a658968 100644
--- a/docs/CHANGES.rst
+++ b/docs/CHANGES.rst
@@ -441,3 +441,4 @@ Changelog
 - Use configuration registry to override translation of date format,
   or fall back to ISO style as last resort. Fixes http://dev.plone.org/ticket/11171
   [kleist]
+


Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-01-26T14:28:37+01:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/Products.CMFPlone/commit/0765faae8e690e1ee6dc564fe026b609b15ca4a1

update CHANGES.rst with entries from docs/CHANGES.rst and remove the latter one

Files changed:
M CHANGES.rst
D docs/CHANGES.rst

diff --git a/CHANGES.rst b/CHANGES.rst
index 2320471..2e2ceae 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -27,6 +27,9 @@ Changelog
 - Get icon from layout_view instead of plone_view.
   [pbauer]
 
+- Fix contentViews (tabs) markup for Plone 5.
+  [davisagli]
+
 - Rename syndication-settings to syndication-controlpanel. Keep the old view registration for backwards compatibility.
   [timo]
 
@@ -64,6 +67,12 @@ Changelog
 5.0a3 (2014-11-01)
 ------------------
 
+- folder_position script: make position and id optional.  Default
+  position to 'ordered' and id to None, which means: do nothing.
+  plone.folder 1.0.5 allows this, making it possible to simply reverse
+  the current sort order by using reverse=False.
+  [maurits]
+
 - Fix JS resource viewlet HTML syntax error.
   [rpatterson]
 
@@ -135,6 +144,19 @@ Changelog
 5.0a2 (2014-04-20)
 ------------------
 
+- Advertise the migration of content to dexterity after a successful
+  upgrade to Plone 5.
+  [pbauer]
+
+- Strip leading & trailing spaces from id and title in rename-form.
+  See https://dev.plone.org/ticket/12998, https://dev.plone.org/ticket/12989,
+  https://dev.plone.org/ticket/9370, https://dev.plone.org/ticket/8338
+  [pbauer]
+
+- Fix incorrect use of dict get method in CatalogTool.search, introduced
+  by PloneHotfix20131210 (issue 195)
+  [fulv]
+
 - Added timezone selection to add site page
   [pysailor, yenzenz]
 
@@ -299,3 +321,14 @@ Changelog
 - Add "plone-5" ZCML feature. Add-ons can register
   ZCML for Plone 5 only using zcml:condition="have plone-5"
   [davisagli]
+
+- Plone's javascript is now developed as part of the Plone mockup
+  (http://github.com/plone/mockup) and is included as a compiled
+  bundle.
+  [davisagli]
+
+- Removed portal_interface tool (PLIP #13770)
+  [ale-rt]
+
+- Removed kss_field_decorator_view support
+  [maurits, jaroel]
diff --git a/docs/CHANGES.rst b/docs/CHANGES.rst
deleted file mode 100644
index a658968..0000000
--- a/docs/CHANGES.rst
+++ /dev/null
@@ -1,444 +0,0 @@
-.. This file should contain the changes for the last release only, which
-   will be included on the package's page on pypi. All older entries are
-   kept in HISTORY.txt
-
-Changelog
-=========
-
-5.0a1 (unreleased)
-------------------
-
-- Fix contentViews (tabs) markup for Plone 5.
-  [davisagli]
-
-- folder_position script: make position and id optional.  Default
-  position to 'ordered' and id to None, which means: do nothing.
-  plone.folder 1.0.5 allows this, making it possible to simply reverse
-  the current sort order by using reverse=False.
-  [maurits]
-
-- Fix JavaScript to work with recent jQuery (>= 1.9) versions.
-  [thet]
-
-- Advertise the migration of content to dexterity after a successful
-  upgrade to Plone 5.
-  [pbauer]
-
-- Strip leading & trailing spaces from id and title in rename-form.
-  See https://dev.plone.org/ticket/12998, https://dev.plone.org/ticket/12989,
-  https://dev.plone.org/ticket/9370, https://dev.plone.org/ticket/8338
-  [pbauer]
-
-- remove quickinstall control panel form since a new one was moved to
-  plone.app.controlpanel
-  [vangheem]
-
-- make extensionprofiles selection part of 'advanced' in plone-addsite
-  [jaroel]
-
-- enable syndication on plone.app.contenttypes collection
-  [vangheem]
-
-- fix syndication settings to not write on read
-  [vangheem]
-
-- fix wrong download url for podcast syndication
-  [Rudd-O]
-
-- Merged PLIP #12344: Use Dexterity-based core content types.
-
-  * Avoid including ATContentTypes and Archetypes as a dependency.
-  * Install the plone.app.contenttypes profile for new sites.
-
-  [davisagli et al]
-
-- Merged PLIP #13270: Move presentation mode out of core.
-  If the feature is still desired, use the plone.app.s5slideshow add-on.
-  [davisagli]
-
-- Add "plone-5" ZCML feature. Add-ons can register
-  ZCML for Plone 5 only using zcml:condition="have plone-5"
-  [davisagli]
-
-
-4.3.3 (unreleased)
-------------------
-
-- Fix incorrect use of dict get method in CatalogTool.search, introduced
-  by PloneHotfix20131210 (issue 195)
-  [fulv]
-
-- Fix issue with the search js in sharing page where the user needed to check
-  twice a checkbox to assign a role after a search.
-  [vincentfretin]
-
-- Catch missing userid on mail_password form, and treat is as
-  an empty userid. That way the user gets a helpful message.
-  [do3cc]
-
-
-4.3.2 (unreleased)
-------------------
-
-- Applied security fixes from PloneHotfix20130618:
-
-  - Protected methods on the ZCatalog.
-  - Added missing module security declarations.
-  - Sanitize url in isURLInPortal.
-  - Check 'Set own password' permission in mailPassword.
-  - Prevent the Zope request from being traversed.
-  - Protected sendto method.
-  - Sanitize input to spamProtect script.
-
-  [davisagli]
-
-- Get ``portal_discussion`` properly with ``getToolByName``.
-  [maurits]
-
-- Fix dependency ordering problem with plone-final import step.
-  [davisagli]
-
-- remove bbb-kss.css from css registry registration
-  [vangheem]
-
-- Stop unload-protection from popping up needlessly if tinyMCE is used on tabbed forms
-  [href]
-
-4.3.1 (2013-05-30)
-------------------
-
-- Some text/* mime types should be Files, not Documents.
-  [rpatterson]
-
-- Remove reference to unimplemented 'make_private' transition in
-  simple_publication_workflow.
-  [danjacka]
-
-- Fail nicely when pasting a deleted item (https://dev.plone.org/ticket/13337)
-  [khink]
-
-- Add a 'max_tabs' option to form-tabbing.js to allow changes to the number of
-  tabs displayed before the script uses a dropdown instead.
-  [esteele]
-
-- register search_rss only for site root
-  [vangheem]
-
-- jquery-integration.js gets disabled during the upgrade to Plone 4.3. Make sure
-  we do so for new sites as well.
-  [esteele]
-
-- Fix commas in kss-bbb.js since IE7/8 is sensative [vangheem]
-
-- Reenable forgotten tests [kiorky]
-
-- Fail nicely when userid is not provided to mail_password script.
-  [esteele]
-
-- Do not display text file content if it is empty.
-  [thomasdesvenain]
-
-- Add distinct classes for live search links.
-  Add id for image details.
-  [cedricmessiant]
-
-- update registerPloneFunction call in login.js (depreacted)
-  [toutpt]
-
-4.3 (2013-04-06)
-----------------
-
-- Fix attribute values in selector expressions of  mark_special_links.js.
-  [mathias.leimgruber]
-
-- Add indexer for location so metadata is included in catalog
-  [vangheem]
-
-- Fix rss 2.0 not providing actual link
-  [vangheem]
-
-- Prevent js inline validation call to /at_validate_field for .blurrable
-  inputs that do not have AT field data validation attributes. This
-  avoids cluttering the error logs with useless at_validate_field
-  errors for fields that just happen to have .blurrable class.
-  [mcmahon]
-
-- Test for #7627 (https://dev.plone.org/ticket/7627)
-
-4.3rc1 (released)
--------------------
-
-- add overlay for folder default page folder factories link
-  [vangheem]
-
-- add sitemap.xml.gz to robots.txt fixes https://dev.plone.org/ticket/13319
-  [vangheem]
-
-- update add site, overview and upgrade templates to use absolute urls
-  to reference css and image resources so it works with virtual hosted
-  sites to sub-folders fixes #11153
-  [vangheem]
-
-- Allow the Content-Type header to be set in registered_notify_template.pt
-  [esteele]
-
-- Extract RegistrationTool's sending of registration emails so that it can be
-  more easily overridden.
-  [esteele]
-
-- bump profile version
-  [vangheem]
-
-- Add event to fix products installed with latest keyword
-  activated by default. Event finds new products installed with
-  the latest keyword and updates them to the last profile version.
-  [eleddy]
-
-- Add event to trigger when a reordering is happening. Without this
-  collective.solr and maybe other alternative indexes are kind of lost.
-  Backport from 4.2.x
-  [do3cc]
-
-- Robot Framework based acceptance tests added.
-  [timo]
-
-- Remove comment form overlay which was only used for the old
-  pre-plone.app.discussion reply form.
-  [timo]
-
-
-4.3b2 (2013-01-17)
-------------------
-
-- removing ``plone_ecmascript/test_ecmascripts.pt`` since its not working and
-  since its not being ran by out test suite.
-  [garbas]
-
-- Call searchUsers with the 'name' argument instead of 'login'.
-  'name' is the officially supported way according to the PAS interface.
-  [maurits]
-
-
-4.3b1 (2012-01-02)
-------------------
-
-- Changes to dependencies when creating a new site (plone-final) to fix
-  #11997.
-  [keul]
-
-- Generate valid atom feeds
-  [lentinj]
-
-- Fix quoted atom.xml feed syndication content type to "html".
-  [elro]
-
-- Add various security fixes based on PloneHotfix20121106.
-  [davisagli]
-
-- Fix RegistrationTool testPasswordValidity method. See
-  https://dev.plone.org/ticket/13325
-  [vipod]
-
-- Fix form_tabbing.js so it stays on the same fieldset when an Archetypes
-  edit form is submitted and returns to itself.
-  [davisagli]
-
-- Use the 'OFS.ObjectManager.bad_id' pattern in 'PloneTool.BAD_CHARS'.
-  This allows names containing '@' to pass 'check_id'.
-  [elro]
-
-- Pass minute_step to date_components_support_view.result(). See
-  https://dev.plone.org/ticket/11251
-  [gbastien]
-
-- Improve error handling on paste action. If it is a real error, the
-  error gets shown and logged.
-  [do3cc]
-
-- Fix sitemap rendering. No longer uses portlet_navtree_macro.pt from
-  the plone_deprecated skin, but a browser view template with much
-  simplified logic.
-  [danjacka]
-
-- Revealed hidden features for sorting folders (#11317).
-  [keul]
-
-- Don't swallow exceptins on object_paste and folder_paste (#9365).
-  [gaudenz]
-
-4.3a2 (2012-10-18)
-------------------
-
-- Use prefixed ids for popup overlays
-  [maartenkling]
-
-- Fix compatible hide fieldset legend for IE6/7/8 in form_tabbing.js
-  [maartenkling]
-
-- Add an animated indicator of AJAX loading via Javascript.
-  It is now called #ajax-spinner and is no longer added in main_template.
-  [davisagli]
-
-- Remove Plone's dependency on KSS. plone.app.kss is now an optional add-on.
-  Functionality that used to be provided using KSS has been reimplemented.
-  [esteele, vangheem, cah190, davisagli]
-
-- Do not block right-side portlets in Members folder on site creation.
-  This fixes https://dev.plone.org/ticket/10764
-  [polyester]
-
-- Fix prefs_install_product_readme so files with non-ascii characters are
-  rendered. This fixes https://dev.plone.org/ticket/12342
-  [ericof]
-
-- Fix StringIO module security so it can still be imported from restricted
-  code in Zope 2.13.17+.
-  [davisagli]
-
-- Filter out non existing types in getUserFriendlyTypes.
-  This avoids an error on the search form when a no longer existing
-  portal_type is still in the catalog.
-  [maurits]
-
-- Declare Plone's dependency on Pillow.
-  [davisagli]
-
-- Merge syndication plip 12908
-  [vangheem]
-
-- Add body class depth registry field
-  [vangheem]
-
-- Check if an item is locked before attempting to delete. Refs #11188
-  [eleddy]
-
-- We can safely move the MAX_TITLE to 50 and even move up MAX_DESCRIPTION 150 refs #11321
-  [maartenkling]
-
-- Remove inline styles, they do nothing, add class so someone can style it when they like refs #12438
-  [maartenkling]
-
-- Show forget password when entering wrong credentials refs #12463
-  [maartenkling]
-
-- Remove h3 to make consistent html refs #11344
-  [maartenkling]
-
-- Fix 'Add New' on Users/Groups Overviews shows overlay when clicking anywhere in form #12201
-  [maartenkling]
-
-- Fix events_listing #12477
-  [maartenkling]
-
-- Fix form_tabbing, to stay on current tab on submitting form
-  [maartenkling]
-
-
-4.3a1 (2012-08-31)
-------------------
-
-- Hide 'plone.resource' and 'collective.z3cform.datetimewidget' from the
-  site factory screen. These are only useful as dependencies of other packages.
-  [optilude]
-
-- Define a ZCML feature called `plone-43` in addition to the existing ones.
-  [thet]
-
-- Deprecated getSiteEncoding and changed occurences to hardcoded `utf-8`
-  [tom_gross]
-
-- zope.globalrequest is a required dependency on tests.
-  [hvelarde]
-
-- Make sure the ResourceRegistries registry setting is created for new sites.
-  [davisagli]
-
-- Searches ignore accents.
-  PLIP http://dev.plone.org/ticket/12110
-  [thomasdesvenain]
-
-- IE critical fix on toggle select and form submit helpers.
-  [thomasdesvenain]
-
-- Fixed javascript injections on jquery.highlightsearchterms.js
-  [gborelli]
-
-- Tweak rules for `sortable_title`. So far we took the first 70 chars and
-  zero-padded numbers to six digits. Now we zero-pad to four digits and take
-  the first 30 and the last 10 characters, thus saving space while still
-  distinguishing long titles which only differ at the end, like imported
-  file or image names.
-  [hannosch]
-
-- PEP 8 (ignoring W602, E203, E241, E301, E501 and E701).
-  [pbdiode, hvelarde]
-
-- Add 'displayPublicationDateInByline' to site properties property sheet in
-  order to finish PLIP #8699: Display publication date in author byline.
-  [vipod]
-
-- Deprecated aliases were replaced on tests.
-  [hvelarde]
-
-- Don't register the plone_deprecated skin layer. These items are no
-  longer supported as part of Plone and remain here temporarily as a
-  convenience to those who may need to move them into their own
-  packages.
-  [davisagli]
-
-- Ensure multiple tabbed forms on the same page work when number of
-  tabs is greater than threshold.
-  [davidjb]
-
-- Remove deprecated `jq` reference from form tabbing JavaScript.
-  [davidjb]
-
-- Remove incorrect line of form tabbing JavaScript which broke
-  forms with more than 6 tabs.
-  Fixes https://dev.plone.org/ticket/12877
-  [davidjb]
-
-- accessibility improvements for screen readers regarding "more" links,
-  see http://dev.plone.org/ticket/11982
-  [rmattb, applied by polyester]
-
-- Fix an outdated "Send this" form handler property reference.
-  [rossp]
-
-- removed search_form-template form plone_deprecated-skin. Use
-  collective.searchform if you need this functionality.
-  [tom_gross]
-
-- Use plone.batching for all batches (PLIP #12235)
-  [tom_gross]
-
-- Re-apply PLIP 10901 to table_sort.js, fixing a bug with reversing sort
-  on the first column.
-  [mj]
-
-- support a PAS plugin for validating passwords
-  PLIP http://dev.plone.org/ticket/10959
-  [djay75]
-
-- Make redirection_view/attempt_redirect fall back to nothing in
-  default_error_message template. If plone.app.redirector gets a URL with
-  special characters, OOBTree.get raises a UnicodeDecodeError and the template
-  fails. This fixes http://dev.plone.org/ticket/12976.
-
-- Channel link in RSS feed now points to the un-syndicated content for the RSS feed,
-  instead of the portal root.
-  [patch by pydanny, applied by kleist]
-
-- Removed unused "localTimeFormat", "localLongTimeFormat", and "localTimeOnlyFormat"
-  from "/portal_properties/site_properties".
-  Fixes https://dev.plone.org/ticket/11171.
-  [kleist]
-
-- CatalogTool.py, PloneBatch.py, PloneFolder.py, PloneTool.py, Portal.py:
-  Don't use list as default parameter value.
-  [kleist]
-
-- Use configuration registry to override translation of date format,
-  or fall back to ISO style as last resort. Fixes http://dev.plone.org/ticket/11171
-  [kleist]
-


