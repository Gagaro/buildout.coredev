Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2015-08-24T09:36:14+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/4c49c76685557b2531dc1a9e9fe40ccadc6e9a6d

migrate linkintegrity-relations from reference_catalog to zc.relation-catalog

Files changed:
M plone/app/upgrade/v50/betas.py

diff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py
index 41275cb..9c6c850 100644
--- a/plone/app/upgrade/v50/betas.py
+++ b/plone/app/upgrade/v50/betas.py
@@ -4,6 +4,7 @@
 from Products.CMFPlone.interfaces import IMarkupSchema
 from Products.CMFPlone.interfaces import ISecuritySchema
 from Products.CMFPlone.interfaces import ILanguageSchema
+from plone.app.linkintegrity.upgrades import migrate_linkintegrity_relations
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.registry.interfaces import IRegistry
 from zope.component import getUtility
@@ -265,6 +266,8 @@ def to50beta3(context):
 def to50beta4(context):
     """5.0beta3 -> 5.0beta4"""
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v50:to50beta4')
+    portal = getSite()
+    migrate_linkintegrity_relations(portal)
 
 
 def upgrade_querystring(context):


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2015-08-24T09:36:14+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.upgrade/commit/cbe131f5488b49dc109d5cf0c1fb1a94b4d4d446

install p.a.linkintegrity (and dependencies) upon upgrade to b4

Files changed:
M plone/app/upgrade/v50/betas.py

diff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py
index 9c6c850..424949d 100644
--- a/plone/app/upgrade/v50/betas.py
+++ b/plone/app/upgrade/v50/betas.py
@@ -267,6 +267,10 @@ def to50beta4(context):
     """5.0beta3 -> 5.0beta4"""
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v50:to50beta4')
     portal = getSite()
+    # install plone.app.linkintegrity and its dependencies
+    qi = getToolByName(portal, 'portal_quickinstaller')
+    if not qi.isProductInstalled('plone.app.linkintegrity'):
+        qi.installProduct('plone.app.linkintegrity')
     migrate_linkintegrity_relations(portal)
 
 


Repository: plone.app.upgrade


Branch: refs/heads/master
Date: 2015-08-24T13:40:53-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.upgrade/commit/90c828f3b27e7b44da5a88320450b2c895d966f4

Merge pull request #43 from plone/linkintegrity

Linkintegrity

Files changed:
M plone/app/upgrade/v50/betas.py

diff --git a/plone/app/upgrade/v50/betas.py b/plone/app/upgrade/v50/betas.py
index 41275cb..424949d 100644
--- a/plone/app/upgrade/v50/betas.py
+++ b/plone/app/upgrade/v50/betas.py
@@ -4,6 +4,7 @@
 from Products.CMFPlone.interfaces import IMarkupSchema
 from Products.CMFPlone.interfaces import ISecuritySchema
 from Products.CMFPlone.interfaces import ILanguageSchema
+from plone.app.linkintegrity.upgrades import migrate_linkintegrity_relations
 from plone.app.upgrade.utils import loadMigrationProfile
 from plone.registry.interfaces import IRegistry
 from zope.component import getUtility
@@ -265,6 +266,12 @@ def to50beta3(context):
 def to50beta4(context):
     """5.0beta3 -> 5.0beta4"""
     loadMigrationProfile(context, 'profile-plone.app.upgrade.v50:to50beta4')
+    portal = getSite()
+    # install plone.app.linkintegrity and its dependencies
+    qi = getToolByName(portal, 'portal_quickinstaller')
+    if not qi.isProductInstalled('plone.app.linkintegrity'):
+        qi.installProduct('plone.app.linkintegrity')
+    migrate_linkintegrity_relations(portal)
 
 
 def upgrade_querystring(context):


