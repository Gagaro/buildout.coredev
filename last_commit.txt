Repository: mockup
Branch: refs/heads/master
Date: 2015-05-27T23:30:24+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/mockup/commit/cd405f9c5fbe7868fa2634edc51ab23580a67b72

update jquery.recurrenceinput.js to v1.4

Files changed:
M CHANGES.rst
M bower.json

diff --git a/CHANGES.rst b/CHANGES.rst
index b4414da..663efa6 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,7 +8,7 @@ Changelog
   while you are editing
   [vangheem]
 
-- Update to jQuery 1.11.3 and moment 2.10.3.
+- Update to jQuery 1.11.3, moment 2.10.3 and jquery.recurrenceinput.js v1.4.
   [thet]
 
 - Cleanup: Use ``windows.alert`` and ``window.confirm`` instead globals. Remove
diff --git a/bower.json b/bower.json
index 802ae7c..39f21c4 100644
--- a/bower.json
+++ b/bower.json
@@ -13,7 +13,7 @@
     "jquery": "1.11.3",
     "jquery-form": "3.46.0",
     "jquery.cookie": "1.4.1",
-    "jquery.recurrenceinput.js": "v1.3",
+    "jquery.recurrenceinput.js": "v1.4",
     "lodash": "2.4.1",
     "logging": "",
     "mockup-core": "2.1.8",


Repository: mockup
Branch: refs/heads/master
Date: 2015-05-28T21:47:50+02:00
Author: Gil Forcada (gforcada) <gforcada@gnome.org>
Commit: https://github.com/plone/mockup/commit/6bee27694b6e5e24f683e0888d98656aedd9a300

Add test-jenkins

This target runs mockup tests and saves the results in an XML file
so that jenkins can show them with its publishers.

Depends on https://github.com/plone/mockup-core/pull/29

Files changed:
M Makefile

diff --git a/Makefile b/Makefile
index d4f78ce..cafa305 100644
--- a/Makefile
+++ b/Makefile
@@ -93,6 +93,9 @@ test: stamp-bower
 test-once: stamp-bower
 	NODE_PATH=$(NODE_PATH) $(GRUNT) test_once $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js --pattern=$(pattern)
 
+test-jenkins: stamp-bower
+	NODE_PATH=$(NODE_PATH) $(GRUNT) test_jenkins $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js --pattern=$(pattern)
+
 test-dev:
 	NODE_PATH=$(NODE_PATH) $(GRUNT) test_dev $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js --pattern=$(pattern)
 


Repository: mockup
Branch: refs/heads/master
Date: 2015-05-28T23:50:33+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/mockup/commit/cc124d6d9742ced3b15e146ebc233253c39e4edf

update jquery.recurrenceinput.js to 1.5

Files changed:
M CHANGES.rst
M bower.json

diff --git a/CHANGES.rst b/CHANGES.rst
index 663efa6..9c5e5f2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,7 +8,7 @@ Changelog
   while you are editing
   [vangheem]
 
-- Update to jQuery 1.11.3, moment 2.10.3 and jquery.recurrenceinput.js v1.4.
+- Update to jQuery 1.11.3, moment 2.10.3 and jquery.recurrenceinput.js v1.5.
   [thet]
 
 - Cleanup: Use ``windows.alert`` and ``window.confirm`` instead globals. Remove
diff --git a/bower.json b/bower.json
index 39f21c4..2503f15 100644
--- a/bower.json
+++ b/bower.json
@@ -13,7 +13,7 @@
     "jquery": "1.11.3",
     "jquery-form": "3.46.0",
     "jquery.cookie": "1.4.1",
-    "jquery.recurrenceinput.js": "v1.4",
+    "jquery.recurrenceinput.js": "v1.5",
     "lodash": "2.4.1",
     "logging": "",
     "mockup-core": "2.1.8",


Repository: mockup
Branch: refs/heads/master
Date: 2015-05-29T17:03:44-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/ccec87028bc22e082d6d9a95874d8a961f91b707

handle errors better with the modal pattern

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index 9c5e5f2..fb04fcf 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.4 (Unreleased)
 ------------------
 
+- handle errors better with the modal pattern
+  [vangheem]
+
 - fix weird issue with selecting multiple links and images on a page
   while you are editing
   [vangheem]
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index 6c45a82..c8b6b67 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -74,8 +74,9 @@ define([
   'pat-registry',
   'mockup-router',
   'mockup-utils',
+  'translate',
   'jquery.form'
-], function($, _, Base, Backdrop, registry, Router, utils) {
+], function($, _, Base, Backdrop, registry, Router, utils, _t) {
   'use strict';
 
   var Modal = Base.extend({
@@ -260,6 +261,7 @@ define([
             } else if (options.onError) {
               options.onError(xhr, textStatus, errorStatus);
             } else {
+              window.alert(_t('There was an error submitting the form.'));
               console.log('error happened do something');
             }
             self.emit('formActionError', [xhr, textStatus, errorStatus]);
@@ -327,28 +329,26 @@ define([
 
         // ajax version
         $.ajax({
-          url: url,
-          error: function(xhr, textStatus, errorStatus) {
-            if (textStatus === 'timeout' && options.onTimeout) {
-              options.onTimeout(self.$modal, xhr, errorStatus);
-
-            // on "error", "abort", and "parsererror"
-            } else if (options.onError) {
-              options.onError(xhr, textStatus, errorStatus);
-            } else {
-              console.log('error happened do something');
-            }
-            self.loading.hide();
-            self.emit('linkActionError', [xhr, textStatus, errorStatus]);
-          },
-          success: function(response, state, xhr) {
-            self.redraw(response, patternOptions);
-            if (options.onSuccess) {
-              options.onSuccess(self, response, state, xhr);
-            }
-            self.loading.hide();
-            self.emit('linkActionSuccess', [response, state, xhr]);
+          url: url
+        }).fail(function(xhr, textStatus, errorStatus) {
+          if (textStatus === 'timeout' && options.onTimeout) {
+            options.onTimeout(self.$modal, xhr, errorStatus);
+
+          // on "error", "abort", and "parsererror"
+          } else if (options.onError) {
+            options.onError(xhr, textStatus, errorStatus);
+          } else {
+            window.alert(_t('There was an error loading modal.'));
+          }
+          self.emit('linkActionError', [xhr, textStatus, errorStatus]);
+        }).done(function(response, state, xhr) {
+          self.redraw(response, patternOptions);
+          if (options.onSuccess) {
+            options.onSuccess(self, response, state, xhr);
           }
+          self.emit('linkActionSuccess', [response, state, xhr]);
+        }).always(function(){
+          self.loading.hide();
         });
       },
       render: function(options) {
@@ -602,10 +602,22 @@ define([
         type: self.options.ajaxType
       }).done(function(response, textStatus, xhr) {
         self.ajaxXHR = undefined;
-        self.loading.hide();
         self.$raw = $('<div />').append($(utils.parseBodyTag(response)));
         self.emit('after-ajax', self, textStatus, xhr);
         self._show();
+      }).fail(function(xhr, textStatus, errorStatus){
+        var options = self.options.actionOptions;
+        if (textStatus === 'timeout' && options.onTimeout) {
+          options.onTimeout(self.$modal, xhr, errorStatus);
+        } else if (options.onError) {
+          options.onError(xhr, textStatus, errorStatus);
+        } else {
+          window.alert(_t('There was an error loading modal.'));
+          self.hide();
+        }
+        self.emit('linkActionError', [xhr, textStatus, errorStatus]);
+      }).always(function(){
+        self.loading.hide();
       });
     },
 


Repository: mockup
Branch: refs/heads/master
Date: 2015-05-30T11:38:22-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/6dc471893f1c74e97e3561912e6231897799e8d7

add image modal

Files changed:
M CHANGES.rst
M mockup/patterns/modal/pattern.js

diff --git a/CHANGES.rst b/CHANGES.rst
index fb04fcf..0b9dded 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,9 @@ Changelog
 2.0.4 (Unreleased)
 ------------------
 
+- add image modal type
+  [vangheem]
+
 - handle errors better with the modal pattern
   [vangheem]
 
diff --git a/mockup/patterns/modal/pattern.js b/mockup/patterns/modal/pattern.js
index c8b6b67..e29434f 100644
--- a/mockup/patterns/modal/pattern.js
+++ b/mockup/patterns/modal/pattern.js
@@ -575,7 +575,7 @@ define([
       }
 
       if (self.$el.is('a')) {
-        if (self.$el.attr('href')) {
+        if (self.$el.attr('href') && !self.options.image) {
           if (!self.options.target && self.$el.attr('href').substr(0, 1) === '#') {
             self.options.target = self.$el.attr('href');
             self.options.content = '';
@@ -640,6 +640,15 @@ define([
       self._show();
     },
 
+    createImageModal: function(){
+      var self = this;
+      self.$wrapper.addClass('image-modal');
+      var src = self.$el.attr('href');
+      // XXX aria?
+      self.$raw = $('<div><h1>Image</h1><div id="content"><div class="modal-image"><img src="' + src + '" /></div></div></div>');
+      self._show();
+    },
+
     initModal: function() {
       var self = this;
       if (self.options.ajaxUrl) {
@@ -648,10 +657,13 @@ define([
         self.createModal = self.createTargetModal;
       } else if (self.options.html) {
         self.createModal = self.createHtmlModal;
+      } else if (self.options.image){
+        self.createModal = self.createImageModal;
       } else {
         self.createModal = self.createBasicModal;
       }
     },
+
     findPosition: function(horpos, vertpos, margin, modalWidth, modalHeight,
                            wrapperInnerWidth, wrapperInnerHeight) {
       var returnpos = {};


Repository: mockup
Branch: refs/heads/master
Date: 2015-05-31T16:31:47-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/e639bcdcc02af7ab2e9b99c02813a6f7c84fd760

Merge pull request #504 from plone/jenkins

Add test-jenkins

Files changed:
M Makefile

diff --git a/Makefile b/Makefile
index d4f78ce..cafa305 100644
--- a/Makefile
+++ b/Makefile
@@ -93,6 +93,9 @@ test: stamp-bower
 test-once: stamp-bower
 	NODE_PATH=$(NODE_PATH) $(GRUNT) test_once $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js --pattern=$(pattern)
 
+test-jenkins: stamp-bower
+	NODE_PATH=$(NODE_PATH) $(GRUNT) test_jenkins $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js --pattern=$(pattern)
+
 test-dev:
 	NODE_PATH=$(NODE_PATH) $(GRUNT) test_dev $(DEBUG) $(VERBOSE) --gruntfile=mockup/Gruntfile.js --pattern=$(pattern)
 


Repository: mockup
Branch: refs/heads/master
Date: 2015-05-31T20:12:16-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/mockup/commit/f3f978ed88d19098650f06a020c46c7b52a9a494

upgrade mockup-core

Files changed:
M CHANGES.rst
M bower.json

diff --git a/CHANGES.rst b/CHANGES.rst
index 0b9dded..5b662a5 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -1,9 +1,12 @@
 Changelog
 =========
 
-2.0.4 (Unreleased)
+2.0.4 (2015-05-31)
 ------------------
 
+- upgrade to mockup-core 2.1.9
+  [vangheem]
+
 - add image modal type
   [vangheem]
 
diff --git a/bower.json b/bower.json
index 2503f15..bbb7c65 100644
--- a/bower.json
+++ b/bower.json
@@ -16,7 +16,7 @@
     "jquery.recurrenceinput.js": "v1.5",
     "lodash": "2.4.1",
     "logging": "",
-    "mockup-core": "2.1.8",
+    "mockup-core": "2.1.9",
     "moment": "2.10.3",
     "patternslib": "2.0.9",
     "pickadate": "3.4.0",


