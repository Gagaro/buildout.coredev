Repository: plone.app.portlets


Branch: refs/heads/master
Date: 2015-09-17T17:40:07+02:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.portlets/commit/25b7e732e5ff974f9d311cf92c7d73c70cbc9743

Be defensive in lookups so that unmigrated sites aren't broken.

Files changed:
M plone/app/portlets/portlets/navigation.py

diff --git a/plone/app/portlets/portlets/navigation.py b/plone/app/portlets/portlets/navigation.py
index 50c1b51..04abfc7 100644
--- a/plone/app/portlets/portlets/navigation.py
+++ b/plone/app/portlets/portlets/navigation.py
@@ -366,13 +366,9 @@ def __init__(self, context, portlet):
 
         # Filter on workflow states, if enabled
         registry = getUtility(IRegistry)
-        navigation_settings = registry.forInterface(
-            INavigationSchema,
-            prefix="plone"
-        )
-        if navigation_settings.filter_on_workflow:
-            query['review_state'] = navigation_settings.workflow_states_to_show
-
+        if registry.get('plone.filter_on_workflow', False):
+            query['review_state'] = registry.get(
+                'plone.workflow_states_to_show', ())
         self.query = query
 
     def __call__(self):


