Repository: Products.PasswordResetTool
Branch: refs/heads/2.0.x
Date: 2015-03-23T11:42:57+10:00
Author: David\ Beitey (davidjb) <david@davidjb.com>
Commit: https://github.com/plone/Products.PasswordResetTool/commit/dc66f7c96167ab0a6b6cfbe2c3f6c0a5edb61e97

Set email content-type correctly in notification templates

Conflicts:
	CHANGES.txt

Files changed:
M CHANGES.txt
M Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
M Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
M README.txt

diff --git a/CHANGES.txt b/CHANGES.txt
index 463c9f6..a3f19c6 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,6 +4,10 @@ Changelog
 2.0.18 (unreleased)
 -------------------
 
+- Set mail Content-Type within registration and password reset email
+  templates (rather than HTTP response headers which are ignored).
+  [davidjb]
+
 - Replace PTC by plone.app.testing (cherry-pick of master tomgross commits)
   [sgeulette]
 - Added userid information in reset mail (useful when the administrator resets a user password)
diff --git a/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt b/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
index d5a57a1..68125bd 100644
--- a/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
+++ b/Products/PasswordResetTool/skins/PasswordReset/mail_password_template.pt
@@ -1,5 +1,4 @@
 <tal:root define="lt string:&lt;;gt string:&gt;;
-                  dummy python:request.RESPONSE.setHeader('Content-Type', 'text/plain;; charset=%s' % options['charset']);
                   member python:options['member'];
                   portal_state context/@@plone_portal_state;
                   view context/@@passwordreset_view;
@@ -8,6 +7,7 @@
 >From: <span tal:replace="structure view/encoded_mail_sender" />
 To: <span tal:replace="python:member.getProperty('email')" />
 Subject: <span tal:replace="view/mail_password_subject" />
+Content-Type: text/plain
 Precedence: bulk
 
 <div i18n:domain="passwordresettool"
diff --git a/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt b/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
index 89b9d2f..8730d0a 100644
--- a/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
+++ b/Products/PasswordResetTool/skins/PasswordReset/registered_notify_template.pt
@@ -1,5 +1,4 @@
 <tal:root define="lt string:&lt;;gt string:&gt;;
-                  dummy python:request.RESPONSE.setHeader('Content-Type', 'text/plain;; charset=utf-8');
                   member python:options['member'];
                   portal_properties context/@@plone_tools/properties;
                   view context/@@passwordreset_view;
@@ -7,6 +6,7 @@
 >From: <span tal:replace="structure view/encoded_mail_sender" />
 To: <span tal:replace="python:member.getProperty('email')" />
 Subject: <span tal:replace="view/registered_notify_subject" />
+Content-Type: text/plain
 Precedence: bulk
 
 <div i18n:domain="passwordresettool"
diff --git a/README.txt b/README.txt
index 9a2ce96..4dbe0e6 100644
--- a/README.txt
+++ b/README.txt
@@ -87,7 +87,8 @@ Notes
     'mail_password_response'.
 
   - 'mail_password_template':
-    Provides the text of the email.
+    Provides the basic headers and text of the email, for extraction
+    and parsing for use by a mail sender.
 
   - 'mail_password_response':
     Informs that the mail has been sent.


