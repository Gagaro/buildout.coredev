Repository: Products.PortalTransforms
Branch: refs/heads/master
Date: 2015-03-03T20:07:24+01:00
Author: Timo Stollenwerk (tisto) <tisto@plone.org>
Commit: https://github.com/plone/Products.PortalTransforms/commit/5b7e4b3cc7769601e580546a063b6201afa87058

Remove policy before adding a new one with the same name. This seems to be neccessary after moving P.Archetypes from PloneTestCase to plone.app.testing.

Files changed:
M Products/PortalTransforms/tests/test_engine.py

diff --git a/Products/PortalTransforms/tests/test_engine.py b/Products/PortalTransforms/tests/test_engine.py
index ae2df8a..c6f2ac7 100644
--- a/Products/PortalTransforms/tests/test_engine.py
+++ b/Products/PortalTransforms/tests/test_engine.py
@@ -209,6 +209,7 @@ def testPolicy(self):
         self.engine.registerTransform(DummyHtmlFilter2())
         required = ['dummy_html_filter1', 'dummy_html_filter2']
 
+        self.engine.manage_delPolicies([mt])
         self.engine.manage_addPolicy(mt, required)
         expected_policy = [('text/x-html-safe',
                             ('dummy_html_filter1', 'dummy_html_filter2'))]
@@ -259,6 +260,8 @@ def testCacheWithVHost(self):
         mt = 'text/x-html-safe'
         self.engine.registerTransform(QuxToVHost())
         required = ['qux_to_vhost']
+
+        self.engine.manage_delPolicies([mt])
         self.engine.manage_addPolicy(mt, required)
 
         data = '<a href="qux">vhost link</a>'


