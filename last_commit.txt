Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2014-12-01T09:34:36+01:00
Author: Martin Opstad Reistadbakk (martior) <martin@blaastolen.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/4e4d013ebc24d3ebaa29c3e8be9f36e800f0b0d3

enable referenceablebehaviour on test for Documents to fix Products.CMFPlone/issues/255

Files changed:
M plone/app/contenttypes/testing.py

diff --git a/plone/app/contenttypes/testing.py b/plone/app/contenttypes/testing.py
index 9e6d8ed..a297c21 100644
--- a/plone/app/contenttypes/testing.py
+++ b/plone/app/contenttypes/testing.py
@@ -44,6 +44,12 @@ def setUpZope(self, app, configurationContext):
 
     def setUpPloneSite(self, portal):
         applyProfile(portal, 'plone.app.contenttypes:default')
+
+        # install and enable referenceablebehavior on Documents to be able to test
+        # controlpanel to enable plone.app.linkintegrity checks
+        applyProfile(portal, 'plone.app.referenceablebehavior:default')
+        portal.portal_types.Document.behaviors += ('zope.lifecycleevent.interfaces.IObjectModifiedEvent',)
+
         mtr = portal.mimetypes_registry
         mime_doc = mtr.lookup('application/msword')[0]
         mime_doc.icon_path = 'custom.png'


Repository: plone.app.contenttypes
Branch: refs/heads/master
Date: 2014-12-01T09:34:43+01:00
Author: Martin Opstad Reistadbakk (martior) <martin@blaastolen.com>
Commit: https://github.com/plone/plone.app.contenttypes/commit/53e0c3dbcde8225ca3aa36185c044b3b089cecf3

Merge branch 'master' of git://github.com/plone/plone.app.contenttypes

Files changed:
M plone/app/contenttypes/upgrades.zcml

diff --git a/plone/app/contenttypes/upgrades.zcml b/plone/app/contenttypes/upgrades.zcml
index 53803c1..1f964e7 100644
--- a/plone/app/contenttypes/upgrades.zcml
+++ b/plone/app/contenttypes/upgrades.zcml
@@ -23,6 +23,7 @@
 
   <!-- We still need Archetypes to use Products.contentmigrator -->
   <configure zcml:condition="installed Products.Archetypes">
+  <configure zcml:condition="installed archetypes.schemaextender">
   <genericsetup:upgradeStep
       source="1001"
       destination="1100"
@@ -32,6 +33,7 @@
       handler=".migration.dxmigration.migrate_to_pa_event"
       />
   </configure>
+  </configure>
 
   <genericsetup:upgradeStep
       source="1100"


