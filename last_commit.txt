Repository: Products.CMFPlone
Branch: refs/heads/master
Date: 2015-06-04T21:29:44-05:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/e76e4cd8e20104f72c1c0e62eae481f10b9b5b15

provide some info on what to do if there is an error loading the resource registry

Files changed:
M Products/CMFPlone/controlpanel/browser/resourceregistry.pt
M Products/CMFPlone/controlpanel/browser/resourceregistry.py

diff --git a/Products/CMFPlone/controlpanel/browser/resourceregistry.pt b/Products/CMFPlone/controlpanel/browser/resourceregistry.pt
index 79c85fb..d5fda8d 100644
--- a/Products/CMFPlone/controlpanel/browser/resourceregistry.pt
+++ b/Products/CMFPlone/controlpanel/browser/resourceregistry.pt
@@ -29,7 +29,35 @@
 
    <div id="content-core"> 
       <span tal:replace="structure context/@@authenticator/authenticator"/>
-      <div class="pat-resourceregistry" tal:attributes="data-pat-resourceregistry view/config" />
+      <div class="pat-resourceregistry" tal:attributes="data-pat-resourceregistry view/config">
+        <div class="portalMessage info">
+          <strong>Info</strong>
+          If you see this, it is because there was an error rendering the resource registry
+          configuration. It's possible you saved a bundle that gives a JavaScript error
+          and it is prevening the resource registry from loading.
+        </div>
+        <h2>Available Options</h2>
+        <ul>
+          <li>Reload the page. There could be a intermittent issue.</li> 
+          <li>Go to the <a href="${portal_url}/portal_registry">Configuration Registry</a>
+              and manually edit the configuration to enable development mode
+              on the resource registry and try to rebuild.</li>
+          <li>You can also attempt to delete your customizations/builds and see if that fixes it.
+            <ul>
+              <tal:overrides tal:repeat="override python: view.get_overrides()">
+                <li>
+                  <form method="POST">
+                    <input type="hidden" name="action" value="delete-file" />
+                    <input type="hidden" name="response" value="html" />
+                    <input type="hidden" name="filepath" value="${override}" />
+                    <input type="submit" value="Delete ${override}" />
+                  </form>
+                </li>
+              </tal:overrides>
+            </ul>
+          </li>
+        </ul>
+      </div>
     </div>
 </metal:main>
 
diff --git a/Products/CMFPlone/controlpanel/browser/resourceregistry.py b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
index 33949e7..12f4d66 100644
--- a/Products/CMFPlone/controlpanel/browser/resourceregistry.py
+++ b/Products/CMFPlone/controlpanel/browser/resourceregistry.py
@@ -193,6 +193,8 @@ def delete_file(self):
         overrides = OverrideFolderManager(self.context)
         overrides.delete_file(resource_path)
 
+        if req.form.get('response') == 'html':
+            return req.response.redirect(req.URL)
         return json.dumps({
             'success': True
         })


