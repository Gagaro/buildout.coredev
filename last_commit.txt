Repository: plone.app.contenttypes


Branch: refs/heads/master
Date: 2015-09-27T20:28:39+02:00
Author: Philip Bauer (pbauer) <bauer@starzel.de>
Commit: https://github.com/plone/plone.app.contenttypes/commit/51d140d34d5939a5b9b9b820080a1ae511cb0e74

Remove imports from p.a.linkintegrity to fix test-issues

Files changed:
M CHANGES.rst
M plone/app/contenttypes/migration/utils.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 16021f9..659afca 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 1.2.5 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Remove imports from p.a.linkintegrity to fix test-issues.
+  [pbauer]
 
 
 1.2.4 (2015-09-27)
diff --git a/plone/app/contenttypes/migration/utils.py b/plone/app/contenttypes/migration/utils.py
index d15328c..d059021 100644
--- a/plone/app/contenttypes/migration/utils.py
+++ b/plone/app/contenttypes/migration/utils.py
@@ -20,9 +20,6 @@
 from plone.app.contenttypes.utils import DEFAULT_TYPES
 from plone.app.discussion.conversation import ANNOTATION_KEY as DISCUSSION_KEY
 from plone.app.discussion.interfaces import IConversation
-from plone.app.linkintegrity.handlers import modifiedArchetype
-from plone.app.linkintegrity.handlers import modifiedDexterity
-from plone.app.linkintegrity.handlers import referencedRelationship
 from plone.app.uuid.utils import uuidToObject
 from plone.contentrules.engine.interfaces import IRuleAssignmentManager
 from plone.dexterity.interfaces import IDexterityContent
@@ -373,18 +370,16 @@ def link_items(  # noqa
     else:
         target_type = 'AT'
 
-    if relationship == referencedRelationship:
-        # 'relatesTo' is the relationship for linkintegrity-relations.
+    if relationship == 'relatesTo':
+        # 'relatesTo' (plone.app.linkintegrity.handlers.referencedRelationship)
+        # is the relationship for linkintegrity-relations.
         # Linkintegrity-relations should automatically be (re)created by
         # plone.app.linkintegrity.handlers.modifiedDexterity or
         # plone.app.linkintegrity.handlers.modifiedArchetype
         # when a ObjectModifiedEvent is thrown.
         # These relations are only created if the source has a richtext-field
         # with a link to the target and should not be created manually.
-        if source_type == 'AT':
-            modifiedArchetype(source_obj, None)
-        if source_type == 'DX':
-            modifiedDexterity(source_obj, None)
+        modified(source_obj)
         return
 
     if source_type == 'AT':


