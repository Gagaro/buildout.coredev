Repository: plone.app.redirector


Branch: refs/heads/master
Date: 2015-09-06T22:17:19-04:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.redirector/commit/3f19130544d63c82ecabf60dc096ce83a09c10ff

Use registry for value lookup

Files changed:
M plone/app/redirector/tests/test_view.py

diff --git a/plone/app/redirector/tests/test_view.py b/plone/app/redirector/tests/test_view.py
index ca4a3ff..18f5c9d 100644
--- a/plone/app/redirector/tests/test_view.py
+++ b/plone/app/redirector/tests/test_view.py
@@ -5,6 +5,8 @@
 
 from zope.component import getUtility, getMultiAdapter
 from plone.app.redirector.interfaces import IRedirectionStorage
+from Products.CMFPlone.interfaces import ISearchSchema
+from plone.registry.interfaces import IRegistry
 
 from plone.app.redirector.testing import \
     PLONE_APP_REDIRECTOR_INTEGRATION_TESTING
@@ -195,7 +197,9 @@ def test_search_blacklisted(self):
         self.folder.f1.invokeFactory('Document', 'p1')
         self.folder.f1.invokeFactory('Document', 'p2')
         fu = self.folder.absolute_url()
-        self.portal.portal_properties.site_properties.types_not_searched = ['Document']
+        registry = getUtility(IRegistry)
+        settings = registry.forInterface(ISearchSchema, prefix="plone")
+        settings.types_not_searched = ('Document',)
         view = self.view(self.portal, fu + '/f2/p1')
         urls = sorted([b.getURL() for b in view.search_for_similar()])
         self.assertEqual(1, len(urls))


