Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-10-20T15:34:20+02:00
Author: Thomas Clement Mogensen (tmog) <mogensen@diku.dk>
Commit: https://github.com/plone/plone.app.content/commit/f6850de2a8c70119c298e9d774f27cf3dc5f0c99

fix issue with i18njs. try the base language if no region specific translation catalog is available.

Files changed:
M plone/app/content/browser/i18n.py

diff --git a/plone/app/content/browser/i18n.py b/plone/app/content/browser/i18n.py
index 8909b4e..9ce7c8b 100644
--- a/plone/app/content/browser/i18n.py
+++ b/plone/app/content/browser/i18n.py
@@ -15,8 +15,14 @@ class i18njs(BrowserView):
     @ram.cache(_cache_key)
     def _gettext_catalog(self, domain, language):
         td = queryUtility(ITranslationDomain, domain)
-        if td is None or language not in td._catalogs:
+        if td is None:
             return
+        if language not in td._catalogs:
+            baselanguage = language.split('-')[0]
+            if baselanguage not in td._catalogs:
+                return
+            else:
+                language = baselanguage
         mo_path = td._catalogs[language][0]
         catalog = td._data[mo_path]._catalog
         if catalog is None:


Repository: plone.app.content


Branch: refs/heads/master
Date: 2015-10-21T08:09:27-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.app.content/commit/ee2793e6a322cf13f8c3ca234f7c7155b58bfd2f

Merge pull request #59 from plone/i18njs_region_fix

fix issue with i18njs and regional language variants

Files changed:
M plone/app/content/browser/i18n.py

diff --git a/plone/app/content/browser/i18n.py b/plone/app/content/browser/i18n.py
index 8909b4e..9ce7c8b 100644
--- a/plone/app/content/browser/i18n.py
+++ b/plone/app/content/browser/i18n.py
@@ -15,8 +15,14 @@ class i18njs(BrowserView):
     @ram.cache(_cache_key)
     def _gettext_catalog(self, domain, language):
         td = queryUtility(ITranslationDomain, domain)
-        if td is None or language not in td._catalogs:
+        if td is None:
             return
+        if language not in td._catalogs:
+            baselanguage = language.split('-')[0]
+            if baselanguage not in td._catalogs:
+                return
+            else:
+                language = baselanguage
         mo_path = td._catalogs[language][0]
         catalog = td._data[mo_path]._catalog
         if catalog is None:


