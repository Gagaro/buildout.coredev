Repository: diazo
Branch: refs/heads/master
Date: 2015-04-26T20:32:44-07:00
Author: Laurence Rowe (lrowe) <laurence@lrowe.co.uk>
Commit: https://github.com/plone/diazo/commit/218b41f0cae91a3dd0d7ee8c1b460150c68e2801

Fix reporting of test failures on python 3.

Files changed:
M lib/diazo/tests/test_diazo.py

diff --git a/lib/diazo/tests/test_diazo.py b/lib/diazo/tests/test_diazo.py
index 37c17cb..6e99644 100644
--- a/lib/diazo/tests/test_diazo.py
+++ b/lib/diazo/tests/test_diazo.py
@@ -7,7 +7,7 @@
 import os
 import sys
 import difflib
-from io import BytesIO, StringIO
+from io import BytesIO, StringIO, open
 import unittest
 try:
     import configparser
@@ -100,7 +100,7 @@ def testAll(self):
         )
 
         # Serialize / parse the theme - this can catch problems with escaping.
-        cts = etree.tostring(ct)
+        cts = etree.tostring(ct, encoding='unicode')
         parser = etree.XMLParser()
         etree.fromstring(cts, parser=parser)
 
@@ -115,8 +115,8 @@ def testAll(self):
                         f.write(old)
                 if self.warnings:
                     print("WARNING:", "compiled.xsl has CHANGED")
-                    for line in difflib.unified_diff(old.split('\n'),
-                                                     new.split('\n'),
+                    for line in difflib.unified_diff(old.split(u'\n'),
+                                                     new.split(u'\n'),
                                                      xslfn, 'now'):
                         print(line)
 
@@ -174,8 +174,8 @@ def testAll(self):
                     etree.fromstring(new.strip())):
                 # if self.writefiles:
                 #    open(outputfn + '.old', 'w').write(old)
-                for line in difflib.unified_diff(old.split('\n'),
-                                                 new.split('\n'),
+                for line in difflib.unified_diff(old.split(u'\n'),
+                                                 new.split(u'\n'),
                                                  outputfn, 'now'):
                     print(line)
                 assert old == new, "output.html has CHANGED"


