Repository: Products.CMFPlone


Branch: refs/heads/master
Date: 2015-07-17T10:57:03+02:00
Author: vangheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/Products.CMFPlone/commit/71eb5a7d2fb0afbb0eb967b43ad988c10115ab98

log info after catalog rebuilt

Files changed:
M CHANGES.rst
M Products/CMFPlone/CatalogTool.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 0ef498b..b147bd2 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -8,6 +8,9 @@ Changelog
 5.0b3 (unreleased)
 ------------------
 
+- log info after catalog rebuilt
+  [vangheem]
+
 - Renamed 'Zope Management Interface' to 'Management Interface'.
   [jaroel]
 
diff --git a/Products/CMFPlone/CatalogTool.py b/Products/CMFPlone/CatalogTool.py
index 4d38865..b73d446 100644
--- a/Products/CMFPlone/CatalogTool.py
+++ b/Products/CMFPlone/CatalogTool.py
@@ -1,7 +1,12 @@
+import logging
+import re
+import time
+import urllib
+
 from AccessControl import ClassSecurityInfo
 from AccessControl.PermissionRole import rolesForPermissionOn
-from AccessControl.Permissions import manage_zcatalog_entries as \
-    ManageZCatalogEntries
+from AccessControl.Permissions import (
+    manage_zcatalog_entries as ManageZCatalogEntries)
 from AccessControl.Permissions import search_zcatalog as SearchZCatalog
 from Acquisition import aq_base
 from Acquisition import aq_inner
@@ -31,9 +36,9 @@
 from zope.interface import Interface
 from zope.interface import implementer
 from zope.interface import providedBy
-import re
-import time
-import urllib
+
+
+logger = logging.getLogger('Plone')
 
 _marker = object()
 
@@ -437,12 +442,14 @@ def manage_catalogRebuild(self, RESPONSE=None, URL1=None):
         elapse = time.time() - elapse
         c_elapse = time.clock() - c_elapse
 
+        msg = ('Catalog Rebuilt\n'
+               'Total time: %s\n'
+               'Total CPU time: %s' % (repr(elapse), repr(c_elapse)))
+        logger.info(msg)
+
         if RESPONSE is not None:
             RESPONSE.redirect(
                 URL1 + '/manage_catalogAdvanced?manage_tabs_message=' +
-                urllib.quote('Catalog Rebuilt\n'
-                             'Total time: %s\n'
-                             'Total CPU time: %s' %
-                             (repr(elapse), repr(c_elapse))))
+                urllib.quote(msg))
 
 InitializeClass(CatalogTool)


