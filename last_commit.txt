Repository: plone.app.event
Branch: refs/heads/master
Date: 2015-05-07T22:11:46Z
Author: Franco Pellegrini () <franco.pellegrini@enfoldsystems.com>
Commit: https://github.com/plone/plone.app.event/commit/6799470e3270fb0286423a787258524df4249c66

Import BBB superclasses from  plone.app.portlets.portlets.base so it works with plone.app.portlets 3.0 and up

Files changed:
M CHANGES.rst
M plone/app/event/bbb/portlets/portlet_calendar.py
M plone/app/event/bbb/portlets/portlet_events.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 7e80538..ae40024 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,10 @@ Changelog
 2.0a10 (unreleased)
 -------------------
 
+- Import BBB superclasses from  plone.app.portlets.portlets.base so it works
+  with plone.app.portlets 3.0 and up
+  [frapell]
+
 - For ``event_listing`` on Collections, ignore the Collection's sorting and use
   what the event listing's mode defines for sorting.
   [thet]
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.py b/plone/app/event/bbb/portlets/portlet_calendar.py
index 7c4ff91..3afdb1b 100644
--- a/plone/app/event/bbb/portlets/portlet_calendar.py
+++ b/plone/app/event/bbb/portlets/portlet_calendar.py
@@ -1,19 +1,27 @@
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets import PloneMessageFactory as _
-from plone.app.portlets.browser.z3cformhelper import AddForm
-from plone.app.portlets.browser.z3cformhelper import EditForm
+try:
+    from plone.app.portlets.browser import z3cformhelper
+    P_A_PORTLETS_PRE_3 = True
+except:
+    P_A_PORTLETS_PRE_3 = False
+from plone.app.portlets.portlets import base
 from plone.app.event.portlets.portlet_calendar import Renderer as RendererBase
 from plone.app.event.portlets.portlet_calendar import ICalendarPortlet
 from plone.app.event.portlets.portlet_calendar import Assignment
-from z3c.form import field
+if P_A_PORTLETS_PRE_3:
+    from z3c.form import field
 
 
 class Renderer(RendererBase):
     render = ViewPageTemplateFile('portlet_calendar.pt')
 
 
-class AddForm(AddForm):
-    fields = field.Fields(ICalendarPortlet)
+class AddForm(base.AddForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(ICalendarPortlet)
+    else:
+        schema = ICalendarPortlet
     label = _(u"Add Calendar Portlet")
     description = _(u"This portlet displays events in a calendar.")
 
@@ -22,7 +30,10 @@ def create(self, data):
                           search_base_uid=data.get('search_base_uid', None))
 
 
-class EditForm(EditForm):
-    fields = field.Fields(ICalendarPortlet)
+class EditForm(base.EditForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(ICalendarPortlet)
+    else:
+        schema = ICalendarPortlet
     label = _(u"Edit Calendar Portlet")
     description = _(u"This portlet displays events in a calendar.")
diff --git a/plone/app/event/bbb/portlets/portlet_events.py b/plone/app/event/bbb/portlets/portlet_events.py
index 2fb8abd..3d68c96 100644
--- a/plone/app/event/bbb/portlets/portlet_events.py
+++ b/plone/app/event/bbb/portlets/portlet_events.py
@@ -1,19 +1,27 @@
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets import PloneMessageFactory as _
-from plone.app.portlets.browser.z3cformhelper import AddForm
-from plone.app.portlets.browser.z3cformhelper import EditForm
+try:
+    from plone.app.portlets.browser import z3cformhelper
+    P_A_PORTLETS_PRE_3 = True
+except:
+    P_A_PORTLETS_PRE_3 = False
+from plone.app.portlets.portlets import base
 from plone.app.event.portlets.portlet_events import Renderer as RendererBase
 from plone.app.event.portlets.portlet_events import Assignment
 from plone.app.event.portlets.portlet_events import IEventsPortlet
-from z3c.form import field
+if P_A_PORTLETS_PRE_3:
+    from z3c.form import field
 
 
 class Renderer(RendererBase):
     render = ViewPageTemplateFile('portlet_events.pt')
 
 
-class AddForm(AddForm):
-    fields = field.Fields(IEventsPortlet)
+class AddForm(base.AddForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(IEventsPortlet)
+    else:
+        schema = IEventsPortlet
     label = _(u"Add Events Portlet")
     description = _(u"This portlet lists upcoming Events.")
 
@@ -23,7 +31,10 @@ def create(self, data):
                           search_base_uid=data.get('search_base_uid', 5))
 
 
-class EditForm(EditForm):
-    fields = field.Fields(IEventsPortlet)
+class EditForm(base.EditForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(IEventsPortlet)
+    else:
+        schema = IEventsPortlet
     label = _(u"Edit Events Portlet")
     description = _(u"This portlet lists upcoming Events.")


Repository: plone.app.event
Branch: refs/heads/master
Date: 2015-05-14T16:36:00-03:00
Author: Franco Pellegrini (frapell) <frapell@gmail.com>
Commit: https://github.com/plone/plone.app.event/commit/2ed772fe6dcb5c321e77380232a55103d8fe4aba

Use pkg_resources to check pkg version

Files changed:
M plone/app/event/bbb/portlets/portlet_calendar.py
M plone/app/event/bbb/portlets/portlet_events.py

diff --git a/plone/app/event/bbb/portlets/portlet_calendar.py b/plone/app/event/bbb/portlets/portlet_calendar.py
index 3afdb1b..6eefcae 100644
--- a/plone/app/event/bbb/portlets/portlet_calendar.py
+++ b/plone/app/event/bbb/portlets/portlet_calendar.py
@@ -1,16 +1,24 @@
+from distutils.version import StrictVersion
+import pkg_resources
+
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets import PloneMessageFactory as _
-try:
-    from plone.app.portlets.browser import z3cformhelper
-    P_A_PORTLETS_PRE_3 = True
-except:
-    P_A_PORTLETS_PRE_3 = False
+
 from plone.app.portlets.portlets import base
 from plone.app.event.portlets.portlet_calendar import Renderer as RendererBase
 from plone.app.event.portlets.portlet_calendar import ICalendarPortlet
 from plone.app.event.portlets.portlet_calendar import Assignment
-if P_A_PORTLETS_PRE_3:
+
+
+version = StrictVersion(pkg_resources.require("plone.app.portlets")[0].version)
+wanted = StrictVersion('3.0')
+
+if version >= wanted:
+    P_A_PORTLETS_PRE_3 = False
     from z3c.form import field
+else:
+    P_A_PORTLETS_PRE_3 = True
+    from plone.app.portlets.browser import z3cformhelper
 
 
 class Renderer(RendererBase):
diff --git a/plone/app/event/bbb/portlets/portlet_events.py b/plone/app/event/bbb/portlets/portlet_events.py
index 3d68c96..8ebfd9e 100644
--- a/plone/app/event/bbb/portlets/portlet_events.py
+++ b/plone/app/event/bbb/portlets/portlet_events.py
@@ -1,16 +1,24 @@
+from distutils.version import StrictVersion
+import pkg_resources
+
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets import PloneMessageFactory as _
-try:
-    from plone.app.portlets.browser import z3cformhelper
-    P_A_PORTLETS_PRE_3 = True
-except:
-    P_A_PORTLETS_PRE_3 = False
+
 from plone.app.portlets.portlets import base
 from plone.app.event.portlets.portlet_events import Renderer as RendererBase
 from plone.app.event.portlets.portlet_events import Assignment
 from plone.app.event.portlets.portlet_events import IEventsPortlet
-if P_A_PORTLETS_PRE_3:
+
+
+version = StrictVersion(pkg_resources.require("plone.app.portlets")[0].version)
+wanted = StrictVersion('3.0')
+
+if version >= wanted:
+    P_A_PORTLETS_PRE_3 = False
     from z3c.form import field
+else:
+    P_A_PORTLETS_PRE_3 = True
+    from plone.app.portlets.browser import z3cformhelper
 
 
 class Renderer(RendererBase):


Repository: plone.app.event
Branch: refs/heads/master
Date: 2015-05-20T19:40:42+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.app.event/commit/8bd2a8510d5bfcd00813c31078d36b4b7988aba0

Merge pull request #184 from plone/p.a.portlets

Make plone.app.event compatible with plone.app.portlets 3.0+

Files changed:
M CHANGES.rst
M plone/app/event/bbb/portlets/portlet_calendar.py
M plone/app/event/bbb/portlets/portlet_events.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 41f744d..efb4788 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -18,6 +18,10 @@ Changelog
 2.0a10 (2015-05-13)
 -------------------
 
+- Import BBB superclasses from  plone.app.portlets.portlets.base so it works
+  with plone.app.portlets 3.0 and up
+  [frapell]
+
 - For ``event_listing`` on Collections, ignore the Collection's sorting and use
   what the event listing's mode defines for sorting.
   [thet]
diff --git a/plone/app/event/bbb/portlets/portlet_calendar.py b/plone/app/event/bbb/portlets/portlet_calendar.py
index 7c4ff91..6eefcae 100644
--- a/plone/app/event/bbb/portlets/portlet_calendar.py
+++ b/plone/app/event/bbb/portlets/portlet_calendar.py
@@ -1,19 +1,35 @@
+from distutils.version import StrictVersion
+import pkg_resources
+
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets import PloneMessageFactory as _
-from plone.app.portlets.browser.z3cformhelper import AddForm
-from plone.app.portlets.browser.z3cformhelper import EditForm
+
+from plone.app.portlets.portlets import base
 from plone.app.event.portlets.portlet_calendar import Renderer as RendererBase
 from plone.app.event.portlets.portlet_calendar import ICalendarPortlet
 from plone.app.event.portlets.portlet_calendar import Assignment
-from z3c.form import field
+
+
+version = StrictVersion(pkg_resources.require("plone.app.portlets")[0].version)
+wanted = StrictVersion('3.0')
+
+if version >= wanted:
+    P_A_PORTLETS_PRE_3 = False
+    from z3c.form import field
+else:
+    P_A_PORTLETS_PRE_3 = True
+    from plone.app.portlets.browser import z3cformhelper
 
 
 class Renderer(RendererBase):
     render = ViewPageTemplateFile('portlet_calendar.pt')
 
 
-class AddForm(AddForm):
-    fields = field.Fields(ICalendarPortlet)
+class AddForm(base.AddForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(ICalendarPortlet)
+    else:
+        schema = ICalendarPortlet
     label = _(u"Add Calendar Portlet")
     description = _(u"This portlet displays events in a calendar.")
 
@@ -22,7 +38,10 @@ def create(self, data):
                           search_base_uid=data.get('search_base_uid', None))
 
 
-class EditForm(EditForm):
-    fields = field.Fields(ICalendarPortlet)
+class EditForm(base.EditForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(ICalendarPortlet)
+    else:
+        schema = ICalendarPortlet
     label = _(u"Edit Calendar Portlet")
     description = _(u"This portlet displays events in a calendar.")
diff --git a/plone/app/event/bbb/portlets/portlet_events.py b/plone/app/event/bbb/portlets/portlet_events.py
index 2fb8abd..8ebfd9e 100644
--- a/plone/app/event/bbb/portlets/portlet_events.py
+++ b/plone/app/event/bbb/portlets/portlet_events.py
@@ -1,19 +1,35 @@
+from distutils.version import StrictVersion
+import pkg_resources
+
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 from plone.app.portlets import PloneMessageFactory as _
-from plone.app.portlets.browser.z3cformhelper import AddForm
-from plone.app.portlets.browser.z3cformhelper import EditForm
+
+from plone.app.portlets.portlets import base
 from plone.app.event.portlets.portlet_events import Renderer as RendererBase
 from plone.app.event.portlets.portlet_events import Assignment
 from plone.app.event.portlets.portlet_events import IEventsPortlet
-from z3c.form import field
+
+
+version = StrictVersion(pkg_resources.require("plone.app.portlets")[0].version)
+wanted = StrictVersion('3.0')
+
+if version >= wanted:
+    P_A_PORTLETS_PRE_3 = False
+    from z3c.form import field
+else:
+    P_A_PORTLETS_PRE_3 = True
+    from plone.app.portlets.browser import z3cformhelper
 
 
 class Renderer(RendererBase):
     render = ViewPageTemplateFile('portlet_events.pt')
 
 
-class AddForm(AddForm):
-    fields = field.Fields(IEventsPortlet)
+class AddForm(base.AddForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(IEventsPortlet)
+    else:
+        schema = IEventsPortlet
     label = _(u"Add Events Portlet")
     description = _(u"This portlet lists upcoming Events.")
 
@@ -23,7 +39,10 @@ def create(self, data):
                           search_base_uid=data.get('search_base_uid', 5))
 
 
-class EditForm(EditForm):
-    fields = field.Fields(IEventsPortlet)
+class EditForm(base.EditForm):
+    if P_A_PORTLETS_PRE_3:
+        fields = field.Fields(IEventsPortlet)
+    else:
+        schema = IEventsPortlet
     label = _(u"Edit Events Portlet")
     description = _(u"This portlet lists upcoming Events.")


