Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2015-09-02T17:51:08+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.schemaeditor/commit/3bd896bba44c80faf76829ad30b872c09e3923ed

Revert "addTokenToUrl soft dependency"

Files changed:
M CHANGES.rst
M plone/schemaeditor/browser/schema/listing.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 77345fa..40baee7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,9 +4,7 @@ Changelog
 2.0.7 (unreleased)
 ------------------
 
-- Make ``plone.protect.utils.addTokenToUrl`` a soft dependency, making this
-  package usable in Plone < 5.0.
-  [thet]
+- Nothing changed yet.
 
 
 2.0.6 (2015-07-18)
diff --git a/plone/schemaeditor/browser/schema/listing.py b/plone/schemaeditor/browser/schema/listing.py
index a559c7e..0c35d01 100644
--- a/plone/schemaeditor/browser/schema/listing.py
+++ b/plone/schemaeditor/browser/schema/listing.py
@@ -7,18 +7,13 @@
 from plone.z3cform.layout import FormWrapper
 from plone.memoize.instance import memoize
 from plone.autoform.form import AutoExtensibleForm
+from plone.protect.utils import addTokenToUrl
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 
 from plone.schemaeditor import SchemaEditorMessageFactory as _
 from plone.schemaeditor.interfaces import IFieldFactory
 from plone.schemaeditor.utils import SchemaModifiedEvent
 
-try:
-    from plone.protect.utils import addTokenToUrl
-except ImportError:
-    addTokenToUrl = None
-
-
 
 class SchemaListing(AutoExtensibleForm, form.Form):
     implements(IEditForm)
@@ -88,8 +83,7 @@ def delete_url(self, field):
         if field.__name__ in self.context.fieldsWhichCannotBeDeleted:
             return
         url = '%s/%s/@@delete' % (self.context.absolute_url(), field.__name__)
-        if addTokenToUrl:
-            url = addTokenToUrl(url, self.request)
+        url = addTokenToUrl(url, self.request)
         return url
 
     @button.buttonAndHandler(
diff --git a/setup.py b/setup.py
index b509a00..dbefdaa 100644
--- a/setup.py
+++ b/setup.py
@@ -36,7 +36,6 @@
           'zope.schema',
           'zope.publisher',
           'z3c.form',
-          'plone.protect',
           'plone.z3cform',
           'plone.autoform',
       ],


Repository: plone.schemaeditor


Branch: refs/heads/master
Date: 2015-09-02T17:51:27+02:00
Author: Johannes Raggam (thet) <raggam-nl@adm.at>
Commit: https://github.com/plone/plone.schemaeditor/commit/26c9468f27ab8116b57f01cee1641a36881bf0ef

Merge pull request #32 from plone/revert-31-thet-addTokenToUrl-softdependency

Revert "addTokenToUrl soft dependency"

Files changed:
M CHANGES.rst
M plone/schemaeditor/browser/schema/listing.py
M setup.py

diff --git a/CHANGES.rst b/CHANGES.rst
index 77345fa..40baee7 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,9 +4,7 @@ Changelog
 2.0.7 (unreleased)
 ------------------
 
-- Make ``plone.protect.utils.addTokenToUrl`` a soft dependency, making this
-  package usable in Plone < 5.0.
-  [thet]
+- Nothing changed yet.
 
 
 2.0.6 (2015-07-18)
diff --git a/plone/schemaeditor/browser/schema/listing.py b/plone/schemaeditor/browser/schema/listing.py
index a559c7e..0c35d01 100644
--- a/plone/schemaeditor/browser/schema/listing.py
+++ b/plone/schemaeditor/browser/schema/listing.py
@@ -7,18 +7,13 @@
 from plone.z3cform.layout import FormWrapper
 from plone.memoize.instance import memoize
 from plone.autoform.form import AutoExtensibleForm
+from plone.protect.utils import addTokenToUrl
 from Products.Five.browser.pagetemplatefile import ViewPageTemplateFile
 
 from plone.schemaeditor import SchemaEditorMessageFactory as _
 from plone.schemaeditor.interfaces import IFieldFactory
 from plone.schemaeditor.utils import SchemaModifiedEvent
 
-try:
-    from plone.protect.utils import addTokenToUrl
-except ImportError:
-    addTokenToUrl = None
-
-
 
 class SchemaListing(AutoExtensibleForm, form.Form):
     implements(IEditForm)
@@ -88,8 +83,7 @@ def delete_url(self, field):
         if field.__name__ in self.context.fieldsWhichCannotBeDeleted:
             return
         url = '%s/%s/@@delete' % (self.context.absolute_url(), field.__name__)
-        if addTokenToUrl:
-            url = addTokenToUrl(url, self.request)
+        url = addTokenToUrl(url, self.request)
         return url
 
     @button.buttonAndHandler(
diff --git a/setup.py b/setup.py
index b509a00..dbefdaa 100644
--- a/setup.py
+++ b/setup.py
@@ -36,7 +36,6 @@
           'zope.schema',
           'zope.publisher',
           'z3c.form',
-          'plone.protect',
           'plone.z3cform',
           'plone.autoform',
       ],


