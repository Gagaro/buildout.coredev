Repository: plone.tiles
Branch: refs/heads/master
Date: 2015-05-20T18:05:03+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.tiles/commit/e0ed550f30a9ac1f5006a9c921b6569817ddedc7

Add support for drafting tile data context

Files changed:
M plone/tiles/tile.py

diff --git a/plone/tiles/tile.py b/plone/tiles/tile.py
index f38de47..cdd13f1 100644
--- a/plone/tiles/tile.py
+++ b/plone/tiles/tile.py
@@ -1,13 +1,17 @@
 # -*- coding: utf-8 -*-
-
-from zope.interface import implements
+from plone.tiles.interfaces import IPersistentTile
+from plone.tiles.interfaces import ITile
+from plone.tiles.interfaces import ITileDataManager
 from zope.component import queryMultiAdapter
-
+from zope.interface import implements
 from zope.publisher.browser import BrowserView
 from zope.traversing.browser.absoluteurl import absoluteURL
 
-from plone.tiles.interfaces import ITile, IPersistentTile
-from plone.tiles.interfaces import ITileDataManager
+try:
+    from plone.app.drafts.interfaces import ICurrentDraftManagement
+    PLONE_APP_DRAFTS = True
+except ImportError:
+    PLONE_APP_DRAFTS = False
 
 
 class Tile(BrowserView):
@@ -90,6 +94,10 @@ def __call__(self, *args, **kwargs):
     @property
     def data(self):
         if self.__cachedData is None:
+            # Support drafting tile data context
+            if PLONE_APP_DRAFTS:
+                ICurrentDraftManagement(self.request).mark()
+            # Get tile data from manager
             reader = ITileDataManager(self)
             self.__cachedData = reader.get()
         return self.__cachedData


Repository: plone.tiles
Branch: refs/heads/master
Date: 2015-05-20T18:06:37+03:00
Author: Asko Soukka (datakurre) <asko.soukka@iki.fi>
Commit: https://github.com/plone/plone.tiles/commit/7830e25bbe4869786b63e5c8dea02d2d3026a855

Update changelog

Files changed:
M CHANGELOG.rst

diff --git a/CHANGELOG.rst b/CHANGELOG.rst
index 3091c82..ca40be4 100644
--- a/CHANGELOG.rst
+++ b/CHANGELOG.rst
@@ -6,6 +6,9 @@ Changelog
 
 - Add support for encoding dictionary fields into tile URL
   [datakurre]
+- Fix issue where tile preview during drafting did not use drafting tile data
+  for the preview
+  [datakurre]
 - Fix issue where saving or deleting transient tile data mutated the current request
   [datakurre]
 - Fix issue where non-ascii characters in tile data raised UnicodeEncode/DecodeErrors


