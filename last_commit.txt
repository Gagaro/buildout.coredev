Repository: plone.app.vocabularies


Branch: refs/heads/master
Date: 2015-09-05T21:51:09-04:00
Author: esteele (esteele) <eric@esteele.net>
Commit: https://github.com/plone/plone.app.vocabularies/commit/841409e8698d9b54a71fc3e850d7900b5e2d244b

Pull available_editors values from the configuration registry

Files changed:
M CHANGES.rst
M plone/app/vocabularies/editors.py

diff --git a/CHANGES.rst b/CHANGES.rst
index ff47277..bbaca26 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,7 +4,8 @@ Changelog
 2.1.21 (unreleased)
 -------------------
 
-- Nothing changed yet.
+- Pull available_editors values from the configuration registry.
+  [esteele]
 
 
 2.1.20 (2015-08-13)
diff --git a/plone/app/vocabularies/editors.py b/plone/app/vocabularies/editors.py
index f74c360..7da92e9 100644
--- a/plone/app/vocabularies/editors.py
+++ b/plone/app/vocabularies/editors.py
@@ -1,11 +1,13 @@
 # -*- coding: utf-8 -*-
-from Products.CMFCore.utils import getToolByName
+from zope.component import getUtility
 from zope.i18nmessageid import MessageFactory
 from zope.interface import implementer
 from zope.schema.interfaces import IVocabularyFactory
 from zope.schema.vocabulary import SimpleTerm
 from zope.schema.vocabulary import SimpleVocabulary
-from zope.site.hooks import getSite
+
+from plone.registry.interfaces import IRegistry
+from Products.CMFPlone.interfaces import IEditingSchema
 
 _ = MessageFactory('plone')
 
@@ -44,11 +46,12 @@ class AvailableEditorsVocabulary(object):
 
     def __call__(self, context):
         items = []
-        site = getSite()
-        pprop = getToolByName(site, 'portal_properties', None)
-        if pprop is not None:
-            editors = pprop.site_properties.available_editors
-            items = [SimpleTerm(e, e, _(e)) for e in editors]
+
+        registry = getUtility(IRegistry)
+        settings = registry.forInterface(IEditingSchema, prefix="plone")
+
+        editors = settings.available_editors
+        items = [SimpleTerm(e, e, _(e)) for e in editors]
         return SimpleVocabulary(items)
 
 AvailableEditorsVocabularyFactory = AvailableEditorsVocabulary()


