Repository: plone.resourceeditor


Branch: refs/heads/master
Date: 2015-10-03T12:46:51-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.resourceeditor/commit/773d1b3821c539f47dae8317066e4c23200df022

Removed incorrect create/modified timestamps

Files changed:
M plone/resourceeditor/browser.py
M plone/resourceeditor/preview.pt

diff --git a/plone/resourceeditor/browser.py b/plone/resourceeditor/browser.py
index c76d2b0..df644b6 100644
--- a/plone/resourceeditor/browser.py
+++ b/plone/resourceeditor/browser.py
@@ -122,15 +122,13 @@ def getInfo(self, obj, path='/'):
         filename = obj.__name__
 
         properties = {
-            'dateCreated': None,
             'dateModified': None,
         }
 
         size = 0
 
         if isinstance(obj, File):
-            properties['dateCreated'] = obj.created().strftime('%c')
-            properties['dateModified'] = obj.modified().strftime('%c')
+            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')
             size = obj.get_size() / 1024
 
         fileType = self.getExtension(obj)
@@ -138,7 +136,6 @@ def getInfo(self, obj, path='/'):
             stats = os.stat(obj.path)
             created = localtime(stats.st_ctime)
             modified = localtime(stats.st_mtime)
-            properties['dateCreated'] = strftime('%c', created)
             properties['dateModified'] = strftime('%c', modified)
             size = stats.st_size / 1024
 
@@ -633,13 +630,11 @@ def getInfo(self, path, getSize=False):
         errorCode = 0
 
         properties = {
-            'dateCreated': None,
             'dateModified': None,
         }
 
         if isinstance(obj, File):
-            properties['dateCreated'] = obj.created().strftime('%c')
-            properties['dateModified'] = obj.modified().strftime('%c')
+            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')
             size = obj.get_size() / 1024
             if size < 1024:
                 size_specifier = u'kb'
@@ -1059,4 +1054,4 @@ def getFolder(root, relpath=''):
             'isFolder': True,
             "expand": True,
             'children': getFolder(self.context)
-        }])
\ No newline at end of file
+        }])
diff --git a/plone/resourceeditor/preview.pt b/plone/resourceeditor/preview.pt
index 8ac5ed6..60f5a0c 100644
--- a/plone/resourceeditor/preview.pt
+++ b/plone/resourceeditor/preview.pt
@@ -7,9 +7,6 @@
                               props info/properties;">
     <img src="" tal:attributes="src info/preview" tal:condition="exists:info/preview" />
     <p class="discreet details">
-        <b i18n:translate="file_preview_date_created">Date Created</b>: <span tal:replace="props/dateCreated" />
-            <span tal:condition="not:props/dateCreated">n/a</span>
-        <br/>
         <b i18n:translate="file_preview_date_modified">Date Modified</b>: <span tal:replace="props/dateModified" />
             <span tal:condition="not:props/dateModified">n/a</span>
         <br/>


Repository: plone.resourceeditor


Branch: refs/heads/master
Date: 2015-10-03T12:47:08-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.resourceeditor/commit/68011564e701fd89d4497c49607598b84230ebd4

Fixed issue breaking file saving in the filemanager

Files changed:
M plone/resourceeditor/browser.py

diff --git a/plone/resourceeditor/browser.py b/plone/resourceeditor/browser.py
index df644b6..b393daf 100644
--- a/plone/resourceeditor/browser.py
+++ b/plone/resourceeditor/browser.py
@@ -169,8 +169,9 @@ def saveFile(self, path, value):
         value = unicode(value.strip(), 'utf-8')
         value = value.replace('\r\n', '\n')
 
-        if IResourceDirectory.providedBy(self.context[path]):
-            return json.dumps({'error': 'invalid path'})
+        if path in self.context:
+            if IResourceDirectory.providedBy(self.context[path]):
+                return json.dumps({'error': 'invalid path'})
 
         if 'relativeUrls' in self.request.form:
             reg = re.compile('url\(([^)]+)\)')


Repository: plone.resourceeditor


Branch: refs/heads/master
Date: 2015-10-03T12:48:49-05:00
Author: Sam Schwartz (obct537) <obct537@gmail.com>
Commit: https://github.com/plone/plone.resourceeditor/commit/fd09a4fe90c157c3415e106ea9d47364c6af626c

updated changelog

Files changed:
M CHANGES.txt

diff --git a/CHANGES.txt b/CHANGES.txt
index 5d425e5..2534d5a 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,8 +4,11 @@ Changelog
 2.0.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed problem causing file timestamps to show up incorrectly
+  [obct537]
 
+- Fixed problem error preventing file saving from the filemanager
+  [obct537]
 
 2.0.3 (2015-09-27)
 ------------------


Repository: plone.resourceeditor


Branch: refs/heads/master
Date: 2015-10-03T13:05:44-05:00
Author: Nathan Van Gheem (vangheem) <vangheem@gmail.com>
Commit: https://github.com/plone/plone.resourceeditor/commit/f95576c9f2ea0c5a2ce67d7c434a56e06e69b927

Merge pull request #12 from plone/saving_fix

Saving fix

Files changed:
M CHANGES.txt
M plone/resourceeditor/browser.py
M plone/resourceeditor/preview.pt

diff --git a/CHANGES.txt b/CHANGES.txt
index 5d425e5..2534d5a 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -4,8 +4,11 @@ Changelog
 2.0.4 (unreleased)
 ------------------
 
-- Nothing changed yet.
+- Fixed problem causing file timestamps to show up incorrectly
+  [obct537]
 
+- Fixed problem error preventing file saving from the filemanager
+  [obct537]
 
 2.0.3 (2015-09-27)
 ------------------
diff --git a/plone/resourceeditor/browser.py b/plone/resourceeditor/browser.py
index c76d2b0..b393daf 100644
--- a/plone/resourceeditor/browser.py
+++ b/plone/resourceeditor/browser.py
@@ -122,15 +122,13 @@ def getInfo(self, obj, path='/'):
         filename = obj.__name__
 
         properties = {
-            'dateCreated': None,
             'dateModified': None,
         }
 
         size = 0
 
         if isinstance(obj, File):
-            properties['dateCreated'] = obj.created().strftime('%c')
-            properties['dateModified'] = obj.modified().strftime('%c')
+            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')
             size = obj.get_size() / 1024
 
         fileType = self.getExtension(obj)
@@ -138,7 +136,6 @@ def getInfo(self, obj, path='/'):
             stats = os.stat(obj.path)
             created = localtime(stats.st_ctime)
             modified = localtime(stats.st_mtime)
-            properties['dateCreated'] = strftime('%c', created)
             properties['dateModified'] = strftime('%c', modified)
             size = stats.st_size / 1024
 
@@ -172,8 +169,9 @@ def saveFile(self, path, value):
         value = unicode(value.strip(), 'utf-8')
         value = value.replace('\r\n', '\n')
 
-        if IResourceDirectory.providedBy(self.context[path]):
-            return json.dumps({'error': 'invalid path'})
+        if path in self.context:
+            if IResourceDirectory.providedBy(self.context[path]):
+                return json.dumps({'error': 'invalid path'})
 
         if 'relativeUrls' in self.request.form:
             reg = re.compile('url\(([^)]+)\)')
@@ -633,13 +631,11 @@ def getInfo(self, path, getSize=False):
         errorCode = 0
 
         properties = {
-            'dateCreated': None,
             'dateModified': None,
         }
 
         if isinstance(obj, File):
-            properties['dateCreated'] = obj.created().strftime('%c')
-            properties['dateModified'] = obj.modified().strftime('%c')
+            properties['dateModified'] = obj.bobobase_modification_time().strftime('%c')
             size = obj.get_size() / 1024
             if size < 1024:
                 size_specifier = u'kb'
@@ -1059,4 +1055,4 @@ def getFolder(root, relpath=''):
             'isFolder': True,
             "expand": True,
             'children': getFolder(self.context)
-        }])
\ No newline at end of file
+        }])
diff --git a/plone/resourceeditor/preview.pt b/plone/resourceeditor/preview.pt
index 8ac5ed6..60f5a0c 100644
--- a/plone/resourceeditor/preview.pt
+++ b/plone/resourceeditor/preview.pt
@@ -7,9 +7,6 @@
                               props info/properties;">
     <img src="" tal:attributes="src info/preview" tal:condition="exists:info/preview" />
     <p class="discreet details">
-        <b i18n:translate="file_preview_date_created">Date Created</b>: <span tal:replace="props/dateCreated" />
-            <span tal:condition="not:props/dateCreated">n/a</span>
-        <br/>
         <b i18n:translate="file_preview_date_modified">Date Modified</b>: <span tal:replace="props/dateModified" />
             <span tal:condition="not:props/dateModified">n/a</span>
         <br/>


